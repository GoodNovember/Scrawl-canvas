<!DOCTYPE html>

<html>
<head>
  <title>Stack factory</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../core/animationloop.html">
                  ./source/core/animationloop.js
                </a>
              
                
                <a class="source" href="../core/component.html">
                  ./source/core/component.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/events.html">
                  ./source/core/events.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/userInteraction.html">
                  ./source/core/userInteraction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="bezier.html">
                  ./source/factory/bezier.js
                </a>
              
                
                <a class="source" href="block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="emitter.html">
                  ./source/factory/emitter.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="fontAttributes.html">
                  ./source/factory/fontAttributes.js
                </a>
              
                
                <a class="source" href="gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="imageAsset.html">
                  ./source/factory/imageAsset.js
                </a>
              
                
                <a class="source" href="line.html">
                  ./source/factory/line.js
                </a>
              
                
                <a class="source" href="loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="net.html">
                  ./source/factory/net.js
                </a>
              
                
                <a class="source" href="oval.html">
                  ./source/factory/oval.js
                </a>
              
                
                <a class="source" href="palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="particle.html">
                  ./source/factory/particle.js
                </a>
              
                
                <a class="source" href="particleForce.html">
                  ./source/factory/particleForce.js
                </a>
              
                
                <a class="source" href="particleHistory.html">
                  ./source/factory/particleHistory.js
                </a>
              
                
                <a class="source" href="particleSpring.html">
                  ./source/factory/particleSpring.js
                </a>
              
                
                <a class="source" href="particleWorld.html">
                  ./source/factory/particleWorld.js
                </a>
              
                
                <a class="source" href="pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="polygon.html">
                  ./source/factory/polygon.js
                </a>
              
                
                <a class="source" href="polyline.html">
                  ./source/factory/polyline.js
                </a>
              
                
                <a class="source" href="quadratic.html">
                  ./source/factory/quadratic.js
                </a>
              
                
                <a class="source" href="quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="radialGradient.html">
                  ./source/factory/radialGradient.js
                </a>
              
                
                <a class="source" href="rectangle.html">
                  ./source/factory/rectangle.js
                </a>
              
                
                <a class="source" href="renderAnimation.html">
                  ./source/factory/renderAnimation.js
                </a>
              
                
                <a class="source" href="shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="spiral.html">
                  ./source/factory/spiral.js
                </a>
              
                
                <a class="source" href="spriteAsset.html">
                  ./source/factory/spriteAsset.js
                </a>
              
                
                <a class="source" href="stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="star.html">
                  ./source/factory/star.js
                </a>
              
                
                <a class="source" href="state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="tetragon.html">
                  ./source/factory/tetragon.js
                </a>
              
                
                <a class="source" href="ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="tracer.html">
                  ./source/factory/tracer.js
                </a>
              
                
                <a class="source" href="tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="unstackedElement.html">
                  ./source/factory/unstackedElement.js
                </a>
              
                
                <a class="source" href="vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="videoAsset.html">
                  ./source/factory/videoAsset.js
                </a>
              
                
                <a class="source" href="wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="../mixin/anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="../mixin/asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="../mixin/assetConsumer.html">
                  ./source/mixin/assetConsumer.js
                </a>
              
                
                <a class="source" href="../mixin/base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="../mixin/cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="../mixin/delta.html">
                  ./source/mixin/delta.js
                </a>
              
                
                <a class="source" href="../mixin/displayShape.html">
                  ./source/mixin/displayShape.js
                </a>
              
                
                <a class="source" href="../mixin/dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="../mixin/entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="../mixin/filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="../mixin/mimic.html">
                  ./source/mixin/mimic.js
                </a>
              
                
                <a class="source" href="../mixin/path.html">
                  ./source/mixin/path.js
                </a>
              
                
                <a class="source" href="../mixin/pattern.html">
                  ./source/mixin/pattern.js
                </a>
              
                
                <a class="source" href="../mixin/pivot.html">
                  ./source/mixin/pivot.js
                </a>
              
                
                <a class="source" href="../mixin/position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="../mixin/shapeBasic.html">
                  ./source/mixin/shapeBasic.js
                </a>
              
                
                <a class="source" href="../mixin/shapeCurve.html">
                  ./source/mixin/shapeCurve.js
                </a>
              
                
                <a class="source" href="../mixin/shapePathCalculation.html">
                  ./source/mixin/shapePathCalculation.js
                </a>
              
                
                <a class="source" href="../mixin/styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="../mixin/tween.html">
                  ./source/mixin/tween.js
                </a>
              
                
                <a class="source" href="../worker/filter-stringed.html">
                  ./source/worker/filter-stringed.js
                </a>
              
                
                <a class="source" href="../worker/filter.html">
                  ./source/worker/filter.js
                </a>
              
                
                <a class="source" href="../worker/filter_canvas.html">
                  ./source/worker/filter_canvas.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="stack-factory">Stack factory</h1>
<p>The Scrawl-canvas Stack/Element system is an attempt to supplement DOM elements with Scrawl-canvas entity positioning and dimensioning functionality.</p>
<ul>
<li>Entitys exist in a Cell environment</li>
<li>They can position themselves within that Cell either <strong>absolutely</strong> (px coordinates), or <strong>relatively</strong> (% coordinates, with values relative to the Cell’s dimensions), or <strong>by reference</strong> (using other entity’s coordinates to calculate their own coordinates - <code>pivot</code>, <code>mimic</code>, <code>path</code>)</li>
<li>They can also base their dimensions on absolute (px) or relative (%) values</li>
<li>They can be <strong>animated</strong> directly (<code>set</code>, <code>deltaSet</code>), or through automation (<code>delta</code> object), or through the Scrawl-canvas <code>tween</code> functionality</li>
<li>They can be stored and retrieved (‘packet’ functionality), cloned (‘clone’, based on packets) and killed (‘kill’ functions)</li>
</ul>
<p><strong>A Stack is a wrapper object around a DOM element</strong>, whose direct children are given Scrawl-canvas Element wrappers:</p>
<pre><code>Stack    ~~&gt; Canvas/Cell  
Element  ~~&gt; Entity (eg Block)  </code></pre>
<p>During initialization Scrawl-canvas will search the DOM tree and automatically create Stack wrappers for any element which has been given a <code>data-stack</code> attribute which resolves to true. Every direct (first level) child inside the stack element will have Element wrappers created for them (except for &lt;canvas&gt; elements). As part of this work, Scrawl-canvas will modify the affected elements’ <code>position</code> CSS style:</p>
<ul>
<li>Stack elements have <code>relative</code> positioning within the DOM</li>
<li>Element elements have <code>absolute</code> positioning within the Stack</li>
</ul>
<p>The Stack factory is not used directly; the factory is not exported as part of the <strong>scrawl object</strong> during Scrawl-canvas initialization. Instead, wrappers can be created for a DOM-based &lt;div&gt; element using the following scrawl function:</p>
<ul>
<li><code>scrawl.addStack</code> - generates a new &lt;div&gt; element, creates a wrapper for it, then adds it to the DOM.</li>
</ul>
<p>Stack wrapper objects use the <strong>base</strong>, <strong>position</strong>, <strong>anchor</strong>, <strong>cascade</strong> and <strong>dom</strong> mixins. Thus Stack wrappers are also <strong>artefact</strong> objects: if a Stack’s DOM element is a direct child of another Stack wrapper’s element then it can be positioned, dimensioned and rotated like any other artefact.</p>
<p>By default, all Stack wrappers will track mouse/touch movements across their DOM element, supplying this data to constituent Canvas objects and artefacts as-and-when-required.</p>
<p>Stack wrappers are used by Scrawl-canvas to invoke the <strong>Display cycle cascade</strong>. As such, they include <code>clear</code>, <code>compile</code>, <code>show</code> and <code>render</code> functions to manage the Display cycle. These functions are asynchronous, returning Promises.</p>
<p>Stack wrappers are excluded from the Scrawl-canvas packet system; they cannot be saved or cloned. Killing a Stack wrapper will remove its DOM element from the document - <strong>including all Elements and Canvases that it contains</strong>.</p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h4 id="demos">Demos:</h4>
<ul>
<li>All stack demos include Stack wrapper functionality - most of which happens behind the scenes and does not need to be directly coded. </li>
<li><a href="../../demo/dom-001.html">DOM-001</a> - Loading the scrawl-canvas library using a script tag in the HTML code</li>
<li><a href="../../demo/dom-003.html">DOM-003</a> - Dynamically create and clone Element artefacts; drag and drop elements (including SVG elements) around a Stack</li>
<li><a href="../../demo/dom-010.html">DOM-010</a> - Add and remove (kill) Scrawl-canvas Stack elements programmatically</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h4 id="imports">Imports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { <span class="hljs-title">constructors</span>, <span class="hljs-title">group</span>, <span class="hljs-title">stack</span>, <span class="hljs-title">element</span>, <span class="hljs-title">artefact</span>, <span class="hljs-title">canvas</span> } <span class="hljs-title">from</span> &#x27;../<span class="hljs-title">core</span>/<span class="hljs-title">library</span>.<span class="hljs-title">js</span>&#x27;;
<span class="hljs-keyword">import</span> { mergeOver, pushUnique, isa_dom, removeItem, xt, addStrings, λ<span class="hljs-built_in">this</span>, λ<span class="hljs-literal">null</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/utilities.js&#x27;</span>;
<span class="hljs-keyword">import</span> { rootElements, setRootElementsSort, domShow } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/document.js&#x27;</span>;
<span class="hljs-keyword">import</span> { uiSubscribedElements, currentCorePosition } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/userInteraction.js&#x27;</span>;

<span class="hljs-keyword">import</span> { makeGroup } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./group.js&#x27;</span>;
<span class="hljs-keyword">import</span> { makeElement } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./element.js&#x27;</span>;
<span class="hljs-keyword">import</span> { makeCoordinate } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./coordinate.js&#x27;</span>;

<span class="hljs-keyword">import</span> baseMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/base.js&#x27;</span>;
<span class="hljs-keyword">import</span> cascadeMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/cascade.js&#x27;</span>;
<span class="hljs-keyword">import</span> domMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/dom.js&#x27;</span>;
<span class="hljs-keyword">import</span> displayMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/displayShape.js&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h4 id="stack-constructor">Stack constructor</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Stack = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">let</span> g, el;

    <span class="hljs-built_in">this</span>.makeName(items.name);
    <span class="hljs-built_in">this</span>.register();
    <span class="hljs-built_in">this</span>.initializePositions();
    <span class="hljs-built_in">this</span>.initializeCascade();

    <span class="hljs-built_in">this</span>.dimensions[<span class="hljs-number">0</span>] = <span class="hljs-number">300</span>;
    <span class="hljs-built_in">this</span>.dimensions[<span class="hljs-number">1</span>] = <span class="hljs-number">150</span>;

    <span class="hljs-built_in">this</span>.pathCorners = [];
    <span class="hljs-built_in">this</span>.css = {};
    <span class="hljs-built_in">this</span>.here = {};
    <span class="hljs-built_in">this</span>.perspective = {

        <span class="hljs-attr">x</span>: <span class="hljs-string">&#x27;50%&#x27;</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-string">&#x27;50%&#x27;</span>,
        <span class="hljs-attr">z</span>: <span class="hljs-number">0</span>
    };
    <span class="hljs-built_in">this</span>.dirtyPerspective = <span class="hljs-literal">true</span>;

    <span class="hljs-built_in">this</span>.initializeDomLayout(items);

    g = makeGroup({
        <span class="hljs-attr">name</span>: <span class="hljs-built_in">this</span>.name,
        <span class="hljs-attr">host</span>: <span class="hljs-built_in">this</span>.name
    });
    <span class="hljs-built_in">this</span>.addGroups(g.name);

    <span class="hljs-built_in">this</span>.set(<span class="hljs-built_in">this</span>.defs);
    <span class="hljs-built_in">this</span>.initializeDisplayShapeActions();
    <span class="hljs-built_in">this</span>.set(items);

    el = <span class="hljs-built_in">this</span>.domElement;

    <span class="hljs-keyword">if</span> (el) {

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.trackHere) pushUnique(uiSubscribedElements, <span class="hljs-built_in">this</span>.name);

        <span class="hljs-keyword">if</span> (el.getAttribute(<span class="hljs-string">&#x27;data-group&#x27;</span>) === <span class="hljs-string">&#x27;root&#x27;</span>) {

            pushUnique(rootElements, <span class="hljs-built_in">this</span>.name);
            setRootElementsSort();
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h4 id="stack-prototype">Stack prototype</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> P = Stack.prototype = <span class="hljs-built_in">Object</span>.create(<span class="hljs-built_in">Object</span>.prototype);
P.type = <span class="hljs-string">&#x27;Stack&#x27;</span>;
P.lib = <span class="hljs-string">&#x27;stack&#x27;</span>;
P.isArtefact = <span class="hljs-literal">true</span>;
P.isAsset = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h4 id="mixins">Mixins</h4>
<ul>
<li><a href="../mixin/base.html">base</a></li>
<li><a href="../mixin/cascade.html">cascade</a></li>
<li><a href="../mixin/dom.html">dom</a></li>
<li><a href="../mixin/displayShape.html">display</a></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P = baseMix(P);
P = cascadeMix(P);
P = domMix(P);
P = displayMix(P);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h4 id="stack-attributes">Stack attributes</h4>
<ul>
<li>Attributes defined in the <a href="../mixin/base.html">base mixin</a>: <strong>name</strong>.</li>
<li>Attributes defined in the <a href="../mixin/position.html">position mixin</a>: <strong>group, visibility, order, start, <em>startX</em>, <em>startY</em>, handle, <em>handleX</em>, <em>handleY</em>, offset, <em>offsetX</em>, <em>offsetY</em>, dimensions, <em>width</em>, <em>height</em>, pivoted, mimicked, lockTo, <em>lockXTo</em>, <em>lockYTo</em>, scale, roll, noUserInteraction, noPositionDependencies, noCanvasEngineUpdates, noFilters, noPathUpdates, purge, bringToFrontOnDrag</strong>.</li>
<li>Attributes defined in the <a href="../mixin/delta.html">delta mixin</a>: <strong>delta, noDeltaUpdates</strong>.</li>
<li>Attributes defined in the <a href="../mixin/pivot.html">pivot mixin</a>: <strong>pivot, pivotCorner, addPivotHandle, addPivotOffset, addPivotRotation</strong>.</li>
<li>Attributes defined in the <a href="../mixin/mimic.html">mimic mixin</a>: <strong>mimic, useMimicDimensions, useMimicScale, useMimicStart, useMimicHandle, useMimicOffset, useMimicRotation, useMimicFlip, addOwnDimensionsToMimic, addOwnScaleToMimic, addOwnStartToMimic, addOwnHandleToMimic, addOwnOffsetToMimic, addOwnRotationToMimic</strong>.</li>
<li>Attributes defined in the <a href="../mixin/path.html">path mixin</a>: <strong>path, pathPosition, addPathHandle, addPathOffset, addPathRotation, constantPathSpeed</strong>.</li>
<li>Attributes defined in the <a href="../mixin/anchor.html">anchor mixin</a>: <strong>anchor</strong>.</li>
<li>Attributes defined in the <a href="../mixin/cascade.html">cascade mixin</a>: <strong>groups</strong>.</li>
<li>Attributes defined in the <a href="../mixin/dom.html">dom mixin</a>: <strong>domElement, pitch, yaw, offsetZ, css, classes, position, actionResize, trackHere, domAttributes</strong>.</li>
<li>Attributes defined in the <a href="../mixin/displayShape.html">display mixin</a>: <strong>breakToBanner, breakToLandscape, breakToPortrait, breakToSkyscraper, actionBannerShape, actionLandscapeShape, actionRectangleShape, actionPortraitShape, actionSkyscraperShape</strong>.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> defaultAttributes = {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><strong>position</strong>, <strong>perspective</strong> - while most of the Stack wrapper’s DOM element’s attributes are handled through CSS, Scrawl-canvas takes control of some positioning-related attributes. Most of these are defined in the <a href="../mixin/dom.html">dom mixin</a> - but the position and perspective attributes are managed in this module</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    position: <span class="hljs-string">&#x27;relative&#x27;</span>,
    <span class="hljs-attr">perspective</span>: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p><strong>trackHere</strong> - Boolean flag to indicate whether the Stack object should participate in the Scrawl-canvas mouse/touch tracking functionality; the functionality can be switched off by setting the flag to false (via <code>set</code>).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    trackHere: <span class="hljs-literal">true</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>TODO: This is all about a mad idea we may have for making stacks ‘responsive’ to viewport changes. It needs a lot more thinking through. Search on ‘isResponsive’ to find the relevant function below</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    isResponsive: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">containElementsInHeight</span>: <span class="hljs-literal">false</span>,
};
P.defs = mergeOver(P.defs, defaultAttributes);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h4 id="packetclone-management">Packet/Clone management</h4>
<p>This functionality is disabled for Stack objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.stringifyFunction = λ<span class="hljs-literal">null</span>;
P.processPacketOut = λ<span class="hljs-literal">null</span>;
P.finalizePacketOut = λ<span class="hljs-literal">null</span>;
P.saveAsPacket = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-string">`[<span class="hljs-subst">${<span class="hljs-built_in">this</span>.name}</span>, <span class="hljs-subst">${<span class="hljs-built_in">this</span>.type}</span>, <span class="hljs-subst">${<span class="hljs-built_in">this</span>.lib}</span>, {}]`</span>
};
P.clone = λ<span class="hljs-built_in">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h4 id="kill-functionality">Kill functionality</h4>
<p>P.kill = function () {</p>

            </div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <pre><code><span class="hljs-keyword">let</span> myname = <span class="hljs-built_in">this</span>.name;</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <pre><code><span class="hljs-comment">// rootElements and uiSubscribedElements arrays</span>
removeItem(rootElements, myname);
setRootElementsSort();</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <pre><code>removeItem(uiSubscribedElements, myname);</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <pre><code><span class="hljs-comment">// Groups</span>
<span class="hljs-keyword">if</span> (group[myname]) group[myname].kill();</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <pre><code><span class="hljs-built_in">Object</span>.entries(artefact).forEach(<span class="hljs-function">(<span class="hljs-params">[name, art]</span>) =&gt;</span> {</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <pre><code>    <span class="hljs-keyword">if</span> (art.host === myname) art.kill();
});</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <pre><code><span class="hljs-comment">// DOM removals</span>
<span class="hljs-built_in">this</span>.domElement.remove();</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <pre><code><span class="hljs-comment">// Scrawl-canvas library</span>
<span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.deregister();</code></pre>
<p>}</p>
<h4 id="kill-functionality">Kill functionality</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.factoryKill = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> myname = <span class="hljs-built_in">this</span>.name;</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>rootElements and uiSubscribedElements arrays</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    removeItem(rootElements, myname);
    setRootElementsSort();

    removeItem(uiSubscribedElements, myname);</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Groups</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (group[myname]) group[myname].kill();

    <span class="hljs-built_in">Object</span>.entries(artefact).forEach(<span class="hljs-function">(<span class="hljs-params">[name, art]</span>) =&gt;</span> {

        <span class="hljs-keyword">if</span> (art.host === myname) art.kill();
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>DOM removals</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">this</span>.domElement.remove();
}</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <h4 id="get-set-deltaset">Get, Set, deltaSet</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> G = P.getters,
    S = P.setters,
    D = P.deltaSetters;</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Similar to start, handle, dimensions, etc Scrawl-canvas supplies some pseudo-attributes to help set and manage the Stack wrapper’s <code>perspective</code> object:</p>
<ul>
<li><code>perspectiveX</code></li>
<li><code>perspectiveY</code></li>
<li><code>perspectiveZ</code></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>G.perspectiveX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.perspective.x;
};
G.perspectiveY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.perspective.y;
};
G.perspectiveZ = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.perspective.z;
};

S.perspectiveX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.perspective.x = item;
    <span class="hljs-built_in">this</span>.dirtyPerspective = <span class="hljs-literal">true</span>;
};
S.perspectiveY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.perspective.y = item;
    <span class="hljs-built_in">this</span>.dirtyPerspective = <span class="hljs-literal">true</span>;
};
S.perspectiveZ = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.perspective.z = item;
    <span class="hljs-built_in">this</span>.dirtyPerspective = <span class="hljs-literal">true</span>;
};
S.perspective = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item = {}</span>) </span>{

    <span class="hljs-built_in">this</span>.perspective.x = (xt(item.x)) ? item.x : <span class="hljs-built_in">this</span>.perspective.x;
    <span class="hljs-built_in">this</span>.perspective.y = (xt(item.y)) ? item.y : <span class="hljs-built_in">this</span>.perspective.y;
    <span class="hljs-built_in">this</span>.perspective.z = (xt(item.z)) ? item.z : <span class="hljs-built_in">this</span>.perspective.z;
    <span class="hljs-built_in">this</span>.dirtyPerspective = <span class="hljs-literal">true</span>;
};
D.perspectiveX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.perspective.x = addStrings(<span class="hljs-built_in">this</span>.perspective.x, item);
    <span class="hljs-built_in">this</span>.dirtyPerspective = <span class="hljs-literal">true</span>;
};
D.perspectiveY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.perspective.y = addStrings(<span class="hljs-built_in">this</span>.perspective.y, item);
    <span class="hljs-built_in">this</span>.dirtyPerspective = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h4 id="prototype-functions">Prototype functions</h4>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p><code>updateArtefacts</code> - internal function. Iterate through all Element and Canvas wrappers associated with the Stack wrapper’s Group object and set a range of dirty flags on them, for future processing by each as appropriate.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.updateArtefacts = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-built_in">this</span>.groupBuckets.forEach(<span class="hljs-function"><span class="hljs-params">grp</span> =&gt;</span> {

        grp.artefactBuckets.forEach(<span class="hljs-function"><span class="hljs-params">art</span> =&gt;</span> {

            <span class="hljs-keyword">if</span> (items.dirtyScale) art.dirtyScale = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyDimensions) art.dirtyDimensions = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyLock) art.dirtyLock = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyStart) art.dirtyStart = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyOffset) art.dirtyOffset = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyHandle) art.dirtyHandle = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyRotation) art.dirtyRotation = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyPathObject) art.dirtyPathObject = <span class="hljs-literal">true</span>;
        })
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p><code>cleanDimensionsAdditionalActions</code> - overwrites mixin/position function. Promulgates Stack dimension changes through to all Element and Canvas wrappers associated with the Stack wrapper’s Group object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cleanDimensionsAdditionalActions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.groupBuckets) {

        <span class="hljs-built_in">this</span>.updateArtefacts({
            <span class="hljs-attr">dirtyDimensions</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">dirtyPath</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">dirtyStart</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">dirtyHandle</span>: <span class="hljs-literal">true</span>,
        });
    }

    <span class="hljs-built_in">this</span>.dirtyDomDimensions = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">this</span>.dirtyPath = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">this</span>.dirtyStart = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">this</span>.dirtyDisplayShape = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">this</span>.dirtyDisplayArea = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p><code>cleanPerspective</code> - internal function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cleanPerspective = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-built_in">this</span>.dirtyPerspective = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">let</span> p = <span class="hljs-built_in">this</span>.perspective;

    <span class="hljs-built_in">this</span>.domPerspectiveString = <span class="hljs-string">`perspective-origin: <span class="hljs-subst">${p.x}</span> <span class="hljs-subst">${p.y}</span>; perspective: <span class="hljs-subst">${p.z}</span>px;`</span>;
    <span class="hljs-built_in">this</span>.domShowRequired = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.groupBuckets) {

        <span class="hljs-built_in">this</span>.updateArtefacts({
            <span class="hljs-attr">dirtyHandle</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">dirtyPathObject</span>: <span class="hljs-literal">true</span>,
        });
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>TODO - experimental! <code>checkResponsive</code></p>
<p>Scrawl-canvas Stack artefacts - at the <strong>root</strong> level - cannot have ‘String%’ dimensions, which means they have absolute dimensions - because everything that relies on ‘String%’ dimensions needs an absolute (number) value for their calculations at the root, which is the stack. </p>
<p>But we still need to make Stacks responsive. We do this by checking if the viewport dimensions have changed (a resize action has taken place) and - if yes - update the stack’s absolute dimensions accordingly … if the <strong>isResponsive</strong> flag has been set to true for the Stack (default is ‘false’ - may change this in due course).</p>
<p>We call this check in the <strong>clear</strong> function below, because it’s doing nothing else useful at the moment and it makes sense to get updates in place here before everything launches into the compile part of the display cycle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.checkResponsive = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.isResponsive &amp;&amp; <span class="hljs-built_in">this</span>.trackHere) {</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Start keeping track of the viewport dimensions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.currentVportWidth) <span class="hljs-built_in">this</span>.currentVportWidth = currentCorePosition.w;
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.currentVportHeight) <span class="hljs-built_in">this</span>.currentVportHeight = currentCorePosition.h;</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>If last display cycle responded to dimension changes, need to finalise height now</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyHeight &amp;&amp; <span class="hljs-built_in">this</span>.containElementsInHeight) {

            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;stack height final fixes need to be done&#x27;</span>);
            <span class="hljs-built_in">this</span>.dirtyHeight = <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.currentVportWidth !== currentCorePosition.w) {

            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;need to update for resized viewport width&#x27;</span>);
            <span class="hljs-built_in">this</span>.currentVportWidth = currentCorePosition.w;

            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.containElementsInHeight) {</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Won’t be updated until the next display cycle, but flag it now for action</p>
<ul>
<li>needed because text in elements flow as part of normal DOM operations</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-built_in">this</span>.dirtyHeight = <span class="hljs-literal">true</span>;
            }
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.currentVportHeight !== currentCorePosition.h) {

            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;need to update for resized viewport height&#x27;</span>);
            <span class="hljs-built_in">this</span>.currentVportHeight = currentCorePosition.h;
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <h5 id="display-cycle-functions">Display cycle functions</h5>

            </div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p><code>clear</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.clear = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-built_in">this</span>.checkResponsive();

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-literal">true</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p><code>compile</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.compile = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> self = <span class="hljs-built_in">this</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {

        self.sortGroups();

        self.prepareStamp()

        self.stamp()
        .then(<span class="hljs-function">() =&gt;</span> {

            <span class="hljs-keyword">let</span> promises = [];

            self.groupBuckets.forEach(<span class="hljs-function"><span class="hljs-params">mygroup</span> =&gt;</span> promises.push(mygroup.stamp()));

            <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.all(promises);
        })
        .then(<span class="hljs-function">() =&gt;</span> resolve(<span class="hljs-literal">true</span>))
        .catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> reject(<span class="hljs-literal">false</span>));
    })
};</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p><code>show</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.show = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {

        domShow();
        resolve(<span class="hljs-literal">true</span>);
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p><code>render</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.render = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> self = <span class="hljs-built_in">this</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {

        self.compile()
        .then(<span class="hljs-function">() =&gt;</span> self.show())
        .then(<span class="hljs-function">() =&gt;</span> resolve(<span class="hljs-literal">true</span>))
        .catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> reject(<span class="hljs-literal">false</span>));
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p><code>addExistingDomElements</code> - argument is a CSS query search String. All elements in the DOM matching the search will be <strong>moved</strong> into the Stack wrapper’s DOM element and given Scrawl-canvas Element wrappers. While Scrawl-canvas will try its best to respect the elements’ CSS attributes, they will be <strong>positioned absolutely</strong> within the Stack and given start, handle and offset values of <code>[0, 0]</code>. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.addExistingDomElements = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">search</span>) </span>{

    <span class="hljs-keyword">let</span> elements, el, captured, i, iz;

    <span class="hljs-keyword">if</span> (xt(search)) {

        elements = (search.substring) ? <span class="hljs-built_in">document</span>.querySelectorAll(search) : [].concat(search);

        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = elements.length; i &lt; iz; i++) {

            el = elements[i];
            
            <span class="hljs-keyword">if</span> (isa_dom(el)) {

                captured = makeElement({
                    <span class="hljs-attr">name</span>: el.id || el.name,
                    <span class="hljs-attr">domElement</span>: el,
                    <span class="hljs-attr">group</span>: <span class="hljs-built_in">this</span>.name,
                    <span class="hljs-attr">host</span>: <span class="hljs-built_in">this</span>.name,
                    <span class="hljs-attr">position</span>: <span class="hljs-string">&#x27;absolute&#x27;</span>,
                    <span class="hljs-attr">setInitialDimensions</span>: <span class="hljs-literal">true</span>,
                });

                <span class="hljs-keyword">if</span> (captured &amp;&amp; captured.domElement) <span class="hljs-built_in">this</span>.domElement.appendChild(captured.domElement);
            }
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p><code>addNewElement</code> - takes an ‘items’ object as an argument. The only required attribute of the argument is <strong>tag</strong>, which determines the type of element that will be created (for example - setting tag to ‘div’ will create a new &lt;div&gt; element)</p>
<ul>
<li>Any other Element artefact attribute can also be included in the argument object, including <strong>text</strong> and <strong>content</strong> attributes to set the new DOM Element’s textContent and innerHTML attributes.</li>
<li>If position and dimension values are not included in the argument, the element will be given default values of [0,0] for start, offset and handle; and dimensions of 100px width and height.</li>
<li>The new element will also default to a CSS box-sizing style value of ‘border-box’, unless the argument’s <strong>boxSizing</strong> attribute has been set to ‘content-box’ - this will override any ‘borderBox’ attribute value in the argument’s <strong>.css</strong> object (if one has been included)</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.addNewElement = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">if</span> (items.tag) {

        items.domElement = <span class="hljs-built_in">document</span>.createElement(items.tag);
        items.domElement.setAttribute(<span class="hljs-string">&#x27;data-group&#x27;</span>, <span class="hljs-built_in">this</span>.name);
        <span class="hljs-keyword">if</span> (!xt(items.group)) items.group = <span class="hljs-built_in">this</span>.name;
        items.host = <span class="hljs-built_in">this</span>.name;

        <span class="hljs-keyword">if</span> (!items.position) items.position = <span class="hljs-string">&#x27;absolute&#x27;</span>;
        <span class="hljs-keyword">if</span> (!xt(items.width)) items.width = <span class="hljs-number">100</span>;
        <span class="hljs-keyword">if</span> (!xt(items.height)) items.height = <span class="hljs-number">100</span>;

        <span class="hljs-keyword">let</span> myElement = makeElement(items);

        <span class="hljs-keyword">if</span> (myElement &amp;&amp; myElement.domElement) {

            <span class="hljs-keyword">if</span> (!xt(items.boxSizing)) myElement.domElement.style.boxSizing = <span class="hljs-string">&#x27;border-box&#x27;</span>;

            <span class="hljs-built_in">this</span>.domElement.appendChild(myElement.domElement);
        }

        <span class="hljs-keyword">return</span> myElement;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <h4 id="factory">Factory</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> makeStack = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Stack(items);
};

<span class="hljs-title">constructors</span>.<span class="hljs-title">Stack</span> = <span class="hljs-title">Stack</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <h4 id="exports">Exports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> {
    makeStack,
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
