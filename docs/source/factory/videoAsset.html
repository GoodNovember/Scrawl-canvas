<!DOCTYPE html>

<html>
<head>
  <title>VideoAsset factory</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../core/animationloop.html">
                  ./source/core/animationloop.js
                </a>
              
                
                <a class="source" href="../core/component.html">
                  ./source/core/component.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/events.html">
                  ./source/core/events.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/userInteraction.html">
                  ./source/core/userInteraction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="bezier.html">
                  ./source/factory/bezier.js
                </a>
              
                
                <a class="source" href="block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="emitter.html">
                  ./source/factory/emitter.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="fontAttributes.html">
                  ./source/factory/fontAttributes.js
                </a>
              
                
                <a class="source" href="gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="imageAsset.html">
                  ./source/factory/imageAsset.js
                </a>
              
                
                <a class="source" href="line.html">
                  ./source/factory/line.js
                </a>
              
                
                <a class="source" href="loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="net.html">
                  ./source/factory/net.js
                </a>
              
                
                <a class="source" href="oval.html">
                  ./source/factory/oval.js
                </a>
              
                
                <a class="source" href="palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="particle.html">
                  ./source/factory/particle.js
                </a>
              
                
                <a class="source" href="particleForce.html">
                  ./source/factory/particleForce.js
                </a>
              
                
                <a class="source" href="particleHistory.html">
                  ./source/factory/particleHistory.js
                </a>
              
                
                <a class="source" href="particleSpring.html">
                  ./source/factory/particleSpring.js
                </a>
              
                
                <a class="source" href="particleWorld.html">
                  ./source/factory/particleWorld.js
                </a>
              
                
                <a class="source" href="pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="polygon.html">
                  ./source/factory/polygon.js
                </a>
              
                
                <a class="source" href="polyline.html">
                  ./source/factory/polyline.js
                </a>
              
                
                <a class="source" href="quadratic.html">
                  ./source/factory/quadratic.js
                </a>
              
                
                <a class="source" href="quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="radialGradient.html">
                  ./source/factory/radialGradient.js
                </a>
              
                
                <a class="source" href="rectangle.html">
                  ./source/factory/rectangle.js
                </a>
              
                
                <a class="source" href="renderAnimation.html">
                  ./source/factory/renderAnimation.js
                </a>
              
                
                <a class="source" href="shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="spiral.html">
                  ./source/factory/spiral.js
                </a>
              
                
                <a class="source" href="spriteAsset.html">
                  ./source/factory/spriteAsset.js
                </a>
              
                
                <a class="source" href="stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="star.html">
                  ./source/factory/star.js
                </a>
              
                
                <a class="source" href="state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="tetragon.html">
                  ./source/factory/tetragon.js
                </a>
              
                
                <a class="source" href="ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="tracer.html">
                  ./source/factory/tracer.js
                </a>
              
                
                <a class="source" href="tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="unstackedElement.html">
                  ./source/factory/unstackedElement.js
                </a>
              
                
                <a class="source" href="vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="videoAsset.html">
                  ./source/factory/videoAsset.js
                </a>
              
                
                <a class="source" href="wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="../mixin/anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="../mixin/asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="../mixin/assetConsumer.html">
                  ./source/mixin/assetConsumer.js
                </a>
              
                
                <a class="source" href="../mixin/base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="../mixin/cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="../mixin/delta.html">
                  ./source/mixin/delta.js
                </a>
              
                
                <a class="source" href="../mixin/displayShape.html">
                  ./source/mixin/displayShape.js
                </a>
              
                
                <a class="source" href="../mixin/dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="../mixin/entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="../mixin/filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="../mixin/mimic.html">
                  ./source/mixin/mimic.js
                </a>
              
                
                <a class="source" href="../mixin/path.html">
                  ./source/mixin/path.js
                </a>
              
                
                <a class="source" href="../mixin/pattern.html">
                  ./source/mixin/pattern.js
                </a>
              
                
                <a class="source" href="../mixin/pivot.html">
                  ./source/mixin/pivot.js
                </a>
              
                
                <a class="source" href="../mixin/position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="../mixin/shapeBasic.html">
                  ./source/mixin/shapeBasic.js
                </a>
              
                
                <a class="source" href="../mixin/shapeCurve.html">
                  ./source/mixin/shapeCurve.js
                </a>
              
                
                <a class="source" href="../mixin/shapePathCalculation.html">
                  ./source/mixin/shapePathCalculation.js
                </a>
              
                
                <a class="source" href="../mixin/styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="../mixin/tween.html">
                  ./source/mixin/tween.js
                </a>
              
                
                <a class="source" href="../worker/filter-stringed.html">
                  ./source/worker/filter-stringed.js
                </a>
              
                
                <a class="source" href="../worker/filter.html">
                  ./source/worker/filter.js
                </a>
              
                
                <a class="source" href="../worker/filter_canvas.html">
                  ./source/worker/filter_canvas.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="videoasset-factory">VideoAsset factory</h1>
<p>The factory generates wrapper Objects around &lt;video&gt; elements which can either be pulled from the current document (DOM-based assets) or fetched from the server using an URL address.</p>
<p>Scrawl-canvas can also create VideoAssets from the Web API <a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaStream">MediaStream</a> interface - <strong><em>this is an experimental feature</em></strong>.</p>
<p>VideoAssets are used by <a href="./picture.html">Picture</a> and <a href="./grid.html">Grid</a> entitys, and <a href="./pattern.html">Pattern</a> styles (though not recommended).</p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h4 id="demos">Demos:</h4>
<ul>
<li><a href="../../demo/canvas-010.html">Canvas-010</a> - Use video sources and media streams for Picture entitys</li>
<li><a href="../../demo/canvas-023.html">Canvas-023</a> - Grid entity - using picture-based assets (image, video, sprite)</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h4 id="imports">Imports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { <span class="hljs-title">constructors</span> } <span class="hljs-title">from</span> &#x27;../<span class="hljs-title">core</span>/<span class="hljs-title">library</span>.<span class="hljs-title">js</span>&#x27;;
<span class="hljs-keyword">import</span> { generateUniqueString, xt, λ<span class="hljs-built_in">this</span>, λ<span class="hljs-literal">null</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/utilities.js&#x27;</span>;

<span class="hljs-keyword">import</span> baseMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/base.js&#x27;</span>;
<span class="hljs-keyword">import</span> assetMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/asset.js&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h4 id="videoasset-constructor">VideoAsset constructor</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> VideoAsset = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.assetConstructor(items);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h4 id="videoasset-prototype">VideoAsset prototype</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> P = VideoAsset.prototype = <span class="hljs-built_in">Object</span>.create(<span class="hljs-built_in">Object</span>.prototype);
P.type = <span class="hljs-string">&#x27;Video&#x27;</span>;
P.lib = <span class="hljs-string">&#x27;asset&#x27;</span>;
P.isArtefact = <span class="hljs-literal">false</span>;
P.isAsset = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h4 id="mixins">Mixins</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P = baseMix(P);
P = assetMix(P);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h4 id="videoasset-attributes">VideoAsset attributes</h4>
<ul>
<li>Attributes defined in the <a href="../mixin/base.html">base mixin</a>: <strong>name</strong>.</li>
<li>Attributes defined in the <a href="../mixin/asset.html">asset mixin</a>: <strong>source, subscribers</strong>.</li>
</ul>
<p>No additional attributes required beyond those supplied by the mixins</p>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h4 id="packet-management">Packet management</h4>
<p>Assets do not take part in the packet or clone systems; they can, however, be used for importing and actioning packets as they retain those base functions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.saveAsPacket = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> [<span class="hljs-built_in">this</span>.name, <span class="hljs-built_in">this</span>.type, <span class="hljs-built_in">this</span>.lib, {}];
};
P.stringifyFunction = λ<span class="hljs-literal">null</span>;
P.processPacketOut = λ<span class="hljs-literal">null</span>;
P.finalizePacketOut = λ<span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h4 id="clone-management">Clone management</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.clone = λ<span class="hljs-built_in">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h4 id="kill-management">Kill management</h4>
<p>No additional kill functionality required</p>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h4 id="get-set-deltaset">Get, Set, deltaSet</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> G = P.getters,
    S = P.setters,
    D = P.deltaSetters;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><strong>source</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.source = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item = {}</span>) </span>{

    <span class="hljs-keyword">if</span> (item) {

        <span class="hljs-keyword">if</span> (item.tagName.toUpperCase() === <span class="hljs-string">&#x27;VIDEO&#x27;</span>) {

            <span class="hljs-built_in">this</span>.source = item;
            <span class="hljs-built_in">this</span>.sourceNaturalWidth = item.videoWidth || <span class="hljs-number">0</span>;
            <span class="hljs-built_in">this</span>.sourceNaturalHeight = item.videoHeight || <span class="hljs-number">0</span>;
            <span class="hljs-built_in">this</span>.sourceLoaded = (item.readyState &gt; <span class="hljs-number">2</span>) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.sourceLoaded) <span class="hljs-built_in">this</span>.notifySubscribers();
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h4 id="prototype-functions">Prototype functions</h4>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p><code>checkSource</code></p>
<ul>
<li>Gets invoked by subscribers (who have a handle to the asset instance object) as part of the display cycle.</li>
<li>If any of the source &lt;video&gt; element’s relevant attributes have changed, the asset wrapper will immediately notify/update ALL of its subscribers by changing attributes on their objects.</li>
<li>TODO: there may be a more efficient way of doing this? If the first subscriber triggers a notify action, which propagates to all subscribers, then subsequent subscribers don’t need to invoke this function for the remainder of this display cycle.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.checkSource = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">width, height</span>) </span>{

    <span class="hljs-keyword">let</span> source = <span class="hljs-built_in">this</span>.source;

    <span class="hljs-keyword">if</span> (source &amp;&amp; source.readyState &gt; <span class="hljs-number">2</span>) {

        <span class="hljs-built_in">this</span>.sourceLoaded = <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.sourceNaturalWidth !== source.videoWidth || 
                <span class="hljs-built_in">this</span>.sourceNaturalHeight !== source.videoHeight || 
                <span class="hljs-built_in">this</span>.sourceNaturalWidth !== width ||
                <span class="hljs-built_in">this</span>.sourceNaturalHeight !== height) {

            <span class="hljs-built_in">this</span>.sourceNaturalWidth = source.videoWidth;
            <span class="hljs-built_in">this</span>.sourceNaturalHeight = source.videoHeight;

            <span class="hljs-built_in">this</span>.notifySubscribers();
        }
    }
    <span class="hljs-keyword">else</span> <span class="hljs-built_in">this</span>.sourceLoaded = <span class="hljs-literal">false</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h4 id="managing-video-sources">Managing video sources</h4>
<p>The following functions invoke their <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement">namesake functions on the source &lt;video&gt; element</a>. </p>
<ul>
<li>Note that some of the functions are defined as being asynchronous; for these functions, we wrap the invocations in Promises which cascade back to the original invocation (probably in user code).</li>
<li>All of these functions are also mapped onto the factories which consume the videoAsset - Picture entitys and Pattern styles - so they can be invoked on those objects instead on the videoAsset instance.</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p><code>addTextTrack</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.addTextTrack = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">kind, label, language</span>) </span>{

    <span class="hljs-keyword">let</span> source = <span class="hljs-built_in">this</span>.source;

    <span class="hljs-keyword">if</span> (source &amp;&amp; source.addTextTrack) source.addTextTrack(kind, label, language);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p><code>captureStream</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.captureStream = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> source = <span class="hljs-built_in">this</span>.source;

    <span class="hljs-keyword">if</span> (source &amp;&amp; source.captureStream) <span class="hljs-keyword">return</span> source.captureStream();
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p><code>canPlayType</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.canPlayType = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">mytype</span>) </span>{

    <span class="hljs-keyword">let</span> source = <span class="hljs-built_in">this</span>.source;

    <span class="hljs-keyword">if</span> (source) <span class="hljs-keyword">return</span> source.canPlayType(mytype);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;maybe&#x27;</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p><code>fastSeek</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.fastSeek = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">time</span>) </span>{

    <span class="hljs-keyword">let</span> source = <span class="hljs-built_in">this</span>.source;

    <span class="hljs-keyword">if</span> (source &amp;&amp; source.fastSeek) source.fastSeek(time);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p><code>load</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.load = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> source = <span class="hljs-built_in">this</span>.source;

    <span class="hljs-keyword">if</span> (source) source.load();
};</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p><code>pause</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.pause = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> source = <span class="hljs-built_in">this</span>.source;

    <span class="hljs-keyword">if</span> (source) source.pause();
};</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p><code>play</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.play = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> source = <span class="hljs-built_in">this</span>.source;

    <span class="hljs-keyword">if</span> (source) <span class="hljs-keyword">return</span> source.play().catch(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> <span class="hljs-built_in">console</span>.log(e.code, e.name, e.message));
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.reject(<span class="hljs-string">&#x27;Source not defined&#x27;</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p><code>setMediaKeys</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.setMediaKeys = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">keys</span>) </span>{

    <span class="hljs-keyword">let</span> source = <span class="hljs-built_in">this</span>.source;

    <span class="hljs-keyword">if</span> (source) {

        <span class="hljs-keyword">if</span> (source.setMediaKeys) <span class="hljs-keyword">return</span> source.setMediaKeys(keys);
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.reject(<span class="hljs-string">&#x27;setMediaKeys not supported&#x27;</span>);
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.reject(<span class="hljs-string">&#x27;Source not defined&#x27;</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p><code>setSinkId</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.setSinkId = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> source = <span class="hljs-built_in">this</span>.source;

    <span class="hljs-keyword">if</span> (source) {

        <span class="hljs-keyword">if</span> (source.setSinkId) <span class="hljs-keyword">return</span> source.setSinkId();
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.reject(<span class="hljs-string">&#x27;setSinkId not supported&#x27;</span>);
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.reject(<span class="hljs-string">&#x27;Source not defined&#x27;</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p><code>gettableVideoAssetAtributes</code>, <code>settableVideoAssetAtributes</code> - exported Arrays.</p>
<ul>
<li>TODO - I was planning to make the &lt;video&gt; element’s attributes accessible to Picture entitys and Pattern styles - need to check if work has been completed at their end.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> gettableVideoAssetAtributes = [
    <span class="hljs-string">&#x27;video_audioTracks&#x27;</span>,
    <span class="hljs-string">&#x27;video_autoPlay&#x27;</span>,
    <span class="hljs-string">&#x27;video_buffered&#x27;</span>,
    <span class="hljs-string">&#x27;video_controller&#x27;</span>,
    <span class="hljs-string">&#x27;video_controls&#x27;</span>,
    <span class="hljs-string">&#x27;video_controlsList&#x27;</span>,
    <span class="hljs-string">&#x27;video_crossOrigin&#x27;</span>,
    <span class="hljs-string">&#x27;video_currentSrc&#x27;</span>,
    <span class="hljs-string">&#x27;video_currentTime&#x27;</span>,
    <span class="hljs-string">&#x27;video_defaultMuted&#x27;</span>,
    <span class="hljs-string">&#x27;video_defaultPlaybackRate&#x27;</span>,
    <span class="hljs-string">&#x27;video_disableRemotePlayback&#x27;</span>,
    <span class="hljs-string">&#x27;video_duration&#x27;</span>,
    <span class="hljs-string">&#x27;video_ended&#x27;</span>,
    <span class="hljs-string">&#x27;video_error&#x27;</span>,
    <span class="hljs-string">&#x27;video_loop&#x27;</span>,
    <span class="hljs-string">&#x27;video_mediaGroup&#x27;</span>,
    <span class="hljs-string">&#x27;video_mediaKeys&#x27;</span>,
    <span class="hljs-string">&#x27;video_muted&#x27;</span>,
    <span class="hljs-string">&#x27;video_networkState&#x27;</span>,
    <span class="hljs-string">&#x27;video_paused&#x27;</span>,
    <span class="hljs-string">&#x27;video_playbackRate&#x27;</span>,
    <span class="hljs-string">&#x27;video_readyState&#x27;</span>,
    <span class="hljs-string">&#x27;video_seekable&#x27;</span>,
    <span class="hljs-string">&#x27;video_seeking&#x27;</span>,
    <span class="hljs-string">&#x27;video_sinkId&#x27;</span>,
    <span class="hljs-string">&#x27;video_src&#x27;</span>,
    <span class="hljs-string">&#x27;video_srcObject&#x27;</span>,
    <span class="hljs-string">&#x27;video_textTracks&#x27;</span>,
    <span class="hljs-string">&#x27;video_videoTracks&#x27;</span>,
    <span class="hljs-string">&#x27;video_volume&#x27;</span>,
];

<span class="hljs-keyword">const</span> settableVideoAssetAtributes = [
    <span class="hljs-string">&#x27;video_autoPlay&#x27;</span>,
    <span class="hljs-string">&#x27;video_controller&#x27;</span>,
    <span class="hljs-string">&#x27;video_controls&#x27;</span>,
    <span class="hljs-string">&#x27;video_crossOrigin&#x27;</span>,
    <span class="hljs-string">&#x27;video_currentTime&#x27;</span>,
    <span class="hljs-string">&#x27;video_defaultMuted&#x27;</span>,
    <span class="hljs-string">&#x27;video_defaultPlaybackRate&#x27;</span>,
    <span class="hljs-string">&#x27;video_disableRemotePlayback&#x27;</span>,
    <span class="hljs-string">&#x27;video_loop&#x27;</span>,
    <span class="hljs-string">&#x27;video_mediaGroup&#x27;</span>,
    <span class="hljs-string">&#x27;video_muted&#x27;</span>,
    <span class="hljs-string">&#x27;video_playbackRate&#x27;</span>,
    <span class="hljs-string">&#x27;video_src&#x27;</span>,
    <span class="hljs-string">&#x27;video_srcObject&#x27;</span>,
    <span class="hljs-string">&#x27;video_volume&#x27;</span>,
];</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h4 id="import-videos">Import videos</h4>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p><code>importDomVideo</code> - import videos defined in the web page HTML code</p>
<ul>
<li>Required argument is a query string used to search the dom for matching elements</li>
<li>Scrawl-canvas does not remove &lt;video&gt; elements from the DOM.</li>
<li>If &lt;video&gt; elements should not appear, developers need to hide them in some way - for instance by positioning them (or their parent element) absolutely to the top or left of the display; or by giving their parent element zero width/height; or by setting their CSS: <code>display: none;</code>, <code>opacity: 0;</code>, etc.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> importDomVideo = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">query</span>) </span>{

    <span class="hljs-keyword">let</span> reg = <span class="hljs-regexp">/.*\/(.*?)\./</span>;

    <span class="hljs-keyword">let</span> items = <span class="hljs-built_in">document</span>.querySelectorAll(query);

    items.forEach(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {

        <span class="hljs-keyword">let</span> name;

        <span class="hljs-keyword">if</span> (item.tagName.toUpperCase() === <span class="hljs-string">&#x27;VIDEO&#x27;</span>) {

            <span class="hljs-keyword">if</span> (item.id || item.name) name = item.id || item.name;
            <span class="hljs-keyword">else</span> {

                <span class="hljs-keyword">let</span> match = reg.exec(item.src);
                name = (match &amp;&amp; match[<span class="hljs-number">1</span>]) ? match[<span class="hljs-number">1</span>] : <span class="hljs-string">&#x27;&#x27;</span>;
            }

            <span class="hljs-keyword">let</span> vid = makeVideoAsset({
                <span class="hljs-attr">name</span>: name,
                <span class="hljs-attr">source</span>: item,
            });

            <span class="hljs-keyword">if</span> (item.readyState &lt;= <span class="hljs-number">2</span>) {

                item.oncanplay = <span class="hljs-function">() =&gt;</span> {

                    vid.set({
                        <span class="hljs-attr">source</span>: item,
                    });
                };
            }
        }
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p><code>importMediaStream</code> - <strong>Warning: experimental!</strong></p>
<ul>
<li>This function will attempt to link a mediaStream - for instance from a device’s camera - to an offscreen &lt;video&gt; element, which then gets wrapped in a videoAsset instance which can be displayed in a canvas via a Picture entity (or even a Pattern style).</li>
<li>TODO - extend functionality so users can manipulate the mediaStream via the Picture entity using it as its asset</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> importMediaStream = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Setup the constraints object with user-supplied data in the items argument</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> constraints = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>For proof-of-concept, only interested in wheter to include or exclude audio in the capture</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    constraints.audio = (xt(items.audio)) ? items.audio : <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>For video, limiting functionality to accepting user values for video width and height (as minDIMENSION, maxDIMENSION and the ideal DIMENSION, and a preference for which camera to use - where applicable</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    constraints.video = {};
    
    <span class="hljs-keyword">let</span> width = constraints.video.width = {};
    <span class="hljs-keyword">if</span> (items.minWidth) width.min = items.minWidth;
    <span class="hljs-keyword">if</span> (items.maxWidth) width.max = items.maxWidth;
    width.ideal = (items.width) ? items.width : <span class="hljs-number">1280</span>;
    
    <span class="hljs-keyword">let</span> height = constraints.video.height = {};
    <span class="hljs-keyword">if</span> (items.minHeight) height.min = items.minHeight;
    <span class="hljs-keyword">if</span> (items.maxHeight) height.max = items.maxHeight;
    height.ideal = (items.height) ? items.height : <span class="hljs-number">720</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>For mobile devices etc - values can be ‘user’ or ‘environment’</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (items.facing) constraints.video.facingMode = items.facing;</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>We need a video element to receive the media stream</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> name = items.name || generateUniqueString();

    <span class="hljs-keyword">let</span> el = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&#x27;video&#x27;</span>);

    <span class="hljs-keyword">let</span> vid = makeVideoAsset({
        <span class="hljs-attr">name</span>: name,
        <span class="hljs-attr">source</span>: el,
    });

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {

        <span class="hljs-keyword">if</span> (navigator &amp;&amp; navigator.mediaDevices) {

            navigator.mediaDevices.getUserMedia(constraints)
            .then(<span class="hljs-function"><span class="hljs-params">mediaStream</span> =&gt;</span> {

                <span class="hljs-keyword">let</span> actuals = mediaStream.getVideoTracks(),
                    data;

                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(actuals) &amp;&amp; actuals[<span class="hljs-number">0</span>]) data = actuals[<span class="hljs-number">0</span>].getConstraints();

                el.id = vid.name;

                <span class="hljs-keyword">if</span> (data) {

                    el.width = data.width;
                    el.height = data.height;
                }

                el.srcObject = mediaStream;

                el.onloadedmetadata = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{

                    el.play();
                }

                resolve(vid);
            })
            .catch (<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {

                <span class="hljs-built_in">console</span>.log(err.message);
                resolve(vid);
            });
        }
        <span class="hljs-keyword">else</span> reject(<span class="hljs-string">&#x27;Navigator.mediaDevices object not found&#x27;</span>);
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p><code>importVideo</code> - load videos from a remote server and create assets from them</p>
<p>Arguments can be a comma-separated list of String urls. For example, for a video link at server url <code>http://www.example.com/path/to/image/flower.mp4</code>:</p>
<ul>
<li>Will attempt to give the new VideoAsset object, and video element, a name/id value of eg ‘flower’ (but not guaranteed)</li>
<li>Will not add the new video element to the DOM</li>
</ul>
<p>Alternatively, the arguments can include an object with the following attributes:</p>
<ul>
<li><strong>name</strong> string.</li>
<li><strong>src</strong> url string.</li>
<li><strong>parent</strong> CSS search string - if set, Scrawl-canvas will attempt to append the new img element to the corresponding DOM element.</li>
<li><strong>isVisible</strong> boolean - if true, and new img element has been added to DOM, make that image visible; default is false.</li>
<li><strong>className</strong> string - list of classes to be added to the new img element.</li>
</ul>
<p>Note: strings and object arguments can be mixed - Scrawl-canvas will interrrogate each argument in turn and take appropriate action to load the assets.</p>
<p><strong><em>Using videos from 3rd Party cloud servers</em></strong> - for example, YouTube. DON’T. Services such as YouTube generally require users to embed videos into web pages using their video player technology. This is so page visitors can be served adverts and recommended videos, etc. Attempts to circumvent this functionality will often break the 3rd Party’s <em>Terms of Service</em>.</p>
<ul>
<li>This advice does not apply to developers who want to include a 3rd Party video player DOM element in a Scrawl-canvas Stack environment. If that meets your requirements, go for it!</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> importVideo = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) </span>{

    <span class="hljs-keyword">let</span> reg = <span class="hljs-regexp">/.*\/(.*?)\./</span>,
        result = <span class="hljs-string">&#x27;&#x27;</span>;

    <span class="hljs-keyword">if</span> (args.length) {

        <span class="hljs-keyword">let</span> name, className, visibility, parent, sources, preload;

        <span class="hljs-keyword">let</span> flag = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">let</span> firstArg = args[<span class="hljs-number">0</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>one or more string urls has been passed to the function</p>
<ul>
<li>urls will be treated as &lt;source&gt; elements assigned to a &lt;video&gt; element</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (firstArg.substring) {

            <span class="hljs-keyword">let</span> match = reg.exec(firstArg);
            name = (match &amp;&amp; match[<span class="hljs-number">1</span>]) ? match[<span class="hljs-number">1</span>] : <span class="hljs-string">&#x27;&#x27;</span>;

            sources = [...args];
            className = <span class="hljs-string">&#x27;&#x27;</span>;
            visibility = <span class="hljs-literal">false</span>;
            parent = <span class="hljs-literal">null</span>;
            preload = <span class="hljs-string">&#x27;auto&#x27;</span>;

            flag = <span class="hljs-literal">true</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>a single object has been passed to the function</p>
<ul>
<li>only process if the object includes a src attribute</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (firstArg &amp;&amp; firstArg.src) {

            name = firstArg.name || <span class="hljs-string">&#x27;&#x27;</span>;

            sources = [...firstArg.src];
            className = firstArg.className || <span class="hljs-string">&#x27;&#x27;</span>;
            visibility = firstArg.visibility || <span class="hljs-literal">false</span>;
            parent = <span class="hljs-built_in">document</span>.querySelector(parent);
            preload = firstArg.preload || <span class="hljs-string">&#x27;auto&#x27;</span>;

            flag = <span class="hljs-literal">true</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>build the video element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> video = makeVideoAsset({
            <span class="hljs-attr">name</span>: name,
        });


        <span class="hljs-keyword">if</span> (flag) {

            <span class="hljs-keyword">let</span> vid = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&#x27;video&#x27;</span>);

            vid.name = name;
            vid.className = className;

            vid.style.display = (visibility) ? <span class="hljs-string">&#x27;block&#x27;</span> : <span class="hljs-string">&#x27;none&#x27;</span>;

            vid.crossOrigin = <span class="hljs-string">&#x27;anonymous&#x27;</span>;

            vid.preload = preload;

            sources.forEach(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {

                <span class="hljs-keyword">let</span> el = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&#x27;source&#x27;</span>);

                el.src = item;

                vid.appendChild(el);
            });

            vid.onload = <span class="hljs-function">() =&gt;</span> {

                video.set({
                    <span class="hljs-attr">source</span>: vid,
                });

                <span class="hljs-keyword">if</span> (parent) parent.appendChild(vid);
            };

            video.set({
                <span class="hljs-attr">source</span>: vid,
            });

            result = name;
        }
    }

    <span class="hljs-keyword">return</span> result;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <h4 id="factory">Factory</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> makeVideoAsset = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> VideoAsset(items);
};

<span class="hljs-title">constructors</span>.<span class="hljs-title">VideoAsset</span> = <span class="hljs-title">VideoAsset</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <h4 id="exports">Exports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> {
    makeVideoAsset,

    gettableVideoAssetAtributes,
    settableVideoAssetAtributes,

    importDomVideo,
    importVideo,

    importMediaStream,
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
