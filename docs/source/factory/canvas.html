<!DOCTYPE html>

<html>
<head>
  <title>Canvas factory</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../core/animationloop.html">
                  ./source/core/animationloop.js
                </a>
              
                
                <a class="source" href="../core/component.html">
                  ./source/core/component.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/events.html">
                  ./source/core/events.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/userInteraction.html">
                  ./source/core/userInteraction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="bezier.html">
                  ./source/factory/bezier.js
                </a>
              
                
                <a class="source" href="block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="emitter.html">
                  ./source/factory/emitter.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="fontAttributes.html">
                  ./source/factory/fontAttributes.js
                </a>
              
                
                <a class="source" href="gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="imageAsset.html">
                  ./source/factory/imageAsset.js
                </a>
              
                
                <a class="source" href="line.html">
                  ./source/factory/line.js
                </a>
              
                
                <a class="source" href="loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="net.html">
                  ./source/factory/net.js
                </a>
              
                
                <a class="source" href="oval.html">
                  ./source/factory/oval.js
                </a>
              
                
                <a class="source" href="palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="particle.html">
                  ./source/factory/particle.js
                </a>
              
                
                <a class="source" href="particleForce.html">
                  ./source/factory/particleForce.js
                </a>
              
                
                <a class="source" href="particleHistory.html">
                  ./source/factory/particleHistory.js
                </a>
              
                
                <a class="source" href="particleSpring.html">
                  ./source/factory/particleSpring.js
                </a>
              
                
                <a class="source" href="particleWorld.html">
                  ./source/factory/particleWorld.js
                </a>
              
                
                <a class="source" href="pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="polygon.html">
                  ./source/factory/polygon.js
                </a>
              
                
                <a class="source" href="polyline.html">
                  ./source/factory/polyline.js
                </a>
              
                
                <a class="source" href="quadratic.html">
                  ./source/factory/quadratic.js
                </a>
              
                
                <a class="source" href="quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="radialGradient.html">
                  ./source/factory/radialGradient.js
                </a>
              
                
                <a class="source" href="rectangle.html">
                  ./source/factory/rectangle.js
                </a>
              
                
                <a class="source" href="renderAnimation.html">
                  ./source/factory/renderAnimation.js
                </a>
              
                
                <a class="source" href="shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="spiral.html">
                  ./source/factory/spiral.js
                </a>
              
                
                <a class="source" href="spriteAsset.html">
                  ./source/factory/spriteAsset.js
                </a>
              
                
                <a class="source" href="stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="star.html">
                  ./source/factory/star.js
                </a>
              
                
                <a class="source" href="state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="tetragon.html">
                  ./source/factory/tetragon.js
                </a>
              
                
                <a class="source" href="ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="tracer.html">
                  ./source/factory/tracer.js
                </a>
              
                
                <a class="source" href="tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="unstackedElement.html">
                  ./source/factory/unstackedElement.js
                </a>
              
                
                <a class="source" href="vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="videoAsset.html">
                  ./source/factory/videoAsset.js
                </a>
              
                
                <a class="source" href="wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="../mixin/anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="../mixin/asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="../mixin/assetConsumer.html">
                  ./source/mixin/assetConsumer.js
                </a>
              
                
                <a class="source" href="../mixin/base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="../mixin/cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="../mixin/delta.html">
                  ./source/mixin/delta.js
                </a>
              
                
                <a class="source" href="../mixin/displayShape.html">
                  ./source/mixin/displayShape.js
                </a>
              
                
                <a class="source" href="../mixin/dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="../mixin/entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="../mixin/filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="../mixin/mimic.html">
                  ./source/mixin/mimic.js
                </a>
              
                
                <a class="source" href="../mixin/path.html">
                  ./source/mixin/path.js
                </a>
              
                
                <a class="source" href="../mixin/pattern.html">
                  ./source/mixin/pattern.js
                </a>
              
                
                <a class="source" href="../mixin/pivot.html">
                  ./source/mixin/pivot.js
                </a>
              
                
                <a class="source" href="../mixin/position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="../mixin/shapeBasic.html">
                  ./source/mixin/shapeBasic.js
                </a>
              
                
                <a class="source" href="../mixin/shapeCurve.html">
                  ./source/mixin/shapeCurve.js
                </a>
              
                
                <a class="source" href="../mixin/shapePathCalculation.html">
                  ./source/mixin/shapePathCalculation.js
                </a>
              
                
                <a class="source" href="../mixin/styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="../mixin/tween.html">
                  ./source/mixin/tween.js
                </a>
              
                
                <a class="source" href="../worker/filter-stringed.html">
                  ./source/worker/filter-stringed.js
                </a>
              
                
                <a class="source" href="../worker/filter.html">
                  ./source/worker/filter.js
                </a>
              
                
                <a class="source" href="../worker/filter_canvas.html">
                  ./source/worker/filter_canvas.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="canvas-factory">Canvas factory</h1>
<p>Scrawl-canvas mediates between its system and &lt;canvas&gt; elements in the DOM using Canvas wrapper objects. The wrapper includes a handle to the visible element, but most work is done on a second &lt;canvas&gt; element - the <strong>base Cell</strong> - which is not part of the DOM, thus excluded from a browser’s Document interface (including events).</p>
<p>The Canvas factory is not used directly; the factory is not exported as part of the <a href="../scrawl.html">scrawl object</a> during Scrawl-canvas initialization. Instead, wrappers can be created for DOM-based &lt;canvas&gt; elements using the following scrawl functions:</p>
<ul>
<li><code>scrawl.getCanvas</code> - locates a &lt;canvas&gt; element in the DOM and creates a wrapper for it.</li>
<li><code>scrawl.addCanvas</code> - generates a new &lt;canvas&gt; element, creates a wrapper for it, then adds it to the DOM.</li>
</ul>
<p>During initialization Scrawl-canvas will search the DOM tree and automatically create Canvas wrappers for all the &lt;canvas&gt; elements it discovers. The first &lt;canvas&gt; element discovered becomes the <strong>current canvas</strong>; all entitys created without a specified <code>group</code> attribute will be assigned to that element’s wrapper’s base Cell’s Group object. We can change the current canvas by invoking the <code>scrawl.setCurrentCanvas</code> function.</p>
<p>A canvas wrapper can include more than one Cell object. It will always include a base Cell object; additional Cells can be treated as <strong><em>cell layers</em></strong> and/or normal artefacts contributing to the final display.</p>
<p>During their creation, Canvas wrappers will directly modify the DOM, adding &lt;div&gt; and &lt;nav&gt; elements to it. These new elements are used as <em>holds</em> where the Canvas will store data and text, mainly to expose &lt;a&gt; links and &lt;p&gt; blocks which expose scene details to assistive technologies (accessibility). These additional elements have zero dimensions and should not affect the layout or painting of the rest of the web page.</p>
<p>Canvas wrapper objects use the <strong>base</strong>, <strong>position</strong>, <strong>dom</strong> and <strong>anchor</strong> mixins. Thus Canvas wrappers are also <strong>artefact</strong> objects: if a &lt;canvas&gt; element is a direct child of a Stack wrapper’s element then it can be positioned, dimensioned and rotated like any other artefact.</p>
<p>By default, all Canvas wrappers will track mouse/touch movements across their &lt;canvas&gt; elements, supplying this data to constituent Cell objects and artefacts as-and-when-required.</p>
<p>Canvas wrappers are used by Scrawl-canvas to invoke the <strong>Display cycle cascade</strong>. As such, they include <code>clear</code>, <code>compile</code>, <code>show</code> and <code>render</code> functions to manage the Display cycle. These functions are asynchronous, returning Promises.</p>
<p>Canvas wrappers are excluded from the Scrawl-canvas packet system; they cannot be saved or cloned. Killing a Canvas wrapper will remove its &lt;canvas&gt; element from the DOM, alongside the additional elements added to the DOM during Canvas creation.</p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h4 id="demos">Demos:</h4>
<ul>
<li>All canvas and component demos, and a few of the stack demos, include Canvas wrapper functionality - most of which happens behind the scenes and does not need to be directly coded. </li>
<li><a href="../../demo/canvas-009.html">Canvas-009</a> - Pattern styles; Entity web link anchors; Dynamic accessibility</li>
<li><a href="../../demo/dom-011.html">DOM-011</a> - Canvas controller <code>fit</code> attribute; Cell positioning (mouse)</li>
<li><a href="../../demo/dom-012.html">DOM-012</a> - Add and remove (kill) Scrawl-canvas canvas elements programmatically</li>
<li><a href="../../demo/component-001.html">Component-001</a> - Scrawl-canvas DOM element components</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h4 id="imports">Imports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { cell, <span class="hljs-title">constructors</span>, <span class="hljs-title">artefact</span>, <span class="hljs-title">group</span> } <span class="hljs-title">from</span> &#x27;../<span class="hljs-title">core</span>/<span class="hljs-title">library</span>.<span class="hljs-title">js</span>&#x27;;
<span class="hljs-keyword">import</span> { rootElements, setRootElementsSort, setCurrentCanvas, domShow, scrawlCanvasHold } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/document.js&#x27;</span>;
<span class="hljs-keyword">import</span> { mergeOver, pushUnique, removeItem, xt, λ<span class="hljs-built_in">this</span>, λ<span class="hljs-literal">null</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/utilities.js&#x27;</span>;
<span class="hljs-keyword">import</span> { uiSubscribedElements } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/userInteraction.js&#x27;</span>;

<span class="hljs-keyword">import</span> { makeState } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./state.js&#x27;</span>;
<span class="hljs-keyword">import</span> { makeCell } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./cell.js&#x27;</span>;
<span class="hljs-keyword">import</span> { makeCoordinate } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./coordinate.js&#x27;</span>;

<span class="hljs-keyword">import</span> baseMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/base.js&#x27;</span>;
<span class="hljs-keyword">import</span> domMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/dom.js&#x27;</span>;
<span class="hljs-keyword">import</span> displayMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/displayShape.js&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h4 id="canvas-constructor">Canvas constructor</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Canvas = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">let</span> g, el;

    <span class="hljs-built_in">this</span>.makeName(items.name);
    <span class="hljs-built_in">this</span>.register();
    <span class="hljs-built_in">this</span>.initializePositions();

    <span class="hljs-built_in">this</span>.dimensions[<span class="hljs-number">0</span>] = <span class="hljs-number">300</span>;
    <span class="hljs-built_in">this</span>.dimensions[<span class="hljs-number">1</span>] = <span class="hljs-number">150</span>;

    <span class="hljs-built_in">this</span>.pathCorners = [];
    <span class="hljs-built_in">this</span>.css = {};
    <span class="hljs-built_in">this</span>.here = {};
    <span class="hljs-built_in">this</span>.perspective = {

        <span class="hljs-attr">x</span>: <span class="hljs-string">&#x27;50%&#x27;</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-string">&#x27;50%&#x27;</span>,
        <span class="hljs-attr">z</span>: <span class="hljs-number">0</span>
    };
    <span class="hljs-built_in">this</span>.dirtyPerspective = <span class="hljs-literal">true</span>;

    <span class="hljs-built_in">this</span>.initializeDomLayout(items);

    <span class="hljs-built_in">this</span>.set(<span class="hljs-built_in">this</span>.defs);

    <span class="hljs-keyword">if</span> (!items.label) items.label = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">this</span>.name}</span> canvas element`</span>;

    <span class="hljs-built_in">this</span>.initializeDisplayShapeActions();

    <span class="hljs-built_in">this</span>.set(items);

    <span class="hljs-built_in">this</span>.cleanDimensions();

    el = <span class="hljs-built_in">this</span>.domElement;

    <span class="hljs-keyword">if</span> (el) {

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.trackHere) pushUnique(uiSubscribedElements, <span class="hljs-built_in">this</span>.name);

        <span class="hljs-built_in">this</span>.engine = <span class="hljs-built_in">this</span>.domElement.getContext(<span class="hljs-string">&#x27;2d&#x27;</span>);

        <span class="hljs-built_in">this</span>.state = makeState({
            <span class="hljs-attr">engine</span>: <span class="hljs-built_in">this</span>.engine
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>set up additional cells array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-built_in">this</span>.cells = [];
        <span class="hljs-built_in">this</span>.cellBatchesClear = [];
        <span class="hljs-built_in">this</span>.cellBatchesCompile = [];
        <span class="hljs-built_in">this</span>.cellBatchesShow = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>setup base cell</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> cellArgs = {
            <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">this</span>.name}</span>_base`</span>,
            <span class="hljs-attr">element</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">width</span>: <span class="hljs-built_in">this</span>.currentDimensions[<span class="hljs-number">0</span>],
            <span class="hljs-attr">height</span>: <span class="hljs-built_in">this</span>.currentDimensions[<span class="hljs-number">1</span>],
            <span class="hljs-attr">cleared</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">compiled</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">shown</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">isBase</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">host</span>: <span class="hljs-built_in">this</span>.name,
            <span class="hljs-attr">controller</span>: <span class="hljs-built_in">this</span>,
            <span class="hljs-attr">order</span>: <span class="hljs-number">10</span>,
        };
        <span class="hljs-built_in">this</span>.base = <span class="hljs-built_in">this</span>.buildCell(cellArgs);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>even if it is a child of a stack element, it needs to be recorded as a ‘rootElement’</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        pushUnique(rootElements, <span class="hljs-built_in">this</span>.name);
        setRootElementsSort();</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h5 id="accessibility">Accessibility</h5>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!el.getAttribute(<span class="hljs-string">&#x27;role&#x27;</span>)) el.setAttribute(<span class="hljs-string">&#x27;role&#x27;</span>, <span class="hljs-string">&#x27;img&#x27;</span>);

        <span class="hljs-keyword">let</span> navigation = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&#x27;nav&#x27;</span>);
        navigation.id = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">this</span>.name}</span>-navigation`</span>;
        navigation.style.width = <span class="hljs-string">&#x27;0px&#x27;</span>;
        navigation.style.height = <span class="hljs-string">&#x27;0px&#x27;</span>;
        navigation.style.maxWidth = <span class="hljs-string">&#x27;0px&#x27;</span>;
        navigation.style.maxHeight = <span class="hljs-string">&#x27;0px&#x27;</span>;
        navigation.style.border = <span class="hljs-string">&#x27;0px&#x27;</span>;
        navigation.style.padding = <span class="hljs-string">&#x27;0px&#x27;</span>;
        navigation.style.margin = <span class="hljs-string">&#x27;0px&#x27;</span>;
        navigation.style.overflow = <span class="hljs-string">&#x27;hidden&#x27;</span>;
        <span class="hljs-built_in">this</span>.navigation = navigation;
        el.appendChild(navigation);

        <span class="hljs-keyword">let</span> textHold = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&#x27;div&#x27;</span>);
        textHold.id = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">this</span>.name}</span>-text-hold`</span>;
        textHold.style.width = <span class="hljs-string">&#x27;0px&#x27;</span>;
        textHold.style.height = <span class="hljs-string">&#x27;0px&#x27;</span>;
        textHold.style.maxWidth = <span class="hljs-string">&#x27;0px&#x27;</span>;
        textHold.style.maxHeight = <span class="hljs-string">&#x27;0px&#x27;</span>;
        textHold.style.border = <span class="hljs-string">&#x27;0px&#x27;</span>;
        textHold.style.padding = <span class="hljs-string">&#x27;0px&#x27;</span>;
        textHold.style.margin = <span class="hljs-string">&#x27;0px&#x27;</span>;
        textHold.style.overflow = <span class="hljs-string">&#x27;hidden&#x27;</span>;
        <span class="hljs-built_in">this</span>.textHold = textHold;
        el.appendChild(textHold);

        <span class="hljs-keyword">let</span> ariaLabel = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&#x27;div&#x27;</span>);
        ariaLabel.id = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">this</span>.name}</span>-ARIA-label`</span>;
        ariaLabel.textContent = <span class="hljs-built_in">this</span>.label;
        <span class="hljs-built_in">this</span>.ariaLabelElement = ariaLabel;
        scrawlCanvasHold.appendChild(ariaLabel);
        el.setAttribute(<span class="hljs-string">&#x27;aria-labelledby&#x27;</span>, ariaLabel.id);
        el.setAttribute(<span class="hljs-string">&#x27;aria-live&#x27;</span>, <span class="hljs-string">&#x27;polite&#x27;</span>);

        <span class="hljs-keyword">let</span> ariaDescription = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&#x27;div&#x27;</span>);
        ariaDescription.id = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">this</span>.name}</span>-ARIA-description`</span>;
        ariaDescription.textContent = <span class="hljs-built_in">this</span>.description;
        <span class="hljs-built_in">this</span>.ariaDescriptionElement = ariaDescription;
        scrawlCanvasHold.appendChild(ariaDescription);
        el.setAttribute(<span class="hljs-string">&#x27;aria-describedby&#x27;</span>, ariaDescription.id);
        el.setAttribute(<span class="hljs-string">&#x27;aria-live&#x27;</span>, <span class="hljs-string">&#x27;polite&#x27;</span>);

        <span class="hljs-built_in">this</span>.cleanAria();
    }

    <span class="hljs-built_in">this</span>.dirtyCells = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">this</span>.apply();

    <span class="hljs-built_in">this</span>.dirtyDomDimensions = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (items.setAsCurrentCanvas) <span class="hljs-built_in">this</span>.setAsCurrentCanvas();
    
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h4 id="canvas-prototype">Canvas prototype</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> P = Canvas.prototype = <span class="hljs-built_in">Object</span>.create(<span class="hljs-built_in">Object</span>.prototype);
P.type = <span class="hljs-string">&#x27;Canvas&#x27;</span>;
P.lib = <span class="hljs-string">&#x27;canvas&#x27;</span>;
P.isArtefact = <span class="hljs-literal">true</span>;
P.isAsset = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h4 id="mixins">Mixins</h4>
<ul>
<li><a href="../mixin/base.html">base</a></li>
<li><a href="../mixin/dom.html">dom</a></li>
<li><a href="../mixin/displayShape.html">display</a></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P = baseMix(P);
P = domMix(P);
P = displayMix(P);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h4 id="canvas-attributes">Canvas attributes</h4>
<ul>
<li>Attributes defined in the <a href="../mixin/base.html">base mixin</a>: <strong>name</strong>.</li>
<li>Attributes defined in the <a href="../mixin/position.html">position mixin</a>: <strong>group, visibility, order, start, <em>startX</em>, <em>startY</em>, handle, <em>handleX</em>, <em>handleY</em>, offset, <em>offsetX</em>, <em>offsetY</em>, dimensions, <em>width</em>, <em>height</em>, pivoted, mimicked, lockTo, <em>lockXTo</em>, <em>lockYTo</em>, scale, roll, noUserInteraction, noPositionDependencies, noCanvasEngineUpdates, noFilters, noPathUpdates, purge, bringToFrontOnDrag</strong>.</li>
<li>Attributes defined in the <a href="../mixin/delta.html">delta mixin</a>: <strong>delta, noDeltaUpdates</strong>.</li>
<li>Attributes defined in the <a href="../mixin/pivot.html">pivot mixin</a>: <strong>pivot, pivotCorner, addPivotHandle, addPivotOffset, addPivotRotation</strong>.</li>
<li>Attributes defined in the <a href="../mixin/mimic.html">mimic mixin</a>: <strong>mimic, useMimicDimensions, useMimicScale, useMimicStart, useMimicHandle, useMimicOffset, useMimicRotation, useMimicFlip, addOwnDimensionsToMimic, addOwnScaleToMimic, addOwnStartToMimic, addOwnHandleToMimic, addOwnOffsetToMimic, addOwnRotationToMimic</strong>.</li>
<li>Attributes defined in the <a href="../mixin/path.html">path mixin</a>: <strong>path, pathPosition, addPathHandle, addPathOffset, addPathRotation, constantPathSpeed</strong>.</li>
<li>Attributes defined in the <a href="../mixin/anchor.html">anchor mixin</a>: <strong>anchor</strong>.</li>
<li>Attributes defined in the <a href="../mixin/dom.html">dom mixin</a>: <strong>domElement, pitch, yaw, offsetZ, css, classes, position, actionResize, trackHere, domAttributes</strong>.</li>
<li>Attributes defined in the <a href="../mixin/displayShape.html">display mixin</a>: <strong>breakToBanner, breakToLandscape, breakToPortrait, breakToSkyscraper, actionBannerShape, actionLandscapeShape, actionRectangleShape, actionPortraitShape, actionSkyscraperShape</strong>.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> defaultAttributes = {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><strong>position</strong> - the CSS position value for the &lt;canvas&gt; element. This value will be set to <code>absolute</code> when the element is an artefact associated with a Stack; <code>relative</code> in other cases.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    position: <span class="hljs-string">&#x27;relative&#x27;</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><strong>trackHere</strong> - Boolean flag to indicate whether the Canvas object should participate in the Scrawl-canvas mouse/touch tracking functionality; the functionality can be switched off by setting the flag to false (via <code>set</code>).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    trackHere: <span class="hljs-literal">true</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p><strong>fit</strong> - String indicating how the base Cell should copy its contents over to the &lt;canvas&gt; element as the final step in the Display cycle. Accepted values are: <code>fill</code>, <code>contain</code>, <code>cover</code>, <code>none</code> (but not <code>scale-down</code>).</p>
<p>The aim of this functionality is to replicate the CSS <code>object-fit</code> property - <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/object-fit">detailed here</a> - for &lt;canvas&gt; elements. Unlike the CSS property, we apply the fit attribute to the Canvas wrapper, not the element itself or its parent element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    fit: <span class="hljs-string">&#x27;none&#x27;</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p><strong>isComponent</strong> - set to true if canvas is being used as part of a Scrawl-canvas component.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    isComponent: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p><strong>renderOnResize</strong> - perform an additional render of the scene following a change in the canvas’s dimensions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    renderOnResize: <span class="hljs-literal">true</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <h5 id="accessibility-attributes">Accessibility attributes</h5>
<p>&lt;canvas&gt; elements are <strong>raster images</strong> - they contain no information within their content (beyond pixel data) which can be analyzed or passed on to the browser or other device. The element <em>can</em> include <code>title</code> and various <code>item</code> attributes (alongside custom <code>data-</code> attributes) but inclusion of these depends entirely on the developer remembering to include them when coding up a web page.</p>
<p>Scrawl-canvas attempts to automate <em>some</em> (but not <em>all</em>) accessibility work through inclusion of the following Canvas attributes (specifically, Scrawl-canvas implements <a href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA">ARIA attributes</a>):</p>
<ul>
<li><strong>title</strong> - this attribute is applied to the &lt;canvas&gt; element’s ‘title’ attribute, and will appear as a tooltip when the user hovers over the canvas</li>
<li><strong>label</strong> and <strong>description</strong> - these attributes are applied to (offscreen) div elements which are referenced by the &lt;canvas&gt; element using <code>aria-labelledby</code> and <code>aria-describedby</code> attributes</li>
</ul>
<p>If no label value is supplied to the Canvas factory (as part of the function’s argument object), then Scrawl-canvas will auto-generate a label based on the canvas’s name. All three attributes can be updated dynamically using the usual <code>set()</code> functionality.</p>
<p>Beyond the Canvas object, Scrawl-canvas also encourages Phrase entitys (which handle graphical text in the canvas display) to expose their content to the DOM, to make it accessible. Also, any artefact given an Anchor link will expose the Anchor’s &lt;a&gt; element in the DOM, which allows the canvas display to become part of the document’s navigation (for example, by keyboard tabbing).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    title: <span class="hljs-string">&#x27;&#x27;</span>,
    <span class="hljs-attr">label</span>: <span class="hljs-string">&#x27;&#x27;</span>,
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;&#x27;</span>,
};
P.defs = mergeOver(P.defs, defaultAttributes);</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <h4 id="packetclone-management">Packet/Clone management</h4>
<p>This functionality is disabled for Canvas objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.stringifyFunction = λ<span class="hljs-literal">null</span>;
P.processPacketOut = λ<span class="hljs-literal">null</span>;
P.finalizePacketOut = λ<span class="hljs-literal">null</span>;
P.saveAsPacket = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-string">`[<span class="hljs-subst">${<span class="hljs-built_in">this</span>.name}</span>, <span class="hljs-subst">${<span class="hljs-built_in">this</span>.type}</span>, <span class="hljs-subst">${<span class="hljs-built_in">this</span>.lib}</span>, {}]`</span>
};
P.clone = λ<span class="hljs-built_in">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <h4 id="kill-functionality">Kill functionality</h4>
<p>P.kill = function () {</p>

            </div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <pre><code><span class="hljs-keyword">let</span> name = <span class="hljs-built_in">this</span>.name,
    host = <span class="hljs-built_in">this</span>.host,
    h, g;</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <pre><code><span class="hljs-comment">// rootElements and uiSubscribedElements arrays</span>
removeItem(rootElements, name);
setRootElementsSort();</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <pre><code>removeItem(uiSubscribedElements, name);</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <pre><code><span class="hljs-comment">// Host and host Group</span>
<span class="hljs-keyword">if</span> (host &amp;&amp; host !== <span class="hljs-string">&#x27;root&#x27;</span>) {</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <pre><code>    h = (<span class="hljs-built_in">this</span>.currentHost) ? <span class="hljs-built_in">this</span>.currentHost : artefact[host];</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <pre><code>    <span class="hljs-keyword">if</span> (h) {</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <pre><code>        h.removeGroups(name);</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <pre><code>        g = group[h.name];
        <span class="hljs-keyword">if</span> (g) g.removeArtefacts(name);
    }
}</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <pre><code><span class="hljs-comment">// Canvas Group</span>
<span class="hljs-keyword">if</span> (group[name]) group[name].kill();</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <pre><code><span class="hljs-comment">// Base Cell</span>
<span class="hljs-built_in">this</span>.base.kill();</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <pre><code><span class="hljs-comment">// DOM removals</span>
<span class="hljs-built_in">this</span>.navigation.remove();
<span class="hljs-built_in">this</span>.textHold.remove();
<span class="hljs-built_in">this</span>.ariaLabelElement.remove();
<span class="hljs-built_in">this</span>.ariaDescriptionElement.remove();
<span class="hljs-built_in">this</span>.domElement.remove();</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <pre><code><span class="hljs-comment">// Scrawl-canvas library</span>
<span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.deregister();</code></pre>
<p>}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.factoryKill = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> name = <span class="hljs-built_in">this</span>.name,
        host = <span class="hljs-built_in">this</span>.host,
        h, g;</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>rootElements and uiSubscribedElements arrays</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    removeItem(rootElements, name);
    setRootElementsSort();

    removeItem(uiSubscribedElements, name);</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Host and host Group</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (host &amp;&amp; host !== <span class="hljs-string">&#x27;root&#x27;</span>) {

        h = (<span class="hljs-built_in">this</span>.currentHost) ? <span class="hljs-built_in">this</span>.currentHost : artefact[host];

        <span class="hljs-keyword">if</span> (h) {

            h.removeGroups(name);

            g = group[h.name];
            <span class="hljs-keyword">if</span> (g) g.removeArtefacts(name);
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Canvas Group</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (group[name]) group[name].kill();</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Base Cell</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">this</span>.base.kill();</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>DOM removals</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">this</span>.navigation.remove();
    <span class="hljs-built_in">this</span>.textHold.remove();
    <span class="hljs-built_in">this</span>.ariaLabelElement.remove();
    <span class="hljs-built_in">this</span>.ariaDescriptionElement.remove();
    <span class="hljs-built_in">this</span>.domElement.remove();
};</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <h4 id="get-set-deltaset">Get, Set, deltaSet</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> G = P.getters,
    S = P.setters,
    D = P.deltaSetters;</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p><code>fit</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.fitDefaults = [<span class="hljs-string">&#x27;fill&#x27;</span>, <span class="hljs-string">&#x27;contain&#x27;</span>, <span class="hljs-string">&#x27;cover&#x27;</span>];
S.fit = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.fit = (<span class="hljs-built_in">this</span>.fitDefaults.indexOf(item) &gt;= <span class="hljs-number">0</span>) ? item : <span class="hljs-string">&#x27;none&#x27;</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p><code>title</code> - String</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.title = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.title = item;
    <span class="hljs-built_in">this</span>.dirtyAria = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p><code>label</code> - String</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.label = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.label = item;
    <span class="hljs-built_in">this</span>.dirtyAria = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p><code>description</code> - String</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.description = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.description = item;
    <span class="hljs-built_in">this</span>.dirtyAria = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p><code>trackHere</code> - Boolean</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.trackHere = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">bool</span>) </span>{

    <span class="hljs-keyword">if</span> (xt(bool)) {

        <span class="hljs-keyword">if</span> (bool) pushUnique(uiSubscribedElements, <span class="hljs-built_in">this</span>.name);
        <span class="hljs-keyword">else</span> removeItem(uiSubscribedElements, <span class="hljs-built_in">this</span>.name);

        <span class="hljs-built_in">this</span>.trackHere = bool;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <h5 id="get-and-set-base-cell-attributes">Get and set base cell attributes</h5>
<p>For convenience, Scrawl-canvas allows us to get/set a limited number of base Cell attributes via their Canvas wrapper’s <code>get</code>, <code>set</code> and <code>deltaSet</code> functions. We can set and deltaSet other base Cell attributes by invoking the <code>mycanvas.setBase</code> and <code>mycanvas.deltaSetBase</code> functions.</p>

            </div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p><code>backgroundColor</code> - String. We can set the base Cell’s background color to any CSS color String value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>G.backgroundColor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.base.backgroundColor;
};
S.backgroundColor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.base) {

        <span class="hljs-built_in">this</span>.base.set({
            <span class="hljs-attr">backgroundColor</span>: item
        });
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p><code>alpha</code> - float Number between 0.0 and 1.0. When the base Cell stamps itself onto the Canvas wrapper’s &lt;canvas&gt; element, it can set the element’s engine to a <code>globalAlpha</code> value stored in the Cell’s alpha attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>G.alpha = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.base.alpha;
};
S.alpha = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.base) {

        <span class="hljs-built_in">this</span>.base.set({
            <span class="hljs-attr">alpha</span>: item
        });
    }
};
D.alpha = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.base) {

        <span class="hljs-built_in">this</span>.base.deltaSet({
            <span class="hljs-attr">alpha</span>: item
        });
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p><code>composite</code> - String. When the base Cell stamps itself onto the Canvas wrapper’s &lt;canvas&gt; element, it can set the element’s engine to a <code>globalCompositeOperation</code> value stored in the Cell’s composite attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>G.composite = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.base.composite;
};
S.composite = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.base) {
        <span class="hljs-built_in">this</span>.base.set({
            <span class="hljs-attr">composite</span>: item
        });
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <h4 id="prototype-functions">Prototype functions</h4>

            </div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p><code>setAsCurrentCanvas</code> - invoke function (without arguments) to make this Canvas wrapper the <strong>current canvas</strong> for future entity generation operations. This is additional to the <code>scrawl.setCurrentCanvas</code> function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.setAsCurrentCanvas = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.base) setCurrentCanvas(<span class="hljs-built_in">this</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p><code>setBase</code> - pass the argument object through to the base Cell’s <code>set</code> function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.setBase = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.base) {

        <span class="hljs-built_in">this</span>.base.set(items);
        <span class="hljs-built_in">this</span>.setBaseHelper();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p><code>deltaSetBase</code> - pass the argument object through to the base Cell’s <code>deltaSet</code> function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.deltaSetBase = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.base) {

        <span class="hljs-built_in">this</span>.base.deltaSet(items);
        <span class="hljs-built_in">this</span>.setBaseHelper();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Internal function - passes the Canvas wrapper’s current <strong>here</strong> object and <strong>fit</strong> attribute to the base Cell for further processing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.updateBaseHere = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.base) <span class="hljs-built_in">this</span>.base.updateBaseHere(<span class="hljs-built_in">this</span>.here, <span class="hljs-built_in">this</span>.fit);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Internal helper function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.setBaseHelper = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> items = {};

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.base.dirtyScale) items.dirtyScale = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.base.dirtyDimensions) items.dirtyDimensions = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.base.dirtyLock) items.dirtyLock = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.base.dirtyStart) items.dirtyStart = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.base.dirtyOffset) items.dirtyOffset = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.base.dirtyHandle) items.dirtyHandle = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.base.dirtyRotation) items.dirtyRotation = <span class="hljs-literal">true</span>;

    <span class="hljs-built_in">this</span>.cleanCells();
    <span class="hljs-built_in">this</span>.base.prepareStamp();

    <span class="hljs-built_in">this</span>.updateCells(items);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p><code>updateCells</code> - internal function. Iterate through all Cells registered in the wrapper’s <strong>cells</strong> Array and set a range of dirty flags on them, for future processing by each Cell.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.updateCells = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-built_in">this</span>.cells.forEach(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {

        <span class="hljs-keyword">let</span> mycell = cell[name];

        <span class="hljs-keyword">if</span> (mycell) {

            <span class="hljs-keyword">if</span> (items.dirtyScale) mycell.dirtyScale = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyDimensions) mycell.dirtyDimensions = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyLock) mycell.dirtyLock = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyStart) mycell.dirtyStart = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyOffset) mycell.dirtyOffset = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyHandle) mycell.dirtyHandle = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyRotation) mycell.dirtyRotation = <span class="hljs-literal">true</span>;
        }
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p><code>buildCell</code> - internal helper function, called by the Canvas constructor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.buildCell = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">let</span> host = items.host || <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (!host) items.host = <span class="hljs-built_in">this</span>.base.name;

    <span class="hljs-keyword">let</span> mycell = makeCell(items);
    
    <span class="hljs-built_in">this</span>.addCell(mycell);
    <span class="hljs-built_in">this</span>.cleanCells();
    <span class="hljs-keyword">return</span> mycell;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p><code>cleanDimensionsAdditionalActions</code> - overwrites mixin/position function. Promulgates canvas dimension changes through to all Cells in the wrapper’s cells Array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cleanDimensionsAdditionalActions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.cells) {

        <span class="hljs-built_in">this</span>.updateCells({
            <span class="hljs-attr">dirtyDimensions</span>: <span class="hljs-literal">true</span>,
        });
    }

    <span class="hljs-built_in">this</span>.dirtyDomDimensions = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">this</span>.dirtyDisplayShape = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">this</span>.dirtyDisplayArea = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p><code>addCell</code> - add a Cell object to the wrapper’s cells Array; argument can be the Cell’s name-String, or the Cell object itself</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.addCell = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    item = (item.substring) ? item : item.name || <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (item) {

        pushUnique(<span class="hljs-built_in">this</span>.cells, item);
        cell[item].prepareStamp();
        <span class="hljs-built_in">this</span>.dirtyCells = <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> item;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p><code>removeCell</code> - remove a Cell object from the wrapper’s cells Array; argument can be the Cell’s name-String, or the Cell object itself</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.removeCell = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    item = (item.substring) ? item : item.name || <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (item) {

        removeItem(<span class="hljs-built_in">this</span>.cells, item);
        <span class="hljs-built_in">this</span>.dirtyCells = <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p><code>killCell</code> - invoke a Cell object’s <strong>kill</strong> function; argument can be the Cell’s name-String, or the Cell object itself</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.killCell = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">let</span> mycell = (item.substring) ? cell[item] : item;

    <span class="hljs-keyword">if</span> (mycell) mycell.kill();

    <span class="hljs-built_in">this</span>.dirtyCells = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <h5 id="display-cycle-functions">Display cycle functions</h5>

            </div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p><code>clear</code> - For Cell objects in the wrapper’s <strong>cells</strong> (and associated) Arrays (returns a Promise):</p>
<ul>
<li>if the Cell object’s <code>cleared</code> flag is true, invoke the Cell’s <code>clear</code> function </li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.clear = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> self = <span class="hljs-built_in">this</span>;

    <span class="hljs-keyword">if</span> (self.dirtyCells) self.cleanCells();

    <span class="hljs-keyword">let</span> next = <span class="hljs-function">(<span class="hljs-params">counter</span>) =&gt;</span> {

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {

            <span class="hljs-keyword">let</span> myCell = self.cellBatchesClear[counter];

            <span class="hljs-keyword">if</span> (myCell) {

                myCell.clear()
                .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {

                    next(counter + <span class="hljs-number">1</span>)
                    .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> resolve(<span class="hljs-literal">true</span>))
                    .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> reject(err));
                })
                .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> reject(err));
            }
            <span class="hljs-keyword">else</span> resolve(<span class="hljs-literal">true</span>);
        });
    };
    <span class="hljs-keyword">return</span> next(<span class="hljs-number">0</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p><code>compile</code> - For Cell objects in the wrapper’s <strong>cells</strong> (and associated) Arrays (returns a Promise):</p>
<ul>
<li>sort Cell objects depending on their <code>compileOrder</code> attribute - Cells with lower order values will be processed first</li>
<li>if the Cell object’s <code>compiled</code> flag is true, invoke the Cell’s <code>compile</code> function </li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.compile = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> self = <span class="hljs-built_in">this</span>;

    <span class="hljs-keyword">if</span> (self.dirtyCells) self.cleanCells();

    <span class="hljs-keyword">let</span> next = <span class="hljs-function">(<span class="hljs-params">counter</span>) =&gt;</span> {

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {

            <span class="hljs-keyword">let</span> myCell = self.cellBatchesCompile[counter];

            <span class="hljs-keyword">if</span> (myCell) {

                myCell.compile()
                .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {

                    next(counter + <span class="hljs-number">1</span>)
                    .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> resolve(<span class="hljs-literal">true</span>))
                    .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> reject(err));
                })
                .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> reject(err));
            }
            <span class="hljs-keyword">else</span> {

                self.prepareStamp();

                self.stamp()
                .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> resolve(<span class="hljs-literal">true</span>))
                .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> reject(err));
            }
        });
    };
    <span class="hljs-keyword">return</span> next(<span class="hljs-number">0</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p><code>show</code> - For Cell objects in the wrapper’s <strong>cells</strong> (and associated) Arrays (returns a Promise):</p>
<ul>
<li>sort Cell objects depending on their <code>showOrder</code> attribute - Cells with lower order values will be processed first</li>
<li>if the Cell object’s <code>shown</code> flag is true, invoke the Cell’s <code>show</code> function </li>
</ul>
<p>And then:</p>
<ul>
<li>copy the base Cells display over to the Canvas wrapper’s &lt;canvas&gt; element</li>
<li>update ARIA and other associated metadata</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.show = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{

    <span class="hljs-keyword">let</span> self = <span class="hljs-built_in">this</span>;

    <span class="hljs-keyword">if</span> (self.dirtyCells) self.cleanCells();

    <span class="hljs-keyword">let</span> next = <span class="hljs-function">(<span class="hljs-params">counter</span>) =&gt;</span> {

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {

            <span class="hljs-keyword">let</span> myCell = self.cellBatchesShow[counter];

            <span class="hljs-keyword">if</span> (myCell) {

                myCell.show()
                .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {

                    next(counter + <span class="hljs-number">1</span>)
                    .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> resolve(<span class="hljs-literal">true</span>))
                    .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> reject(err));
                })
                .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> reject(err));
            }
            <span class="hljs-keyword">else</span> {

                self.engine.clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, self.localWidth, self.localHeight);
                
                self.base.show()
                .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {

                    domShow();

                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyAria) <span class="hljs-built_in">this</span>.cleanAria();

                    resolve(<span class="hljs-literal">true</span>);
                })
                .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> reject(err));
            }
        });
    };
    <span class="hljs-keyword">return</span> next(<span class="hljs-number">0</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p><code>render</code> - orchestrate a single Display cycle - clear, then compile, then show (returns a Promise).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.render = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> self = <span class="hljs-built_in">this</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {

        self.clear()
        .then(<span class="hljs-function">() =&gt;</span> self.compile())
        .then(<span class="hljs-function">() =&gt;</span> self.show())
        .then(<span class="hljs-function">() =&gt;</span> resolve(<span class="hljs-literal">true</span>))
        .catch(<span class="hljs-function">() =&gt;</span> resolve(<span class="hljs-literal">false</span>));
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p><code>cleanCells</code> - internal function triggered each time there is an update to the <strong>cells</strong> Array attribute, or a constituent Cell sets the Canvas wrapper’s <code>dirtyCell</code> flag.</p>
<ul>
<li>Cell objects include attribute flags - <code>cleared</code>, <code>compiled</code>, <code>shown</code> - which tell their Canvas wrapper whether they should be included in each part of the Display cycle</li>
<li>For the compile and show steps, Cell objects also include attributes - <code>compileOrder</code>, <code>showOrder</code> - indicating the order in which they should be processed (compared to other Cell objects). </li>
<li>The sorting algorithm for all three operations is a bucket sort. </li>
<li>The results of these operations are deposited in three internal Arrays which are used as part of the Canvas wrapper’s clear/compile/show functionality.</li>
</ul>
<p>We do things this way because there may be situations where a Cell needs to calculate and compile before another cell, but should be shown (applied to) the base Cell after the other Cells (so it appears on top of them).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cleanCells = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-built_in">this</span>.dirtyCells = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">let</span> tempClear = [],
        tempCompile = [],
        tempShow = [],
        cells = <span class="hljs-built_in">this</span>.cells,
        order;

    cells.forEach(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {

        <span class="hljs-keyword">let</span> mycell = cell[item];

        <span class="hljs-keyword">if</span> (mycell) {

            <span class="hljs-keyword">if</span> (mycell.cleared) tempClear.push(mycell);

            <span class="hljs-keyword">if</span> (mycell.compiled) {

                order = mycell.compileOrder;

                <span class="hljs-keyword">if</span> (!tempCompile[order]) tempCompile[order] = [];

                tempCompile[order].push(mycell);
            }

            <span class="hljs-keyword">if</span> (mycell.shown) {

                order = mycell.showOrder;

                <span class="hljs-keyword">if</span> (!tempShow[order]) tempShow[order] = [];
                tempShow[order].push(mycell);
            }
        }
    });

    <span class="hljs-built_in">this</span>.cellBatchesClear = [].concat(tempClear);
    <span class="hljs-built_in">this</span>.cellBatchesCompile = tempCompile.reduce(<span class="hljs-function">(<span class="hljs-params">a, v</span>) =&gt;</span> a.concat(v), []);
    <span class="hljs-built_in">this</span>.cellBatchesShow = tempShow.reduce(<span class="hljs-function">(<span class="hljs-params">a, v</span>) =&gt;</span> a.concat(v), []);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <h5 id="handling-dom-events">Handling DOM events</h5>
<p><code>cascadeEventAction</code> - The Canvas wrapper’s &lt;canvas&gt; element is part of the DOM, thus it is able to participate in all normal DOM events. We use the cascadeEventAction function to tell the wrapper which of the events it receives should be cascaded down to its constituent Cell objects and, in turn, their Groups’ artefacts. </p>
<p>This allows us to ‘regionalize’ various parts of the &lt;canvas&gt; element so that they respond in a similar way to an HTML <strong>image map</strong> (defined using &lt;map&gt; and &lt;area&gt; elements) </p>
<ul>
<li>Cascaded events are limited to mouse and touch events, which Scrawl-canvas bundles together into 5 types of event: <code>down</code>, <code>up</code> (which also captures click events), <code>enter</code>, <code>leave</code>, <code>move</code>.</li>
<li>Returns an Array of name Strings for the entitys at the current mouse cursor coordinates; the Array is also accessible from the Canvas wrapper’s <code>currentActiveEntityNames</code> attribute.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cascadeEventAction = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">action</span>) </span>{

    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.currentActiveEntityNames) <span class="hljs-built_in">this</span>.currentActiveEntityNames = [];

    <span class="hljs-keyword">let</span> currentActiveEntityNames = <span class="hljs-built_in">this</span>.currentActiveEntityNames,
        testActiveEntityObjects = [],
        testActiveEntityNames = [],
        newActiveEntityObjects = [],
        newActiveEntityNames = [],
        knownActiveEntityObjects = [],
        knownActiveEntityNames = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <ol>
<li>Find all entitys currently colliding with the mouse/touch coordinate over the canvas</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">this</span>.cells.forEach(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {

        <span class="hljs-keyword">let</span> myCell = cell[name];

        <span class="hljs-keyword">if</span> (myCell &amp;&amp; (myCell.shown || myCell.isBase)) testActiveEntityObjects.push(myCell.getEntityHits());
    });

    testActiveEntityObjects = testActiveEntityObjects.reduce(<span class="hljs-function">(<span class="hljs-params">a, v</span>) =&gt;</span> a.concat(v), []);</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <ol start="2">
<li>Process the returned test results</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>    testActiveEntityObjects.forEach(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {

        <span class="hljs-keyword">let</span> name = item.name;

        <span class="hljs-keyword">if</span> (testActiveEntityNames.indexOf(name) &lt; <span class="hljs-number">0</span>) {

            testActiveEntityNames.push(name);

            <span class="hljs-keyword">if</span> (currentActiveEntityNames.indexOf(name) &lt; <span class="hljs-number">0</span>) {

                newActiveEntityObjects.push(item);
                newActiveEntityNames.push(name);
            }
            <span class="hljs-keyword">else</span> {

                knownActiveEntityObjects.push(item);
                knownActiveEntityNames.push(name);
            }
        }
    });

    <span class="hljs-keyword">let</span> currentActiveEntityObjects = newActiveEntityObjects.concat(knownActiveEntityObjects);</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <ol start="3">
<li>Trigger the required action on each affected entity</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> doLeave = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">if</span> (currentActiveEntityNames.length) {

            newActiveEntityNames.forEach(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> removeItem(currentActiveEntityNames, name));
            knownActiveEntityNames.forEach(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> removeItem(currentActiveEntityNames, name));

            currentActiveEntityNames.forEach(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {

                <span class="hljs-keyword">let</span> myArt = artefact[name];

                <span class="hljs-keyword">if</span> (myArt) myArt.onLeave();
            });
        }
    };

    <span class="hljs-keyword">switch</span> (action) {

        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;down&#x27;</span> :
            currentActiveEntityObjects.forEach(<span class="hljs-function"><span class="hljs-params">art</span> =&gt;</span> art.onDown());
            <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;up&#x27;</span> :
            currentActiveEntityObjects.forEach(<span class="hljs-function"><span class="hljs-params">art</span> =&gt;</span> art.onUp());
            <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;enter&#x27;</span> :
            newActiveEntityObjects.forEach(<span class="hljs-function"><span class="hljs-params">art</span> =&gt;</span> art.onEnter());
            <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;leave&#x27;</span> :
            doLeave();
            <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;move&#x27;</span> :
            doLeave();
            newActiveEntityObjects.forEach(<span class="hljs-function"><span class="hljs-params">art</span> =&gt;</span> art.onEnter());
            <span class="hljs-keyword">break</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <ol start="4">
<li>Cleanup and return</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">this</span>.currentActiveEntityNames = newActiveEntityNames.concat(knownActiveEntityNames);

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.currentActiveEntityNames;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p><code>cleanAria</code> - internal function; transfers updated <strong>title</strong>, <strong>label</strong> and <strong>description</strong> attribute values into the relevant DOM elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cleanAria = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-built_in">this</span>.dirtyAria = <span class="hljs-literal">false</span>;
    <span class="hljs-built_in">this</span>.domElement.setAttribute(<span class="hljs-string">&#x27;title&#x27;</span>, <span class="hljs-built_in">this</span>.title);
    <span class="hljs-built_in">this</span>.ariaLabelElement.textContent = <span class="hljs-built_in">this</span>.label;
    <span class="hljs-built_in">this</span>.ariaDescriptionElement.textContent = <span class="hljs-built_in">this</span>.description;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <h4 id="factory">Factory</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> makeCanvas = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Canvas(items);
};

<span class="hljs-title">constructors</span>.<span class="hljs-title">Canvas</span> = <span class="hljs-title">Canvas</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <h4 id="exports">Exports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> {
    makeCanvas,
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
