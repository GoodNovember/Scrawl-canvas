<!DOCTYPE html>

<html>
<head>
  <title>Filter factory</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../core/animationloop.html">
                  ./source/core/animationloop.js
                </a>
              
                
                <a class="source" href="../core/component.html">
                  ./source/core/component.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/events.html">
                  ./source/core/events.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/userInteraction.html">
                  ./source/core/userInteraction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="../core/wasmWrapper.html">
                  ./source/core/wasmWrapper.js
                </a>
              
                
                <a class="source" href="action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="bezier.html">
                  ./source/factory/bezier.js
                </a>
              
                
                <a class="source" href="block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="cog.html">
                  ./source/factory/cog.js
                </a>
              
                
                <a class="source" href="color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="emitter.html">
                  ./source/factory/emitter.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="filterEngine.html">
                  ./source/factory/filterEngine.js
                </a>
              
                
                <a class="source" href="fontAttributes.html">
                  ./source/factory/fontAttributes.js
                </a>
              
                
                <a class="source" href="gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="imageAsset.html">
                  ./source/factory/imageAsset.js
                </a>
              
                
                <a class="source" href="line.html">
                  ./source/factory/line.js
                </a>
              
                
                <a class="source" href="loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="mesh.html">
                  ./source/factory/mesh.js
                </a>
              
                
                <a class="source" href="net.html">
                  ./source/factory/net.js
                </a>
              
                
                <a class="source" href="noise.html">
                  ./source/factory/noise.js
                </a>
              
                
                <a class="source" href="oval.html">
                  ./source/factory/oval.js
                </a>
              
                
                <a class="source" href="palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="particle.html">
                  ./source/factory/particle.js
                </a>
              
                
                <a class="source" href="particleForce.html">
                  ./source/factory/particleForce.js
                </a>
              
                
                <a class="source" href="particleHistory.html">
                  ./source/factory/particleHistory.js
                </a>
              
                
                <a class="source" href="particleSpring.html">
                  ./source/factory/particleSpring.js
                </a>
              
                
                <a class="source" href="particleWorld.html">
                  ./source/factory/particleWorld.js
                </a>
              
                
                <a class="source" href="pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="polygon.html">
                  ./source/factory/polygon.js
                </a>
              
                
                <a class="source" href="polyline.html">
                  ./source/factory/polyline.js
                </a>
              
                
                <a class="source" href="quadratic.html">
                  ./source/factory/quadratic.js
                </a>
              
                
                <a class="source" href="quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="radialGradient.html">
                  ./source/factory/radialGradient.js
                </a>
              
                
                <a class="source" href="rectangle.html">
                  ./source/factory/rectangle.js
                </a>
              
                
                <a class="source" href="renderAnimation.html">
                  ./source/factory/renderAnimation.js
                </a>
              
                
                <a class="source" href="shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="spiral.html">
                  ./source/factory/spiral.js
                </a>
              
                
                <a class="source" href="spriteAsset.html">
                  ./source/factory/spriteAsset.js
                </a>
              
                
                <a class="source" href="stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="star.html">
                  ./source/factory/star.js
                </a>
              
                
                <a class="source" href="state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="tetragon.html">
                  ./source/factory/tetragon.js
                </a>
              
                
                <a class="source" href="ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="tracer.html">
                  ./source/factory/tracer.js
                </a>
              
                
                <a class="source" href="tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="unstackedElement.html">
                  ./source/factory/unstackedElement.js
                </a>
              
                
                <a class="source" href="vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="videoAsset.html">
                  ./source/factory/videoAsset.js
                </a>
              
                
                <a class="source" href="wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="../mixin/anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="../mixin/asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="../mixin/assetConsumer.html">
                  ./source/mixin/assetConsumer.js
                </a>
              
                
                <a class="source" href="../mixin/base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="../mixin/cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="../mixin/delta.html">
                  ./source/mixin/delta.js
                </a>
              
                
                <a class="source" href="../mixin/displayShape.html">
                  ./source/mixin/displayShape.js
                </a>
              
                
                <a class="source" href="../mixin/dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="../mixin/entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="../mixin/filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="../mixin/mimic.html">
                  ./source/mixin/mimic.js
                </a>
              
                
                <a class="source" href="../mixin/path.html">
                  ./source/mixin/path.js
                </a>
              
                
                <a class="source" href="../mixin/pattern.html">
                  ./source/mixin/pattern.js
                </a>
              
                
                <a class="source" href="../mixin/pivot.html">
                  ./source/mixin/pivot.js
                </a>
              
                
                <a class="source" href="../mixin/position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="../mixin/shapeBasic.html">
                  ./source/mixin/shapeBasic.js
                </a>
              
                
                <a class="source" href="../mixin/shapeCurve.html">
                  ./source/mixin/shapeCurve.js
                </a>
              
                
                <a class="source" href="../mixin/shapePathCalculation.html">
                  ./source/mixin/shapePathCalculation.js
                </a>
              
                
                <a class="source" href="../mixin/styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="../mixin/tween.html">
                  ./source/mixin/tween.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="filter-factory">Filter factory</h1>
<p>Filters take in an image representation of an <a href="../mixin/entity.html">entity</a>, <a href="./group.html">Group</a> of entitys or a <a href="./cell.html">Cell</a> display and, by manipulating the image’s data, return an updated image which replaces those entitys or Cell in the final output display.</p>
<p>Scrawl-canvas defines its filters in <strong>Filter objects</strong>, detailed in this module. The functionality to make use of these objects is coded up in the <a href="../mixin/filter.html">filter mixin</a>, which is used by the Cell, Group and all entity factories.</p>
<p>Scrawl-canvas uses a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API">web worker</a> to generate filter outputs - defined in the <a href="../worker/filter.html">filter web worker</a>. The web worker implements a number of common filter algorithms. These algorithms - <strong>called filter actions</strong> - can be combined in a wide variety of ways, including the use of multiple pathways, to create complex filter results.</p>
<h4 id="web-worker-filter-actions">Web worker filter actions</h4>
<p><code>alpha-to-channels</code> - Copies the alpha channel value over to the selected value or, alternatively, sets that channels value to zero, or leaves the channel’s value unchanged. Setting the appropriate “includeChannel” flags will copy the alpha channel value to that channel; when that flag is false, setting the appropriate “excludeChannel” flag will set that channel’s value to zero. Object attributes: action, lineIn, lineOut, opacity, includeRed, includeGreen, includeBlue, excludeRed, excludeGreen, excludeBlue</p>
<p><code>area-alpha</code> - Places a tile schema across the input, quarters each tile and then sets the alpha channels of the pixels in selected quarters of each tile to zero. Can be used to create horizontal or vertical bars, or chequerboard effects. Object attributes: action, lineIn, lineOut, opacity, tileWidth, tileHeight, offsetX, offsetY, gutterWidth, gutterHeight, areaAlphaLevels</p>
<p><code>average-channels</code> - Calculates an average value from each pixel’s included channels and applies that value to all channels that have not been specifically excluded; excluded channels have their values set to 0. Object attributes: action, lineIn, lineOut, opacity, includeRed, includeGreen, includeBlue, excludeRed, excludeGreen, excludeBlue</p>
<p><code>binary</code> - Set the channel to either 0 or 255, depending on whether the channel value is below or above a given level. Level values are set using the “red”, “green”, “blue” and “alpha” arguments. Setting these values to 0 disables the action for that channel. Object attributes: action, lineIn, lineOut, opacity, red, green, blue, alpha</p>
<p><code>blend</code> - Using two source images (from the “lineIn” and “lineMix” arguments), combine their color information using various separable and non-separable blend modes (as defined by the W3C Compositing and Blending Level 1 recommendations. The blending method is determined by the String value supplied in the “blend” argument; permitted values are: ‘color-burn’, ‘color-dodge’, ‘darken’, ‘difference’, ‘exclusion’, ‘hard-light’, ‘lighten’, ‘lighter’, ‘multiply’, ‘overlay’, ‘screen’, ‘soft-light’, ‘color’, ‘hue’, ‘luminosity’, and ‘saturation’. Note that the source images may be of different sizes: the output (lineOut) image size will be the same as the source (NOT lineIn) image; the lineMix image can be moved relative to the lineIn image using the “offsetX” and “offsetY” arguments. Object attributes: action, lineIn, lineOut, lineMix, opacity, blend, offsetX, offsetY</p>
<p><code>blur</code> - Performs a multi-loop, two-step ‘horizontal-then-vertical averaging sweep’ calculation across all pixels to create a blur effect. Note that this filter is expensive, thus much slower to complete compared to other filter effects. Object attributes: action, lineIn, lineOut, opacity, radius, passes, processVertical, processHorizontal, includeRed, includeGreen, includeBlue, includeAlpha, step</p>
<p><code>channels-to-alpha</code> - Calculates an average value from each pixel’s included channels and applies that value to the alpha channel. Object attributes: action, lineIn, lineOut, opacity, includeRed, includeGreen, includeBlue</p>
<p><code>chroma</code> - Using an array of ‘range’ arrays, determine whether a pixel’s values lie entirely within a range’s values and, if true, sets that pixel’s alpha channel value to zero. Each ‘range’ array comprises six Numbers representing [minimum-red, minimum-green, minimum-blue, maximum-red, maximum-green, maximum-blue] values. Object attributes: action, lineIn, lineOut, opacity, ranges</p>
<p><code>clamp-channels</code> - Clamp each color channel to a range set by lowColor and highColor values. Object attributes: action, lineIn, lineOut, opacity, lowRed, lowGreen, lowBlue, highRed, highGreen, highBlue</p>
<p><code>colors-to-alpha</code> - Determine the alpha channel value for each pixel depending on the closeness to that pixel’s color channel values to a reference color supplied in the “red”, “green” and “blue” arguments. The sensitivity of the effect can be manipulated using the “transparentAt” and “opaqueAt” values, both of which lie in the range 0-1. Object attributes: action, lineIn, lineOut, opacity, red, green, blue, opaqueAt, transparentAt</p>
<p><code>compose</code> - Using two source images (from the “lineIn” and “lineMix” arguments), combine their color information using alpha compositing rules (as defined by Porter/Duff). The compositing method is determined by the String value supplied in the “compose” argument; permitted values are: ‘destination-only’, ‘destination-over’, ‘destination-in’, ‘destination-out’, ‘destination-atop’, ‘source-only’, ‘source-over’ (default), ‘source-in’, ‘source-out’, ‘source-atop’, ‘clear’, ‘xor’, or ‘lighter’. Note that the source images may be of different sizes: the output (lineOut) image size will be the same as the source (NOT lineIn) image; the lineMix image can be moved relative to the lineIn image using the “offsetX” and “offsetY” arguments. Object attributes: action, lineIn, lineOut, lineMix, opacity, compose, offsetX, offsetY</p>
<p><code>displace</code> - Shift pixels around the image, based on the values supplied in a displacement process-image. Object attributes: action, lineIn, lineOut, lineMix, opacity, channelX, channelY, scaleX, scaleY, transparentEdges, offsetX, offsetY</p>
<p><code>emboss</code> - A 3x3 matrix transform; the matrix weights are calculated internally from the values of two arguments: “strength”, and “angle” - which is a value measured in degrees, with 0 degrees pointing to the right of the origin (along the positive x axis). Post-processing options include removing unchanged pixels, or setting then to mid-gray. The convenience method includes additional arguments which will add a choice of grayscale, then channel clamping, then blurring actions before passing the results to this emboss action. Object attributes: action, lineIn, lineOut, opacity, strength, angle, tolerance, keepOnlyChangedAreas, postProcessResults; pseudo-arguments for the convenience method include useNaturalGrayscale, clamp, smoothing</p>
<p><code>flood</code> - Set all pixels to the channel values supplied in the “red”, “green”, “blue” and “alpha” arguments. Object attributes: action, lineIn, lineOut, opacity, red, green, blue, alpha</p>
<p><code>grayscale</code> - For each pixel, averages the weighted color channels and applies the result across all the color channels. This gives a more realistic monochrome effect. Object attributes: action, lineIn, lineOut, opacity</p>
<p><code>invert-channels</code> - For each pixel, subtracts its current channel values - when included - from 255. Object attributes: action, lineIn, lineOut, opacity, includeRed, includeGreen, includeBlue, includeAlpha</p>
<p><code>lock-channels-to-levels</code> - Produces a posterize effect. Takes in four arguments - “red”, “green”, “blue” and “alpha” - each of which is an Array of zero or more integer Numbers (between 0 and 255). The filter works by looking at each pixel’s channel value and determines which of the corresponding Array’s Number values it is closest to; it then sets the channel value to that Number value. Object attributes: action, lineIn, lineOut, opacity, red, green, blue, alpha</p>
<p><code>matrix</code> - Performs a matrix operation on each pixel’s channels, calculating the new value using neighbouring pixel weighted values. Also known as a convolution matrix, kernel or mask operation. Note that this filter is expensive, thus much slower to complete compared to other filter effects. The matrix dimensions can be set using the “width” and “height” arguments, while setting the home pixel’s position within the matrix can be set using the “offsetX” and “offsetY” arguments. The weights to be applied need to be supplied in the “weights” argument - an Array listing the weights row-by-row starting from the top-left corner of the matrix. By default all color channels are included in the calculations while the alpha channel is excluded. The ‘edgeDetect’, ‘emboss’ and ‘sharpen’ convenience filter methods all use the matrix action, pre-setting the required weights. Object attributes: action, lineIn, lineOut, opacity, includeRed, includeGreen, includeBlue, includeAlpha, width, height, offsetX, offsetY, weights</p>
<p><code>modulate-channels</code> - Multiplies each channel’s value by the supplied argument value. A channel-argument’s value of ‘0’ will set that channel’s value to zero; a value of ‘1’ will leave the channel value unchanged. If the “saturation” flag is set to ‘true’ the calculation changes to start at the color range mid point. The ‘brightness’ and ‘saturation’ filters are special forms of the ‘channels’ filter which use a single “levels” argument to set all three color channel arguments to the same value. Object attributes: action, lineIn, lineOut, opacity, red, green, blue, alpha, saturation; pseudo-argument: level</p>
<p><code>offset</code> - Offset the input image in the output image. Object attributes: action, lineIn, lineOut, opacity, offsetRedX, offsetRedY, offsetGreenX, offsetGreenY, offsetBlueX, offsetBlueY, offsetAlphaX, offsetAlphaY; pseudo-argument: offsetX, offsetY</p>
<p><code>pixelate</code> - Pixelizes the input image by creating a grid of tiles across it and then averaging the color values of each pixel in a tile and setting its value to the average. Tile width and height, and their offset from the top left corner of the image, are set via the “tileWidth”, “tileHeight”, “offsetX” and “offsetY” arguments. Object attributes: action, lineIn, lineOut, opacity, tileWidth, tileHeight, offsetX, offsetY, includeRed, includeGreen, includeBlue, includeAlpha</p>
<p><code>process-image</code> - Add an asset image to the filter process chain. The asset - the String name of the asset object - must be pre-loaded before it can be included in the filter. The “width” and “height” arguments are measured in integer Number pixels; the “copy” arguments can be either percentage Strings (relative to the asset’s natural dimensions) or absolute Number values (in pixels). The “lineOut” argument is required - be aware that the filter action does not check for any pre-existing assets cached under this name and, if they exist, will overwrite them with this asset’s data. Object attributes: action, lineOut, asset, width, height, copyWidth, copyHeight, copyX, copyY</p>
<p><code>set-channel-to-level</code> - Sets the value of each pixel’s included channel to the value supplied in the “level” argument. Object attributes: action, lineIn, lineOut, opacity, includeRed, includeGreen, includeBlue, includeAlpha, level</p>
<p><code>step-channels</code> - Takes three divisor values - “red”, “green”, “blue”. For each pixel, its color channel values are divided by the corresponding color divisor, floored to the integer value and then multiplied by the divisor. For example a divisor value of ‘50’ applied to a channel value of ‘120’ will give a result of ‘100’. The output is a form of posterization. Object attributes: action, lineIn, lineOut, opacity, red, green, blue</p>
<p><code>threshold</code> - Grayscales the input then, for each pixel, checks the color channel values against a “level” argument: pixels with channel values above the level value are assigned to the ‘high’ color; otherwise they are updated to the ‘low’ color. The “high” and “low” arguments are [red, green, blue] integer Number Arrays. The convenience function will accept the pseudo-attributes “highRed”, “lowRed” etc in place of the “high” and “low” Arrays. Object attributes: action, lineIn, lineOut, opacity, low, high; pseudo-arguments: lowRed, lowGreen, lowBlue, highRed, highGreen, highBlue</p>
<p><code>tint-channels</code> - Has similarities to the SVG <feColorMatrix> filter element, but excludes the alpha channel from calculations. Rather than set a matrix, we set nine arguments to determine how the value of each color channel in a pixel will affect both itself and its fellow color channels. The ‘sepia’ convenience filter presets these values to create a sepia effect. Object attributes: action, lineIn, lineOut, opacity, redInRed, redInGreen, redInBlue, greenInRed, greenInGreen, greenInBlue, blueInRed, blueInGreen, blueInBlue</p>
<p><code>user-defined-legacy</code> - Previous to Scrawl-canvas version 8.4.0, filters could be defined with an argument which passed a function string to the filter worker, which the worker would then run against the source input image as-and-when required. This functionality has been removed from the new filter system. All such filters will now return the input image unchanged. Object attributes: action, lineIn, lineOut, opacity</p>
<pre><code><span class="hljs-comment">// Example: the following code creates a filter that applies a thick red border around the entitys </span>
<span class="hljs-comment">// it is applied to; if used on a group then it will outline the outside of the group&#x27;s entitys, </span>
<span class="hljs-comment">// ignoring overlaps between entitys:</span>
scrawl.makeFilter({
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;redBorder&#x27;</span>,
    <span class="hljs-attr">actions</span>: [
        {
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;blur&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: <span class="hljs-string">&#x27;source-alpha&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: <span class="hljs-string">&#x27;shadow&#x27;</span>,
            <span class="hljs-attr">radius</span>: <span class="hljs-number">3</span>,
            <span class="hljs-attr">passes</span>: <span class="hljs-number">2</span>, 
            <span class="hljs-attr">includeRed</span>: <span class="hljs-literal">false</span>, 
            <span class="hljs-attr">includeGreen</span>: <span class="hljs-literal">false</span>, 
            <span class="hljs-attr">includeBlue</span>: <span class="hljs-literal">false</span>, 
            <span class="hljs-attr">includeAlpha</span>: <span class="hljs-literal">true</span>, 
        },
        {
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;binary&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: <span class="hljs-string">&#x27;shadow&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: <span class="hljs-string">&#x27;shadow&#x27;</span>,
            <span class="hljs-attr">alpha</span>: <span class="hljs-number">1</span>, 
        },
        {
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;flood&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: <span class="hljs-string">&#x27;shadow&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: <span class="hljs-string">&#x27;red-flood&#x27;</span>,
            <span class="hljs-attr">red</span>: <span class="hljs-number">255</span>,
        },
        {
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;compose&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: <span class="hljs-string">&#x27;shadow&#x27;</span>,
            <span class="hljs-attr">lineMix</span>: <span class="hljs-string">&#x27;red-flood&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: <span class="hljs-string">&#x27;colorized&#x27;</span>,
            <span class="hljs-attr">compose</span>: <span class="hljs-string">&#x27;destination-in&#x27;</span>,
        },
        {
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;compose&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: <span class="hljs-string">&#x27;source&#x27;</span>,
            <span class="hljs-attr">lineMix</span>: <span class="hljs-string">&#x27;colorized&#x27;</span>,
        }
    ],
});</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h4 id="demos">Demos:</h4>
<ul>
<li><a href="../../demo/canvas-007.html">Canvas-007</a> - Apply filters at the entity, group and cell level</li>
<li><a href="../../demo/canvas-020.html">Canvas-020</a> - Testing createImageFromXXX functionality</li>
<li><a href="../../demo/canvas-027.html">Canvas-027</a> - Video control and manipulation; chroma-based hit zone</li>
<li><a href="../../demo/component-004.html">Component-004</a> - Scrawl-canvas packets; save and load a range of different entitys</li>
<li><a href="../../demo/filters-019.html">Filters-019</a> - Using a Noise asset with a displace filter</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h4 id="imports">Imports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { <span class="hljs-title">constructors</span>, <span class="hljs-title">cell</span>, <span class="hljs-title">group</span>, <span class="hljs-title">entity</span>, <span class="hljs-title">asset</span> } <span class="hljs-title">from</span> &#x27;../<span class="hljs-title">core</span>/<span class="hljs-title">library</span>.<span class="hljs-title">js</span>&#x27;;
<span class="hljs-keyword">import</span> { mergeOver, removeItem, λ<span class="hljs-literal">null</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/utilities.js&#x27;</span>;

<span class="hljs-keyword">import</span> { makeFilterEngine } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./filterEngine.js&#x27;</span>;

<span class="hljs-keyword">import</span> baseMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/base.js&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h4 id="filter-constructor">Filter constructor</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Filter = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-built_in">this</span>.makeName(items.name);
    <span class="hljs-built_in">this</span>.register();

    <span class="hljs-built_in">this</span>.actions = [];

    <span class="hljs-built_in">this</span>.set(items);
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h4 id="filter-prototype">Filter prototype</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> P = Filter.prototype = <span class="hljs-built_in">Object</span>.create(<span class="hljs-built_in">Object</span>.prototype);
P.type = <span class="hljs-string">&#x27;Filter&#x27;</span>;
P.lib = <span class="hljs-string">&#x27;filter&#x27;</span>;
P.isArtefact = <span class="hljs-literal">false</span>;
P.isAsset = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h4 id="mixins">Mixins</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P = baseMix(P);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h4 id="filter-attributes">Filter attributes</h4>
<ul>
<li>Attributes defined in the <a href="../mixin/base.html">base mixin</a>: <strong>name</strong>.</li>
<li>___Note:__ unlike other Scrawl-canvas factory functions, the Filter factory does not set all its default attributes as part of its constructors. The reason for this is that these attributes are often specific to just one or a few filter actions or methods; not setting these defaults help save some object memory.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> defaultAttributes = {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h5 id="how-the-filter-factory-builds-filters">How the filter factory builds filters</h5>
<p>Filter actions are defined in action objects - which are vanilla Javascript Objects which are collected together in the <strong>actions</strong> array. Each action object is processed sequentially by the web worker to produce the final output for that filter.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    actions: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>The <strong>method</strong> attribute is a String which, in legacy filters, determines the actions which that filter will take on the image. An entity, Group or Cell can include more than one filter object in its <code>filters</code> Array. </p>
<ul>
<li>Filter factory invocations which include the method attribute in their argument object do not need to include an actions attribute; the factory will build the action objects for us.</li>
<li>When using the method attribute, other attributes can be included alongside it. The filter factory will automatically transpose these attributes to the action object.</li>
<li>The following Strings are valid methods: ‘areaAlpha’, ‘binary’, ‘blend’, ‘blue’, ‘blur’, ‘brightness’, ‘channelLevels’, ‘channels’, ‘channelstep’, ‘channelsToAlpha’, ‘chroma’, ‘chromakey’, ‘clampChannels’, ‘compose’, ‘cyan’, ‘displace’, ‘edgeDetect’,  ‘emboss’, ‘flood’, ‘gray’, ‘grayscale’, ‘green’, ‘image’, ‘invert’, ‘magenta’, ‘matrix’, ‘matrix5’, ‘notblue’, ‘notgreen’, ‘notred’, ‘offset’, ‘offsetChannels’, ‘pixelate’, ‘red’, ‘saturation’, ‘sepia’, ‘sharpen’, ‘threshold’, ‘tint’, ‘userDefined’, ‘yellow’,</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    method: <span class="hljs-string">&#x27;&#x27;</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h5 id="how-filters-process-data">How filters process data</h5>
<p>The Scrawl-canvas filters web worker can use <strong><em>multiple pathways</em></strong> to process a filter’s Array of action objects. In essence, a filter action can store the results of its work in a named cache, which can then be used by other filter actions further down the line.</p>
<ul>
<li>When Scrawl-canvas applies filters to an entity, Group or Cell it will go through the entity’s <code>filters</code> Array looking for any <code>process-image</code> actions; when it finds one it will add a snapshot of the associated asset’s current image state to the filter object (thus Cell and Noise assets are naturally dynamic).</li>
<li>Then the system sends all of the filter’s action objects over to the filters web worker, alongside a snapshot of the entity, Group or Cell to be processed.</li>
<li>If the entity, Group or Cell is acting as a stencil (its <code>isStencil</code> flag has been set to true) then a snapshot of the background behind the entity/Group/Cell is sent instead of the entitys themselves.</li>
<li>When the web worker recieves the data packet, it stores the snapshot in its <code>source</code> cache, and replicates it into the <code>work</code> object.</li>
<li>All filter actions require a <strong>lineIn</strong> string which references a cached image or snapshot. If this is not supplied, then the action will process the data stored in the <code>work</code> object.</li>
<li>Additional sources for the lineIn (or lineMix) data are <code>source</code>, which copies the original source image data and delivers it to the action; and <code>source-alpha</code> which copies the original source’s alpha channel data to each of the color channels and delivers it to the action.</li>
<li>Similarly all filter actions require a <strong>lineOut</strong> which identifies the name of a cache in which the processed data can be stored. If this is not supplied, then the action will copy the processed data back into the <code>work</code> object</li>
<li>Some filter actions - specifically <code>blend</code>, <code>compose</code> and <code>displace</code> - use two inputs, combining the data referenced by the <strong>lineIn</strong> and <strong>lineMix</strong> attribute into <strong>lineOut</strong> cache or work object.</li>
<li>When processing completes, the updated data held in the work object is returned by the web worker, which Scrawl-canvas then uses to stamp the entity/Group/Cell into the display canvas.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    lineIn: <span class="hljs-string">&#x27;&#x27;</span>,
    <span class="hljs-attr">lineMix</span>: <span class="hljs-string">&#x27;&#x27;</span>,
    <span class="hljs-attr">lineOut</span>: <span class="hljs-string">&#x27;&#x27;</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Every action includes an <strong>opacity</strong> attribute which defines how much of the incoming image data (<code>lineIn</code>) and how much of the processed results gets included in the output data (<code>lineOut</code>)</p>
<ul>
<li>When set to <code>0</code>, the output consists entirely of input data</li>
<li>When set to <code>1</code> (the default), the output consists entirely of processed data</li>
<li>Values between these limits instruct the action to combine input and processed data proportionately in a linear fashion: a value of <code>0.7</code> leads to a result consisting of 30% input data and 70% processed data</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    opacity: <span class="hljs-number">1</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h5 id="other-attributes-used-by-various-filters">Other attributes used by various filters</h5>
<p>The attributes below are used by specific filter actions and/or methods, and the values they take may change according to the filter’s requirements. Check out the following demos to see these attributes in action with each filter method:</p>
<ul>
<li><a href="../../demo/filters-001.html">Filters-001</a> - Parameters for: blur filter</li>
<li><a href="../../demo/filters-002.html">Filters-002</a> - Parameters for: red, green, blue, cyan, magenta, yellow, notred, notgreen, notblue, grayscale, sepia, invert filters</li>
<li><a href="../../demo/filters-003.html">Filters-003</a> - Parameters for: brightness, saturation filters</li>
<li><a href="../../demo/filters-004.html">Filters-004</a> - Parameters for: threshold filter</li>
<li><a href="../../demo/filters-005.html">Filters-005</a> - Parameters for: channelstep filter</li>
<li><a href="../../demo/filters-006.html">Filters-006</a> - Parameters for: channelLevels filter</li>
<li><a href="../../demo/filters-007.html">Filters-007</a> - Parameters for: channels filter</li>
<li><a href="../../demo/filters-008.html">Filters-008</a> - Parameters for: tint filter</li>
<li><a href="../../demo/filters-009.html">Filters-009</a> - Parameters for: pixelate filter</li>
<li><a href="../../demo/filters-010.html">Filters-010</a> - Parameters for: chroma filter</li>
<li><a href="../../demo/filters-011.html">Filters-011</a> - Parameters for: chromakey filter</li>
<li><a href="../../demo/filters-012.html">Filters-012</a> - Parameters for: matrix, matrix5 filters</li>
<li><a href="../../demo/filters-013.html">Filters-013</a> - Parameters for: flood filter</li>
<li><a href="../../demo/filters-014.html">Filters-014</a> - Parameters for: areaAlpha filter</li>
<li><a href="../../demo/filters-015.html">Filters-015</a> - Using assets in the filter stream; filter compositing</li>
<li><a href="../../demo/filters-016.html">Filters-016</a> - Filter blend operation</li>
<li><a href="../../demo/filters-017.html">Filters-017</a> - Parameters for: displace filter</li>
<li><a href="../../demo/filters-018.html">Filters-018</a> - Parameters for: emboss filter</li>
<li><a href="../../demo/filters-020.html">Filters-020</a> - Parameters for: clampChannels filter</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    alpha: <span class="hljs-number">255</span>,
    <span class="hljs-attr">angle</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">areaAlphaLevels</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">asset</span>: <span class="hljs-string">&#x27;&#x27;</span>,
    <span class="hljs-attr">blend</span>: <span class="hljs-string">&#x27;normal&#x27;</span>,
    <span class="hljs-attr">blue</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">blueInBlue</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">blueInGreen</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">blueInRed</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">channelX</span>: <span class="hljs-string">&#x27;red&#x27;</span>,
    <span class="hljs-attr">channelY</span>: <span class="hljs-string">&#x27;green&#x27;</span>,
    <span class="hljs-attr">clamp</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">compose</span>: <span class="hljs-string">&#x27;source-over&#x27;</span>,
    <span class="hljs-attr">copyHeight</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">copyWidth</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">copyX</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">copyY</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">excludeAlpha</span>: <span class="hljs-literal">true</span>, 
    <span class="hljs-attr">excludeBlue</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">excludeGreen</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">excludeRed</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">green</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">greenInBlue</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">greenInGreen</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">greenInRed</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">gutterHeight</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">gutterWidth</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">highBlue</span>: <span class="hljs-number">255</span>,
    <span class="hljs-attr">highGreen</span>: <span class="hljs-number">255</span>,
    <span class="hljs-attr">highRed</span>: <span class="hljs-number">255</span>,
    <span class="hljs-attr">includeAlpha</span>: <span class="hljs-literal">false</span>, 
    <span class="hljs-attr">includeBlue</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">includeGreen</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">includeRed</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">keepOnlyChangedAreas</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">level</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">lowBlue</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">lowGreen</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">lowRed</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">offsetAlphaX</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">offsetAlphaY</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">offsetBlueX</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">offsetBlueY</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">offsetGreenX</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">offsetGreenY</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">offsetRedX</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">offsetRedY</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">offsetX</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">offsetY</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">opaqueAt</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">passes</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">postProcessResults</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">processHorizontal</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">processVertical</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">radius</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">ranges</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">red</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">redInBlue</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">redInGreen</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">redInRed</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">scaleX</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">scaleY</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">smoothing</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">step</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">strength</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">tileHeight</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">tileWidth</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">tolerance</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">transparentAt</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">transparentEdges</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">useNaturalGrayscale</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">weights</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>,
};
P.defs = mergeOver(P.defs, defaultAttributes);</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h4 id="packet-management">Packet management</h4>
<p>No additional packet functionality required</p>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h4 id="clone-management">Clone management</h4>
<p>No additional clone functionality required</p>

            </div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h4 id="kill-management">Kill management</h4>
<p>Overwrites ./mixin/base.js</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.kill = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> myname = <span class="hljs-built_in">this</span>.name;</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Remove filter from all entity filters attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">Object</span>.entries(entity).forEach(<span class="hljs-function">(<span class="hljs-params">[name, ent]</span>) =&gt;</span> {

        <span class="hljs-keyword">let</span> f = ent.filters;
        <span class="hljs-keyword">if</span> (f &amp;&amp; f.indexOf(myname) &gt;= <span class="hljs-number">0</span>) removeItem(f, myname);
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Remove filter from all group filters attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">Object</span>.entries(group).forEach(<span class="hljs-function">(<span class="hljs-params">[name, grp]</span>) =&gt;</span> {

        <span class="hljs-keyword">let</span> f = grp.filters;
        <span class="hljs-keyword">if</span> (f &amp;&amp; f.indexOf(myname) &gt;= <span class="hljs-number">0</span>) removeItem(f, myname);
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Remove filter from all cell filters attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">Object</span>.entries(cell).forEach(<span class="hljs-function">(<span class="hljs-params">[name, c]</span>) =&gt;</span> {

        <span class="hljs-keyword">let</span> f = c.filters;
        <span class="hljs-keyword">if</span> (f &amp;&amp; f.indexOf(myname) &gt;= <span class="hljs-number">0</span>) removeItem(f, myname);
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Remove filter from the Scrawl-canvas library</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">this</span>.deregister();
    
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <h4 id="get-set-deltaset">Get, Set, deltaSet</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> S = P.setters, 
    D = P.deltaSetters;</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p><code>set</code> - Overwrites mixin/base.js function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.set = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Object</span>.keys(items).length) {

        <span class="hljs-keyword">let</span> setters = <span class="hljs-built_in">this</span>.setters,
            defs = <span class="hljs-built_in">this</span>.defs,
            predefined;

        <span class="hljs-built_in">Object</span>.entries(items).forEach(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> {

            <span class="hljs-keyword">if</span> (key &amp;&amp; key !== <span class="hljs-string">&#x27;name&#x27;</span> &amp;&amp; value != <span class="hljs-literal">null</span>) {

                predefined = setters[key];

                <span class="hljs-keyword">if</span> (predefined) predefined.call(<span class="hljs-built_in">this</span>, value);
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> defs[key] !== <span class="hljs-string">&#x27;undefined&#x27;</span>) <span class="hljs-built_in">this</span>[key] = value;
            }
        }, <span class="hljs-built_in">this</span>);
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.method &amp;&amp; setActionsArray[<span class="hljs-built_in">this</span>.method]) setActionsArray[<span class="hljs-built_in">this</span>.method](<span class="hljs-built_in">this</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p><code>setDelta</code> - Overwrites mixin/base.js function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.setDelta = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Object</span>.keys(items).length) {

        <span class="hljs-keyword">let</span> setters = <span class="hljs-built_in">this</span>.deltaSetters,
            defs = <span class="hljs-built_in">this</span>.defs,
            predefined;

        <span class="hljs-built_in">Object</span>.entries(items).forEach(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> {

            <span class="hljs-keyword">if</span> (key &amp;&amp; key !== <span class="hljs-string">&#x27;name&#x27;</span> &amp;&amp; value != <span class="hljs-literal">null</span>) {

                predefined = setters[key];

                <span class="hljs-keyword">if</span> (predefined) predefined.call(<span class="hljs-built_in">this</span>, value);
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> defs[key] != <span class="hljs-string">&#x27;undefined&#x27;</span>) <span class="hljs-built_in">this</span>[key] = addStrings(<span class="hljs-built_in">this</span>[key], value);
            }
        }, <span class="hljs-built_in">this</span>);
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.method &amp;&amp; setActionsArray[<span class="hljs-built_in">this</span>.method]) setActionsArray[<span class="hljs-built_in">this</span>.method](<span class="hljs-built_in">this</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <h4 id="compatibility-with-scrawl-canvas-legacy-filters-functionality">Compatibility with Scrawl-canvas legacy filters functionality</h4>
<p>The Scrawl-canvas filters code was rewritten from scratch for version 8.4.0. The new functionality introduced the concept of “line processing” - <strong><em>lineIn, lineMix, lineOut</em></strong> (analagous to SVG in, in2 and result attributes) - alongside the addition of more sophisticated image processing tools such as blend modes, compositing, more adaptable matrices, image loading, displacement mapping, etc.</p>
<p>The legacy system - defining filters using <strong>method</strong> String attributes - has been adapted to use the new system behind the scenes. As a result all legacy filters will continue to work as expected - with one exception: user-defined filters, which allowed the user to coder a function string to pass on to the web worker, will no longer function in Scrawl-canvas v8.4.0.</p>
<p>Note that there are no plans to deprecate the legacy method of defining/creating Filters. The following code will continue to work:</p>
<pre><code><span class="hljs-comment">// __Brightness__ filter</span>
scrawl.makeFilter({
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;my-bright-filter&#x27;</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;brightness&#x27;</span>,
    <span class="hljs-attr">level</span>: <span class="hljs-number">0.5</span>,</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>// <strong>Threshhold</strong> filter
}).clone({
    name: ‘my-duotone-filter’,
    method: ‘threshold’,
    level: 127,
    lowRed: 100,
    lowGreen: 0,
    lowBlue: 0,
    highRed: 220,
    highGreen: 60,
    highBlue: 60,
});</p>
<pre><code></code></pre>

            </div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p><code>setActionsArray</code> - an object containing a large number of functions which will convert legacy factory function invocations (using <strong>method</strong> strings) into modern Filter objects (using <strong>actions</strong> arrays):</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> setActionsArray = {</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p><strong>alphaToChannels</strong> (new in v8.4.0) - copies the alpha channel value over to the selected value or, alternatively, sets that channels value to zero, or leaves the channel’s value unchanged. Setting the appropriate “includeChannel” flags will copy the alpha channel value to that channel; when that flag is false, setting the appropriate “excludeChannel” flag will set that channel’s value to zero.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    alphaToChannels: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;alpha-to-channels&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">includeRed</span>: (f.includeRed != <span class="hljs-literal">null</span>) ? f.includeRed : <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeGreen</span>: (f.includeGreen != <span class="hljs-literal">null</span>) ? f.includeGreen : <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeBlue</span>: (f.includeBlue != <span class="hljs-literal">null</span>) ? f.includeBlue : <span class="hljs-literal">true</span>,
            <span class="hljs-attr">excludeRed</span>: (f.excludeRed != <span class="hljs-literal">null</span>) ? f.excludeRed : <span class="hljs-literal">true</span>,
            <span class="hljs-attr">excludeGreen</span>: (f.excludeGreen != <span class="hljs-literal">null</span>) ? f.excludeGreen : <span class="hljs-literal">true</span>,
            <span class="hljs-attr">excludeBlue</span>: (f.excludeBlue != <span class="hljs-literal">null</span>) ? f.excludeBlue : <span class="hljs-literal">true</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p><strong>areaAlpha</strong> (new in v8.4.0) - places a tile schema across the input, quarters each tile and then sets the alpha channels of the pixels in selected quarters of each tile to zero. Can be used to create horizontal or vertical bars, or chequerboard effects.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    areaAlpha: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;area-alpha&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">tileWidth</span>: (f.tileWidth != <span class="hljs-literal">null</span>) ? f.tileWidth : <span class="hljs-number">1</span>,
            <span class="hljs-attr">tileHeight</span>: (f.tileHeight != <span class="hljs-literal">null</span>) ? f.tileHeight : <span class="hljs-number">1</span>,
            <span class="hljs-attr">offsetX</span>: (f.offsetX != <span class="hljs-literal">null</span>) ? f.offsetX : <span class="hljs-number">0</span>,
            <span class="hljs-attr">offsetY</span>: (f.offsetY != <span class="hljs-literal">null</span>) ? f.offsetY : <span class="hljs-number">0</span>,
            <span class="hljs-attr">gutterWidth</span>: (f.gutterWidth != <span class="hljs-literal">null</span>) ? f.gutterWidth : <span class="hljs-number">1</span>,
            <span class="hljs-attr">gutterHeight</span>: (f.gutterHeight != <span class="hljs-literal">null</span>) ? f.gutterHeight : <span class="hljs-number">1</span>,
            <span class="hljs-attr">areaAlphaLevels</span>: (f.areaAlphaLevels != <span class="hljs-literal">null</span>) ? f.areaAlphaLevels : [<span class="hljs-number">255</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>],
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p><strong>binary</strong> (new in v8.4.0) - set the channel to either 0 or 255, depending on whether the channel value is below or above a given level. Level values are set using the “red”, “green”, “blue” and “alpha” arguments. Setting these values to 0 disables the action for that channel</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    binary: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;binary&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">red</span>: (f.red != <span class="hljs-literal">null</span>) ? f.red : <span class="hljs-number">0</span>,
            <span class="hljs-attr">green</span>: (f.green != <span class="hljs-literal">null</span>) ? f.green : <span class="hljs-number">0</span>,
            <span class="hljs-attr">blue</span>: (f.blue != <span class="hljs-literal">null</span>) ? f.blue : <span class="hljs-number">0</span>,
            <span class="hljs-attr">alpha</span>: (f.alpha != <span class="hljs-literal">null</span>) ? f.alpha : <span class="hljs-number">0</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p><strong>blend</strong> (new in v8.4.0) - perform a blend operation on two images; available blend options include: ‘color-burn’, ‘color-dodge’, ‘darken’, ‘difference’, ‘exclusion’, ‘hard-light’, ‘lighten’, ‘lighter’, ‘multiply’, ‘overlay’, ‘screen’, ‘soft-light’, ‘color’, ‘hue’, ‘luminosity’, and ‘saturation’ - see <a href="https://www.w3.org/TR/compositing-1/#blending">W3C Compositing and Blending recommendations</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    blend: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;blend&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineMix</span>: (f.lineMix != <span class="hljs-literal">null</span>) ? f.lineMix : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">blend</span>: (f.blend != <span class="hljs-literal">null</span>) ? f.blend : <span class="hljs-string">&#x27;normal&#x27;</span>,
            <span class="hljs-attr">offsetX</span>: (f.offsetX != <span class="hljs-literal">null</span>) ? f.offsetX : <span class="hljs-number">0</span>,
            <span class="hljs-attr">offsetY</span>: (f.offsetY != <span class="hljs-literal">null</span>) ? f.offsetY : <span class="hljs-number">0</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p><strong>blue</strong> - removes red and green channel color from the image</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    blue: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;average-channels&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">excludeRed</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">excludeGreen</span>: <span class="hljs-literal">true</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p><strong>blur</strong> - blurs the image</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    blur: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;blur&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">includeRed</span>: (f.includeRed != <span class="hljs-literal">null</span>) ? f.includeRed : <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeGreen</span>: (f.includeGreen != <span class="hljs-literal">null</span>) ? f.includeGreen : <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeBlue</span>: (f.includeBlue != <span class="hljs-literal">null</span>) ? f.includeBlue : <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeAlpha</span>: (f.includeAlpha != <span class="hljs-literal">null</span>) ? f.includeAlpha : <span class="hljs-literal">false</span>,
            <span class="hljs-attr">processHorizontal</span>: (f.processHorizontal != <span class="hljs-literal">null</span>) ? f.processHorizontal : <span class="hljs-literal">true</span>,
            <span class="hljs-attr">processVertical</span>: (f.processVertical != <span class="hljs-literal">null</span>) ? f.processVertical : <span class="hljs-literal">true</span>,
            <span class="hljs-attr">radius</span>: (f.radius != <span class="hljs-literal">null</span>) ? f.radius : <span class="hljs-number">1</span>,
            <span class="hljs-attr">passes</span>: (f.passes != <span class="hljs-literal">null</span>) ? f.passes : <span class="hljs-number">1</span>,
            <span class="hljs-attr">step</span>: (f.step != <span class="hljs-literal">null</span>) ? f.step : <span class="hljs-number">1</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p><strong>brightness</strong> - adjusts the brightness of the image</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    brightness: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        <span class="hljs-keyword">let</span> level = (f.level != <span class="hljs-literal">null</span>) ? f.level : <span class="hljs-number">1</span>;

        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;modulate-channels&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">red</span>: level,
            <span class="hljs-attr">green</span>: level,
            <span class="hljs-attr">blue</span>: level,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p><strong>channelLevels</strong> (new in v8.4.0) - produces a posterize effect. Takes in four arguments - “red”, “green”, “blue” and “alpha” - each of which is an Array of zero or more integer Numbers (between 0 and 255). The filter works by looking at each pixel’s channel value and determines which of the corresponding Array’s Number values it is closest to; it then sets the channel value to that Number value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    channelLevels: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;lock-channels-to-levels&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">red</span>: (f.red != <span class="hljs-literal">null</span>) ? f.red : [<span class="hljs-number">0</span>],
            <span class="hljs-attr">green</span>: (f.green != <span class="hljs-literal">null</span>) ? f.green : [<span class="hljs-number">0</span>],
            <span class="hljs-attr">blue</span>: (f.blue != <span class="hljs-literal">null</span>) ? f.blue : [<span class="hljs-number">0</span>],
            <span class="hljs-attr">alpha</span>: (f.alpha != <span class="hljs-literal">null</span>) ? f.alpha : [<span class="hljs-number">255</span>],
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p><strong>thiskey</strong> - </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    channels: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;modulate-channels&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">red</span>: (f.red != <span class="hljs-literal">null</span>) ? f.red : <span class="hljs-number">1</span>,
            <span class="hljs-attr">green</span>: (f.green != <span class="hljs-literal">null</span>) ? f.green : <span class="hljs-number">1</span>,
            <span class="hljs-attr">blue</span>: (f.blue != <span class="hljs-literal">null</span>) ? f.blue : <span class="hljs-number">1</span>,
            <span class="hljs-attr">alpha</span>: (f.alpha != <span class="hljs-literal">null</span>) ? f.alpha : <span class="hljs-number">1</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p><strong>thiskey</strong> - </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    channelstep: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;step-channels&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">red</span>: (f.red != <span class="hljs-literal">null</span>) ? f.red : <span class="hljs-number">1</span>,
            <span class="hljs-attr">green</span>: (f.green != <span class="hljs-literal">null</span>) ? f.green : <span class="hljs-number">1</span>,
            <span class="hljs-attr">blue</span>: (f.blue != <span class="hljs-literal">null</span>) ? f.blue : <span class="hljs-number">1</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p><strong>thiskey</strong> (new in v8.4.0) - </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    channelsToAlpha: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;channels-to-alpha&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">includeRed</span>: (f.includeRed != <span class="hljs-literal">null</span>) ? f.includeRed : <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeGreen</span>: (f.includeGreen != <span class="hljs-literal">null</span>) ? f.includeGreen : <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeBlue</span>: (f.includeBlue != <span class="hljs-literal">null</span>) ? f.includeBlue : <span class="hljs-literal">true</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p><strong>thiskey</strong> - </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    chroma: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;chroma&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">ranges</span>: (f.ranges != <span class="hljs-literal">null</span>) ? f.ranges : [],
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p><strong>thiskey</strong> (new in v8.4.0) - </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    chromakey: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;colors-to-alpha&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">red</span>: (f.red != <span class="hljs-literal">null</span>) ? f.red : <span class="hljs-number">0</span>,
            <span class="hljs-attr">green</span>: (f.green != <span class="hljs-literal">null</span>) ? f.green : <span class="hljs-number">255</span>,
            <span class="hljs-attr">blue</span>: (f.blue != <span class="hljs-literal">null</span>) ? f.blue : <span class="hljs-number">0</span>,
            <span class="hljs-attr">transparentAt</span>: (f.transparentAt != <span class="hljs-literal">null</span>) ? f.transparentAt : <span class="hljs-number">0</span>,
            <span class="hljs-attr">opaqueAt</span>: (f.opaqueAt != <span class="hljs-literal">null</span>) ? f.opaqueAt : <span class="hljs-number">1</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p><strong>thiskey</strong> (new in v8.4.0) - </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    clampChannels: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;clamp-channels&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">lowRed</span>: (f.lowRed != <span class="hljs-literal">null</span>) ? f.lowRed : <span class="hljs-number">0</span>,
            <span class="hljs-attr">lowGreen</span>: (f.lowGreen != <span class="hljs-literal">null</span>) ? f.lowGreen : <span class="hljs-number">0</span>,
            <span class="hljs-attr">lowBlue</span>: (f.lowBlue != <span class="hljs-literal">null</span>) ? f.lowBlue : <span class="hljs-number">0</span>,
            <span class="hljs-attr">highRed</span>: (f.highRed != <span class="hljs-literal">null</span>) ? f.highRed : <span class="hljs-number">255</span>,
            <span class="hljs-attr">highGreen</span>: (f.highGreen != <span class="hljs-literal">null</span>) ? f.highGreen : <span class="hljs-number">255</span>,
            <span class="hljs-attr">highBlue</span>: (f.highBlue != <span class="hljs-literal">null</span>) ? f.highBlue : <span class="hljs-number">255</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p><strong>compose</strong> (new in v8.4.0) - perform a composite operation on two images; available compose options include: ‘destination-only’, ‘destination-over’, ‘destination-in’, ‘destination-out’, ‘destination-atop’, ‘source-only’, ‘source-over’ (default), ‘source-in’, ‘source-out’, ‘source-atop’, ‘clear’, and ‘xor’ - see <a href="https://www.w3.org/TR/compositing-1/#porterduffcompositingoperators">W3C Compositing and Blending recommendations</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    compose: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;compose&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineMix</span>: (f.lineMix != <span class="hljs-literal">null</span>) ? f.lineMix : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">compose</span>: (f.compose != <span class="hljs-literal">null</span>) ? f.compose : <span class="hljs-string">&#x27;source-over&#x27;</span>,
            <span class="hljs-attr">offsetX</span>: (f.offsetX != <span class="hljs-literal">null</span>) ? f.offsetX : <span class="hljs-number">0</span>,
            <span class="hljs-attr">offsetY</span>: (f.offsetY != <span class="hljs-literal">null</span>) ? f.offsetY : <span class="hljs-number">0</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p><strong>cyan</strong> - removes red channel color from the image, and averages the remaining channel colors</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    cyan: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;average-channels&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">includeGreen</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeBlue</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">excludeRed</span>: <span class="hljs-literal">true</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p><strong>displace</strong> (new in v8.4.0) - moves pixels around the image, based on the color channel values supplied by a displacement map image</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    displace: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;displace&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineMix</span>: (f.lineMix != <span class="hljs-literal">null</span>) ? f.lineMix : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">channelX</span>: (f.channelX != <span class="hljs-literal">null</span>) ? f.channelX : <span class="hljs-string">&#x27;red&#x27;</span>,
            <span class="hljs-attr">channelY</span>: (f.channelY != <span class="hljs-literal">null</span>) ? f.channelY : <span class="hljs-string">&#x27;green&#x27;</span>,
            <span class="hljs-attr">offsetX</span>: (f.offsetX != <span class="hljs-literal">null</span>) ? f.offsetX : <span class="hljs-number">0</span>,
            <span class="hljs-attr">offsetY</span>: (f.offsetY != <span class="hljs-literal">null</span>) ? f.offsetY : <span class="hljs-number">0</span>,
            <span class="hljs-attr">scaleX</span>: (f.scaleX != <span class="hljs-literal">null</span>) ? f.scaleX : <span class="hljs-number">1</span>,
            <span class="hljs-attr">scaleY</span>: (f.scaleY != <span class="hljs-literal">null</span>) ? f.scaleY : <span class="hljs-number">1</span>,
            <span class="hljs-attr">transparentEdges</span>: (f.transparentEdges != <span class="hljs-literal">null</span>) ? f.transparentEdges : <span class="hljs-literal">false</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p><strong>edgeDetect</strong> (new in v8.4.0) - applies a preset 3x3 edge-detect matrix to the image</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    edgeDetect: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;matrix&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">width</span>: <span class="hljs-number">3</span>,
            <span class="hljs-attr">height</span>: <span class="hljs-number">3</span>,
            <span class="hljs-attr">offsetX</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">offsetY</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">includeRed</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeGreen</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeBlue</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeAlpha</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">weights</span>: [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,-<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>],
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p><strong>emboss</strong> (new in v8.4.0) - outputs a black-gray-red emboss effect</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    emboss: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        <span class="hljs-keyword">const</span> actions = [];
        <span class="hljs-keyword">if</span> (f.useNaturalGrayscale) {
            actions.push({
                <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;grayscale&#x27;</span>,
                <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
                <span class="hljs-attr">lineOut</span>: <span class="hljs-string">&#x27;emboss-work&#x27;</span>,
            });
        }
        <span class="hljs-keyword">else</span> {
            actions.push({
                <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;average-channels&#x27;</span>,
                <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
                <span class="hljs-attr">lineOut</span>: <span class="hljs-string">&#x27;emboss-work&#x27;</span>,
                <span class="hljs-attr">includeRed</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">includeGreen</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">includeBlue</span>: <span class="hljs-literal">true</span>,
            });
        }
        <span class="hljs-keyword">if</span> (f.clamp) {
            actions.push({
                <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;clamp-channels&#x27;</span>,
                <span class="hljs-attr">lineIn</span>: <span class="hljs-string">&#x27;emboss-work&#x27;</span>,
                <span class="hljs-attr">lineOut</span>: <span class="hljs-string">&#x27;emboss-work&#x27;</span>,
                <span class="hljs-attr">lowRed</span>: <span class="hljs-number">0</span> + f.clamp, 
                <span class="hljs-attr">lowGreen</span>: <span class="hljs-number">0</span> + f.clamp, 
                <span class="hljs-attr">lowBlue</span>: <span class="hljs-number">0</span> + f.clamp, 
                <span class="hljs-attr">highRed</span>: <span class="hljs-number">255</span> - f.clamp, 
                <span class="hljs-attr">highGreen</span>: <span class="hljs-number">255</span> - f.clamp, 
                <span class="hljs-attr">highBlue</span>: <span class="hljs-number">255</span> - f.clamp,
            });
        }
        <span class="hljs-keyword">if</span> (f.smoothing) {
            actions.push({
                <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;blur&#x27;</span>,
                <span class="hljs-attr">lineIn</span>: <span class="hljs-string">&#x27;emboss-work&#x27;</span>,
                <span class="hljs-attr">lineOut</span>: <span class="hljs-string">&#x27;emboss-work&#x27;</span>,
                <span class="hljs-attr">radius</span>: f.smoothing,
                <span class="hljs-attr">passes</span>: <span class="hljs-number">2</span>,
            });
        }
        actions.push({
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;emboss&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: <span class="hljs-string">&#x27;emboss-work&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">angle</span>: (f.angle != <span class="hljs-literal">null</span>) ? f.angle : <span class="hljs-number">0</span>,
            <span class="hljs-attr">strength</span>: (f.strength != <span class="hljs-literal">null</span>) ? f.strength : <span class="hljs-number">1</span>,
            <span class="hljs-attr">tolerance</span>: (f.tolerance != <span class="hljs-literal">null</span>) ? f.tolerance : <span class="hljs-number">0</span>,
            <span class="hljs-attr">keepOnlyChangedAreas</span>: (f.keepOnlyChangedAreas != <span class="hljs-literal">null</span>) ? f.keepOnlyChangedAreas : <span class="hljs-literal">false</span>,
            <span class="hljs-attr">postProcessResults</span>: (f.postProcessResults != <span class="hljs-literal">null</span>) ? f.postProcessResults : <span class="hljs-literal">true</span>,
        });
        f.actions = actions;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p><strong>flood</strong> (new in v8.4.0) - creates a uniform sheet of the required color, which can then be used by other filter actions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    flood: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;flood&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">red</span>: (f.red != <span class="hljs-literal">null</span>) ? f.red : <span class="hljs-number">0</span>,
            <span class="hljs-attr">green</span>: (f.green != <span class="hljs-literal">null</span>) ? f.green : <span class="hljs-number">0</span>,
            <span class="hljs-attr">blue</span>: (f.blue != <span class="hljs-literal">null</span>) ? f.blue : <span class="hljs-number">0</span>,
            <span class="hljs-attr">alpha</span>: (f.alpha != <span class="hljs-literal">null</span>) ? f.alpha : <span class="hljs-number">255</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p><strong>gray</strong> (new in v8.4.0) - averages the three color channel colors</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    gray: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;average-channels&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">includeRed</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeGreen</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeBlue</span>: <span class="hljs-literal">true</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p><strong>grayscale</strong> - produces a more realistic black-and-white photograph effect</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    grayscale: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;grayscale&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p><strong>green</strong> - removes red and blue channel color from the image</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    green: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;average-channels&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">excludeRed</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">excludeBlue</span>: <span class="hljs-literal">true</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p><strong>image</strong> (new in v8.4.0) - load an image into the web worker, where it can then be used by other filter actions - useful for effects such as watermarking an image</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    image: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{

        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;process-image&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">asset</span>: (f.asset != <span class="hljs-literal">null</span>) ? f.asset : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">width</span>: (f.width != <span class="hljs-literal">null</span>) ? f.width : <span class="hljs-number">1</span>,
            <span class="hljs-attr">height</span>: (f.height != <span class="hljs-literal">null</span>) ? f.height : <span class="hljs-number">1</span>,
            <span class="hljs-attr">copyWidth</span>: (f.copyWidth != <span class="hljs-literal">null</span>) ? f.copyWidth : <span class="hljs-number">1</span>,
            <span class="hljs-attr">copyHeight</span>: (f.copyHeight != <span class="hljs-literal">null</span>) ? f.copyHeight : <span class="hljs-number">1</span>,
            <span class="hljs-attr">copyX</span>: (f.copyX != <span class="hljs-literal">null</span>) ? f.copyX : <span class="hljs-number">0</span>,
            <span class="hljs-attr">copyY</span>: (f.copyY != <span class="hljs-literal">null</span>) ? f.copyY : <span class="hljs-number">0</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p><strong>invert</strong> - inverts the colors in the image, producing an effect similar to a photograph negative</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    invert: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;invert-channels&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">includeRed</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeGreen</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeBlue</span>: <span class="hljs-literal">true</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p><strong>magenta</strong> - removes green channel color from the image, and averages the remaining channel colors</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    magenta: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;average-channels&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">includeRed</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeBlue</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">excludeGreen</span>: <span class="hljs-literal">true</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p><strong>matrix</strong> - applies a 3x3 convolution matrix, kernel or mask operation to the image</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    matrix: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;matrix&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">width</span>: <span class="hljs-number">3</span>,
            <span class="hljs-attr">height</span>: <span class="hljs-number">3</span>,
            <span class="hljs-attr">offsetX</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">offsetY</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">includeRed</span>: (f.includeRed != <span class="hljs-literal">null</span>) ? f.includeRed : <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeGreen</span>: (f.includeGreen != <span class="hljs-literal">null</span>) ? f.includeGreen : <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeBlue</span>: (f.includeBlue != <span class="hljs-literal">null</span>) ? f.includeBlue : <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeAlpha</span>: (f.includeAlpha != <span class="hljs-literal">null</span>) ? f.includeAlpha : <span class="hljs-literal">false</span>,
            <span class="hljs-attr">weights</span>: (f.weights != <span class="hljs-literal">null</span>) ? f.weights : [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>],
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p><strong>matrix5</strong> - applies a 5x5 convolution matrix, kernel or mask operation to the image</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    matrix5: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;matrix&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">width</span>: <span class="hljs-number">5</span>,
            <span class="hljs-attr">height</span>: <span class="hljs-number">5</span>,
            <span class="hljs-attr">offsetX</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">offsetY</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">includeRed</span>: (f.includeRed != <span class="hljs-literal">null</span>) ? f.includeRed : <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeGreen</span>: (f.includeGreen != <span class="hljs-literal">null</span>) ? f.includeGreen : <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeBlue</span>: (f.includeBlue != <span class="hljs-literal">null</span>) ? f.includeBlue : <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeAlpha</span>: (f.includeAlpha != <span class="hljs-literal">null</span>) ? f.includeAlpha : <span class="hljs-literal">false</span>,
            <span class="hljs-attr">weights</span>: (f.weights != <span class="hljs-literal">null</span>) ? f.weights : [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>],
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p><strong>notblue</strong> - zeroes the blue channel values (not the same effect as the yellow filter)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    notblue: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;set-channel-to-level&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">includeBlue</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">level</span>: <span class="hljs-number">0</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p><strong>notgreen</strong> - zeroes the green channel values (not the same effect as the magenta filter)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    notgreen: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;set-channel-to-level&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">includeGreen</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">level</span>: <span class="hljs-number">0</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p><strong>notred</strong> - zeroes the red channel values (not the same effect as the cyan filter)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    notred: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;set-channel-to-level&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">includeRed</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">level</span>: <span class="hljs-number">0</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p><strong>offset</strong> (new in v8.4.0) - moves the image in its entirety by the given offset</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    offset: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;offset&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">offsetRedX</span>: (f.offsetX != <span class="hljs-literal">null</span>) ? f.offsetX : <span class="hljs-number">0</span>,
            <span class="hljs-attr">offsetRedY</span>: (f.offsetY != <span class="hljs-literal">null</span>) ? f.offsetY : <span class="hljs-number">0</span>,
            <span class="hljs-attr">offsetGreenX</span>: (f.offsetX != <span class="hljs-literal">null</span>) ? f.offsetX : <span class="hljs-number">0</span>,
            <span class="hljs-attr">offsetGreenY</span>: (f.offsetY != <span class="hljs-literal">null</span>) ? f.offsetY : <span class="hljs-number">0</span>,
            <span class="hljs-attr">offsetBlueX</span>: (f.offsetX != <span class="hljs-literal">null</span>) ? f.offsetX : <span class="hljs-number">0</span>,
            <span class="hljs-attr">offsetBlueY</span>: (f.offsetY != <span class="hljs-literal">null</span>) ? f.offsetY : <span class="hljs-number">0</span>,
            <span class="hljs-attr">offsetAlphaX</span>: (f.offsetX != <span class="hljs-literal">null</span>) ? f.offsetX : <span class="hljs-number">0</span>,
            <span class="hljs-attr">offsetAlphaY</span>: (f.offsetY != <span class="hljs-literal">null</span>) ? f.offsetY : <span class="hljs-number">0</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p><strong>offsetChannels</strong> (new in v8.4.0) - moves each channel  by an offset set for that channel. Can create a crude stereoscopic output</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    offsetChannels: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;offset&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">offsetRedX</span>: (f.offsetRedX != <span class="hljs-literal">null</span>) ? f.offsetRedX : <span class="hljs-number">0</span>,
            <span class="hljs-attr">offsetRedY</span>: (f.offsetRedY != <span class="hljs-literal">null</span>) ? f.offsetRedY : <span class="hljs-number">0</span>,
            <span class="hljs-attr">offsetGreenX</span>: (f.offsetGreenX != <span class="hljs-literal">null</span>) ? f.offsetGreenX : <span class="hljs-number">0</span>,
            <span class="hljs-attr">offsetGreenY</span>: (f.offsetGreenY != <span class="hljs-literal">null</span>) ? f.offsetGreenY : <span class="hljs-number">0</span>,
            <span class="hljs-attr">offsetBlueX</span>: (f.offsetBlueX != <span class="hljs-literal">null</span>) ? f.offsetBlueX : <span class="hljs-number">0</span>,
            <span class="hljs-attr">offsetBlueY</span>: (f.offsetBlueY != <span class="hljs-literal">null</span>) ? f.offsetBlueY : <span class="hljs-number">0</span>,
            <span class="hljs-attr">offsetAlphaX</span>: (f.offsetAlphaX != <span class="hljs-literal">null</span>) ? f.offsetAlphaX : <span class="hljs-number">0</span>,
            <span class="hljs-attr">offsetAlphaY</span>: (f.offsetAlphaY != <span class="hljs-literal">null</span>) ? f.offsetAlphaY : <span class="hljs-number">0</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p><strong>pixelate</strong> - averages the colors in a block to produce a series of obscuring tiles</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    pixelate: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;pixelate&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">tileWidth</span>: (f.tileWidth != <span class="hljs-literal">null</span>) ? f.tileWidth : <span class="hljs-number">1</span>,
            <span class="hljs-attr">tileHeight</span>: (f.tileHeight != <span class="hljs-literal">null</span>) ? f.tileHeight : <span class="hljs-number">1</span>,
            <span class="hljs-attr">offsetX</span>: (f.offsetX != <span class="hljs-literal">null</span>) ? f.offsetX : <span class="hljs-number">0</span>,
            <span class="hljs-attr">offsetY</span>: (f.offsetY != <span class="hljs-literal">null</span>) ? f.offsetY : <span class="hljs-number">0</span>,
            <span class="hljs-attr">includeRed</span>: (f.includeRed != <span class="hljs-literal">null</span>) ? f.includeRed : <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeGreen</span>: (f.includeGreen != <span class="hljs-literal">null</span>) ? f.includeGreen : <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeBlue</span>: (f.includeBlue != <span class="hljs-literal">null</span>) ? f.includeBlue : <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeAlpha</span>: (f.includeAlpha != <span class="hljs-literal">null</span>) ? f.includeAlpha : <span class="hljs-literal">false</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p><strong>red</strong> - removes blue and green channel color from the image</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    red: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;average-channels&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">excludeGreen</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">excludeBlue</span>: <span class="hljs-literal">true</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p><strong>saturation</strong> - alters the saturation level of the image</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    saturation: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        <span class="hljs-keyword">let</span> level = (f.level != <span class="hljs-literal">null</span>) ? f.level : <span class="hljs-number">1</span>;

        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;modulate-channels&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">red</span>: level,
            <span class="hljs-attr">green</span>: level,
            <span class="hljs-attr">blue</span>: level,
            <span class="hljs-attr">saturation</span>: <span class="hljs-literal">true</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p><strong>sepia</strong> - recalculates the values of each color channel (a tint action) to create a more ‘antique’ version of the image</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    sepia: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;tint-channels&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">redInRed</span>: <span class="hljs-number">0.393</span>,
            <span class="hljs-attr">redInGreen</span>: <span class="hljs-number">0.349</span>,
            <span class="hljs-attr">redInBlue</span>: <span class="hljs-number">0.272</span>,
            <span class="hljs-attr">greenInRed</span>: <span class="hljs-number">0.769</span>,
            <span class="hljs-attr">greenInGreen</span>: <span class="hljs-number">0.686</span>,
            <span class="hljs-attr">greenInBlue</span>: <span class="hljs-number">0.534</span>,
            <span class="hljs-attr">blueInRed</span>: <span class="hljs-number">0.189</span>,
            <span class="hljs-attr">blueInGreen</span>: <span class="hljs-number">0.168</span>,
            <span class="hljs-attr">blueInBlue</span>: <span class="hljs-number">0.131</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p><strong>sharpen</strong> (new in v8.4.0) - applies a preset 3x3 sharpen matrix to the image</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    sharpen: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;matrix&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">width</span>: <span class="hljs-number">3</span>,
            <span class="hljs-attr">height</span>: <span class="hljs-number">3</span>,
            <span class="hljs-attr">offsetX</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">offsetY</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">includeRed</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeGreen</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeBlue</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeAlpha</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">weights</span>: [<span class="hljs-number">0</span>,-<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,-<span class="hljs-number">1</span>,<span class="hljs-number">5</span>,-<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,-<span class="hljs-number">1</span>,<span class="hljs-number">0</span>],
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p><strong>threshold</strong> - creates a duotone effect - grayscales the input then, for each pixel, checks the color channel values against a “level” argument: pixels with channel values above the level value are assigned to the ‘high’ color; otherwise they are updated to the ‘low’ color.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    threshold: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        <span class="hljs-keyword">let</span> lowRed = (f.lowRed != <span class="hljs-literal">null</span>) ? f.lowRed : <span class="hljs-number">0</span>,
            lowGreen = (f.lowGreen != <span class="hljs-literal">null</span>) ? f.lowGreen : <span class="hljs-number">0</span>,
            lowBlue = (f.lowBlue != <span class="hljs-literal">null</span>) ? f.lowBlue : <span class="hljs-number">0</span>,
            highRed = (f.highRed != <span class="hljs-literal">null</span>) ? f.highRed : <span class="hljs-number">255</span>,
            highGreen = (f.highGreen != <span class="hljs-literal">null</span>) ? f.highGreen : <span class="hljs-number">255</span>,
            highBlue = (f.highBlue != <span class="hljs-literal">null</span>) ? f.highBlue : <span class="hljs-number">255</span>;

        <span class="hljs-keyword">let</span> low = (f.low != <span class="hljs-literal">null</span>) ? f.low : [lowRed, lowGreen, lowBlue],
            high = (f.high != <span class="hljs-literal">null</span>) ? f.high : [highRed, highGreen, highBlue];

        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;threshold&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">level</span>: (f.level != <span class="hljs-literal">null</span>) ? f.level : <span class="hljs-number">128</span>,
            <span class="hljs-attr">low</span>: low,
            <span class="hljs-attr">high</span>: high,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p><strong>tint</strong> - has similarities to the SVG &lt;feColorMatrix&gt; filter element, but excludes the alpha channel from calculations. Rather than set a matrix, we set nine arguments to determine how the value of each color channel in a pixel will affect both itself and its fellow color channels.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    tint: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;tint-channels&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">redInRed</span>: (f.redInRed != <span class="hljs-literal">null</span>) ? f.redInRed : <span class="hljs-number">1</span>,
            <span class="hljs-attr">redInGreen</span>: (f.redInGreen != <span class="hljs-literal">null</span>) ? f.redInGreen : <span class="hljs-number">0</span>,
            <span class="hljs-attr">redInBlue</span>: (f.redInBlue != <span class="hljs-literal">null</span>) ? f.redInBlue : <span class="hljs-number">0</span>,
            <span class="hljs-attr">greenInRed</span>: (f.greenInRed != <span class="hljs-literal">null</span>) ? f.greenInRed : <span class="hljs-number">0</span>,
            <span class="hljs-attr">greenInGreen</span>: (f.greenInGreen != <span class="hljs-literal">null</span>) ? f.greenInGreen : <span class="hljs-number">1</span>,
            <span class="hljs-attr">greenInBlue</span>: (f.greenInBlue != <span class="hljs-literal">null</span>) ? f.greenInBlue : <span class="hljs-number">0</span>,
            <span class="hljs-attr">blueInRed</span>: (f.blueInRed != <span class="hljs-literal">null</span>) ? f.blueInRed : <span class="hljs-number">0</span>,
            <span class="hljs-attr">blueInGreen</span>: (f.blueInGreen != <span class="hljs-literal">null</span>) ? f.blueInGreen : <span class="hljs-number">0</span>,
            <span class="hljs-attr">blueInBlue</span>: (f.blueInBlue != <span class="hljs-literal">null</span>) ? f.blueInBlue : <span class="hljs-number">1</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p><strong>userDefined</strong> - DEPRECATED - this filter method no longer has any effect, returning an unchanged image</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    userDefined: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;user-defined-legacy&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
        }];
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p><strong>yellow</strong> - removes blue channel color from the image, and averages the remaining channel colors</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    yellow: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{
        f.actions = [{
            <span class="hljs-attr">action</span>: <span class="hljs-string">&#x27;average-channels&#x27;</span>,
            <span class="hljs-attr">lineIn</span>: (f.lineIn != <span class="hljs-literal">null</span>) ? f.lineIn : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">lineOut</span>: (f.lineOut != <span class="hljs-literal">null</span>) ? f.lineOut : <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">opacity</span>: (f.opacity != <span class="hljs-literal">null</span>) ? f.opacity : <span class="hljs-number">1</span>,
            <span class="hljs-attr">includeRed</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">includeGreen</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">excludeBlue</span>: <span class="hljs-literal">true</span>,
        }];
    },
};</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <h4 id="prototype-functions">Prototype functions</h4>
<p>No additional prototype functions defined</p>

            </div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <h4 id="filter-engine-pool">Filter engine pool</h4>
<p>For now, we use one filter engine</p>
<ul>
<li>This used to be a pool of web workers which loaded up filter functionality</li>
<li>Now it is just another module call in the main thread</li>
<li>Which means that, as filters web workers were the only reason for using Promises, we can get rid of promises</li>
<li>Because my testing seems to indicate that workers were no faster than this code, possibly slower!</li>
<li>Getting rid of Promises would massively simplify the code base, but would lead to breaking changes</li>
<li>But there is surely scope for getting rid of them as far as possible eg simplifying entity stamp workflow</li>
<li>And now we have a good place to start our WASM experiments, with filters</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> filterPool = makeFilterEngine();

<span class="hljs-keyword">const</span> requestFilterWorker = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> filterPool;
};

<span class="hljs-keyword">const</span> releaseFilterWorker = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">f</span>) </span>{};

<span class="hljs-keyword">const</span> actionFilterWorker = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ignore, items</span>) </span>{

	<span class="hljs-keyword">let</span> res = filterPool.action(items);
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.resolve(res);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <h4 id="factory">Factory</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> makeFilter = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Filter(items);
};

<span class="hljs-title">constructors</span>.<span class="hljs-title">Filter</span> = <span class="hljs-title">Filter</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <h4 id="exports">Exports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> {
    makeFilter,
    requestFilterWorker,
    releaseFilterWorker,
    actionFilterWorker,
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
