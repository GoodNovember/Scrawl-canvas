<!DOCTYPE html>

<html>
<head>
  <title>Loom factory</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../core/animationloop.html">
                  ./source/core/animationloop.js
                </a>
              
                
                <a class="source" href="../core/component.html">
                  ./source/core/component.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/events.html">
                  ./source/core/events.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/userInteraction.html">
                  ./source/core/userInteraction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="bezier.html">
                  ./source/factory/bezier.js
                </a>
              
                
                <a class="source" href="block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="emitter.html">
                  ./source/factory/emitter.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="fontAttributes.html">
                  ./source/factory/fontAttributes.js
                </a>
              
                
                <a class="source" href="gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="imageAsset.html">
                  ./source/factory/imageAsset.js
                </a>
              
                
                <a class="source" href="line.html">
                  ./source/factory/line.js
                </a>
              
                
                <a class="source" href="loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="net.html">
                  ./source/factory/net.js
                </a>
              
                
                <a class="source" href="oval.html">
                  ./source/factory/oval.js
                </a>
              
                
                <a class="source" href="palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="particle.html">
                  ./source/factory/particle.js
                </a>
              
                
                <a class="source" href="particleForce.html">
                  ./source/factory/particleForce.js
                </a>
              
                
                <a class="source" href="particleHistory.html">
                  ./source/factory/particleHistory.js
                </a>
              
                
                <a class="source" href="particleSpring.html">
                  ./source/factory/particleSpring.js
                </a>
              
                
                <a class="source" href="particleWorld.html">
                  ./source/factory/particleWorld.js
                </a>
              
                
                <a class="source" href="pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="polygon.html">
                  ./source/factory/polygon.js
                </a>
              
                
                <a class="source" href="polyline.html">
                  ./source/factory/polyline.js
                </a>
              
                
                <a class="source" href="quadratic.html">
                  ./source/factory/quadratic.js
                </a>
              
                
                <a class="source" href="quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="radialGradient.html">
                  ./source/factory/radialGradient.js
                </a>
              
                
                <a class="source" href="rectangle.html">
                  ./source/factory/rectangle.js
                </a>
              
                
                <a class="source" href="renderAnimation.html">
                  ./source/factory/renderAnimation.js
                </a>
              
                
                <a class="source" href="shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="spiral.html">
                  ./source/factory/spiral.js
                </a>
              
                
                <a class="source" href="spriteAsset.html">
                  ./source/factory/spriteAsset.js
                </a>
              
                
                <a class="source" href="stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="star.html">
                  ./source/factory/star.js
                </a>
              
                
                <a class="source" href="state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="tetragon.html">
                  ./source/factory/tetragon.js
                </a>
              
                
                <a class="source" href="ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="tracer.html">
                  ./source/factory/tracer.js
                </a>
              
                
                <a class="source" href="tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="unstackedElement.html">
                  ./source/factory/unstackedElement.js
                </a>
              
                
                <a class="source" href="vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="videoAsset.html">
                  ./source/factory/videoAsset.js
                </a>
              
                
                <a class="source" href="wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="../mixin/anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="../mixin/asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="../mixin/assetConsumer.html">
                  ./source/mixin/assetConsumer.js
                </a>
              
                
                <a class="source" href="../mixin/base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="../mixin/cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="../mixin/delta.html">
                  ./source/mixin/delta.js
                </a>
              
                
                <a class="source" href="../mixin/displayShape.html">
                  ./source/mixin/displayShape.js
                </a>
              
                
                <a class="source" href="../mixin/dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="../mixin/entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="../mixin/filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="../mixin/mimic.html">
                  ./source/mixin/mimic.js
                </a>
              
                
                <a class="source" href="../mixin/path.html">
                  ./source/mixin/path.js
                </a>
              
                
                <a class="source" href="../mixin/pattern.html">
                  ./source/mixin/pattern.js
                </a>
              
                
                <a class="source" href="../mixin/pivot.html">
                  ./source/mixin/pivot.js
                </a>
              
                
                <a class="source" href="../mixin/position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="../mixin/shapeBasic.html">
                  ./source/mixin/shapeBasic.js
                </a>
              
                
                <a class="source" href="../mixin/shapeCurve.html">
                  ./source/mixin/shapeCurve.js
                </a>
              
                
                <a class="source" href="../mixin/shapePathCalculation.html">
                  ./source/mixin/shapePathCalculation.js
                </a>
              
                
                <a class="source" href="../mixin/styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="../mixin/tween.html">
                  ./source/mixin/tween.js
                </a>
              
                
                <a class="source" href="../worker/filter-stringed.html">
                  ./source/worker/filter-stringed.js
                </a>
              
                
                <a class="source" href="../worker/filter.html">
                  ./source/worker/filter.js
                </a>
              
                
                <a class="source" href="../worker/filter_canvas.html">
                  ./source/worker/filter_canvas.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="loom-factory">Loom factory</h1>
<p>A Loom offers functionality to render an image onto a &lt;canvas&gt; element, where the image is not a rectangle - it can have curved borders. It can also offer the illusion of flat 3D images in the canvas, giving them perspective.</p>
<p>Loom entitys are <strong><em>composite entitys</em></strong> - an wentity that relies on other entitys for its basic functionality.</p>
<ul>
<li>Every Loom object requires two (or one) path-enabled <a href="./shape.html">Shape</a> entitys to act as its left and right tracks.</li>
<li>A Loom entity also requires a <a href="./picture.html">Picture</a> entity to act as its image source.</li>
<li>Looms can use CSS color Strings for their strokeStyle values, alongside <strong>Gradient</strong>, <strong>RadialGradient</strong>, <strong>Color</strong> and <strong>Pattern</strong> objects. </li>
<li>They can use <strong>Anchor</strong> objects for user navigation. </li>
<li>They can be rendered to the canvas by including them in a <strong>Cell</strong> object’s <strong>Group</strong>. </li>
<li>They can be <strong>animated</strong> directly, or using delta animation, or act as the target for <strong>Tween</strong> animations.</li>
<li>Looms can be cloned, and killed.</li>
</ul>
<p><strong><em>Note that this is experimental technology!</em></strong></p>
<ul>
<li>Current code does not use <a href="./mixin/position.html">position</a> or <a href="./mixin/entity.html">entity</a> mixins, meaning much of the code here has been copied over from those mixins (DRY issue).</li>
<li>TODO: clone functionality not yet tested. A possible use case is to clome a Loom so they share the same Shape struts, but have different Picture sources and <code>from/toPathStart/End</code> cursor values - multiple images tracked and animated.</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h4 id="demos">Demos:</h4>
<ul>
<li><a href="../../demo/canvas-024.html">Canvas-024</a> - Loom entity functionality</li>
<li><a href="../../demo/dom-015.html">DOM-015</a> - Use stacked DOM artefact corners as pivot points</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h4 id="imports">Imports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { <span class="hljs-title">constructors</span>, <span class="hljs-title">artefact</span> } <span class="hljs-title">from</span> &#x27;../<span class="hljs-title">core</span>/<span class="hljs-title">library</span>.<span class="hljs-title">js</span>&#x27;;
<span class="hljs-keyword">import</span> { currentGroup } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/document.js&#x27;</span>;
<span class="hljs-keyword">import</span> { mergeOver, mergeDiscard, pushUnique, λ<span class="hljs-literal">null</span>, λ<span class="hljs-built_in">this</span>, xta } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/utilities.js&#x27;</span>;

<span class="hljs-keyword">import</span> { makeState } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../factory/state.js&#x27;</span>;
<span class="hljs-keyword">import</span> { requestCell, releaseCell } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../factory/cell.js&#x27;</span>;

<span class="hljs-keyword">import</span> baseMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/base.js&#x27;</span>;
<span class="hljs-keyword">import</span> anchorMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/anchor.js&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h4 id="loom-constructor">Loom constructor</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Loom = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-built_in">this</span>.makeName(items.name);
    <span class="hljs-built_in">this</span>.register();

    <span class="hljs-built_in">this</span>.set(<span class="hljs-built_in">this</span>.defs);

    <span class="hljs-built_in">this</span>.state = makeState();

    <span class="hljs-keyword">if</span> (!items.group) items.group = currentGroup;

    <span class="hljs-built_in">this</span>.onEnter = λ<span class="hljs-literal">null</span>;
    <span class="hljs-built_in">this</span>.onLeave = λ<span class="hljs-literal">null</span>;
    <span class="hljs-built_in">this</span>.onDown = λ<span class="hljs-literal">null</span>;
    <span class="hljs-built_in">this</span>.onUp = λ<span class="hljs-literal">null</span>;

    <span class="hljs-built_in">this</span>.delta = {};

    <span class="hljs-built_in">this</span>.set(items);

    <span class="hljs-built_in">this</span>.fromPathData = [];
    <span class="hljs-built_in">this</span>.toPathData = [];

    <span class="hljs-built_in">this</span>.watchFromPath = <span class="hljs-literal">null</span>;
    <span class="hljs-built_in">this</span>.watchIndex = -<span class="hljs-number">1</span>;
    <span class="hljs-built_in">this</span>.engineInstructions = [];
    <span class="hljs-built_in">this</span>.engineDeltaLengths = [];

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h4 id="loom-prototype">Loom prototype</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> P = Loom.prototype = <span class="hljs-built_in">Object</span>.create(<span class="hljs-built_in">Object</span>.prototype);
P.type = <span class="hljs-string">&#x27;Loom&#x27;</span>;
P.lib = <span class="hljs-string">&#x27;entity&#x27;</span>;
P.isArtefact = <span class="hljs-literal">true</span>;
P.isAsset = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h4 id="mixins">Mixins</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P = baseMix(P);
P = anchorMix(P);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h4 id="loom-attributes">Loom attributes</h4>
<ul>
<li>Attributes defined in the <a href="../mixin/base.html">base mixin</a>: <strong>name</strong>.</li>
<li>Attributes defined in the <a href="../mixin/anchor.html">anchor mixin</a>: <strong>anchor</strong>.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> defaultAttributes = {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><strong>fromPath</strong>, <strong>toPath</strong> - A Loom entity uses 2 Shape paths to construct a frame between which the image will be redrawn. These attributes can be set using the Shapes’ name-String, or the Shape objects themselves</p>
<ul>
<li>The positioning, scaling etc of each strut is set in the constituent Shape entitys, not the Loom entity.</li>
<li>We can use a single path for both attributes, though nothing will show if the <code>start/end</code> attributs do not have differing values.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    fromPath: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">toPath</span>: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p><strong>fromPathStart</strong>, <strong>fromPathEnd</strong> and <strong>toPathStart</strong>, <strong>toPathEnd</strong> - float Numbers generally between <code>0.0 - 1.0</code> - The Loom entity can set the start and end cursors on each of its path struts, between which the image will be drawn. </p>
<ul>
<li>These can be animated to allow the image to <em>flow</em> between one part of the display and another, changing its shape as it moves.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    fromPathStart: <span class="hljs-number">0</span>,
    <span class="hljs-attr">fromPathEnd</span>: <span class="hljs-number">1</span>,

    <span class="hljs-attr">toPathStart</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">toPathEnd</span>: <span class="hljs-number">1</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p><strong>synchronizePathCursors</strong> - Boolean flag - To make sure the <code>from...</code> and <code>to...</code> strut start points, and end points, have the same value set the attribute to <code>true</code> (default). </p>
<ul>
<li>Setting it to <code>false</code> allows the cursors to be set independently on each strut … which in turn may lead to unexpected display consequences.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    synchronizePathCursors: <span class="hljs-literal">true</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p> <strong>loopPathCursors</strong> - Boolean flag - For animation purposes, the image will move between the struts with the bottom of the page appearing again at the top of the Loom as it moves down (and vice versa). </p>
<ul>
<li>To change this functionality - so that the image slowly disappears as it animates up and down past the ends of the struts, set the attribute to <code>false</code>.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    loopPathCursors: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">constantPathSpeed</span>: <span class="hljs-literal">true</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><strong>isHorizontalCopy</strong> - Boolean flag - Copying the source image to the output happens, by default, by rows - which effectively means the struts are on the left-hand and right-hand edges of the image. </p>
<ul>
<li>To change this to columns (which sets the struts to the top and bottom edges of the image) set the attribute to <code>false</code> </li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    isHorizontalCopy: <span class="hljs-literal">true</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><strong>showBoundingBox</strong> (Boolean), <strong>boundingBoxColor</strong> (CSS color String) - Mainly for library development/testing work - shows the loom entity’s bounding box - which is calculated from the constituent Shape entitys’ current bounding boxes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    showBoundingBox: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">boundingBoxColor</span>: <span class="hljs-string">&#x27;#000000&#x27;</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p><strong>source</strong> - The Picture entity source for this loom. For initialization and/or <code>set</code>, we can supply either the Picture entity itself, or its name-String value.</p>
<ul>
<li>The content image displayed by the Loom entity are set in the Picture entity, not the Loom, and can be any artefact supported by the Picture (image, video, sprite, or a Cell artefact).</li>
<li>Note that any <strong><em>filters should be applied to the Picture entity</em></strong>; Loom entitys do not support filter functionality but will apply a Picture’s filters to the source image as-and-where appropriate.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    source: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p><strong>sourceIsVideoOrSprite</strong> - Boolean flag - If the Picture entity is hosting a video or sprite asset, we need to update the input on every frame. </p>
<ul>
<li>It’s easier to tell the Loom entity to do this using a flag, rather than get the Picture entity to update all its Loom subscribers on every display cycle. </li>
<li>For Pictures using image assets the flag must be set to <code>false</code> (the default); setting the flag to <code>true</code> will significantly degrade display and animation performance.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    sourceIsVideoOrSprite: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>The current Frame drawing process often leads to <a href="https://en.wikipedia.org/wiki/Moir%C3%A9_pattern">moiré interference patterns</a> appearing in the resulting image. Scrawl-canvas uses a resize trick to blur out these patterns. </p>
<p><strong>interferenceLoops</strong> (positive integer Number), <strong>interferenceFactor</strong> (positive float Number) - The interferenceFactor attribute sets the resizing ratio; while he interferenceLoops attribute sets the number of times the image gets resized. </p>
<ul>
<li>If inteference patterns still appear in the final image, tweak these values to see if a better output can be achieved.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    interferenceLoops: <span class="hljs-number">2</span>,
    <span class="hljs-attr">interferenceFactor</span>: <span class="hljs-number">1.03</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>The Loom entity does not use the <a href="./mixin/position.html">position</a> or <a href="./mixin/entity.html">entity</a> mixins (used by most other entitys) as its positioning is entirely dependent on the position, rotation, scale etc of its constituent Shape path entity struts. </p>
<p>It does, however, use these attributes (alongside their setters and getters): <strong>visibility</strong>, <strong>order</strong>, <strong>delta</strong>, <strong>host</strong>, <strong>group</strong>, <strong>anchor</strong>, <strong>collides</strong>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    visibility: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">order</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">delta</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">host</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">group</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">anchor</span>: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p><strong>noCanvasEngineUpdates</strong> - Boolean flag - Canvas engine updates are required for the Loom’s border - strokeStyle and line styling; if a Loom is to be drawn without a border, then setting this flag to <code>true</code> may help improve rendering efficiency.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    noCanvasEngineUpdates: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p><strong>noDeltaUpdates</strong> - Boolean flag - Loom entitys support delta animation - achieved by updating the <code>...path</code> attributes by appropriate (and small!) values. If the Loom is not going to be animated by delta values, setting the flag to <code>true</code> may help improve rendering efficiency.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    noDeltaUpdates: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p><strong>onEnter</strong>, <strong>onLeave</strong>, <strong>onDown</strong>, <strong>onUp</strong> - Loom entitys support <strong><em>collision detection</em></strong>, reporting a hit when a test coordinate falls within the Loom’s output image. As a result, Looms can also accept and act on the four <strong>on</strong> functions - see <a href="../mixin/entity.html#section-11">entity event listener functions</a> for more details.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    onEnter: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">onLeave</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">onDown</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">onUp</span>: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p><strong>noUserInteraction</strong> - Boolean flag - To switch off collision detection for a Loom entity - which might help improve rendering efficiency - set the flag to <code>true</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    noUserInteraction: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p><a href="./anchor.html">Anchor objects</a> can be assigned to Loom entitys, meaning the following attributes are supported:</p>
<ul>
<li>anchorDescription</li>
<li>anchorType</li>
<li>anchorTarget</li>
<li>anchorRel</li>
<li>anchorReferrerPolicy</li>
<li>anchorPing</li>
<li>anchorHreflang</li>
<li>anchorHref</li>
<li>anchorDownload</li>
</ul>
<p>And the anchor attributes can also be supplied as a key:value object assigned to the <strong>anchor</strong> attribute:</p>
<pre><code>    anchor: {
        description
        download
        href
        hreflang
        ping
        referrerpolicy
        <span class="hljs-attr">rel</span>:
        target:
        anchorType
        <span class="hljs-attr">clickAction</span>: 
    }</code></pre>
<p>Note that Loom entitys DO NOT SUPPORT the sensor component of the Scrawl-canvas collisions system and will return an empty array when asked to supply sensor coordinates for testing against other artefacts.</p>

            </div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p><strong>method</strong> - All normal Scrawl-canvas entity stamping methods are supported.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    method: <span class="hljs-string">&#x27;fill&#x27;</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Loom entitys support appropriate styling attributes, mainly for their stroke styles (used with the <code>draw</code>, <code>drawAndFill</code>, <code>fillAndDraw</code>, <code>drawThenFill</code> and <code>fillThenDraw</code> stamping methods). </p>
<ul>
<li>These <strong><em>state</em></strong> attributes are stored directly on the object, rather than in a separate <a href="./state.html">State</a> object. </li>
</ul>
<p>The following attributes are thus supported:</p>
<p>Alpha and Composite operations will be applied to both the Loom entity’s border (the Shape entitys, with connecting lines between their paths’ start and end points) and fill (the image displayed between the Loom’s struts)</p>
<ul>
<li><strong>globalAlpha</strong></li>
<li><strong>globalCompositeOperation</strong></li>
</ul>
<p>All line attributes are supported</p>
<ul>
<li><strong>lineWidth</strong></li>
<li><strong>lineCap</strong></li>
<li><strong>lineJoin</strong></li>
<li><strong>lineDash</strong></li>
<li><strong>lineDashOffset</strong></li>
<li><strong>miterLimit</strong></li>
</ul>
<p>The Loom entity’s strokeStyle can be any style supported by Scrawl-canvas - color strings, gradient objects, and pattern objects</p>
<ul>
<li><strong>strokeStyle</strong></li>
</ul>
<p>The shadow attributes will only be applied to the stroke (border), not to the Loom’s fill (image)</p>
<ul>
<li><strong>shadowOffsetX</strong></li>
<li><strong>shadowOffsetY</strong></li>
<li><strong>shadowBlur</strong></li>
<li><strong>shadowColor</strong></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>};
P.defs = mergeOver(P.defs, defaultAttributes);</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <h4 id="packet-management">Packet management</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.packetExclusions = pushUnique(P.packetExclusions, [<span class="hljs-string">&#x27;pathObject&#x27;</span>, <span class="hljs-string">&#x27;state&#x27;</span>]);
P.packetExclusionsByRegex = pushUnique(P.packetExclusionsByRegex, [<span class="hljs-string">&#x27;^(local|dirty|current)&#x27;</span>, <span class="hljs-string">&#x27;Subscriber$&#x27;</span>]);
P.packetCoordinates = pushUnique(P.packetCoordinates, []);
P.packetObjects = pushUnique(P.packetObjects, [<span class="hljs-string">&#x27;group&#x27;</span>, <span class="hljs-string">&#x27;fromPath&#x27;</span>, <span class="hljs-string">&#x27;toPath&#x27;</span>, <span class="hljs-string">&#x27;source&#x27;</span>]);
P.packetFunctions = pushUnique(P.packetFunctions, [<span class="hljs-string">&#x27;onEnter&#x27;</span>, <span class="hljs-string">&#x27;onLeave&#x27;</span>, <span class="hljs-string">&#x27;onDown&#x27;</span>, <span class="hljs-string">&#x27;onUp&#x27;</span>]);

P.processPacketOut = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key, value, includes</span>) </span>{

    <span class="hljs-keyword">let</span> result = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">if</span>(includes.indexOf(key) &lt; <span class="hljs-number">0</span> &amp;&amp; value === <span class="hljs-built_in">this</span>.defs[key]) result = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">return</span> result;
};

P.finalizePacketOut = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">copy, items</span>) </span>{

    <span class="hljs-keyword">let</span> stateCopy = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">this</span>.state.saveAsPacket(items))[<span class="hljs-number">3</span>];
    copy = mergeOver(copy, stateCopy);

    copy = <span class="hljs-built_in">this</span>.handlePacketAnchor(copy, items);

    <span class="hljs-keyword">return</span> copy;
};

P.handlePacketAnchor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">copy, items</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.anchor) {

        <span class="hljs-keyword">let</span> a = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">this</span>.anchor.saveAsPacket(items))[<span class="hljs-number">3</span>];
        copy.anchor = a;
    }
    <span class="hljs-keyword">return</span> copy;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h4 id="clone-management">Clone management</h4>
<p>TODO - this functionality is currently disabled, need to enable it and make it work properly</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.clone = λ<span class="hljs-built_in">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <h4 id="kill-management">Kill management</h4>
<p>No additional kill functionality required</p>

            </div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <h4 id="get-set-deltaset">Get, Set, deltaSet</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> G = P.getters,
    S = P.setters,
    D = P.deltaSetters;</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p><strong>get</strong> - copied over from the entity mixin</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.get = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">let</span> getter = <span class="hljs-built_in">this</span>.getters[item];

    <span class="hljs-keyword">if</span> (getter) <span class="hljs-keyword">return</span> getter.call(<span class="hljs-built_in">this</span>);

    <span class="hljs-keyword">else</span> {

        <span class="hljs-keyword">let</span> def = <span class="hljs-built_in">this</span>.defs[item],
            state = <span class="hljs-built_in">this</span>.state,
            val;

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> def != <span class="hljs-string">&#x27;undefined&#x27;</span>) {

            val = <span class="hljs-built_in">this</span>[item];
            <span class="hljs-keyword">return</span> (<span class="hljs-keyword">typeof</span> val != <span class="hljs-string">&#x27;undefined&#x27;</span>) ? val : def;
        }

        def = state.defs[item];

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> def != <span class="hljs-string">&#x27;undefined&#x27;</span>) {

            val = state[item];
            <span class="hljs-keyword">return</span> (<span class="hljs-keyword">typeof</span> val != <span class="hljs-string">&#x27;undefined&#x27;</span>) ? val : def;
        }
        <span class="hljs-keyword">return</span> undef;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p><strong>set</strong> - copied over from the entity mixin.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.set = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Object</span>.keys(items).length) {

        <span class="hljs-keyword">let</span> setters = <span class="hljs-built_in">this</span>.setters,
            defs = <span class="hljs-built_in">this</span>.defs,
            state = <span class="hljs-built_in">this</span>.state,
            stateSetters = (state) ? state.setters : {},
            stateDefs = (state) ? state.defs : {},
            predefined, stateFlag;

        <span class="hljs-built_in">Object</span>.entries(items).forEach(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> {

            <span class="hljs-keyword">if</span> (key &amp;&amp; key !== <span class="hljs-string">&#x27;name&#x27;</span> &amp;&amp; value != <span class="hljs-literal">null</span>) {

                predefined = setters[key];
                stateFlag = <span class="hljs-literal">false</span>;

                <span class="hljs-keyword">if</span> (!predefined) {

                    predefined = stateSetters[key];
                    stateFlag = <span class="hljs-literal">true</span>;
                }

                <span class="hljs-keyword">if</span> (predefined) predefined.call(stateFlag ? <span class="hljs-built_in">this</span>.state : <span class="hljs-built_in">this</span>, value);
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> defs[key] !== <span class="hljs-string">&#x27;undefined&#x27;</span>) <span class="hljs-built_in">this</span>[key] = value;
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> stateDefs[key] !== <span class="hljs-string">&#x27;undefined&#x27;</span>) state[key] = value;
            }
        }, <span class="hljs-built_in">this</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p><strong>setDelta</strong> - copied over from the entity mixin.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.setDelta = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Object</span>.keys(items).length) {

        <span class="hljs-keyword">let</span> setters = <span class="hljs-built_in">this</span>.deltaSetters,
            defs = <span class="hljs-built_in">this</span>.defs,
            state = <span class="hljs-built_in">this</span>.state,
            stateSetters = (state) ? state.deltaSetters : {},
            stateDefs = (state) ? state.defs : {},
            predefined, stateFlag;

        <span class="hljs-built_in">Object</span>.entries(items).forEach(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> {

            <span class="hljs-keyword">if</span> (key &amp;&amp; key !== <span class="hljs-string">&#x27;name&#x27;</span> &amp;&amp; value != <span class="hljs-literal">null</span>) {

                predefined = setters[key];
                stateFlag = <span class="hljs-literal">false</span>;

                <span class="hljs-keyword">if</span> (!predefined) {

                    predefined = stateSetters[key];
                    stateFlag = <span class="hljs-literal">true</span>;
                }

                <span class="hljs-keyword">if</span> (predefined) predefined.call(stateFlag ? <span class="hljs-built_in">this</span>.state : <span class="hljs-built_in">this</span>, value);
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> defs[key] !== <span class="hljs-string">&#x27;undefined&#x27;</span>) <span class="hljs-built_in">this</span>[key] = addStrings(<span class="hljs-built_in">this</span>[key], value);
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> stateDefs[key] !== <span class="hljs-string">&#x27;undefined&#x27;</span>) state[key] = addStrings(state[key], value);
            }
        }, <span class="hljs-built_in">this</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p><strong>host</strong>, <strong>getHost</strong> - copied over from the position mixin.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.host = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item) {

        <span class="hljs-keyword">let</span> host = artefact[item];

        <span class="hljs-keyword">if</span> (host &amp;&amp; host.here) <span class="hljs-built_in">this</span>.host = host.name;
        <span class="hljs-keyword">else</span> <span class="hljs-built_in">this</span>.host = item;
    }
    <span class="hljs-keyword">else</span> <span class="hljs-built_in">this</span>.host = <span class="hljs-string">&#x27;&#x27;</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p><strong>group</strong> - copied over from the position mixin.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>G.group = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> (<span class="hljs-built_in">this</span>.group) ? <span class="hljs-built_in">this</span>.group.name : <span class="hljs-string">&#x27;&#x27;</span>;
};
S.group = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">let</span> g;

    <span class="hljs-keyword">if</span> (item) {

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.group &amp;&amp; <span class="hljs-built_in">this</span>.group.type === <span class="hljs-string">&#x27;Group&#x27;</span>) <span class="hljs-built_in">this</span>.group.removeArtefacts(<span class="hljs-built_in">this</span>.name);

        <span class="hljs-keyword">if</span> (item.substring) {

            g = group[item];

            <span class="hljs-keyword">if</span> (g) <span class="hljs-built_in">this</span>.group = g;
            <span class="hljs-keyword">else</span> <span class="hljs-built_in">this</span>.group = item;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-built_in">this</span>.group = item;
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.group &amp;&amp; <span class="hljs-built_in">this</span>.group.type === <span class="hljs-string">&#x27;Group&#x27;</span>) <span class="hljs-built_in">this</span>.group.addArtefacts(<span class="hljs-built_in">this</span>.name);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p><strong>getHere</strong> - returns current core position.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.getHere = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> currentCorePosition;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p><strong>delta</strong> - copied over from the position mixin.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.delta = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">if</span> (items) <span class="hljs-built_in">this</span>.delta = mergeDiscard(<span class="hljs-built_in">this</span>.delta, items);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p><strong>fromPath</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.fromPath = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item) {

        <span class="hljs-keyword">let</span> oldPath = <span class="hljs-built_in">this</span>.fromPath,
            newPath = (item.substring) ? artefact[item] : item,
            name = <span class="hljs-built_in">this</span>.name;

        <span class="hljs-keyword">if</span> (newPath &amp;&amp; newPath.name &amp;&amp; newPath.useAsPath) {

            <span class="hljs-keyword">if</span> (oldPath &amp;&amp; oldPath.name !== newPath.name) removeItem(oldPath.pathed, name);

            pushUnique(newPath.pathed, name);

            <span class="hljs-built_in">this</span>.fromPath = newPath;

            <span class="hljs-built_in">this</span>.dirtyStart = <span class="hljs-literal">true</span>;
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p><strong>toPath</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.toPath = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item) {

        <span class="hljs-keyword">let</span> oldPath = <span class="hljs-built_in">this</span>.toPath,
            newPath = (item.substring) ? artefact[item] : item,
            name = <span class="hljs-built_in">this</span>.name;

        <span class="hljs-keyword">if</span> (newPath &amp;&amp; newPath.name &amp;&amp; newPath.useAsPath) {

            <span class="hljs-keyword">if</span> (oldPath &amp;&amp; oldPath.name !== newPath.name) removeItem(oldPath.pathed, name);

            pushUnique(newPath.pathed, name);

            <span class="hljs-built_in">this</span>.toPath = newPath;

            <span class="hljs-built_in">this</span>.dirtyStart = <span class="hljs-literal">true</span>;
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p><strong>source</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.source = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    item = (item.substring) ? artefact[item] : item;

    <span class="hljs-keyword">if</span> (item &amp;&amp; item.type === <span class="hljs-string">&#x27;Picture&#x27;</span>) {

        <span class="hljs-keyword">let</span> src = <span class="hljs-built_in">this</span>.source;

        <span class="hljs-keyword">if</span> (src &amp;&amp; src.type === <span class="hljs-string">&#x27;Picture&#x27;</span>) src.imageUnsubscribe(<span class="hljs-built_in">this</span>.name);

        <span class="hljs-built_in">this</span>.source = item;
        item.imageSubscribe(<span class="hljs-built_in">this</span>.name);
        <span class="hljs-built_in">this</span>.dirtyInput = <span class="hljs-literal">true</span>;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p><strong>isHorizontalCopy</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.isHorizontalCopy = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.isHorizontalCopy = (item) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;
    <span class="hljs-built_in">this</span>.dirtyPathData = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p><strong>synchronizePathCursors</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.synchronizePathCursors = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.synchronizePathCursors = (item) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (item) {

        <span class="hljs-built_in">this</span>.toPathStart = <span class="hljs-built_in">this</span>.fromPathStart;
        <span class="hljs-built_in">this</span>.toPathEnd = <span class="hljs-built_in">this</span>.fromPathEnd;
    }

    <span class="hljs-built_in">this</span>.dirtyPathData = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p><strong>loopPathCursors</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.loopPathCursors = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.loopPathCursors = (item) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (item) {

        <span class="hljs-keyword">let</span> c,
            floor = <span class="hljs-built_in">Math</span>.floor;

        c = <span class="hljs-built_in">this</span>.fromPathStart
        <span class="hljs-keyword">if</span> (c &lt; <span class="hljs-number">0</span> || c &gt; <span class="hljs-number">1</span>) <span class="hljs-built_in">this</span>.fromPathStart = c - floor(c);

        c = <span class="hljs-built_in">this</span>.fromPathEnd
        <span class="hljs-keyword">if</span> (c &lt; <span class="hljs-number">0</span> || c &gt; <span class="hljs-number">1</span>) <span class="hljs-built_in">this</span>.fromPathEnd = c - floor(c);

        c = <span class="hljs-built_in">this</span>.toPathStart
        <span class="hljs-keyword">if</span> (c &lt; <span class="hljs-number">0</span> || c &gt; <span class="hljs-number">1</span>) <span class="hljs-built_in">this</span>.toPathStart = c - floor(c);

        c = <span class="hljs-built_in">this</span>.toPathEnd
        <span class="hljs-keyword">if</span> (c &lt; <span class="hljs-number">0</span> || c &gt; <span class="hljs-number">1</span>) <span class="hljs-built_in">this</span>.toPathEnd = c - floor(c);
    }

    <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p><strong>fromPathStart</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.fromPathStart = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.loopPathCursors &amp;&amp; (item &lt; <span class="hljs-number">0</span> || item &gt; <span class="hljs-number">1</span>)) item = item - <span class="hljs-built_in">Math</span>.floor(item);
    <span class="hljs-built_in">this</span>.fromPathStart = item;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.synchronizePathCursors) <span class="hljs-built_in">this</span>.toPathStart = item;
    <span class="hljs-built_in">this</span>.dirtyPathData = <span class="hljs-literal">true</span>;
};
D.fromPathStart = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">let</span> val = <span class="hljs-built_in">this</span>.fromPathStart += item;

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.loopPathCursors &amp;&amp; (val &lt; <span class="hljs-number">0</span> || val &gt; <span class="hljs-number">1</span>)) val = val - <span class="hljs-built_in">Math</span>.floor(val);
    <span class="hljs-built_in">this</span>.fromPathStart = val;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.synchronizePathCursors) <span class="hljs-built_in">this</span>.toPathStart = val;
    <span class="hljs-built_in">this</span>.dirtyPathData = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p><strong>fromPathEnd</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.fromPathEnd = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.loopPathCursors &amp;&amp; (item &lt; <span class="hljs-number">0</span> || item &gt; <span class="hljs-number">1</span>)) item = item - <span class="hljs-built_in">Math</span>.floor(item);
    <span class="hljs-built_in">this</span>.fromPathEnd = item;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.synchronizePathCursors) <span class="hljs-built_in">this</span>.toPathEnd = item;
    <span class="hljs-built_in">this</span>.dirtyPathData = <span class="hljs-literal">true</span>;
};
D.fromPathEnd = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">let</span> val = <span class="hljs-built_in">this</span>.fromPathEnd += item;

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.loopPathCursors &amp;&amp; (val &lt; <span class="hljs-number">0</span> || val &gt; <span class="hljs-number">1</span>)) val = val - <span class="hljs-built_in">Math</span>.floor(val);
    <span class="hljs-built_in">this</span>.fromPathEnd = val;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.synchronizePathCursors) <span class="hljs-built_in">this</span>.toPathEnd = val;
    <span class="hljs-built_in">this</span>.dirtyPathData = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p><strong>toPathStart</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.toPathStart = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.loopPathCursors &amp;&amp; (item &lt; <span class="hljs-number">0</span> || item &gt; <span class="hljs-number">1</span>)) item = item - <span class="hljs-built_in">Math</span>.floor(item);
    <span class="hljs-built_in">this</span>.toPathStart = item;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.synchronizePathCursors) <span class="hljs-built_in">this</span>.fromPathStart = item;
    <span class="hljs-built_in">this</span>.dirtyPathData = <span class="hljs-literal">true</span>;
};
D.toPathStart = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">let</span> val = <span class="hljs-built_in">this</span>.toPathStart += item;

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.loopPathCursors &amp;&amp; (val &lt; <span class="hljs-number">0</span> || val &gt; <span class="hljs-number">1</span>)) val = val - <span class="hljs-built_in">Math</span>.floor(val);
    <span class="hljs-built_in">this</span>.toPathStart = val;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.synchronizePathCursors) <span class="hljs-built_in">this</span>.fromPathStart = val;
    <span class="hljs-built_in">this</span>.dirtyPathData = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p><strong>toPathEnd</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.toPathEnd = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.loopPathCursors &amp;&amp; (item &lt; <span class="hljs-number">0</span> || item &gt; <span class="hljs-number">1</span>)) item = item - <span class="hljs-built_in">Math</span>.floor(item);
    <span class="hljs-built_in">this</span>.toPathEnd = item;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.synchronizePathCursors) <span class="hljs-built_in">this</span>.fromPathEnd = item;
    <span class="hljs-built_in">this</span>.dirtyPathData = <span class="hljs-literal">true</span>;
};
D.toPathEnd = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">let</span> val = <span class="hljs-built_in">this</span>.toPathEnd += item;

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.loopPathCursors &amp;&amp; (val &lt; <span class="hljs-number">0</span> || val &gt; <span class="hljs-number">1</span>)) val = val - <span class="hljs-built_in">Math</span>.floor(val);
    <span class="hljs-built_in">this</span>.toPathEnd = val;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.synchronizePathCursors) <span class="hljs-built_in">this</span>.fromPathEnd = val;
    <span class="hljs-built_in">this</span>.dirtyPathData = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <h4 id="prototype-functions">Prototype functions</h4>

            </div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p><code>getHost</code> - copied over from the position mixin.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.getHost = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.currentHost) <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.currentHost;
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.host) {

        <span class="hljs-keyword">let</span> host = artefact[<span class="hljs-built_in">this</span>.host];

        <span class="hljs-keyword">if</span> (host) {

            <span class="hljs-built_in">this</span>.currentHost = host;
            <span class="hljs-built_in">this</span>.dirtyHost = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.currentHost;
        }
    }
    <span class="hljs-keyword">return</span> currentCorePosition;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p><code>updateByDelta</code>, <code>reverseByDelta</code> - copied over from the position mixin.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.updateByDelta = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-built_in">this</span>.setDelta(<span class="hljs-built_in">this</span>.delta);

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};

P.reverseByDelta = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> temp = {};
    
    <span class="hljs-built_in">Object</span>.entries(<span class="hljs-built_in">this</span>.delta).forEach(<span class="hljs-function">(<span class="hljs-params">[key, val]</span>) =&gt;</span> {

        <span class="hljs-keyword">if</span> (val.substring) val = -(<span class="hljs-built_in">parseFloat</span>(val)) + <span class="hljs-string">&#x27;%&#x27;</span>;
        <span class="hljs-keyword">else</span> val = -val;

        temp[key] = val;
    });

    <span class="hljs-built_in">this</span>.setDelta(temp);

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p><code>setDeltaValues</code> - copied over from the position mixin.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.setDeltaValues = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">let</span> delta = <span class="hljs-built_in">this</span>.delta, 
        oldVal, action;

    <span class="hljs-built_in">Object</span>.entries(items).forEach(<span class="hljs-function">(<span class="hljs-params">[key, requirement]</span>) =&gt;</span> {

        <span class="hljs-keyword">if</span> (xt(delta[key])) {

            action = requirement;

            oldVal = delta[key];

            <span class="hljs-keyword">switch</span> (action) {

                <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;reverse&#x27;</span> :
                    <span class="hljs-keyword">if</span> (oldVal.toFixed) delta[key] = -oldVal;</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>TODO: reverse String% (and em, etc) values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">break</span>;

                <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;zero&#x27;</span> :
                    <span class="hljs-keyword">if</span> (oldVal.toFixed) delta[key] = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>TODO: zero String% (and em, etc) values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">break</span>;

                <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;add&#x27;</span> :
                    <span class="hljs-keyword">break</span>;

                <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;subtract&#x27;</span> :
                    <span class="hljs-keyword">break</span>;

                <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;multiply&#x27;</span> :
                    <span class="hljs-keyword">break</span>;

                <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;divide&#x27;</span> :
                    <span class="hljs-keyword">break</span>;
            }
        }
    })
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Invalidate mid-init functionality</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.midInitActions = λ<span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Invalidating sensor functionality</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cleanCollisionData = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> [<span class="hljs-number">0</span>, []];
};
P.getSensors = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> [];
};</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <h4 id="display-cycle-functionality">Display cycle functionality</h4>

            </div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p><code>prepareStamp</code> - function called as part of the Display cycle <code>compile</code> step.</p>
<ul>
<li>This function is called before we get into the entity stamp promise cascade (thus it’s a synchronous function). This is where we need to check whether we need to recalculate the path data which we’ll use later to build the Loom entity’s output image.</li>
<li>We only need to recalculate the path data on the initial render, and afterwards when the <strong>dirtyPathData</strong> flag has been set.</li>
<li>If we perform the recalculation, then we need to make sure to set the <strong>dirtyOutput</strong> flag, which will trigger the output image build.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.prepareStamp = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> fPath = <span class="hljs-built_in">this</span>.fromPath,
        tPath = <span class="hljs-built_in">this</span>.toPath;</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Sanity check 1</p>
<ul>
<li><code>getBoundingBox</code> will recalculate and set the <code>dirtyPathData</code> flag </li>
<li>if paths have set the Loom’s <code>dirtyStart</code> flag</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> [startX, startY, outputWidth, outputHeight] = <span class="hljs-built_in">this</span>.getBoundingBox();</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Sanity check 2</p>
<ul>
<li>we can set the <code>dirtyPathData</code> ourselves if paths <code>start/end</code> coordinates have changed</li>
<li>in case Shape path <code>roll/scale/flip/etc</code> updates don’t get messaged to the Loom entity</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.dirtyPathData) {

        <span class="hljs-keyword">let</span> {<span class="hljs-attr">x</span>: testFromStartX, <span class="hljs-attr">y</span>: testFromStartY} = fPath.getPathPositionData(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">let</span> {<span class="hljs-attr">x</span>: testFromEndX, <span class="hljs-attr">y</span>: testFromEndY} = fPath.getPathPositionData(<span class="hljs-number">1</span>);
        <span class="hljs-keyword">let</span> {<span class="hljs-attr">x</span>: testToStartX, <span class="hljs-attr">y</span>: testToStartY} = tPath.getPathPositionData(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">let</span> {<span class="hljs-attr">x</span>: testToEndX, <span class="hljs-attr">y</span>: testToEndY} = tPath.getPathPositionData(<span class="hljs-number">1</span>);

        <span class="hljs-keyword">let</span> localPathTests = [testFromStartX, testFromStartY, testFromEndX, testFromEndY, testToStartX, testToStartY, testToEndX, testToEndY];

        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.pathTests || <span class="hljs-built_in">this</span>.pathTests.some(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> item !== localPathTests[index])) {

            <span class="hljs-built_in">this</span>.pathTests = localPathTests;
            <span class="hljs-built_in">this</span>.dirtyPathData = <span class="hljs-literal">true</span>;
        }
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyPathData || !<span class="hljs-built_in">this</span>.fromPathData.length) {

        <span class="hljs-built_in">this</span>.dirtyPathData = <span class="hljs-literal">false</span>;

        <span class="hljs-built_in">this</span>.watchIndex = -<span class="hljs-number">1</span>;
        <span class="hljs-built_in">this</span>.engineInstructions.length = <span class="hljs-number">0</span>;
        <span class="hljs-built_in">this</span>.engineDeltaLengths.length = <span class="hljs-number">0</span>;

        <span class="hljs-keyword">let</span> mCeil = <span class="hljs-built_in">Math</span>.ceil,
            mMax = <span class="hljs-built_in">Math</span>.max,
            mMin = <span class="hljs-built_in">Math</span>.min,
            mFloor = <span class="hljs-built_in">Math</span>.floor;

        <span class="hljs-keyword">let</span> fromPathData = <span class="hljs-built_in">this</span>.fromPathData;
        fromPathData.length = <span class="hljs-number">0</span>;

        <span class="hljs-keyword">let</span> toPathData = <span class="hljs-built_in">this</span>.toPathData;
        toPathData.length = <span class="hljs-number">0</span>;

        <span class="hljs-keyword">if</span>(fPath &amp;&amp; tPath) {

            <span class="hljs-keyword">let</span> fPathLength = mCeil(fPath.length),
                tPathLength = mCeil(tPath.length),
                pathSteps, pathDelta, x, y;

            pathSteps = <span class="hljs-built_in">this</span>.setSourceDimension(mMax(fPathLength, tPathLength));

            <span class="hljs-keyword">let</span> fPathStart = <span class="hljs-built_in">this</span>.fromPathStart,
                fPathEnd = <span class="hljs-built_in">this</span>.fromPathEnd,
                tPathStart = <span class="hljs-built_in">this</span>.toPathStart,
                tPathEnd = <span class="hljs-built_in">this</span>.toPathEnd,
                fPartial, tPartial, fRatio, tRatio, minPartial,
                pathSpeed = <span class="hljs-built_in">this</span>.constantPathSpeed;

            <span class="hljs-keyword">if</span> (fPathStart &lt; fPathEnd) fPartial = fPathEnd - fPathStart;
            <span class="hljs-keyword">else</span> fPartial = fPathEnd + (<span class="hljs-number">1</span> - fPathStart);
            <span class="hljs-keyword">if</span> (fPartial &lt; <span class="hljs-number">0.005</span>) fPartial = <span class="hljs-number">0.005</span>;

            <span class="hljs-keyword">if</span> (tPathStart &lt; tPathEnd) tPartial = tPathEnd - tPathStart;
            <span class="hljs-keyword">else</span> tPartial = tPathEnd + (<span class="hljs-number">1</span> - tPathStart);
            <span class="hljs-keyword">if</span> (tPartial &lt; <span class="hljs-number">0.005</span>) tPartial = <span class="hljs-number">0.005</span>;

            minPartial = mCeil(mMin(fPartial, tPartial));

            pathDelta = <span class="hljs-number">1</span> / (pathSteps * (<span class="hljs-number">1</span> / minPartial));

            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> cursor = <span class="hljs-number">0</span>; cursor &lt;= <span class="hljs-number">1</span>; cursor += pathDelta) {

                ({x, y} = fPath.getPathPositionData(cursor, pathSpeed));
                fromPathData.push([x - startX, y - startY]);

                ({x, y} = tPath.getPathPositionData(cursor, pathSpeed));
                toPathData.push([x - startX, y - startY]);
            }

            <span class="hljs-built_in">this</span>.fromPathSteps = fPartial / minPartial;
            <span class="hljs-built_in">this</span>.toPathSteps = tPartial / minPartial;

            <span class="hljs-built_in">this</span>.watchFromPath = (<span class="hljs-built_in">this</span>.fromPathSteps === <span class="hljs-number">1</span>) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;

            <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-built_in">this</span>.dirtyPathData = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.sourceIsVideoOrSprite) <span class="hljs-built_in">this</span>.dirtyInput = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p><code>setSourceDimension</code> - internal function called by <code>prepareStamp</code>.</p>
<ul>
<li>We make the source dimensions a square of the longest path length</li>
<li>This way, we can do a horizontal scan, or a vertical scan with no further calculation</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.setSourceDimension = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <ul>
<li><code>prepareStamp</code> does the dimension calculation itself, then supplies the new value</li>
<li>we just need to update this.sourceDimension and set the dirtyInput flag</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (val) {

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.sourceDimension !== val) {

            <span class="hljs-built_in">this</span>.sourceDimension = val;
            <span class="hljs-built_in">this</span>.dirtyInput = <span class="hljs-literal">true</span>;
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>if other functions call setSourceDimension, they will do it without supplying a new value</p>
<ul>
<li>in which case we can calculate and update it here</li>
<li>other functions do it as a sanity check </li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> {

        <span class="hljs-keyword">let</span> fPath = <span class="hljs-built_in">this</span>.fromPath,
            tPath = <span class="hljs-built_in">this</span>.toPath;

        <span class="hljs-keyword">if</span>(fPath &amp;&amp; tPath) {

            <span class="hljs-keyword">let</span> mCeil = <span class="hljs-built_in">Math</span>.ceil,
                fPathLength = mCeil(fPath.length),
                tPathLength = mCeil(tPath.length);

            <span class="hljs-keyword">let</span> steps = <span class="hljs-built_in">Math</span>.max(fPathLength, tPathLength);

            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.sourceDimension !== steps) <span class="hljs-built_in">this</span>.sourceDimension = steps;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-built_in">this</span>.sourceDimension = <span class="hljs-number">0</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.sourceDimension;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p><code>simpleStamp</code> - Simple stamping is entirely synchronous</p>
<ul>
<li>TODO: we may have to disable this functionality for the Loom entity, if we use a web worker for either the prepareStamp calculations, or to build the output image itself</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.simpleStamp = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">host, changes = {}</span>) </span>{

    <span class="hljs-keyword">if</span> (host &amp;&amp; host.type === <span class="hljs-string">&#x27;Cell&#x27;</span>) {

        <span class="hljs-built_in">this</span>.currentHost = host;
        
        <span class="hljs-keyword">if</span> (changes) {

            <span class="hljs-built_in">this</span>.set(changes);
            <span class="hljs-built_in">this</span>.prepareStamp();
        }

        <span class="hljs-built_in">this</span>.regularStampSynchronousActions();
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p><code>stamp</code> - All entity stamping, except for simple stamps, goes through this function, which needs to return a Promise which will resolve in due course.</p>
<ul>
<li>While other entitys have to worry about applying filters as part of the stamping process, this is not an issue for Loom entitys because filters are defined on, and applied to, the source Picture entity, not the Loom itself</li>
</ul>
<p>Here we check which dirty flags need actioning, and call a range of different functions to process the work. These flags are:</p>
<ul>
<li><code>dirtyInput</code> - the Picture entity has reported a change in its source, or copy attributes)</li>
<li><code>dirtyOutput</code> - to render the cleaned input, or take account that the Loom paths’ cursors have changed)</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.stamp = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">force = <span class="hljs-literal">false</span>, host, changes</span>) </span>{

    <span class="hljs-keyword">if</span> (force) {

        <span class="hljs-keyword">if</span> (host &amp;&amp; host.type === <span class="hljs-string">&#x27;Cell&#x27;</span>) <span class="hljs-built_in">this</span>.currentHost = host;

        <span class="hljs-keyword">if</span> (changes) {

            <span class="hljs-built_in">this</span>.set(changes);
            <span class="hljs-built_in">this</span>.prepareStamp();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.regularStamp();
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.visibility) {

        <span class="hljs-keyword">let</span> self = <span class="hljs-built_in">this</span>,
            dirtyInput = <span class="hljs-built_in">this</span>.dirtyInput,
            dirtyOutput = <span class="hljs-built_in">this</span>.dirtyOutput;

        <span class="hljs-keyword">if</span> (dirtyInput) {

            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {

                self.cleanInput()
                .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>We don’t need to completely reject if output is not clean</p>
<ul>
<li>It should be enough to bale out of the stamp functionality and hope it resolves during the next RAF iteration</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`<span class="hljs-subst">${self.name}</span> - cleanInput Error: source has a zero dimension`</span>);
                    resolve(<span class="hljs-literal">false</span>);
                })
                .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {

                    self.sourceImageData = res;
                    <span class="hljs-keyword">return</span> self.cleanOutput();
                })
                .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {

                    self.output = res;
                    <span class="hljs-keyword">return</span> self.regularStamp();
                })
                .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {

                    resolve(<span class="hljs-literal">true</span>);
                })
                .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
                    
                    reject(err);
                });
            })
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dirtyOutput) {

            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {

                self.cleanOutput()
                .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {

                    self.output = res;
                    <span class="hljs-keyword">return</span> self.regularStamp();
                })
                .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {

                    resolve(<span class="hljs-literal">true</span>);
                })
                .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
                    
                    reject(err);
                });
            })
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.regularStamp();
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-literal">false</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <h4 id="clean-functions">Clean functions</h4>

            </div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p><code>cleanInput</code> - internal function called by <code>stamp</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cleanInput = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> self = <span class="hljs-built_in">this</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {

        self.dirtyInput = <span class="hljs-literal">false</span>;

        self.setSourceDimension();

        <span class="hljs-keyword">let</span> sourceDimension = self.sourceDimension;

        <span class="hljs-keyword">if</span> (!sourceDimension) {

            self.dirtyInput = <span class="hljs-literal">true</span>;
            reject();
        }

        <span class="hljs-keyword">let</span> cell = requestCell(),
            engine = cell.engine,
            canvas = cell.element;

        canvas.width = sourceDimension;
        canvas.height = sourceDimension;
        engine.setTransform(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);

        self.source.stamp(<span class="hljs-literal">true</span>, cell, { 
            <span class="hljs-attr">startX</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">startY</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">handleX</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">handleY</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">offsetX</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">offsetY</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">roll</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">scale</span>: <span class="hljs-number">1</span>,

            <span class="hljs-attr">width</span>: sourceDimension,
            <span class="hljs-attr">height</span>: sourceDimension,

            <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;fill&#x27;</span>,
        })
        .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {

            <span class="hljs-keyword">let</span> sourceImageData = engine.getImageData(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, sourceDimension, sourceDimension);

            releaseCell(cell);
            resolve(sourceImageData);
        })
        .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {

            releaseCell(cell);
            reject(err);
        });
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p><code>cleanOutput</code> - internal function called by <code>stamp</code></p>
<ul>
<li>If you’re not a fan of big functions, please look away now.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cleanOutput = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    
    <span class="hljs-keyword">let</span> self = <span class="hljs-built_in">this</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {

        self.dirtyOutput = <span class="hljs-literal">false</span>;

        self.setSourceDimension();
        
        <span class="hljs-keyword">let</span> sourceDimension = self.sourceDimension, 
            sourceData = self.sourceImageData;

        <span class="hljs-keyword">if</span> (sourceDimension &amp;&amp; sourceData) {

            <span class="hljs-keyword">let</span> mHypot = <span class="hljs-built_in">Math</span>.hypot,
                mFloor = <span class="hljs-built_in">Math</span>.floor,
                mCeil = <span class="hljs-built_in">Math</span>.ceil,
                mAtan2 = <span class="hljs-built_in">Math</span>.atan2,
                mCos = <span class="hljs-built_in">Math</span>.cos,
                mSin = <span class="hljs-built_in">Math</span>.sin;

            <span class="hljs-keyword">let</span> fromPathData = self.fromPathData,
                toPathData = self.toPathData,

                dataLen = fromPathData.length,

                fPathStart = self.fromPathStart,
                fCursor = fPathStart * dataLen,
                fStep = self.fromPathSteps || <span class="hljs-number">1</span>,

                tPathStart = self.toPathStart,
                tCursor = tPathStart * dataLen,
                tStep = self.toPathSteps || <span class="hljs-number">1</span>,

                magicHorizontalPi = <span class="hljs-number">0.5</span> * <span class="hljs-built_in">Math</span>.PI,
                magicVerticalPi = magicHorizontalPi - <span class="hljs-number">1.5708</span>,

                isHorizontalCopy = self.isHorizontalCopy,
                loop = self.loopPathCursors,

                fx, fy, tx, ty, dx, dy, dLength, dAngle, cos, sin, 

                watchFromPath = self.watchFromPath,
                watchIndex = self.watchIndex, 
                engineInstructions = self.engineInstructions,
                engineDeltaLengths = self.engineDeltaLengths,
                instruction;

            <span class="hljs-keyword">let</span> [startX, startY, outputWidth, outputHeight] = self.getBoundingBox();

            <span class="hljs-keyword">let</span> inputCell = requestCell(),
                inputEngine = inputCell.engine,
                inputCanvas = inputCell.element;

            inputCanvas.width = sourceDimension;
            inputCanvas.height = sourceDimension;
            inputEngine.setTransform(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
            inputEngine.putImageData(sourceData, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);

            <span class="hljs-keyword">let</span> outputCell = requestCell(),
                outputEngine = outputCell.engine,
                outputCanvas = outputCell.element;

            outputCanvas.width = outputWidth;
            outputCanvas.height = outputHeight;
            outputEngine.globalAlpha = self.state.globalAlpha;
            outputEngine.setTransform(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);

            <span class="hljs-keyword">if</span>(!engineInstructions.length) {

                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; sourceDimension; i++) {

                    <span class="hljs-keyword">if</span> (watchIndex &lt; <span class="hljs-number">0</span>) {

                        <span class="hljs-keyword">if</span> (watchFromPath &amp;&amp; fCursor &lt; <span class="hljs-number">1</span>) watchIndex = i;
                        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!watchFromPath &amp;&amp; tCursor &lt; <span class="hljs-number">1</span>) watchIndex = i;
                    }

                    <span class="hljs-keyword">if</span> (fCursor &lt; dataLen &amp;&amp; tCursor &lt; dataLen &amp;&amp; fCursor &gt;= <span class="hljs-number">0</span> &amp;&amp; tCursor &gt;= <span class="hljs-number">0</span>) {

                        [fx, fy] = fromPathData[mFloor(fCursor)];
                        [tx, ty] = toPathData[mFloor(tCursor)];

                        dx = tx - fx;
                        dy = ty - fy;

                        dLength = mHypot(dx, dy);

                        <span class="hljs-keyword">if</span> (isHorizontalCopy) {

                            dAngle = -mAtan2(dx, dy) + magicHorizontalPi;
                            cos = mCos(dAngle);
                            sin = mSin(dAngle);

                            engineInstructions.push([cos, sin, -sin, cos, fx, fy]);
                            engineDeltaLengths.push(dLength);
                        }
                        <span class="hljs-keyword">else</span> {

                            dAngle = -mAtan2(dx, dy) + magicVerticalPi;
                            cos = mCos(dAngle);
                            sin = mSin(dAngle);

                            engineInstructions.push([cos, sin, -sin, cos, fx, fy, dLength]);
                            engineDeltaLengths.push(dLength);
                        }
                    }
                    <span class="hljs-keyword">else</span> {

                        engineInstructions.push(<span class="hljs-literal">false</span>);
                        engineDeltaLengths.push(<span class="hljs-literal">false</span>);
                    }

                    fCursor += fStep;
                    tCursor += tStep;

                    <span class="hljs-keyword">if</span> (loop) {

                        <span class="hljs-keyword">if</span> (fCursor &gt;= dataLen) fCursor -= dataLen;
                        <span class="hljs-keyword">if</span> (tCursor &gt;= dataLen) tCursor -= dataLen;
                    }
                }
                <span class="hljs-keyword">if</span> (watchIndex &lt; <span class="hljs-number">0</span>) watchIndex = <span class="hljs-number">0</span>;
                self.watchIndex = watchIndex;
            }

            <span class="hljs-keyword">if</span> (isHorizontalCopy) {


                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; sourceDimension; i++) {

                    instruction = engineInstructions[watchIndex];

                    <span class="hljs-keyword">if</span> (instruction) {

                        outputEngine.setTransform(...instruction);
                        outputEngine.drawImage(inputCanvas, <span class="hljs-number">0</span>, watchIndex, sourceDimension, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, engineDeltaLengths[watchIndex], <span class="hljs-number">1</span>);
                    }
                    watchIndex++;

                    <span class="hljs-keyword">if</span> (watchIndex &gt;= sourceDimension) watchIndex = <span class="hljs-number">0</span>;
                }
            }
            <span class="hljs-keyword">else</span> {

                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; sourceDimension; i++) {

                    instruction = engineInstructions[watchIndex];

                    <span class="hljs-keyword">if</span> (instruction) {

                        outputEngine.setTransform(...instruction);
                        outputEngine.drawImage(inputCanvas, watchIndex, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, sourceDimension, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, engineDeltaLengths[watchIndex]);
                    }
                    watchIndex++;

                    <span class="hljs-keyword">if</span> (watchIndex &gt;= sourceDimension) watchIndex = <span class="hljs-number">0</span>;
                }
            }

            <span class="hljs-keyword">let</span> iFactor = self.interferenceFactor,
                iLoops = self.interferenceLoops,

                iWidth = mCeil(outputWidth * iFactor),
                iHeight = mCeil(outputHeight * iFactor);

            inputCanvas.width = iWidth;
            inputCanvas.height = iHeight;

            outputEngine.setTransform(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
            inputEngine.setTransform(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);

            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; iLoops; j++) {

                inputEngine.drawImage(outputCanvas, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, outputWidth, outputHeight, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, iWidth, iHeight);
                outputEngine.drawImage(inputCanvas, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, iWidth, iHeight, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, outputWidth, outputHeight);
            }

            <span class="hljs-keyword">let</span> outputData = outputEngine.getImageData(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, outputWidth, outputHeight);

            releaseCell(inputCell);
            releaseCell(outputCell);

            self.dirtyTargetImage = <span class="hljs-literal">true</span>;

            resolve(outputData);
        }
        <span class="hljs-keyword">else</span> reject(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">this</span>.name}</span> - cleanOutput Error: source has a zero dimension, or no data`</span>));
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p><code>regularStamp</code> - internal function called by <code>stamp</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.regularStamp = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> self = <span class="hljs-built_in">this</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {

        <span class="hljs-keyword">if</span> (self.currentHost) {

            self.regularStampSynchronousActions();
            resolve(<span class="hljs-literal">true</span>);
        }
        reject(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`<span class="hljs-subst">${self.name}</span> has no current host`</span>));
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p><code>regularStampSynchronousActions</code> - internal function called by <code>regularStamp</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.regularStampSynchronousActions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> dest = <span class="hljs-built_in">this</span>.currentHost;

    <span class="hljs-keyword">if</span> (dest) {

        <span class="hljs-keyword">let</span> engine = dest.engine;

        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.noCanvasEngineUpdates) dest.setEngine(<span class="hljs-built_in">this</span>);

        <span class="hljs-built_in">this</span>[<span class="hljs-built_in">this</span>.method](engine);
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p><code>getBoundingBox</code> - internal function called by <code>prepareStamp</code> and <code>cleanOutput</code> functions, as well as the various <strong><em>method</em></strong> functions.</p>
<ul>
<li>Loom calculates its bounding box from the Shape path entitys associated with it</li>
<li>This function recalculates when presented with a <code>dirtyStart</code> flag - we rely on the Shape entitys to tell us when their paths have changed/updated</li>
<li>Results get stashed in the <strong>boundingBox</strong> attribute for easier access, but all the method functions call this function just in case the box needs recalculating.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.getBoundingBox = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> fPath = <span class="hljs-built_in">this</span>.fromPath,
        tPath = <span class="hljs-built_in">this</span>.toPath;

    <span class="hljs-keyword">if</span>(fPath &amp;&amp; tPath) {

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyStart) {

            <span class="hljs-keyword">if</span> (fPath.getBoundingBox &amp;&amp; tPath.getBoundingBox) {

                <span class="hljs-built_in">this</span>.dirtyStart = <span class="hljs-literal">false</span>;

                <span class="hljs-keyword">let</span> [lsx, lsy, sw, sh, sx, sy] = fPath.getBoundingBox();
                <span class="hljs-keyword">let</span> [lex, ley, ew, eh, ex, ey] = tPath.getBoundingBox();

                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(lsx) || <span class="hljs-built_in">isNaN</span>(lsy) || <span class="hljs-built_in">isNaN</span>(sw) || <span class="hljs-built_in">isNaN</span>(sh) || <span class="hljs-built_in">isNaN</span>(sx) || <span class="hljs-built_in">isNaN</span>(sy) || <span class="hljs-built_in">isNaN</span>(lex) || <span class="hljs-built_in">isNaN</span>(ley) || <span class="hljs-built_in">isNaN</span>(ew) || <span class="hljs-built_in">isNaN</span>(eh) || <span class="hljs-built_in">isNaN</span>(ex) || <span class="hljs-built_in">isNaN</span>(ey)) <span class="hljs-built_in">this</span>.dirtyStart = <span class="hljs-literal">true</span>;

                <span class="hljs-keyword">if</span> (lsx == lex &amp;&amp; lsy == ley &amp;&amp; sw == ew &amp;&amp; sh == eh &amp;&amp; sx == ex &amp;&amp; sy == ey) <span class="hljs-built_in">this</span>.dirtyStart = <span class="hljs-literal">true</span>;

                lsx += sx;
                lsy += sy;
                lex += ex;
                ley += ey;

                <span class="hljs-keyword">let</span> minX = <span class="hljs-built_in">Math</span>.min(lsx, lex);
                <span class="hljs-keyword">let</span> maxX = <span class="hljs-built_in">Math</span>.max(lsx + sw, lex + ew);
                <span class="hljs-keyword">let</span> minY = <span class="hljs-built_in">Math</span>.min(lsy, ley);
                <span class="hljs-keyword">let</span> maxY = <span class="hljs-built_in">Math</span>.max(lsy + sh, ley + eh);

                <span class="hljs-built_in">this</span>.boundingBox = [minX, minY, maxX - minX, maxY - minY];

                <span class="hljs-built_in">this</span>.dirtyPathData = <span class="hljs-literal">true</span>;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-built_in">this</span>.boundingBox = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>];
        }
    }
    <span class="hljs-keyword">else</span> <span class="hljs-built_in">this</span>.boundingBox = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>];

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.boundingBox;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <h5 id="stamp-methods">Stamp methods</h5>
<p>These ‘method’ functions stamp the Loom entity onto the canvas context supplied to them in the <code>engine</code> argument.</p>

            </div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p><code>fill</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.fill = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine</span>) </span>{


    <span class="hljs-built_in">this</span>.doFill(engine);

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.showBoundingBox) <span class="hljs-built_in">this</span>.drawBoundingBox(engine);

};</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p><code>draw</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.draw = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine</span>) </span>{

    <span class="hljs-built_in">this</span>.doStroke(engine);

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.showBoundingBox) <span class="hljs-built_in">this</span>.drawBoundingBox(engine);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p><code>drawAndFill</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.drawAndFill = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine</span>) </span>{

    <span class="hljs-built_in">this</span>.doStroke(engine);
    <span class="hljs-built_in">this</span>.currentHost.clearShadow();
    <span class="hljs-built_in">this</span>.doFill(engine);

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.showBoundingBox) <span class="hljs-built_in">this</span>.drawBoundingBox(engine);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p><code>fillAndDraw</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.fillAndDraw = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine</span>) </span>{

    <span class="hljs-built_in">this</span>.doFill(engine);
    <span class="hljs-built_in">this</span>.currentHost.clearShadow();
    <span class="hljs-built_in">this</span>.doStroke(engine);

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.showBoundingBox) <span class="hljs-built_in">this</span>.drawBoundingBox(engine);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p><code>drawThenFill</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.drawThenFill = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine</span>) </span>{

    <span class="hljs-built_in">this</span>.doStroke(engine);
    <span class="hljs-built_in">this</span>.doFill(engine);

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.showBoundingBox) <span class="hljs-built_in">this</span>.drawBoundingBox(engine);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p><code>fillThenDraw</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.fillThenDraw = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine</span>) </span>{

    <span class="hljs-built_in">this</span>.doFill(engine);
    <span class="hljs-built_in">this</span>.doStroke(engine);

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.showBoundingBox) <span class="hljs-built_in">this</span>.drawBoundingBox(engine);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p><code>clear</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.clear = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine</span>) </span>{

    <span class="hljs-keyword">let</span> output = <span class="hljs-built_in">this</span>.output,
        canvas = (<span class="hljs-built_in">this</span>.currentHost) ? <span class="hljs-built_in">this</span>.currentHost.element : <span class="hljs-literal">false</span>,
        gco = engine.globalCompositeOperation;

    <span class="hljs-keyword">if</span> (output &amp;&amp; canvas) {

        <span class="hljs-keyword">let</span> tempCell = requestCell(),
            tempEngine = tempCell.engine,
            tempCanvas = tempCell.element;

        <span class="hljs-keyword">let</span> [x, y, w, h] = <span class="hljs-built_in">this</span>.getBoundingBox();

        tempCanvas.width = w;
        tempCanvas.height = h;

        tempEngine.putImageData(output, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        engine.setTransform(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        engine.globalCompositeOperation = <span class="hljs-string">&#x27;destination-out&#x27;</span>;
        engine.drawImage(tempCanvas, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, w, h, x, y, w, h);
        engine.globalCompositeOperation = gco;

        releaseCell(tempCell);
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.showBoundingBox) <span class="hljs-built_in">this</span>.drawBoundingBox(engine);
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p><code>none</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.none = λ<span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>These <strong>stroke</strong> and <strong>fill</strong> functions handle most of the stuff that the method functions require to stamp the Loom entity onto a canvas cell.</p>

            </div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p><code>doStroke</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.doStroke = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine</span>) </span>{

    <span class="hljs-keyword">let</span> fPath = <span class="hljs-built_in">this</span>.fromPath,
        tPath = <span class="hljs-built_in">this</span>.toPath;

    <span class="hljs-keyword">if</span>(fPath &amp;&amp; fPath.getBoundingBox &amp;&amp; tPath &amp;&amp; tPath.getBoundingBox) {

        <span class="hljs-keyword">let</span> host = <span class="hljs-built_in">this</span>.currentHost;

        <span class="hljs-keyword">if</span> (host) {

            <span class="hljs-keyword">let</span> fStart = fPath.currentStampPosition,
                fEnd = fPath.getPathPositionData(<span class="hljs-number">1</span>),
                tStart = tPath.currentStampPosition,
                tEnd = tPath.getPathPositionData(<span class="hljs-number">1</span>);

            host.rotateDestination(engine, fStart[<span class="hljs-number">0</span>], fStart[<span class="hljs-number">1</span>], fPath);
            engine.stroke(fPath.pathObject);

            host.rotateDestination(engine, tStart[<span class="hljs-number">0</span>], tStart[<span class="hljs-number">1</span>], fPath);
            engine.stroke(tPath.pathObject);

            engine.setTransform(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
            engine.beginPath()
            engine.moveTo(fEnd.x, fEnd.y);
            engine.lineTo(tEnd.x, tEnd.y);
            engine.moveTo(...tStart);
            engine.lineTo(...fStart);
            engine.closePath();
            engine.stroke();
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p><code>doFill</code></p>
<ul>
<li>Canvas API’s <code>putImageData</code> function turns transparent pixels in the output into transparent in the host canvas - which is not what we want</li>
<li>Problem solved by putting output into a pool cell, then drawing it from there to the host cell</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.doFill = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine</span>) </span>{

    <span class="hljs-keyword">let</span> output = <span class="hljs-built_in">this</span>.output,
        canvas = (<span class="hljs-built_in">this</span>.currentHost) ? <span class="hljs-built_in">this</span>.currentHost.element : <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (output &amp;&amp; canvas) {

        <span class="hljs-keyword">let</span> tempCell = requestCell(),
            tempEngine = tempCell.engine,
            tempCanvas = tempCell.element;

        <span class="hljs-keyword">let</span> [x, y, w, h] = <span class="hljs-built_in">this</span>.getBoundingBox();

        tempCanvas.width = w;
        tempCanvas.height = h;

        tempEngine.putImageData(output, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        engine.setTransform(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        engine.drawImage(tempCanvas, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, w, h, x, y, w, h);

        releaseCell(tempCell);
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p><code>drawBoundingBox</code></p>
<ul>
<li>Usually only need to draw the bounding box during development work, to make sure the getBoundingBox calculation is operating correctly</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.drawBoundingBox = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyStart) <span class="hljs-built_in">this</span>.getBoundingBox();

    engine.save();

    <span class="hljs-keyword">let</span> t = engine.getTransform();
    engine.setTransform(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);

    engine.strokeStyle = <span class="hljs-built_in">this</span>.boundingBoxColor;
    engine.lineWidth = <span class="hljs-number">1</span>;
    engine.globalCompositeOperation = <span class="hljs-string">&#x27;source-over&#x27;</span>;
    engine.globalAlpha = <span class="hljs-number">1</span>;
    engine.shadowOffsetX = <span class="hljs-number">0</span>;
    engine.shadowOffsetY = <span class="hljs-number">0</span>;
    engine.shadowBlur = <span class="hljs-number">0</span>;

    engine.strokeRect(...this.boundingBox);

    engine.restore();
    engine.setTransform(t);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <h4 id="collision-functionality">Collision functionality</h4>

            </div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>The <code>checkHit</code> functionality can be used in the same way it is for other entitys (and groups)</p>
<ul>
<li>One difference is that this function checks hits against an ImageData object, thus doesn’t need to be supplied with a pool canvas so that it can do its job</li>
<li>Note: will check for the <code>dirtyTargetImage</code> flag, which normally gets checked as part of the rendering cycle</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.checkHit = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = []</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.noUserInteraction) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">let</span> tests = (!<span class="hljs-built_in">Array</span>.isArray(items)) ?  [items] : items,
        targetData = (<span class="hljs-built_in">this</span>.output &amp;&amp; <span class="hljs-built_in">this</span>.output.data) ? <span class="hljs-built_in">this</span>.output.data : <span class="hljs-literal">false</span>, 
        tx, ty, cx, cy, index;

    <span class="hljs-keyword">if</span> (targetData) {

        <span class="hljs-keyword">let</span> [x, y, w, h] = <span class="hljs-built_in">this</span>.getBoundingBox();

        <span class="hljs-keyword">if</span> (tests.some(<span class="hljs-function"><span class="hljs-params">test</span> =&gt;</span> {

            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(test)) {

                tx = test[<span class="hljs-number">0</span>];
                ty = test[<span class="hljs-number">1</span>];
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (xta(test, test.x, test.y)) {

                tx = test.x;
                ty = test.y;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

            <span class="hljs-keyword">if</span> (!tx.toFixed || !ty.toFixed || <span class="hljs-built_in">isNaN</span>(tx) || <span class="hljs-built_in">isNaN</span>(ty)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

            cx = tx - x;
            cy = ty - y;

            <span class="hljs-keyword">if</span> (cx &lt; <span class="hljs-number">0</span> || cx &gt; w || cy &lt; <span class="hljs-number">0</span> || cy &gt; h) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; 

            index = (((cy * w) + cx) * <span class="hljs-number">4</span>) + <span class="hljs-number">3</span>;

            <span class="hljs-keyword">if</span> (targetData) <span class="hljs-keyword">return</span> (targetData[index] &gt; <span class="hljs-number">0</span>) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

        }, <span class="hljs-built_in">this</span>)) {

            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">x</span>: tx,
                <span class="hljs-attr">y</span>: ty,
                <span class="hljs-attr">artefact</span>: <span class="hljs-built_in">this</span>
            };
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <h4 id="factory">Factory</h4>
<pre><code>scrawl.makeQuadratic({

    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;my-quad&#x27;</span>,
    <span class="hljs-comment">// [... rest of definition]</span>
});

<span class="hljs-keyword">let</span> myBez = scrawl.makeBezier({

    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;my-bezier&#x27;</span>,
    <span class="hljs-comment">// [... rest of definition]</span>
});

scrawl.makePicture({

    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;myFlower&#x27;</span>,

    <span class="hljs-comment">// Loom will respect the Picture&#x27;s copy attributes when creating its output</span>
    <span class="hljs-attr">copyStartX</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">copyStartY</span>: <span class="hljs-number">0</span>,

    <span class="hljs-attr">copyWidth</span>: <span class="hljs-string">&#x27;100%&#x27;</span>,
    <span class="hljs-attr">copyHeight</span>: <span class="hljs-string">&#x27;100%&#x27;</span>,

    <span class="hljs-comment">// Best practice - set visibility to false</span>
    <span class="hljs-attr">visibility</span>: <span class="hljs-literal">false</span>,

    <span class="hljs-comment">// [... rest of definition]</span>
});

<span class="hljs-keyword">let</span> myLoom = scrawl.makeLoom({

    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;display-loom&#x27;</span>,

    <span class="hljs-attr">fromPath</span>: <span class="hljs-string">&#x27;my-quad&#x27;</span>,
    <span class="hljs-attr">toPath</span>: myBez,

    <span class="hljs-attr">source</span>: <span class="hljs-string">&#x27;myFlower&#x27;</span>,

    <span class="hljs-attr">lineWidth</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">lineCap</span>: <span class="hljs-string">&#x27;round&#x27;</span>,
    <span class="hljs-attr">strokeStyle</span>: <span class="hljs-string">&#x27;orange&#x27;</span>,

    <span class="hljs-attr">boundingBoxColor</span>: <span class="hljs-string">&#x27;red&#x27;</span>,
    <span class="hljs-attr">showBoundingBox</span>: <span class="hljs-literal">true</span>,

    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;fillThenDraw&#x27;</span>,
});</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> makeLoom = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Loom(items);
};

<span class="hljs-title">constructors</span>.<span class="hljs-title">Loom</span> = <span class="hljs-title">Loom</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <h4 id="exports">Exports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> {
    makeLoom,
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
