<!DOCTYPE html>

<html>
<head>
  <title>ImageAsset factory</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../core/animationloop.html">
                  ./source/core/animationloop.js
                </a>
              
                
                <a class="source" href="../core/component.html">
                  ./source/core/component.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/events.html">
                  ./source/core/events.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/userInteraction.html">
                  ./source/core/userInteraction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="bezier.html">
                  ./source/factory/bezier.js
                </a>
              
                
                <a class="source" href="block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="emitter.html">
                  ./source/factory/emitter.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="fontAttributes.html">
                  ./source/factory/fontAttributes.js
                </a>
              
                
                <a class="source" href="gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="imageAsset.html">
                  ./source/factory/imageAsset.js
                </a>
              
                
                <a class="source" href="line.html">
                  ./source/factory/line.js
                </a>
              
                
                <a class="source" href="loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="net.html">
                  ./source/factory/net.js
                </a>
              
                
                <a class="source" href="oval.html">
                  ./source/factory/oval.js
                </a>
              
                
                <a class="source" href="palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="particle.html">
                  ./source/factory/particle.js
                </a>
              
                
                <a class="source" href="particleForce.html">
                  ./source/factory/particleForce.js
                </a>
              
                
                <a class="source" href="particleHistory.html">
                  ./source/factory/particleHistory.js
                </a>
              
                
                <a class="source" href="particleSpring.html">
                  ./source/factory/particleSpring.js
                </a>
              
                
                <a class="source" href="particleWorld.html">
                  ./source/factory/particleWorld.js
                </a>
              
                
                <a class="source" href="pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="polygon.html">
                  ./source/factory/polygon.js
                </a>
              
                
                <a class="source" href="polyline.html">
                  ./source/factory/polyline.js
                </a>
              
                
                <a class="source" href="quadratic.html">
                  ./source/factory/quadratic.js
                </a>
              
                
                <a class="source" href="quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="radialGradient.html">
                  ./source/factory/radialGradient.js
                </a>
              
                
                <a class="source" href="rectangle.html">
                  ./source/factory/rectangle.js
                </a>
              
                
                <a class="source" href="renderAnimation.html">
                  ./source/factory/renderAnimation.js
                </a>
              
                
                <a class="source" href="shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="spiral.html">
                  ./source/factory/spiral.js
                </a>
              
                
                <a class="source" href="spriteAsset.html">
                  ./source/factory/spriteAsset.js
                </a>
              
                
                <a class="source" href="stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="star.html">
                  ./source/factory/star.js
                </a>
              
                
                <a class="source" href="state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="tetragon.html">
                  ./source/factory/tetragon.js
                </a>
              
                
                <a class="source" href="ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="tracer.html">
                  ./source/factory/tracer.js
                </a>
              
                
                <a class="source" href="tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="unstackedElement.html">
                  ./source/factory/unstackedElement.js
                </a>
              
                
                <a class="source" href="vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="videoAsset.html">
                  ./source/factory/videoAsset.js
                </a>
              
                
                <a class="source" href="wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="../mixin/anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="../mixin/asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="../mixin/assetConsumer.html">
                  ./source/mixin/assetConsumer.js
                </a>
              
                
                <a class="source" href="../mixin/base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="../mixin/cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="../mixin/delta.html">
                  ./source/mixin/delta.js
                </a>
              
                
                <a class="source" href="../mixin/displayShape.html">
                  ./source/mixin/displayShape.js
                </a>
              
                
                <a class="source" href="../mixin/dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="../mixin/entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="../mixin/filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="../mixin/mimic.html">
                  ./source/mixin/mimic.js
                </a>
              
                
                <a class="source" href="../mixin/path.html">
                  ./source/mixin/path.js
                </a>
              
                
                <a class="source" href="../mixin/pattern.html">
                  ./source/mixin/pattern.js
                </a>
              
                
                <a class="source" href="../mixin/pivot.html">
                  ./source/mixin/pivot.js
                </a>
              
                
                <a class="source" href="../mixin/position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="../mixin/shapeBasic.html">
                  ./source/mixin/shapeBasic.js
                </a>
              
                
                <a class="source" href="../mixin/shapeCurve.html">
                  ./source/mixin/shapeCurve.js
                </a>
              
                
                <a class="source" href="../mixin/shapePathCalculation.html">
                  ./source/mixin/shapePathCalculation.js
                </a>
              
                
                <a class="source" href="../mixin/styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="../mixin/tween.html">
                  ./source/mixin/tween.js
                </a>
              
                
                <a class="source" href="../worker/filter-stringed.html">
                  ./source/worker/filter-stringed.js
                </a>
              
                
                <a class="source" href="../worker/filter.html">
                  ./source/worker/filter.js
                </a>
              
                
                <a class="source" href="../worker/filter_canvas.html">
                  ./source/worker/filter_canvas.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="imageasset-factory">ImageAsset factory</h1>
<p>The factory generates wrapper Objects around &lt;img&gt; elements which can either be pulled from the current document (DOM-based assets), or fetched from the server using an URL address.</p>
<p>Image-based assets can also be created from entity artefacts, groups of entity artefacts, and Cell wrappers</p>
<p>ImageAssets are used by <a href="./picture.html">Picture</a> and <a href="./grid.html">Grid</a> entitys, and <a href="./pattern.html">Pattern</a> styles.</p>
<p>TODO: ImageAssets don’t support animated <code>.gif</code> images (or if they do, then its entirely a lucky accident). Tested image formats are <code>.jpg</code> and <code>.png</code>.</p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h4 id="demos">Demos:</h4>
<ul>
<li><a href="../../demo/canvas-008.html">Canvas-008</a> - Picture entity position; manipulate copy attributes</li>
<li><a href="../../demo/canvas-009.html">Canvas-009</a> - Pattern styles; Entity web link anchors; Dynamic accessibility</li>
<li><a href="../../demo/canvas-023.html">Canvas-023</a> - Grid entity - using picture-based assets (image, video, sprite)</li>
<li><a href="../../demo/canvas-025.html">Canvas-025</a> - Responsive images</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h4 id="imports">Imports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { <span class="hljs-title">constructors</span>, <span class="hljs-title">canvas</span>, <span class="hljs-title">cell</span>, <span class="hljs-title">group</span>, <span class="hljs-title">artefact</span> } <span class="hljs-title">from</span> &#x27;../<span class="hljs-title">core</span>/<span class="hljs-title">library</span>.<span class="hljs-title">js</span>&#x27;;
<span class="hljs-keyword">import</span> { mergeOver, isa_obj, λ<span class="hljs-built_in">this</span>, λ<span class="hljs-literal">null</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/utilities.js&#x27;</span>;

<span class="hljs-keyword">import</span> baseMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/base.js&#x27;</span>;
<span class="hljs-keyword">import</span> assetMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/asset.js&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h4 id="imageasset-constructor">ImageAsset constructor</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> ImageAsset = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.assetConstructor(items);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h4 id="imageasset-prototype">ImageAsset prototype</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> P = ImageAsset.prototype = <span class="hljs-built_in">Object</span>.create(<span class="hljs-built_in">Object</span>.prototype);
P.type = <span class="hljs-string">&#x27;Image&#x27;</span>;
P.lib = <span class="hljs-string">&#x27;asset&#x27;</span>;
P.isArtefact = <span class="hljs-literal">false</span>;
P.isAsset = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h4 id="mixins">Mixins</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P = baseMix(P);
P = assetMix(P);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h4 id="imageasset-attributes">ImageAsset attributes</h4>
<ul>
<li>Attributes defined in the <a href="../mixin/base.html">base mixin</a>: <strong>name</strong>.</li>
<li>Attributes defined in the <a href="../mixin/asset.html">asset mixin</a>: <strong>source, subscribers</strong>.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> defaultAttributes = {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><strong>intrinsicDimensions</strong> - Javascript object which defines the intrinsic dimensions of each image contributing to an &lt;img&gt; element’s <code>srcset</code> attribute. Can also be set in Javascript code:</p>
<pre><code>filename-<span class="hljs-built_in">String</span>: [width-<span class="hljs-built_in">Number</span>, height-<span class="hljs-built_in">Number</span>]
{
    <span class="hljs-string">&#x27;river-300.jpg&#x27;</span>: [<span class="hljs-number">300</span>, <span class="hljs-number">225</span>], 
    <span class="hljs-string">&#x27;river-600.jpg&#x27;</span>: [<span class="hljs-number">600</span>, <span class="hljs-number">450</span>], 
    <span class="hljs-string">&#x27;river-900.jpg&#x27;</span>: [<span class="hljs-number">900</span>, <span class="hljs-number">675</span>]
}</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>    intrinsicDimensions: <span class="hljs-literal">null</span>,
};
P.defs = mergeOver(P.defs, defaultAttributes);</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h4 id="packet-management">Packet management</h4>
<p>Assets do not take part in the packet or clone systems; they can, however, be used for importing and actioning packets as they retain those base functions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.saveAsPacket = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> [<span class="hljs-built_in">this</span>.name, <span class="hljs-built_in">this</span>.type, <span class="hljs-built_in">this</span>.lib, {}];
};
P.stringifyFunction = λ<span class="hljs-literal">null</span>;
P.processPacketOut = λ<span class="hljs-literal">null</span>;
P.finalizePacketOut = λ<span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h4 id="clone-management">Clone management</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.clone = λ<span class="hljs-built_in">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h4 id="kill-management">Kill management</h4>
<p>No additional kill functionality required</p>

            </div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h4 id="get-set-deltaset">Get, Set, deltaSet</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> G = P.getters,
    S = P.setters,
    D = P.deltaSetters;</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><strong>source</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.source = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item = {}</span>) </span>{

    <span class="hljs-keyword">if</span> (item) {</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>For &lt;img&gt; and &lt;picture&gt; elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ([<span class="hljs-string">&#x27;IMG&#x27;</span>, <span class="hljs-string">&#x27;PICTURE&#x27;</span>].indexOf(item.tagName.toUpperCase()) &gt;= <span class="hljs-number">0</span>) {

            <span class="hljs-built_in">this</span>.source = item;
            <span class="hljs-built_in">this</span>.sourceNaturalWidth = item.naturalWidth;
            <span class="hljs-built_in">this</span>.sourceNaturalHeight = item.naturalHeight;
            <span class="hljs-built_in">this</span>.sourceLoaded = item.complete;
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.sourceLoaded) <span class="hljs-built_in">this</span>.notifySubscribers();
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p><strong>currentSrc</strong> - this attribute is not part of the defs object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.currentSrc = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.currentSrc = item;
    <span class="hljs-built_in">this</span>.currentFile = <span class="hljs-built_in">this</span>.currentSrc.split(<span class="hljs-string">&quot;/&quot;</span>).pop();
};</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h4 id="prototype-functions">Prototype functions</h4>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p><code>checkSource</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.checkSource = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">width, height</span>) </span>{

    <span class="hljs-keyword">let</span> el = <span class="hljs-built_in">this</span>.source,
        action = <span class="hljs-string">&#x27;element&#x27;</span>;

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.sourceLoaded) {

        <span class="hljs-keyword">let</span> iDims = <span class="hljs-built_in">this</span>.intrinsicDimensions[<span class="hljs-built_in">this</span>.currentFile];

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.currentSrc !== el.currentSrc) {

            <span class="hljs-built_in">this</span>.set({
                <span class="hljs-attr">currentSrc</span>: el.currentSrc
            });

            iDims = <span class="hljs-built_in">this</span>.intrinsicDimensions[<span class="hljs-built_in">this</span>.currentFile];
            
            <span class="hljs-keyword">if</span> (iDims) action = <span class="hljs-string">&#x27;intrinsic&#x27;</span>;
            <span class="hljs-keyword">else</span> action = <span class="hljs-string">&#x27;zero&#x27;</span>;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (iDims) action = <span class="hljs-string">&#x27;intrinsic&#x27;</span>;

        <span class="hljs-keyword">switch</span> (action) {

            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;zero&#x27;</span> :

                <span class="hljs-built_in">this</span>.sourceNaturalWidth = <span class="hljs-number">0</span>;
                <span class="hljs-built_in">this</span>.sourceNaturalHeight = <span class="hljs-number">0</span>;
                <span class="hljs-built_in">this</span>.notifySubscribers();
                <span class="hljs-keyword">break</span>;

            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;intrinsic&#x27;</span> :

                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.sourceNaturalWidth !== iDims[<span class="hljs-number">0</span>] || 
                        <span class="hljs-built_in">this</span>.sourceNaturalHeight !== iDims[<span class="hljs-number">1</span>]) {

                    <span class="hljs-built_in">this</span>.sourceNaturalWidth = iDims[<span class="hljs-number">0</span>];
                    <span class="hljs-built_in">this</span>.sourceNaturalHeight = iDims[<span class="hljs-number">1</span>];

                    <span class="hljs-built_in">this</span>.notifySubscribers();
                }
                <span class="hljs-keyword">break</span>;

            <span class="hljs-keyword">default</span>:

                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.sourceNaturalWidth !== el.naturalWidth || 
                        <span class="hljs-built_in">this</span>.sourceNaturalHeight !== el.naturalHeight || 
                        <span class="hljs-built_in">this</span>.sourceNaturalWidth !== width ||
                        <span class="hljs-built_in">this</span>.sourceNaturalHeight !== height) {

                    <span class="hljs-built_in">this</span>.sourceNaturalWidth = el.naturalWidth;
                    <span class="hljs-built_in">this</span>.sourceNaturalHeight = el.naturalHeight;

                    <span class="hljs-built_in">this</span>.notifySubscribers();
                }
        };
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p><code>gettableImageAssetAtributes</code>, <code>settableImageAssetAtributes</code> - exported Arrays.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> gettableImageAssetAtributes = [];
<span class="hljs-keyword">const</span> settableImageAssetAtributes = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <h4 id="importing-images-into-scrawl-canvas">Importing images into Scrawl-canvas</h4>

            </div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p><code>importImage</code> - load images from a remote server and create assets from them</p>
<p>Arguments can be a comma-separated list of String urls. For example, for aimage file at server url <code>http://www.example.com/path/to/image/flower.jpg</code>:</p>
<ul>
<li>Will attempt to give the new imageAsset object, and img element, a name/id value of eg ‘flower’ (but not guaranteed)</li>
<li>Will not add the new img element to the DOM</li>
</ul>
<p>Alternatively, the arguments can include an object with the following attributes:</p>
<ul>
<li><strong>name</strong> string.</li>
<li><strong>src</strong> url string.</li>
<li><strong>parent</strong> CSS search string - if set, Scrawl-canvas will attempt to append the new img element to the corresponding DOM element.</li>
<li><strong>isVisible</strong> boolean - if true, and new img element has been added to DOM, make that image visible; default is false.</li>
<li><strong>className</strong> string - list of classes to be added to the new img element.</li>
</ul>
<p>Note: strings and object arguments can be mixed - Scrawl-canvas will interrrogate each argument in turn and take appropriate action to load the assets.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> importImage = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) </span>{

    <span class="hljs-keyword">let</span> reg = <span class="hljs-regexp">/.*\/(.*?)\./</span>,
        results = [];

    args.forEach(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {

        <span class="hljs-keyword">let</span> name, url, className, visibility, 
            parent = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">let</span> flag = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">if</span> (item.substring) {

            <span class="hljs-keyword">let</span> match = reg.exec(item);

            name = (match &amp;&amp; match[<span class="hljs-number">1</span>]) ? match[<span class="hljs-number">1</span>] : <span class="hljs-string">&#x27;&#x27;</span>;
            url = item;
            className = <span class="hljs-string">&#x27;&#x27;</span>;
            visibility = <span class="hljs-literal">false</span>;

            flag = <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">else</span> {

            item = (isa_obj(item)) ? item : <span class="hljs-literal">false</span>;

            <span class="hljs-keyword">if</span> (item &amp;&amp; item.src) {

                name = item.name || <span class="hljs-string">&#x27;&#x27;</span>;

                url = item.src;
                className = item.className || <span class="hljs-string">&#x27;&#x27;</span>;
                visibility = item.visibility || <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">if</span> (item.parent) parent = <span class="hljs-built_in">document</span>.querySelector(item.parent);

                flag = <span class="hljs-literal">true</span>;
            }
        }    

        <span class="hljs-keyword">if</span> (flag) {

            <span class="hljs-keyword">let</span> image = makeImageAsset({
                <span class="hljs-attr">name</span>: name,
                <span class="hljs-attr">intrinsicDimensions</span>: {},
            });

            <span class="hljs-keyword">let</span> img = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&#x27;img&#x27;</span>);

            img.name = name;
            img.className = className;
            img.crossorigin = <span class="hljs-string">&#x27;anonymous&#x27;</span>;

            img.style.display = (visibility) ? <span class="hljs-string">&#x27;block&#x27;</span> : <span class="hljs-string">&#x27;none&#x27;</span>;

            <span class="hljs-keyword">if</span> (parent) parent.appendChild(img);
            
            img.onload = <span class="hljs-function">() =&gt;</span> {

                image.set({
                    <span class="hljs-attr">source</span>: img,
                });
            };
            
            img.src = url;

            image.set({
                <span class="hljs-attr">source</span>: img,
            });

            results.push(name);
        }
        <span class="hljs-keyword">else</span> results.push(<span class="hljs-literal">false</span>);
    });
    <span class="hljs-keyword">return</span> results;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p><code>importDomImage</code> - import images defined in the web page HTML code</p>
<ul>
<li>Required argument is a query string used to search the dom for matching elements</li>
<li>Scrawl-canvas does not remove &lt;img&gt; elements from the DOM (this is a breaking change from Scrawl-canvas v7.0). </li>
<li>If &lt;img&gt; elements should not appear, developers need to hide them in some way - for instance by positioning them (or their parent element) absolutely to the top or left of the display; or by giving their parent element zero width/height; or by setting their CSS: <code>display: none;</code>, <code>opacity: 0;</code>, etc.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> importDomImage = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">query</span>) </span>{

    <span class="hljs-keyword">let</span> reg = <span class="hljs-regexp">/.*\/(.*?)\./</span>;

    <span class="hljs-keyword">let</span> items = <span class="hljs-built_in">document</span>.querySelectorAll(query);

    items.forEach(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {

        <span class="hljs-keyword">let</span> name;

        <span class="hljs-keyword">if</span> ([<span class="hljs-string">&#x27;IMG&#x27;</span>, <span class="hljs-string">&#x27;PICTURE&#x27;</span>].indexOf(item.tagName.toUpperCase()) &gt;= <span class="hljs-number">0</span>) {

            <span class="hljs-keyword">if</span> (item.id || item.name) name = item.id || item.name;
            <span class="hljs-keyword">else</span> {

                <span class="hljs-keyword">let</span> match = reg.exec(item.src);
                name = (match &amp;&amp; match[<span class="hljs-number">1</span>]) ? match[<span class="hljs-number">1</span>] : <span class="hljs-string">&#x27;&#x27;</span>;
            }

            <span class="hljs-keyword">let</span> intrinsics = item.dataset.dimensions || {};
            <span class="hljs-keyword">if</span> (intrinsics.substring) intrinsics = <span class="hljs-built_in">JSON</span>.parse(intrinsics);

            <span class="hljs-keyword">let</span> image = makeImageAsset({
                <span class="hljs-attr">name</span>: name,
                <span class="hljs-attr">source</span>: item,
                <span class="hljs-attr">intrinsicDimensions</span>: intrinsics,
                <span class="hljs-attr">currentSrc</span>: item.currentSrc,
            });

            item.onload = <span class="hljs-function">() =&gt;</span> {

                image.set({
                    <span class="hljs-attr">source</span>: item,
                });
            };
        }
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>We can get cells, groups and entitys to save their output as imagedata, which we can then use to build an asset which in turn can be used by Picture entitys and pattern styles</p>

            </div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p><code>createImageFromCell</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> createImageFromCell = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item, stashAsAsset = <span class="hljs-literal">false</span></span>) </span>{

    <span class="hljs-keyword">let</span> mycell = (item.substring) ? cell[item] || canvas[item] : item;

    <span class="hljs-keyword">if</span> (mycell.type === <span class="hljs-string">&#x27;Canvas&#x27;</span>) mycell = mycell.base;

    <span class="hljs-keyword">if</span> (mycell.type === <span class="hljs-string">&#x27;Cell&#x27;</span>) {

        mycell.stashOutput = <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">if</span> (stashAsAsset) mycell.stashOutputAsAsset = <span class="hljs-literal">true</span>;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p><code>createImageFromGroup</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> createImageFromGroup = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item, stashAsAsset = <span class="hljs-literal">false</span></span>) </span>{

    <span class="hljs-keyword">let</span> mygroup;

    <span class="hljs-keyword">if</span> (item &amp;&amp; !item.substring) {

        <span class="hljs-keyword">if</span> (item.type === <span class="hljs-string">&#x27;Group&#x27;</span>) mygroup = item;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.type === <span class="hljs-string">&#x27;Cell&#x27;</span>) mygroup = group[item.name];
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.type === <span class="hljs-string">&#x27;Canvas&#x27;</span>) mygroup = group[item.base.name];
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item &amp;&amp; item.substring) mygroup = group[item];

    <span class="hljs-keyword">if</span> (mygroup) {

        mygroup.stashOutput = <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">if</span> (stashAsAsset) mygroup.stashOutputAsAsset = <span class="hljs-literal">true</span>;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p><code>createImageFromEntity</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> createImageFromEntity = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item, stashAsAsset = <span class="hljs-literal">false</span></span>) </span>{

    <span class="hljs-keyword">let</span> myentity = (item.substring) ? artefact[item] : item;

    <span class="hljs-keyword">if</span> (myentity.isArtefact) {

        myentity.stashOutput = <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">if</span> (stashAsAsset) myentity.stashOutputAsAsset = <span class="hljs-literal">true</span>;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h4 id="factory">Factory</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> makeImageAsset = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ImageAsset(items);
};

<span class="hljs-title">constructors</span>.<span class="hljs-title">ImageAsset</span> = <span class="hljs-title">ImageAsset</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <h4 id="exports">Exports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> {
    makeImageAsset,

    gettableImageAssetAtributes,
    settableImageAssetAtributes,

    importImage,
    importDomImage,

    createImageFromCell,
    createImageFromGroup,
    createImageFromEntity,
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
