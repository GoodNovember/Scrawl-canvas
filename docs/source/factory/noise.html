<!DOCTYPE html>

<html>
<head>
  <title>Noise factory</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../core/animationloop.html">
                  ./source/core/animationloop.js
                </a>
              
                
                <a class="source" href="../core/component.html">
                  ./source/core/component.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/events.html">
                  ./source/core/events.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/userInteraction.html">
                  ./source/core/userInteraction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="bezier.html">
                  ./source/factory/bezier.js
                </a>
              
                
                <a class="source" href="block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="cog.html">
                  ./source/factory/cog.js
                </a>
              
                
                <a class="source" href="color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="emitter.html">
                  ./source/factory/emitter.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="fontAttributes.html">
                  ./source/factory/fontAttributes.js
                </a>
              
                
                <a class="source" href="gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="imageAsset.html">
                  ./source/factory/imageAsset.js
                </a>
              
                
                <a class="source" href="line.html">
                  ./source/factory/line.js
                </a>
              
                
                <a class="source" href="loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="mesh.html">
                  ./source/factory/mesh.js
                </a>
              
                
                <a class="source" href="net.html">
                  ./source/factory/net.js
                </a>
              
                
                <a class="source" href="noise.html">
                  ./source/factory/noise.js
                </a>
              
                
                <a class="source" href="oval.html">
                  ./source/factory/oval.js
                </a>
              
                
                <a class="source" href="palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="particle.html">
                  ./source/factory/particle.js
                </a>
              
                
                <a class="source" href="particleForce.html">
                  ./source/factory/particleForce.js
                </a>
              
                
                <a class="source" href="particleHistory.html">
                  ./source/factory/particleHistory.js
                </a>
              
                
                <a class="source" href="particleSpring.html">
                  ./source/factory/particleSpring.js
                </a>
              
                
                <a class="source" href="particleWorld.html">
                  ./source/factory/particleWorld.js
                </a>
              
                
                <a class="source" href="pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="polygon.html">
                  ./source/factory/polygon.js
                </a>
              
                
                <a class="source" href="polyline.html">
                  ./source/factory/polyline.js
                </a>
              
                
                <a class="source" href="quadratic.html">
                  ./source/factory/quadratic.js
                </a>
              
                
                <a class="source" href="quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="radialGradient.html">
                  ./source/factory/radialGradient.js
                </a>
              
                
                <a class="source" href="rectangle.html">
                  ./source/factory/rectangle.js
                </a>
              
                
                <a class="source" href="renderAnimation.html">
                  ./source/factory/renderAnimation.js
                </a>
              
                
                <a class="source" href="shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="spiral.html">
                  ./source/factory/spiral.js
                </a>
              
                
                <a class="source" href="spriteAsset.html">
                  ./source/factory/spriteAsset.js
                </a>
              
                
                <a class="source" href="stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="star.html">
                  ./source/factory/star.js
                </a>
              
                
                <a class="source" href="state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="tetragon.html">
                  ./source/factory/tetragon.js
                </a>
              
                
                <a class="source" href="ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="tracer.html">
                  ./source/factory/tracer.js
                </a>
              
                
                <a class="source" href="tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="unstackedElement.html">
                  ./source/factory/unstackedElement.js
                </a>
              
                
                <a class="source" href="vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="videoAsset.html">
                  ./source/factory/videoAsset.js
                </a>
              
                
                <a class="source" href="wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="../mixin/anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="../mixin/asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="../mixin/assetConsumer.html">
                  ./source/mixin/assetConsumer.js
                </a>
              
                
                <a class="source" href="../mixin/base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="../mixin/cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="../mixin/delta.html">
                  ./source/mixin/delta.js
                </a>
              
                
                <a class="source" href="../mixin/displayShape.html">
                  ./source/mixin/displayShape.js
                </a>
              
                
                <a class="source" href="../mixin/dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="../mixin/entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="../mixin/filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="../mixin/mimic.html">
                  ./source/mixin/mimic.js
                </a>
              
                
                <a class="source" href="../mixin/path.html">
                  ./source/mixin/path.js
                </a>
              
                
                <a class="source" href="../mixin/pattern.html">
                  ./source/mixin/pattern.js
                </a>
              
                
                <a class="source" href="../mixin/pivot.html">
                  ./source/mixin/pivot.js
                </a>
              
                
                <a class="source" href="../mixin/position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="../mixin/shapeBasic.html">
                  ./source/mixin/shapeBasic.js
                </a>
              
                
                <a class="source" href="../mixin/shapeCurve.html">
                  ./source/mixin/shapeCurve.js
                </a>
              
                
                <a class="source" href="../mixin/shapePathCalculation.html">
                  ./source/mixin/shapePathCalculation.js
                </a>
              
                
                <a class="source" href="../mixin/styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="../mixin/tween.html">
                  ./source/mixin/tween.js
                </a>
              
                
                <a class="source" href="../worker/filter-string.html">
                  ./source/worker/filter-string.js
                </a>
              
                
                <a class="source" href="../worker/filter.html">
                  ./source/worker/filter.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="noise-factory">Noise factory</h1>
<p>The purpose of the Noise asset is to give us a resource for generating noisy (semi-regular) maps. These can then be used directly as Picture or Pattern images, or uploaded to the filter worker object as part of a filter that uses displacement map functionality.</p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h4 id="current-functionality">Current functionality</h4>
<p>At the moment the Noise asset can generate Perlin-type noise, with engines supplied for:</p>
<ul>
<li>Perlin (classic)</li>
<li>Perlin (improved)</li>
<li>Simplex - the default engine</li>
<li>Value</li>
</ul>
<p>These engines are supported by a number of settable (and thus animatable) attributes, including special functions for smoothing the engine output. Demo <a href="../../demo/filters-019.html">Filters-019</a> has been set up to allow for experimenting with these attributes</p>
<p>The noise generated will be output to a dedicated offscreen &lt;canvas&gt; element, which is the asset used by Picture entitys, Pattern styles and filters. The output image can be set to three color schemas:</p>
<ul>
<li><strong>Monochrome</strong> (black - gray - white)</li>
<li><strong>Gradient</strong> - mediated by a Scrawl-canvas Color object</li>
<li><strong>Hue</strong> - where the engine output for each pixel is interpreted as the hue component of an HSL color</li>
</ul>
<p>(<strong><em>NOTE:</em></strong> Perlin, Simplex and Value noise generator code based on code found in the <a href="https://github.com/lencinhaus/canvas-noise">canvas-noise GitHub repository</a> written by <a href="https://github.com/lencinhaus">lencinhaus</a>.</p>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h4 id="possible-future-functionality">Possible future functionality</h4>
<p>There’s no reason why the Noise asset cannot be extended to output other types of (semi-regular) noise data. For instance:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Nearest-neighbor_interpolation">Nearest neighbour interpolation</a> - for tesselations, particularly with <a href="https://en.wikipedia.org/wiki/Unstructured_grid">unstructured grids</a></li>
<li><a href="https://en.wikipedia.org/wiki/Linear_interpolation">Linear interpolation</a> </li>
<li><a href="https://en.wikipedia.org/wiki/Bilinear_interpolation">Bilinear interpolation</a></li>
<li><a href="https://en.wikipedia.org/wiki/Bicubic_interpolation">Bicubic interpolation</a> - and see also (this blog post)[<a href="https://jobtalle.com/cubic_noise.html%5D">https://jobtalle.com/cubic_noise.html]</a></li>
<li>Using non-rectangular <a href="https://en.wikipedia.org/wiki/Types_of_mesh">grids or meshes</a> as a starting point for generating noise. For instance: <a href="https://www.sciencemag.org/news/2016/05/sunflowers-show-complex-fibonacci-sequences">sunflower pattern</a></li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h4 id="demos">Demos:</h4>
<ul>
<li><a href="../../demo/canvas-044.html">Canvas-044</a> - Building more complex patterns</li>
<li><a href="../../demo/filters-019.html">Filters-019</a> - Using a Noise asset with a displace filter</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h4 id="imports">Imports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { <span class="hljs-title">constructors</span> } <span class="hljs-title">from</span> &#x27;../<span class="hljs-title">core</span>/<span class="hljs-title">library</span>.<span class="hljs-title">js</span>&#x27;;
<span class="hljs-keyword">import</span> { mergeOver, λ<span class="hljs-literal">null</span>, λ<span class="hljs-built_in">this</span>, λfirstArg, removeItem, seededRandomNumberGenerator, interpolate, easeOutSine, easeInSine, easeOutInSine, easeOutQuad, easeInQuad, easeOutInQuad, easeOutCubic, easeInCubic, easeOutInCubic, easeOutQuart, easeInQuart, easeOutInQuart, easeOutQuint, easeInQuint, easeOutInQuint, easeOutExpo, easeInExpo, easeOutInExpo, easeOutCirc, easeInCirc, easeOutInCirc, easeOutBack, easeInBack, easeOutInBack, easeOutElastic, easeInElastic, easeOutInElastic, easeOutBounce, easeInBounce, easeOutInBounce } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/utilities.js&#x27;</span>;

<span class="hljs-keyword">import</span> { makeColor } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./color.js&#x27;</span>;

<span class="hljs-keyword">import</span> baseMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/base.js&#x27;</span>;
<span class="hljs-keyword">import</span> assetMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/asset.js&#x27;</span>;
<span class="hljs-keyword">import</span> patternMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/pattern.js&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h4 id="noise-constructor">Noise constructor</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Noise = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-built_in">this</span>.makeName(items.name);
    <span class="hljs-built_in">this</span>.register();

    <span class="hljs-keyword">let</span> mycanvas = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&#x27;canvas&#x27;</span>);
    mycanvas.id = <span class="hljs-built_in">this</span>.name;
    <span class="hljs-built_in">this</span>.installElement(mycanvas);

    <span class="hljs-built_in">this</span>.perm = [];
    <span class="hljs-built_in">this</span>.permMod8 = [];
    <span class="hljs-built_in">this</span>.values = [];
    <span class="hljs-built_in">this</span>.grad = [];

    <span class="hljs-built_in">this</span>.subscribers = [];

    <span class="hljs-built_in">this</span>.colorFactory = makeColor({
        <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">this</span>.name}</span>-color-factory`</span>,
        <span class="hljs-attr">minimumColor</span>: items.gradientStart || <span class="hljs-string">&#x27;red&#x27;</span>,
        <span class="hljs-attr">maximumColor</span>: items.gradientEnd || <span class="hljs-string">&#x27;green&#x27;</span>,
    });

    <span class="hljs-built_in">this</span>.set(<span class="hljs-built_in">this</span>.defs);
    <span class="hljs-built_in">this</span>.set(items);

    <span class="hljs-keyword">if</span> (items.subscribe) <span class="hljs-built_in">this</span>.subscribers.push(items.subscribe);

    <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h4 id="noise-prototype">Noise prototype</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> P = Noise.prototype = <span class="hljs-built_in">Object</span>.create(<span class="hljs-built_in">Object</span>.prototype);
P.type = <span class="hljs-string">&#x27;Noise&#x27;</span>;
P.lib = <span class="hljs-string">&#x27;asset&#x27;</span>;
P.isArtefact = <span class="hljs-literal">false</span>;
P.isAsset = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h4 id="mixins">Mixins</h4>
<ul>
<li><a href="../mixin/base.html">base</a></li>
<li><a href="../mixin/asset.html">asset</a></li>
<li><a href="../mixin/pattern.html">pattern</a></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P = baseMix(P);
P = assetMix(P);
P = patternMix(P);</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h4 id="noise-attributes">Noise attributes</h4>
<ul>
<li>Attributes defined in the <a href="../mixin/base.html">base mixin</a>: <strong>name</strong>.</li>
<li>Attributes defined in the <a href="../mixin/asset.html">asset mixin</a>: <strong>source, subscribers</strong>.</li>
<li>Attributes defined in the <a href="../mixin/pattern.html">pattern mixin</a>: <strong>repeat, patternMatrix, matrixA, matrixB, matrixC, matrixD, matrixE, matrixF</strong>.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> defaultAttributes = {</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>The offscreen canvas dimensions, within which the noise will be generated, is set using the <strong>width</strong> and <strong>height</strong> attributes. These take Number values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    width: <span class="hljs-number">300</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">150</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p><strong>color</strong> - String value determining how the generated noise will be output on the canvas. Currently recognised values are: <code>monochrome</code> (default), <code>gradient</code> and <code>hue</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    color: <span class="hljs-string">&#x27;monochrome&#x27;</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>When the <code>color</code> choice has been set to <code>monochrome</code> we can clamp the pixel values using the <strong>monochromeStart</strong> and <strong>monochromeRange</strong> attributes, both of which take integer Numbers. </p>
<ul>
<li>Accepted monochromeStart values are 0 to 255</li>
<li>Accepted monochromeRange values are -255 to 255</li>
<li>Be aware that the monochromeRange value will be recalculated to make sure calculated pixel values remain in the 0-255 color channel range</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    monochromeStart: <span class="hljs-number">0</span>,
    <span class="hljs-attr">monochromeRange</span>: <span class="hljs-number">255</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>When the <code>color</code> choice has been set to <code>gradient</code> we can control the start and end colors of the gradient using the <strong>gradientStart</strong> and <strong>gradientEnd</strong> attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    gradientStart: <span class="hljs-string">&#x27;#ff0000&#x27;</span>,
    <span class="hljs-attr">gradientEnd</span>: <span class="hljs-string">&#x27;#00ff00&#x27;</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>When the <code>color</code> choice has been set to <code>hue</code> we can control the pixel colors (in terms of their HSL components) using the <strong>hueStart</strong>, <strong>hueRange</strong>, <strong>saturation</strong> and <strong>luminosity</strong> attributes:</p>
<ul>
<li><code>hueStart</code> - float Number value in degrees, will be clamped to between 0 and 360</li>
<li><code>hueRange</code> - float Number value in degrees, can be negative as well as positive</li>
<li><code>saturation</code> - float Number value, between 0 and 100</li>
<li><code>luminosity</code> - float Number value, between 0 and 100</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    hueStart: <span class="hljs-number">0</span>,
    <span class="hljs-attr">hueRange</span>: <span class="hljs-number">120</span>,
    <span class="hljs-attr">saturation</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">luminosity</span>: <span class="hljs-number">50</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p><strong>noiseEngine</strong> - String - the currently supported noise engines String values are: <code>perlin</code>, <code>improved-perlin</code>, <code>simplex</code>, <code>value</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    noiseEngine: <span class="hljs-string">&#x27;simplex&#x27;</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>When a noise engine initializes it will create several Arrays of pseudo-random values. The <strong>seed</strong> attribute is a String used to initialize the pseudo-random number generator, while the <strong>size</strong> attribute is a Number (often a power of 2 value) which determines the lengths of the Arrays</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    seed: <span class="hljs-string">&#x27;any_random_string_will_do&#x27;</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">256</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>The <strong>scale</strong> attribute determines the relative scale of the noise calculation, which affects the noise output. Think of it as a rather idiosyncratic zoom factor </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    scale: <span class="hljs-number">50</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Attributes used when calculating the noise map include:</p>
<ul>
<li><strong>octaves</strong> - a positive integer Number - the more octives, the more naturalistic the output - values over 6 are rarely productive</li>
<li>__octaveFunction - a String identifying the function to be run at the end of each octave loop. Currently only <code>none</code> and <code>absolute</code> functions are supported</li>
<li><strong>persistance</strong> and <strong>lacunarity</strong> values change at the conclusion of each octave loop; these attributes set their initial values</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    octaves: <span class="hljs-number">1</span>,
    <span class="hljs-attr">octaveFunction</span>: <span class="hljs-string">&#x27;none&#x27;</span>,
    <span class="hljs-attr">persistence</span>: <span class="hljs-number">0.5</span>,
    <span class="hljs-attr">lacunarity</span>: <span class="hljs-number">2</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>The <strong>smoothing</strong> attribute - a String value - identifies the smoothing function that will be applied pixel noise values as they are calculated. There are a wide number of functions available, including: easeOutSine, easeInSine, easeOutInSine, easeOutQuad, easeInQuad, easeOutInQuad, easeOutCubic, easeInCubic, easeOutInCubic, easeOutQuart, easeInQuart, easeOutInQuart, easeOutQuint, easeInQuint, easeOutInQuint, easeOutExpo, easeInExpo, easeOutInExpo, easeOutCirc, easeInCirc, easeOutInCirc, easeOutBack, easeInBack, easeOutInBack, easeOutElastic, easeInElastic, easeOutInElastic, easeOutBounce, easeInBounce, easeOutInBounce, cosine, hermite, quintic (default)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    smoothing: <span class="hljs-string">&#x27;quintic&#x27;</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Post-processing the noise map: The <strong>sumFunction</strong> attribute - a String value - identifies the smoothing function that will be applied to the noise map once the noise calculations complete. </p>
<ul>
<li>Permitted values include: <code>none</code>, <code>sine-x</code>, <code>sine-y</code>, <code>sine</code>, <code>modular</code></li>
<li><strong>sineFrequencyCoeff</strong> - a Number - is used by sine-based sum functions</li>
<li><strong>modularAmplitude</strong> - a Number - is used by the modular sum function</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    sumFunction: <span class="hljs-string">&#x27;none&#x27;</span>,
    <span class="hljs-attr">sineFrequencyCoeff</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">modularAmplitude</span>: <span class="hljs-number">5</span>,


};
P.defs = mergeOver(P.defs, defaultAttributes);

<span class="hljs-keyword">delete</span> P.defs.source;
<span class="hljs-keyword">delete</span> P.defs.sourceLoaded;</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <h4 id="packet-management">Packet management</h4>
<p>This functionality is disabled for Cell objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.stringifyFunction = λ<span class="hljs-literal">null</span>;
P.processPacketOut = λ<span class="hljs-literal">null</span>;
P.finalizePacketOut = λ<span class="hljs-literal">null</span>;
P.saveAsPacket = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-string">`[<span class="hljs-subst">${<span class="hljs-built_in">this</span>.name}</span>, <span class="hljs-subst">${<span class="hljs-built_in">this</span>.type}</span>, <span class="hljs-subst">${<span class="hljs-built_in">this</span>.lib}</span>, {}]`</span>
};</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <h4 id="clone-management">Clone management</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.clone = λ<span class="hljs-built_in">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <h4 id="kill-management">Kill management</h4>
<p>No additional kill functionality required</p>

            </div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <h4 id="get-set-deltaset">Get, Set, deltaSet</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> G = P.getters,
    S = P.setters,
    D = P.deltaSetters;</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p><strong>source</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.source = λ<span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p><strong>subscribers</strong> - we disable the ability to set the subscribers Array directly. Picture entitys and Pattern styles will manage their subscription to the asset using their subscribe() and unsubscribe() functions. Filters will check for updates every time they run</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.subscribers = λ<span class="hljs-literal">null</span>;

S.octaveFunction = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.octaveFunction = <span class="hljs-built_in">this</span>.octaveFunctions[item] || λfirstArg;
    <span class="hljs-built_in">this</span>.dirtyNoise = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
};

S.sumFunction = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.sumFunction = <span class="hljs-built_in">this</span>.sumFunctions[item] || λfirstArg;
    <span class="hljs-built_in">this</span>.dirtyNoise = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
};

S.smoothing = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.smoothing = <span class="hljs-built_in">this</span>.smoothingFunctions[item] || λfirstArg;
    <span class="hljs-built_in">this</span>.dirtyNoise = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
};

S.noiseEngine = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.noiseEngine = <span class="hljs-built_in">this</span>.noiseEngines[item] || <span class="hljs-built_in">this</span>.noiseEngines[<span class="hljs-string">&#x27;simplex&#x27;</span>];
    <span class="hljs-built_in">this</span>.dirtyNoise = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
};

S.octaves = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item.toFixed) {

        <span class="hljs-built_in">this</span>.octaves = item;
        <span class="hljs-built_in">this</span>.dirtyNoise = <span class="hljs-literal">true</span>;
        <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
    }
};

S.seed = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item.substring) {

        <span class="hljs-built_in">this</span>.seed = item;
        <span class="hljs-built_in">this</span>.dirtyNoise = <span class="hljs-literal">true</span>;
        <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
    }
};

P.supportedColorSchemes = [<span class="hljs-string">&#x27;monochrome&#x27;</span>, <span class="hljs-string">&#x27;gradient&#x27;</span>, <span class="hljs-string">&#x27;hue&#x27;</span>];
S.color = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.supportedColorSchemes.indexOf(item) &gt;= <span class="hljs-number">0</span>) {

        <span class="hljs-built_in">this</span>.color = item;
        <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
    }
};

S.scale = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item.toFixed) {

        <span class="hljs-built_in">this</span>.scale = item;
        <span class="hljs-built_in">this</span>.dirtyNoise = <span class="hljs-literal">true</span>;
        <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
    }
};

S.size = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item.toFixed) {

        <span class="hljs-built_in">this</span>.size = item;
        <span class="hljs-built_in">this</span>.dirtyNoise = <span class="hljs-literal">true</span>;
        <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
    }
};

S.persistence = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item.toFixed) {

        <span class="hljs-built_in">this</span>.persistence = item;
        <span class="hljs-built_in">this</span>.dirtyNoise = <span class="hljs-literal">true</span>;
        <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
    }
};

S.lacunarity = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item.toFixed) {

        <span class="hljs-built_in">this</span>.lacunarity = item;
        <span class="hljs-built_in">this</span>.dirtyNoise = <span class="hljs-literal">true</span>;
        <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
    }
};

S.gradientStart = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item.substring) {

        <span class="hljs-built_in">this</span>.colorFactory.setMinimumColor(item);
        <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
    }
};

S.gradientEnd = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item.substring) {

        <span class="hljs-built_in">this</span>.colorFactory.setMaximumColor(item);
        <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
    }
};

S.monochromeStart = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item.toFixed &amp;&amp; item &gt;= <span class="hljs-number">0</span>) {

        <span class="hljs-built_in">this</span>.monochromeStart = item % <span class="hljs-number">360</span>;
        <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
    }
};

S.monochromeRange = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item.toFixed &amp;&amp; item &gt;= -<span class="hljs-number">255</span> &amp;&amp; item &lt; <span class="hljs-number">256</span>) {

        <span class="hljs-built_in">this</span>.monochromeRange = <span class="hljs-built_in">Math</span>.floor(item);
        <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
    }
};

S.hueStart = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item.toFixed) {

        <span class="hljs-built_in">this</span>.hueStart = item;
        <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
    }
};

S.hueRange = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item.toFixed) {

        <span class="hljs-built_in">this</span>.hueRange = item;
        <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
    }
};

S.saturation = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item.toFixed &amp;&amp; item &gt;= <span class="hljs-number">0</span> &amp;&amp; item &lt;= <span class="hljs-number">100</span>) {

        <span class="hljs-built_in">this</span>.saturation = <span class="hljs-built_in">Math</span>.floor(item);
        <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
    }
};

S.luminosity = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item.toFixed &amp;&amp; item &gt;= <span class="hljs-number">0</span> &amp;&amp; item &lt;= <span class="hljs-number">100</span>) {

        <span class="hljs-built_in">this</span>.luminosity = <span class="hljs-built_in">Math</span>.floor(item);
        <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
    }
};

S.sineFrequencyCoeff = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item.toFixed) {

        <span class="hljs-built_in">this</span>.sineFrequencyCoeff = item;
        <span class="hljs-built_in">this</span>.dirtyNoise = <span class="hljs-literal">true</span>;
        <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
    }
};

S.modularAmplitude = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item.toFixed) {

        <span class="hljs-built_in">this</span>.modularAmplitude = item;
        <span class="hljs-built_in">this</span>.dirtyNoise = <span class="hljs-literal">true</span>;
        <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
    }
};

S.width = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item.toFixed) {

        <span class="hljs-built_in">this</span>.width = item;
        <span class="hljs-built_in">this</span>.sourceNaturalWidth = item;
        <span class="hljs-built_in">this</span>.dirtyNoise = <span class="hljs-literal">true</span>;
        <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
    }
};

S.height = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item.toFixed) {

        <span class="hljs-built_in">this</span>.height = item;
        <span class="hljs-built_in">this</span>.sourceNaturalHeight = item;
        <span class="hljs-built_in">this</span>.dirtyNoise = <span class="hljs-literal">true</span>;
        <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <h4 id="prototype-functions">Prototype functions</h4>
<p><code>installElement</code> - internal function, used by the constructor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.installElement = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">element</span>) </span>{

    <span class="hljs-built_in">this</span>.element = element;
    <span class="hljs-built_in">this</span>.engine = <span class="hljs-built_in">this</span>.element.getContext(<span class="hljs-string">&#x27;2d&#x27;</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p><code>checkSource</code></p>
<ul>
<li>Gets invoked by subscribers (who have a handle to the asset instance object) as part of the display cycle.</li>
<li>Noise assets will automatically pass this call onto <code>notifySubscribers</code>, where dirty flags get checked and rectified</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.checkSource = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">width, height</span>) </span>{

    <span class="hljs-built_in">this</span>.notifySubscribers();
};</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p><code>getData</code> function called by Cell objects when calculating required updates to its CanvasRenderingContext2D engine, specifically for an entity’s <strong>fillStyle</strong>, <strong>strokeStyle</strong> and <strong>shadowColor</strong> attributes.</p>
<ul>
<li>This is the point when we clean Scrawl-canvas assets which have told their subscribers that asset data/attributes have updated</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.getData = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entity, cell</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>this.checkSource(this.width, this.height);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">this</span>.notifySubscribers();

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.buildStyle(cell);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p><code>notifySubscribers</code>, <code>notifySubscriber</code> - overwrites the functions defined in mixin/asset.js</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.notifySubscribers = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyOutput || <span class="hljs-built_in">this</span>.dirtyNoise) <span class="hljs-built_in">this</span>.cleanOutput();

    <span class="hljs-built_in">this</span>.subscribers.forEach(<span class="hljs-function"><span class="hljs-params">sub</span> =&gt;</span> <span class="hljs-built_in">this</span>.notifySubscriber(sub), <span class="hljs-built_in">this</span>);
};

P.notifySubscriber = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">sub</span>) </span>{

    sub.sourceNaturalWidth = <span class="hljs-built_in">this</span>.width;
    sub.sourceNaturalHeight = <span class="hljs-built_in">this</span>.height;
    sub.sourceLoaded = <span class="hljs-literal">true</span>;
    sub.source = <span class="hljs-built_in">this</span>.element;
    sub.dirtyImage = <span class="hljs-literal">true</span>;
    sub.dirtyCopyStart = <span class="hljs-literal">true</span>;
    sub.dirtyCopyDimensions = <span class="hljs-literal">true</span>;
    sub.dirtyImageSubscribers = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p><code>cleanOutput</code> - internal function called by the <code>notifySubscribers</code> function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cleanOutput = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyNoise) <span class="hljs-built_in">this</span>.cleanNoise();
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyOutput) <span class="hljs-built_in">this</span>.paintCanvas();
};</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p><code>cleanNoise</code> - internal function called by the <code>cleanOutput</code> function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cleanNoise = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyNoise) {

        <span class="hljs-built_in">this</span>.dirtyNoise = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">let</span> {noiseEngine, seed, width, height, element, engine, octaves, lacunarity, persistence, scale, octaveFunction, sumFunction} = <span class="hljs-built_in">this</span>;

        <span class="hljs-keyword">if</span> (noiseEngine &amp;&amp; noiseEngine.init) {</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Seed our pseudo-random number generator</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-built_in">this</span>.rndEngine = seededRandomNumberGenerator(seed);</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Generate the permutations table(s)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-built_in">this</span>.generatePermutationTable();</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Initialize the appropriate noise function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            noiseEngine.init.call(<span class="hljs-built_in">this</span>);

            <span class="hljs-keyword">let</span> x, y, o, i, iz,
                noiseValues = [],
                scaledX, scaledY,
                totalNoise, amplitude, frequency;</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Prepare the noiseValues 2d array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> (y = <span class="hljs-number">0</span>; y &lt; height; y++) {

                noiseValues[y] = [];

                <span class="hljs-keyword">for</span> (x = <span class="hljs-number">0</span>; x &lt; width; x++) {
                    noiseValues[y][x] = [];
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Calculate a relative scale, and setup min/max variables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">let</span> relativeScale = <span class="hljs-built_in">Math</span>.pow(width, -scale / <span class="hljs-number">100</span>);

            <span class="hljs-keyword">let</span> max = -<span class="hljs-number">1000</span>, 
                min = <span class="hljs-number">1000</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>This is the core of the calculation, performed for each cell in the noiseValues 2d array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> (y = <span class="hljs-number">0</span>; y &lt; height; y++) {
                <span class="hljs-keyword">for</span> (x = <span class="hljs-number">0</span>; x &lt; width; x++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>We can modify the output by scaling it</p>
<ul>
<li>Note that modifying the canvas dimensions (width, height) can also have a scaling effect</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    scaledX = x * relativeScale;
                    scaledY = y * relativeScale;</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Amplitude and frequency will update once per octave calculation; totalNoise is the sum of all octave results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    totalNoise = <span class="hljs-number">0</span>;
                    amplitude = <span class="hljs-number">1</span>; 
                    frequency = <span class="hljs-number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>The calculation will be performed at least once</p>
<ul>
<li>For some reason the literature insists on calling these loops “octaves”</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">for</span> (o = <span class="hljs-number">0</span>; o &lt; octaves; o++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Call the appropriate getNoiseValue function</p>
<ul>
<li>The result needs to be stored in a variable scoped locally to this loop iteration</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">let</span> octaveNoise = noiseEngine.getNoiseValue.call(<span class="hljs-built_in">this</span>, scaledX * frequency, scaledY * frequency);</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Update octave with a post-calculation octaveFunction, if required</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        octaveNoise = octaveFunction(octaveNoise, scaledX, scaledY, o + <span class="hljs-number">1</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Modify result by the current amplitude, and add to the running total</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        octaveNoise *= amplitude;
                        totalNoise += octaveNoise;</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Update the variables that change over multiple octave loops</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        frequency *= lacunarity;
                        amplitude *= persistence;
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Update the noise value in its array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    noiseValues[y][x] = totalNoise;</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>… and check for max/min spread of the generated values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    min = <span class="hljs-built_in">Math</span>.min(min, totalNoise);
                    max = <span class="hljs-built_in">Math</span>.max(max, totalNoise);
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Calculate the span of numbers generated - we need to get all the results in the range 0 to 1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">let</span> noiseSpan = max - min;

            <span class="hljs-keyword">for</span> (y = <span class="hljs-number">0</span>; y &lt; height; y++) {
                <span class="hljs-keyword">for</span> (x = <span class="hljs-number">0</span>; x &lt; width; x++) {

                    scaledX = x * relativeScale;
                    scaledY = y * relativeScale;</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Clamp the cell’s noise value to between 0 and 1, then update it with the post-calculation sumFunction, if required</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">let</span> clampedVal = (noiseValues[y][x] - min) / noiseSpan;
                    noiseValues[y][x] = sumFunction.call(<span class="hljs-built_in">this</span>, clampedVal, x * relativeScale, y * relativeScale);
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Update the cached noise values arrays</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-built_in">this</span>.noiseValues = noiseValues;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-built_in">this</span>.dirtyNoise = <span class="hljs-literal">true</span>;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p><code>paintCanvas</code> - internal function called by the <code>cleanOutput</code> function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.paintCanvas = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyOutput) {

        <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">let</span> {noiseValues, element, engine, width, height, color, colorFactory, monochromeStart, monochromeRange, hueStart, hueRange, saturation, luminosity} = <span class="hljs-built_in">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Noise values will be calculated in the cleanNoise function, but just in case this function gets invoked directly before the 2d array has been created …</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != noiseValues) {</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Update the Canvas element’s dimensions - this will also clear the canvas display</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            element.width = width;
            element.height = height;</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Rebuild the display, pixel-by-pixel</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">switch</span> (color) {

                <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;hue&#x27;</span> :

                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> y = <span class="hljs-number">0</span>; y &lt; height; y++) {
                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> x = <span class="hljs-number">0</span>; x &lt; width; x++) {

                            engine.fillStyle = <span class="hljs-string">`hsl(<span class="hljs-subst">${(hueStart + (noiseValues[y][x] * hueRange)) % <span class="hljs-number">360</span>}</span>, <span class="hljs-subst">${saturation}</span>%, <span class="hljs-subst">${luminosity}</span>%)`</span>;
                            engine.fillRect(x, y, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
                        }
                    }
                    <span class="hljs-keyword">break</span>;

                <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;gradient&#x27;</span> :

                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> y = <span class="hljs-number">0</span>; y &lt; height; y++) {
                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> x = <span class="hljs-number">0</span>; x &lt; width; x++) {

                            engine.fillStyle = colorFactory.getRangeColor(noiseValues[y][x]);
                            engine.fillRect(x, y, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
                        }
                    }
                    <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>The default color preference is monochrome</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">default</span> :

                    <span class="hljs-keyword">if</span> (monochromeRange &gt; <span class="hljs-number">0</span>) {

                        <span class="hljs-keyword">if</span> (monochromeStart + monochromeRange &gt; <span class="hljs-number">255</span>) monochromeRange = <span class="hljs-number">255</span> - monochromeStart;
                    }
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (monochromeRange &lt; <span class="hljs-number">0</span>) {

                        <span class="hljs-keyword">if</span> (monochromeStart - monochromeRange &lt; <span class="hljs-number">0</span>) monochromeRange = monochromeStart;
                    }

                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> y = <span class="hljs-number">0</span>; y &lt; height; y++) {
                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> x = <span class="hljs-number">0</span>; x &lt; width; x++) {

                            <span class="hljs-keyword">let</span> gray = <span class="hljs-built_in">Math</span>.floor(monochromeStart + (noiseValues[y][x] * monochromeRange));

                            engine.fillStyle = <span class="hljs-string">`rgb(<span class="hljs-subst">${gray}</span>, <span class="hljs-subst">${gray}</span>, <span class="hljs-subst">${gray}</span>)`</span>;

                            engine.fillRect(x, y, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
                        }
                    }
            }
        }
        <span class="hljs-keyword">else</span> <span class="hljs-built_in">this</span>.dirtyOutput = <span class="hljs-literal">true</span>;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <h4 id="noise-generator-functionality">Noise generator functionality</h4>

            </div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Convenience constants
P.F = 0.5 * (Math.sqrt(3) - 1);
P.G = (3 - Math.sqrt(3)) / 6;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.simplexConstantF = <span class="hljs-number">0.5</span> * (<span class="hljs-built_in">Math</span>.sqrt(<span class="hljs-number">3</span>) - <span class="hljs-number">1</span>);
P.simplexConstantG = (<span class="hljs-number">3</span> - <span class="hljs-built_in">Math</span>.sqrt(<span class="hljs-number">3</span>)) / <span class="hljs-number">6</span>;
P.simplexConstantDoubleG = ((<span class="hljs-number">3</span> - <span class="hljs-built_in">Math</span>.sqrt(<span class="hljs-number">3</span>)) / <span class="hljs-number">6</span>) * <span class="hljs-number">2</span>;
P.perlinGrad = [[<span class="hljs-number">1</span>, <span class="hljs-number">1</span>], [-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>], [-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>], [-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>]];</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p><code>noiseEngines</code> - a {key:object} object. Each named object contains two functions:</p>
<ul>
<li><strong>init</strong> - invoked to prepare the engine for a bout of calculations - called by the <code>cleanNoise</code> function</li>
<li><strong>getNoiseValue</strong> - a function called on a per-pixel basis, which calculates the noise value for that pixel</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.noiseEngines = {

    <span class="hljs-string">&#x27;perlin&#x27;</span>: {

        <span class="hljs-attr">init</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

            <span class="hljs-keyword">const</span> {grad, size, rndEngine} = <span class="hljs-built_in">this</span>;

            <span class="hljs-keyword">let</span> dist;
            
            grad.length = <span class="hljs-number">0</span>;

            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; size; i++) {

                grad[i] = [(rndEngine.random() * <span class="hljs-number">2</span>) - <span class="hljs-number">1</span>, (rndEngine.random() * <span class="hljs-number">2</span>) - <span class="hljs-number">1</span>];
                dist = <span class="hljs-built_in">Math</span>.sqrt(grad[i][<span class="hljs-number">0</span>] *  grad[i][<span class="hljs-number">0</span>] + grad[i][<span class="hljs-number">1</span>] * grad[i][<span class="hljs-number">1</span>]);
                grad[i][<span class="hljs-number">0</span>] /= dist;
                grad[i][<span class="hljs-number">1</span>] /= dist;
            }
        },

        <span class="hljs-attr">getNoiseValue</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>{

            <span class="hljs-keyword">const</span> {size, perm, grad, smoothing} = <span class="hljs-built_in">this</span>;

            <span class="hljs-keyword">let</span> a, b, u, v;

            <span class="hljs-keyword">let</span> bx0 = <span class="hljs-built_in">Math</span>.floor(x) % size,
                bx1 = (bx0 + <span class="hljs-number">1</span>) % size;

            <span class="hljs-keyword">let</span> rx0 = x - <span class="hljs-built_in">Math</span>.floor(x),
                rx1 = rx0 - <span class="hljs-number">1</span>;

            <span class="hljs-keyword">let</span> by0 = <span class="hljs-built_in">Math</span>.floor(y) % size,
                by1 = (by0 + <span class="hljs-number">1</span>) % size;

            <span class="hljs-keyword">let</span> ry0 = y - <span class="hljs-built_in">Math</span>.floor(y),
                ry1 = ry0 - <span class="hljs-number">1</span>;

            <span class="hljs-keyword">let</span> i = perm[bx0],
                j = perm[bx1];

            <span class="hljs-keyword">let</span> b00 = perm[i + by0],
                b10 = perm[j + by0],
                b01 = perm[i + by1],
                b11 = perm[j + by1];

            <span class="hljs-keyword">let</span> sx = smoothing(rx0),
                sy = smoothing(ry0);
            
            u = rx0 * grad[b00][<span class="hljs-number">0</span>] + ry0 * grad[b00][<span class="hljs-number">1</span>];
            v = rx1 * grad[b10][<span class="hljs-number">0</span>] + ry0 * grad[b10][<span class="hljs-number">1</span>];
            a = interpolate(sx, u, v);
            
            u = rx0 * grad[b01][<span class="hljs-number">0</span>] + ry1 * grad[b01][<span class="hljs-number">1</span>];
            v = rx1 * grad[b11][<span class="hljs-number">0</span>] + ry1 * grad[b11][<span class="hljs-number">1</span>];
            b = interpolate(sx, u, v);
            
            <span class="hljs-keyword">return</span> <span class="hljs-number">0.5</span> * (<span class="hljs-number">1</span> + interpolate(sy, a, b));
        },
    },

    <span class="hljs-string">&#x27;improved-perlin&#x27;</span>: {

        <span class="hljs-attr">init</span>: λ<span class="hljs-literal">null</span>,

        <span class="hljs-attr">getNoiseValue</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>{

            <span class="hljs-keyword">const</span> {size, perm, permMod8, perlinGrad, smoothing} = <span class="hljs-built_in">this</span>;

            <span class="hljs-keyword">let</span> a, b, u, v;

            <span class="hljs-keyword">let</span> bx0 = <span class="hljs-built_in">Math</span>.floor(x) % size, 
                bx1 = (bx0 + <span class="hljs-number">1</span>) % size;

            <span class="hljs-keyword">let</span> rx0 = x - <span class="hljs-built_in">Math</span>.floor(x), 
                rx1 = rx0 - <span class="hljs-number">1</span>;

            <span class="hljs-keyword">let</span> by0 = <span class="hljs-built_in">Math</span>.floor(y) % size, 
                by1 = (by0 + <span class="hljs-number">1</span>) % size;

            <span class="hljs-keyword">let</span> ry0 = y - <span class="hljs-built_in">Math</span>.floor(y), 
                ry1 = ry0 - <span class="hljs-number">1</span>;

            <span class="hljs-keyword">let</span> i = perm[bx0], 
                j = perm[bx1]; 

            <span class="hljs-keyword">let</span> b00 = permMod8[i + by0], 
                b10 = permMod8[j + by0], 
                b01 = permMod8[i + by1], 
                b11 = permMod8[j + by1];
            
            <span class="hljs-keyword">let</span> sx = smoothing(rx0),
                sy = smoothing(ry0);
            
            u = rx0 * perlinGrad[b00][<span class="hljs-number">0</span>] + ry0 * perlinGrad[b00][<span class="hljs-number">1</span>];
            v = rx1 * perlinGrad[b10][<span class="hljs-number">0</span>] + ry0 * perlinGrad[b10][<span class="hljs-number">1</span>];
            a = interpolate(sx, u, v);
            
            u = rx0 * perlinGrad[b01][<span class="hljs-number">0</span>] + ry1 * perlinGrad[b01][<span class="hljs-number">1</span>];
            v = rx1 * perlinGrad[b11][<span class="hljs-number">0</span>] + ry1 * perlinGrad[b11][<span class="hljs-number">1</span>];
            b = interpolate(sx, u, v);

            <span class="hljs-keyword">return</span> <span class="hljs-number">0.5</span> * (<span class="hljs-number">1</span> + interpolate(sy, a, b));
        }
    },

    <span class="hljs-string">&#x27;simplex&#x27;</span>: {

        <span class="hljs-attr">init</span>: λ<span class="hljs-literal">null</span>,

        <span class="hljs-attr">getNoiseValue</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>{

            <span class="hljs-keyword">const</span> getCornerNoise = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cx, cy, gridPos</span>) </span>{

                <span class="hljs-keyword">let</span> calc = <span class="hljs-number">0.5</span> - (cx * cx) - (cy * cy);
                <span class="hljs-keyword">if</span> (calc &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;

                <span class="hljs-keyword">let</span> [gx, gy] = perlinGrad[gridPos];
                <span class="hljs-keyword">return</span> calc * calc * ((gx * cx) + (gy * cy));
            };
            
            <span class="hljs-keyword">const</span> {simplexConstantF, simplexConstantG, simplexConstantDoubleG, size, perlinGrad, perm, permMod8} = <span class="hljs-built_in">this</span>;
            
            <span class="hljs-keyword">let</span> summedCoordinates = (x + y) * simplexConstantF,
                summedX = <span class="hljs-built_in">Math</span>.floor(x + summedCoordinates),
                summedY = <span class="hljs-built_in">Math</span>.floor(y + summedCoordinates),
                modifiedSummedCoordinates = (summedX + summedY) * simplexConstantG;

            <span class="hljs-keyword">let</span> cornerX = x - (summedX - modifiedSummedCoordinates),
                cornerY = y - (summedY - modifiedSummedCoordinates);
            
            <span class="hljs-keyword">let</span> remainderX = summedX % size,
                remainderY = summedY % size;

            <span class="hljs-keyword">let</span> pos = permMod8[remainderX + perm[remainderY]],
                noise = getCornerNoise(cornerX, cornerY, pos);

            pos = permMod8[remainderX + <span class="hljs-number">1</span> + perm[remainderY + <span class="hljs-number">1</span>]]
            noise += getCornerNoise((cornerX - <span class="hljs-number">1</span> + simplexConstantDoubleG), (cornerY - <span class="hljs-number">1</span> + simplexConstantDoubleG), pos);

            <span class="hljs-keyword">let</span> unitA = <span class="hljs-number">0</span>,
                unitB = <span class="hljs-number">1</span>;

            <span class="hljs-keyword">if</span> (cornerX &gt; cornerY) {
                unitA = <span class="hljs-number">1</span>;
                unitB = <span class="hljs-number">0</span>;
            }

            pos = permMod8[remainderX + unitA + perm[remainderY + unitB]];
            noise += getCornerNoise((cornerX - unitA + simplexConstantG), (cornerY - unitB + simplexConstantG), pos);

            <span class="hljs-keyword">return</span> <span class="hljs-number">0.5</span> + (<span class="hljs-number">35</span> * noise);
        },
    },

    <span class="hljs-string">&#x27;value&#x27;</span>: {

        <span class="hljs-attr">init</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

            <span class="hljs-keyword">const</span> {values, size, rndEngine} = <span class="hljs-built_in">this</span>;

            values.length = <span class="hljs-number">0</span>;

            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; size; i++) {

                values[i] = values[i + size] = rndEngine.random();
            }
        },

        <span class="hljs-attr">getNoiseValue</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>{

            <span class="hljs-keyword">const</span> {values, size, perm, smoothing} = <span class="hljs-built_in">this</span>;

            <span class="hljs-keyword">let</span> x0 = <span class="hljs-built_in">Math</span>.floor(x) % size,
                y0 = <span class="hljs-built_in">Math</span>.floor(y) % size,
                x1 = (x0 + <span class="hljs-number">1</span>) % size,
                y1 = (y0 + <span class="hljs-number">1</span>) % size,
                vx = x - <span class="hljs-built_in">Math</span>.floor(x),
                vy = y - <span class="hljs-built_in">Math</span>.floor(y),
                sx = smoothing(vx),
                sy = smoothing(vy),
                i = perm[x0],
                j = perm[x1],
                p00 = perm[i + y0],
                p10 = perm[j + y0],
                p01 = perm[i + y1],
                p11 = perm[j + y1],
                i1 = interpolate(sx, values[p00], values[p10]),
                i2 = interpolate(sx, values[p01], values[p11]);

            <span class="hljs-keyword">return</span> interpolate(sy, i1, i2);
        },
    },
};</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p><code>generatePermutationTable</code> - internal function called by the <code>cleanNoise</code> function</p>
<ul>
<li>The permutation tables get recalculated each time the noise data gets cleaned</li>
<li><code>rndEngine</code> is a seedable pseudo-random number generator</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.generatePermutationTable = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">const</span> {perm, permMod8, rndEngine, size} = <span class="hljs-built_in">this</span>;

    perm.length = <span class="hljs-number">0</span>;
    permMod8.length = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">let</span> i, j, k;

    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; size; i++) {

        perm[i] = i;
    }
    
    <span class="hljs-keyword">while</span> (--i) {

        j = <span class="hljs-built_in">Math</span>.floor(rndEngine.random() * size);
        k = perm[i];
        perm[i] = perm[j];
        perm[j] = k;
    }
    
    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; size; i++) {

        perm[i + size] = perm[i];
        permMod8[i] = permMod8[i + size] = perm[i] % <span class="hljs-number">8</span>;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p><code>octaveFunctions</code> - a {key:functions} object holding functions used to modify octave loop results</p>
<ul>
<li>calling signature: <code>octaveFunction(octave, scaledX, scaledY, o + 1)</code></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.octaveFunctions = {

    <span class="hljs-attr">none</span>: λfirstArg,
    <span class="hljs-attr">absolute</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">octave</span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.abs((octave * <span class="hljs-number">2</span>) - <span class="hljs-number">1</span>) },
};</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p><code>sumFunctions</code> - a {key:functions} object holding functions used to modify noise values after their calculation has completed (post-processing)</p>
<ul>
<li>calling signature: <code>sumFunction.call(this, clampedVal, x * relativeScale, y * relativeScale)</code></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.sumFunctions = {

    <span class="hljs-attr">none</span>: λfirstArg,

    <span class="hljs-string">&#x27;sine-x&#x27;</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">v, sx, sy</span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-number">0.5</span> + (<span class="hljs-built_in">Math</span>.sin((sx * <span class="hljs-built_in">this</span>.sineFrequencyCoeff) + v) / <span class="hljs-number">2</span>) },
    <span class="hljs-string">&#x27;sine-y&#x27;</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">v, sx, sy</span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-number">0.5</span> + (<span class="hljs-built_in">Math</span>.sin((sy * <span class="hljs-built_in">this</span>.sineFrequencyCoeff) + v) / <span class="hljs-number">2</span>) },
    <span class="hljs-attr">sine</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">v, sx, sy</span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-number">0.5</span> + (<span class="hljs-built_in">Math</span>.sin((sx * <span class="hljs-built_in">this</span>.sineFrequencyCoeff) + v) / <span class="hljs-number">4</span>) + (<span class="hljs-built_in">Math</span>.sin((sy * <span class="hljs-built_in">this</span>.sineFrequencyCoeff) + v) / <span class="hljs-number">4</span>) },

    <span class="hljs-attr">modular</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) </span>{
        <span class="hljs-keyword">let</span> g = v * <span class="hljs-built_in">this</span>.modularAmplitude;
        <span class="hljs-keyword">return</span> g - <span class="hljs-built_in">Math</span>.floor(g);
    },
};</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p><code>smoothingFunctions</code> - a {key:function} object containing various <strong><em>fade functions</em></strong> which can be used to smooth calculated coordinate values so that they will ease towards integral values.</p>
<ul>
<li>Used by the “perlin_classic”, “perlin_improved” and “value” getNoiseValue functions; the “simplex” getNoiseValue function does away with the need for a smoothing operation.</li>
<li>calling signature: <code>smoothing(value)</code></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.smoothingFunctions = {</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p><strong>none</strong> - effectively linear - no smoothing gets performed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    none: λfirstArg,

    easeOutSine,
    easeInSine,
    easeOutInSine,
    easeOutQuad,
    easeInQuad,
    easeOutInQuad,
    easeOutCubic,
    easeInCubic,
    easeOutInCubic,
    easeOutQuart,
    easeInQuart,
    easeOutInQuart,
    easeOutQuint,
    easeInQuint,
    easeOutInQuint,
    easeOutExpo,
    easeInExpo,
    easeOutInExpo,
    easeOutCirc,
    easeInCirc,
    easeOutInCirc,
    easeOutBack,
    easeInBack,
    easeOutInBack,
    easeOutElastic,
    easeInElastic,
    easeOutInElastic,
    easeOutBounce,
    easeInBounce,
    easeOutInBounce,</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p><strong>cosine</strong> - a cosine-based interpolator</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    cosine: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-number">.5</span> * (<span class="hljs-number">1</span> + <span class="hljs-built_in">Math</span>.cos((<span class="hljs-number">1</span> - t) * <span class="hljs-built_in">Math</span>.PI)) },</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p><strong>hermite</strong> - a cubic Hermite interpolator</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    hermite: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{ <span class="hljs-keyword">return</span> t * t * (-t * <span class="hljs-number">2</span> + <span class="hljs-number">3</span>) },</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p><strong>quintic</strong> - the original ease function used by Perlin</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    quintic: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{ <span class="hljs-keyword">return</span> t * t * t * (t * (t * <span class="hljs-number">6</span> - <span class="hljs-number">15</span>) + <span class="hljs-number">10</span>) },
};</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <h4 id="factory">Factory</h4>
<pre><code>scrawl.makeNoise({
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;my-noise-generator&#x27;</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">octaves</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">scale</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">noiseFunction</span>: <span class="hljs-string">&#x27;simplex&#x27;</span>,
});</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> makeNoise = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Noise(items);
};

<span class="hljs-title">constructors</span>.<span class="hljs-title">Noise</span> = <span class="hljs-title">Noise</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <h4 id="exports">Exports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> {
    makeNoise,
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
