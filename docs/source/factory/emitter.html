<!DOCTYPE html>

<html>
<head>
  <title>Emitter factory</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../core/animationloop.html">
                  ./source/core/animationloop.js
                </a>
              
                
                <a class="source" href="../core/component.html">
                  ./source/core/component.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/events.html">
                  ./source/core/events.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/userInteraction.html">
                  ./source/core/userInteraction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="bezier.html">
                  ./source/factory/bezier.js
                </a>
              
                
                <a class="source" href="block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="emitter.html">
                  ./source/factory/emitter.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="fontAttributes.html">
                  ./source/factory/fontAttributes.js
                </a>
              
                
                <a class="source" href="gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="imageAsset.html">
                  ./source/factory/imageAsset.js
                </a>
              
                
                <a class="source" href="line.html">
                  ./source/factory/line.js
                </a>
              
                
                <a class="source" href="loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="net.html">
                  ./source/factory/net.js
                </a>
              
                
                <a class="source" href="oval.html">
                  ./source/factory/oval.js
                </a>
              
                
                <a class="source" href="palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="particle.html">
                  ./source/factory/particle.js
                </a>
              
                
                <a class="source" href="particleForce.html">
                  ./source/factory/particleForce.js
                </a>
              
                
                <a class="source" href="particleHistory.html">
                  ./source/factory/particleHistory.js
                </a>
              
                
                <a class="source" href="particleSpring.html">
                  ./source/factory/particleSpring.js
                </a>
              
                
                <a class="source" href="particleWorld.html">
                  ./source/factory/particleWorld.js
                </a>
              
                
                <a class="source" href="pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="polygon.html">
                  ./source/factory/polygon.js
                </a>
              
                
                <a class="source" href="polyline.html">
                  ./source/factory/polyline.js
                </a>
              
                
                <a class="source" href="quadratic.html">
                  ./source/factory/quadratic.js
                </a>
              
                
                <a class="source" href="quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="radialGradient.html">
                  ./source/factory/radialGradient.js
                </a>
              
                
                <a class="source" href="rectangle.html">
                  ./source/factory/rectangle.js
                </a>
              
                
                <a class="source" href="renderAnimation.html">
                  ./source/factory/renderAnimation.js
                </a>
              
                
                <a class="source" href="shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="spiral.html">
                  ./source/factory/spiral.js
                </a>
              
                
                <a class="source" href="spriteAsset.html">
                  ./source/factory/spriteAsset.js
                </a>
              
                
                <a class="source" href="stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="star.html">
                  ./source/factory/star.js
                </a>
              
                
                <a class="source" href="state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="tetragon.html">
                  ./source/factory/tetragon.js
                </a>
              
                
                <a class="source" href="ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="tracer.html">
                  ./source/factory/tracer.js
                </a>
              
                
                <a class="source" href="tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="unstackedElement.html">
                  ./source/factory/unstackedElement.js
                </a>
              
                
                <a class="source" href="vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="videoAsset.html">
                  ./source/factory/videoAsset.js
                </a>
              
                
                <a class="source" href="wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="../mixin/anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="../mixin/asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="../mixin/assetConsumer.html">
                  ./source/mixin/assetConsumer.js
                </a>
              
                
                <a class="source" href="../mixin/base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="../mixin/cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="../mixin/delta.html">
                  ./source/mixin/delta.js
                </a>
              
                
                <a class="source" href="../mixin/displayShape.html">
                  ./source/mixin/displayShape.js
                </a>
              
                
                <a class="source" href="../mixin/dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="../mixin/entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="../mixin/filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="../mixin/mimic.html">
                  ./source/mixin/mimic.js
                </a>
              
                
                <a class="source" href="../mixin/path.html">
                  ./source/mixin/path.js
                </a>
              
                
                <a class="source" href="../mixin/pattern.html">
                  ./source/mixin/pattern.js
                </a>
              
                
                <a class="source" href="../mixin/pivot.html">
                  ./source/mixin/pivot.js
                </a>
              
                
                <a class="source" href="../mixin/position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="../mixin/shapeBasic.html">
                  ./source/mixin/shapeBasic.js
                </a>
              
                
                <a class="source" href="../mixin/shapeCurve.html">
                  ./source/mixin/shapeCurve.js
                </a>
              
                
                <a class="source" href="../mixin/shapePathCalculation.html">
                  ./source/mixin/shapePathCalculation.js
                </a>
              
                
                <a class="source" href="../mixin/styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="../mixin/tween.html">
                  ./source/mixin/tween.js
                </a>
              
                
                <a class="source" href="../worker/filter-stringed.html">
                  ./source/worker/filter-stringed.js
                </a>
              
                
                <a class="source" href="../worker/filter.html">
                  ./source/worker/filter.js
                </a>
              
                
                <a class="source" href="../worker/filter_canvas.html">
                  ./source/worker/filter_canvas.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="emitter-factory">Emitter factory</h1>
<p>The Scrawl-canvas particle physics engine is a simple system designed to allow developers a way to add particle-based effects to their canvas animation scenes. The physics engine is built on top of the following components:</p>
<ul>
<li><a href="./particle.html">Particle objects</a>, which represent a 3-dimensional coordinate - based on a Scrawl-canvas <a href="./vector.html">Vector object</a> - and include a history of recent positions which we can use to determine how to display that particle on screen.</li>
<li><a href="./particleHistory.html">History arrays</a> which can be pooled (reused) to cut down on Array creation and distruction during the animation.</li>
<li><a href="./particleForce.html">Force objects</a> which define the general and occasional forces to be applied to each particle in the system as the animation progresses - a <strong>gravity</strong> force object is pre-defined by Scrawl-canvas.</li>
<li><a href="./particleSpring.html">Spring objects</a> used to define a constraint (connection) between two particles in a system.</li>
<li><a href="./particleWorld.html">World objects</a> where we can store attributes and values used by various objects; these attributes can be set up so that they will be inherited by clones of the World object. We can also influence the speed of the physics animation here.</li>
</ul>
<p>We do not have to handle particle generation and manipulation ourselves. Instead, Scrawl-canvas gives us three dedicated <strong>entitys</strong> which we use to add particle animation effects to the canvas scene. These entitys are:</p>
<ul>
<li><a href="./tracer.html">Tracer</a> - this entity generates a single non-recycled (in other words: long lasting) particle with a history, which we can use to display trace effects in the animation.</li>
<li><a href="./emitter.html">Emitter</a> - an entity which generates a stream of short-lived, recycled particles, each with its own history. Emitters are highly versatile entitys which can generate a wide range of effects.</li>
<li><a href="./net.html">Net</a> - a (generally) larger entity which uses both forces and springs to manage the animation of its non-recycled particles. Note that other artefacts can use Net particles as a reference for their own positioning.</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h4 id="demos">Demos:</h4>
<ul>
<li><a href="../../demo/particles-001.html">particles-001</a> - Emitter entity, and Particle World, basic functionality</li>
<li><a href="../../demo/particles-002.html">particles-002</a> - Emitter using artefacts</li>
<li><a href="../../demo/particles-003.html">particles-003</a> - Position Emitter entity: start; pivot; mimic; path; mouse; drag-and-drop</li>
<li><a href="../../demo/particles-004.html">particles-004</a> - Emit particles along the length of a path</li>
<li><a href="../../demo/particles-005.html">particles-005</a> - Emit particles from inside an artefact’s area</li>
<li><a href="../../demo/particles-006.html">particles-006</a> - Fixed number of Particles in a field; preAction and postAction functionality</li>
<li><a href="../../demo/particles-007.html">particles-007</a> - Particle Force objects: generation and functionality</li>
<li><a href="../../demo/particles-012.html">particles-012</a> - Use Net entity particles as reference coordinates for other artefacts</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h4 id="imports">Imports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { <span class="hljs-title">constructors</span>, <span class="hljs-title">tween</span>, <span class="hljs-title">artefact</span>, <span class="hljs-title">group</span>, <span class="hljs-title">world</span> } <span class="hljs-title">from</span> &#x27;../<span class="hljs-title">core</span>/<span class="hljs-title">library</span>.<span class="hljs-title">js</span>&#x27;;
<span class="hljs-keyword">import</span> { pushUnique, mergeOver, λ<span class="hljs-literal">null</span>, isa_fn, isa_obj, xt, xta } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/utilities.js&#x27;</span>;
<span class="hljs-keyword">import</span> { currentGroup } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/document.js&#x27;</span>;

<span class="hljs-keyword">import</span> { requestParticle, releaseParticle } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./particle.js&#x27;</span>;
<span class="hljs-keyword">import</span> { requestCell, releaseCell } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./cell.js&#x27;</span>;
<span class="hljs-keyword">import</span> { makeVector, requestVector, releaseVector } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./vector.js&#x27;</span>;
<span class="hljs-keyword">import</span> { requestCoordinate, releaseCoordinate } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./coordinate.js&#x27;</span>;
<span class="hljs-keyword">import</span> { makeColor } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./color.js&#x27;</span>;

<span class="hljs-keyword">import</span> baseMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/base.js&#x27;</span>;
<span class="hljs-keyword">import</span> entityMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/entity.js&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h4 id="emitter-constructor">Emitter constructor</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Emitter = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-built_in">this</span>.makeName(items.name);
    <span class="hljs-built_in">this</span>.register();
    <span class="hljs-built_in">this</span>.initializePositions();
    <span class="hljs-built_in">this</span>.set(<span class="hljs-built_in">this</span>.defs);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>The entity has a hit zone which can be used for drag-and-drop, and other user interactions. Thus the <code>onXYZ</code> UI functions remain relevant.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">this</span>.onEnter = λ<span class="hljs-literal">null</span>;
    <span class="hljs-built_in">this</span>.onLeave = λ<span class="hljs-literal">null</span>;
    <span class="hljs-built_in">this</span>.onDown = λ<span class="hljs-literal">null</span>;
    <span class="hljs-built_in">this</span>.onUp = λ<span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Each instantiated entity will include two color factories - one for creating random fillStyle color Strings for generated particles, the other for generating strokeStyle colors.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">this</span>.fillColorFactory = makeColor({ <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">this</span>.name}</span>-fillColorFactory`</span>});
    <span class="hljs-built_in">this</span>.strokeColorFactory = makeColor({ <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">this</span>.name}</span>-strokeColorFactory`</span>});</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>The <code>range</code> attributes use Vector objects in which to hold their data.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">this</span>.range = makeVector();
    <span class="hljs-built_in">this</span>.rangeFrom = makeVector();</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>As part of its <code>stamp</code> functionality the Emitter entity will invoke three user-defined <code>xyzAction</code> functions. If none of these functions are supplied to the entity, then it will not display anything on the canvas.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">this</span>.preAction = λ<span class="hljs-literal">null</span>;
    <span class="hljs-built_in">this</span>.stampAction = λ<span class="hljs-literal">null</span>;
    <span class="hljs-built_in">this</span>.postAction = λ<span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Setup the particle store, including the arrays used for winnowing out and killing dead particles</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">this</span>.particleStore = [];
    <span class="hljs-built_in">this</span>.deadParticles = [];
    <span class="hljs-built_in">this</span>.liveParticles = [];

    <span class="hljs-keyword">if</span> (!items.group) items.group = currentGroup;

    <span class="hljs-built_in">this</span>.set(items);

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.purge) <span class="hljs-built_in">this</span>.purgeArtefact(<span class="hljs-built_in">this</span>.purge);

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h4 id="emitter-prototype">Emitter prototype</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> P = Emitter.prototype = <span class="hljs-built_in">Object</span>.create(<span class="hljs-built_in">Object</span>.prototype);

P.type = <span class="hljs-string">&#x27;Emitter&#x27;</span>;
P.lib = <span class="hljs-string">&#x27;entity&#x27;</span>;
P.isArtefact = <span class="hljs-literal">true</span>;
P.isAsset = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h4 id="mixins">Mixins</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P = baseMix(P);
P = entityMix(P);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h4 id="emitter-attributes">Emitter attributes</h4>
<ul>
<li>Attributes defined in the <a href="../mixin/base.html">base mixin</a>: <strong>name</strong>.</li>
<li>Attributes defined in the <a href="../mixin/position.html">position mixin</a>: <strong>group, visibility, order, start, <em>startX</em>, <em>startY</em>, handle, <em>handleX</em>, <em>handleY</em>, offset, <em>offsetX</em>, <em>offsetY</em>, dimensions, <em>width</em>, <em>height</em>, pivoted, mimicked, lockTo, <em>lockXTo</em>, <em>lockYTo</em>, scale, roll, noUserInteraction, noPositionDependencies, noCanvasEngineUpdates, noFilters, noPathUpdates, purge, bringToFrontOnDrag</strong>.</li>
<li>Attributes defined in the <a href="../mixin/delta.html">delta mixin</a>: <strong>delta, noDeltaUpdates</strong>.</li>
<li>Attributes defined in the <a href="../mixin/pivot.html">pivot mixin</a>: <strong>pivot, pivotCorner, addPivotHandle, addPivotOffset, addPivotRotation</strong>.</li>
<li>Attributes defined in the <a href="../mixin/mimic.html">mimic mixin</a>: <strong>mimic, useMimicDimensions, useMimicScale, useMimicStart, useMimicHandle, useMimicOffset, useMimicRotation, useMimicFlip, addOwnDimensionsToMimic, addOwnScaleToMimic, addOwnStartToMimic, addOwnHandleToMimic, addOwnOffsetToMimic, addOwnRotationToMimic</strong>.</li>
<li>Attributes defined in the <a href="../mixin/path.html">path mixin</a>: <strong>path, pathPosition, addPathHandle, addPathOffset, addPathRotation, constantPathSpeed</strong>.</li>
<li>Attributes defined in the <a href="../mixin/entity.html">entity mixin</a>: <strong>method, pathObject, winding, flipReverse, flipUpend, scaleOutline, lockFillStyleToEntity, lockStrokeStyleToEntity, onEnter, onLeave, onDown, onUp, <em>fillStyle, strokeStyle, globalAlpha, globalCompositeOperation, lineWidth, lineCap, lineJoin, lineDash, lineDashOffset, miterLimit, shadowOffsetX, shadowOffsetY, shadowBlur, shadowColor, filter</em></strong>.</li>
<li>Attributes defined in the <a href="../mixin/anchor.html">anchor mixin</a>: <strong>anchor</strong>.</li>
<li>Attributes defined in the <a href="../mixin/filter.html">filter mixin</a>: <strong>filters, isStencil</strong>.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> defaultAttributes = {</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><strong>world</strong> - World object; can be set using the String name of a World object, or the World object itself.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    world: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p><strong>artefact</strong> - In theory, any Scrawl-canvas object whose <code>isArtefact</code> flag is set to <code>true</code> can be assigned to this attribute. However this has not been tested on non-entity artefacts. For now, stick to Scrawl-canvas entity objects.</p>
<ul>
<li>Can be set using the String name of an artefact object, or the artefact object itself.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    artefact: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p><strong>range</strong> and <strong>rangeFrom</strong> - Vector objects with some convenience pseudo-attributes to make setting them a bit easier: <em>rangeX, rangeY, rangeZ, rangeFromX, rangeFromY, rangeFromZ</em>.</p>
<ul>
<li>These attributes set each generated particle’sinitial velocity; their values represent the distance travelled in the x, y and z directions, as measured in pixels-per-second.</li>
<li>The <code>rangeFrom</code> attributes (float Numbers that can be negative) the lowest value in that dimension that will be generated. This value is <strong><em>local to the particle</em></strong> thus negative values are to the left (x) or above (y) or behind (z) the particle’s initial position.</li>
<li>The <code>range</code> attributes (again, float Numbers that can be negative) are the <strong><em>maximum (or least maximum) random value</em></strong> which will be added to the rangeFrom value. </li>
<li>All particles are assigned a (constrained) random velocity in this manner when they are generated.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    range: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">rangeFrom</span>: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p><strong>generationRate</strong> - positive integer Number - Emitter entitys use <strong><em>ephemeral particles</em></strong> to produce their visual effects, generating a steady stream of particles over time and then killing them off in various ways. Attribute <em>sets the maximum number of particles that the Emitter will generate every second</em>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    generationRate: <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p><strong>particleCount</strong> - positive integer Number - attribute <em>sets the maximum number of particles that the Emitter will manage and display at any one time</em>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    particleCount: <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p><strong>generateAlongPath</strong>, <strong>generateInArea</strong> - Object-based flags (default: <code>false</code>) - to set the flags, assign an entity object to them</p>
<ul>
<li>the default action is for the Emitter to generate its particles from a single coordinate which can be determined from the Emitter’s <code>lockTo</code> attribute - thus the coordinate can be the absolute/relative start coordinates, or a path/pivot/mimic reference entity, or a Net particle, or the mouse cursor.</li>
<li>If we set the <code>generateAlongPath</code> attribute to a path-based entity then the Emitter will use that path to set the initial coordinate for all its generated particles</li>
<li>If we set the <code>generateInArea</code> attribute to any entity then the Emitter will use that entity’s area to set the initial coordinate for all its generated particles</li>
<li><code>generateInArea</code> takes precedence over <code>generateAlongPath</code>, which in turn takes precedence over the default coordinate behaviour</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    generateAlongPath: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">generateInArea</span>: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p><strong>generationChoke</strong> - Number measuring milliseconds (default: 15) - because both <code>generateAlongPath</code> and <code>generateInArea</code> functionalities use a <code>while</code> loop, we need a way to break out of those loops should they fail to generate an acceptable coordinate within a given amount of time. This attribute sets the maximum time the entity will spend on generating semi-random coordinates during any one Display cycle loop.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    generationChoke: <span class="hljs-number">15</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Emitter entitys will continuously generate new particles (up to the limit set in the <code>particleCount</code> attribute). The <code>killAfterTime</code>, <code>killRadius</code> and <code>killBeyondCanvas</code> attributes set out the circumstances in which existing particles will be removed from the entity’s <code>particleStore</code> attribute</p>
<ul>
<li><strong>killAfterTime</strong> - a positive float Number - sets the maximum time (measured in <strong><em>seconds</em></strong>) that a particle will live before it is killed and removed. This time is set on particle generation and is not updatable. We can add some randomness to the time through the <strong>killAfterTimeVariation</strong> attribute.</li>
<li><strong>killRadius</strong> - a positive float Number - sets the maximum distance (measurted in pixels) from its initial position that a particle can move. If it moves beyond that distance, it will be killed. Again, some variation can be introduced through the <strong>killRadiusVariation</strong> attribute.</li>
<li><strong>killBeyondCanvas</strong> - a Boolean flag (default: <code>false</code>) - when set, any particle that moves beyond its host Cell’s canvas dimensions will be killed and removed.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    killAfterTime: <span class="hljs-number">0</span>,
    <span class="hljs-attr">killAfterTimeVariation</span>: <span class="hljs-number">0</span>,

    <span class="hljs-attr">killRadius</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">killRadiusVariation</span>: <span class="hljs-number">0</span>,

    <span class="hljs-attr">killBeyondCanvas</span>: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p><strong>historyLength</strong> - positive integer Number - every Particle will keep a record of its recent state, in a set of ParticleHistory arrays stored in the Particle’s <code>history</code> Array. The Emitter entity will set the maximum permitted length of the history array whenever it generates a new Particle. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    historyLength: <span class="hljs-number">1</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Emitter entitys will, as part of the Display cycle, apply any force objects assigned to a Particle. The initial forces assigned to every new Particle will be in line with the Force objects included in the Emitter’s <strong>forces</strong> Array.</p>
<ul>
<li>To set the Array, supply a new Array containing Force objects, and/or the name Strings of those Force objects, to the <code>forces</code> attribute.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    forces: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p><strong>mass</strong>, <strong>massVariation</strong> - positive float Number - the initial mass assigned to each Particle when it is generated.</p>
<ul>
<li>The <code>mass</code> attribute is used by the pre-defined <strong><em>gravity Force</em></strong></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    mass: <span class="hljs-number">1</span>,
    <span class="hljs-attr">massVariation</span>: <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Physics calculations are handled by the Emitter entity’s physics <strong>engine</strong> which must be a String value of either <code>euler</code> (the default engine), <code>improved-euler</code> or <code>runge-kutta</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    engine: <span class="hljs-string">&#x27;euler&#x27;</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Note that the <strong>hitRadius</strong> attribute is tied directly to the <strong>width</strong> and <strong>height</strong> attributes (which are effectively meaningless for this entity)</p>
<ul>
<li>This attribute is absolute - unlike other Scrawl-canvas radius attributes it cannot be set using a percentage String value</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    hitRadius: <span class="hljs-number">10</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>We can tell the entity to display its hit zone by setting the <code>showHitRadius</code> flag. The hit zone outline color attribute <code>hitRadiusColor</code> accepts any valid CSS color String value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    showHitRadius: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">hitRadiusColor</span>: <span class="hljs-string">&#x27;#000000&#x27;</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p><strong>resetAfterBlur</strong> - positive float Number (measuring seconds) - physics simulations can be brittle, particularly if they are forced to calculate Particle loads (accelerations), velocities and speeds over a large time step. Rather than manage that time step in cases where the user may neglect or navigate away from the browser tab containing the physics animation, Scrawl-canvas will stop, clear, and recreate the scene if the time it takes the user to return to (re-focus on) the web page is greater than the value set in this attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    resetAfterBlur: <span class="hljs-number">3</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <h5 id="not-defined-in-the-defs-object-but-set-up-in-the-constructor-and-setters">Not defined in the defs object, but set up in the constructor and setters</h5>

            </div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p><strong>particleStore</strong> - an Array where all the Emitter’s current particles will be stored. To render the entity, we need to iterate through these particles and use them to repeatedly stamp the Emitter’s artefact - or perform equivalent &lt;canvas&gt; context engine instructions - onto the host Cell. These actions will be defined in the <code>stampAction</code> function.</p>

            </div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>The user-defined stamp functions <strong>preAction</strong>, <strong>stampAction</strong> and <strong>postAction</strong> are invoked in turn one each tick of the Display cycle. By default these functions do nothing, meaning nothing gets drawn to the canvas</p>
<ul>
<li><code>preAction</code> and <code>postAction</code> - these functions receive a single argument, a Cell wrapper on which we can draw additional graphics (if needed) - see Demo <a href="../../demo/particles-006.html">Particles 006</a> for a working example</li>
<li><code>stampAction</code> - define all major rendering actions in this function. The function receives the following arguments: <code>(artefact, particle, host)</code> - where <code>artefact</code> is the Emitter entity’s artefact object (if any has been defined/set); <code>particle</code> is the current Particle object whose history needs to be rendered onto the canvas; and <code>host</code> is the Cell wrapper on which we will draw our graphics</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p><strong>fillColorFactory</strong> and <strong>strokeColorFactory</strong> - Color objects - there will never be a need to define these attributes as this is done as part of the factory’s object build functionality. Used to generate fill and stroke colors for each newly generated particle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
};
P.defs = mergeOver(P.defs, defaultAttributes);</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <h4 id="packet-management">Packet management</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.packetExclusions = pushUnique(P.packetExclusions, [<span class="hljs-string">&#x27;forces&#x27;</span>, <span class="hljs-string">&#x27;particleStore&#x27;</span>, <span class="hljs-string">&#x27;deadParticles&#x27;</span>, <span class="hljs-string">&#x27;liveParticles&#x27;</span>, <span class="hljs-string">&#x27;fillColorFactory&#x27;</span>, <span class="hljs-string">&#x27;strokeColorFactory&#x27;</span>]);
P.packetExclusionsByRegex = pushUnique(P.packetExclusionsByRegex, []);
P.packetCoordinates = pushUnique(P.packetCoordinates, []);
P.packetObjects = pushUnique(P.packetObjects, [<span class="hljs-string">&#x27;world&#x27;</span>, <span class="hljs-string">&#x27;artefact&#x27;</span>, <span class="hljs-string">&#x27;generateInArea&#x27;</span>, <span class="hljs-string">&#x27;generateAlongPath&#x27;</span>]);
P.packetFunctions = pushUnique(P.packetFunctions, [<span class="hljs-string">&#x27;preAction&#x27;</span>, <span class="hljs-string">&#x27;stampAction&#x27;</span>, <span class="hljs-string">&#x27;postAction&#x27;</span>]);

P.finalizePacketOut = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">copy, items</span>) </span>{

    <span class="hljs-keyword">let</span> forces = items.forces || <span class="hljs-built_in">this</span>.forces || <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span> (forces) {

        <span class="hljs-keyword">let</span> tempForces = [];
        forces.forEach(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> {

            <span class="hljs-keyword">if</span> (f.substring) tempForces.push(f);
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isa_obj(f) &amp;&amp; f.name) tempForces.push(f.name);
        });
        copy.forces = tempForces;
    }

    <span class="hljs-keyword">let</span> tempParticles = [];
    <span class="hljs-built_in">this</span>.particleStore.forEach(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> tempParticles.push(p.saveAsPacket()));
    copy.particleStore = tempParticles;

    <span class="hljs-keyword">return</span> copy;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <h4 id="clone-management">Clone management</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.postCloneAction = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">clone, items</span>) </span>{

    <span class="hljs-keyword">return</span> clone;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <h4 id="kill-management">Kill management</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.factoryKill = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">killArtefact, killWorld</span>) </span>{

    <span class="hljs-built_in">this</span>.isRunning = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (killArtefact) <span class="hljs-built_in">this</span>.artefact.kill();

    <span class="hljs-keyword">if</span> (killWorld) <span class="hljs-built_in">this</span>.world.kill();

    <span class="hljs-built_in">this</span>.fillColorFactory.kill();
    <span class="hljs-built_in">this</span>.strokeColorFactory.kill();
    
    <span class="hljs-built_in">this</span>.deadParticles.forEach(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.kill());
    <span class="hljs-built_in">this</span>.liveParticles.forEach(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.kill());
    <span class="hljs-built_in">this</span>.particleStore.forEach(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.kill());
};</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <h4 id="get-set-deltaset">Get, Set, deltaSet</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> G = P.getters,
    S = P.setters,
    D = P.deltaSetters;

S.rangeX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{ <span class="hljs-built_in">this</span>.range.x = val; };
S.rangeY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{ <span class="hljs-built_in">this</span>.range.y = val; };
S.rangeZ = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{ <span class="hljs-built_in">this</span>.range.z = val; };
S.range = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{ <span class="hljs-built_in">this</span>.range.set(item); };

S.rangeFromX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{ <span class="hljs-built_in">this</span>.rangeFrom.x = val; };
S.rangeFromY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{ <span class="hljs-built_in">this</span>.rangeFrom.y = val; };
S.rangeFromZ = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{ <span class="hljs-built_in">this</span>.rangeFrom.z = val; };
S.rangeFrom = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{ <span class="hljs-built_in">this</span>.rangeFrom.set(item); };

S.preAction = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (isa_fn(item)) <span class="hljs-built_in">this</span>.preAction = item;
};
S.stampAction = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (isa_fn(item)) <span class="hljs-built_in">this</span>.stampAction = item;
};
S.postAction = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (isa_fn(item)) <span class="hljs-built_in">this</span>.postAction = item;
};


S.world = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">let</span> w;

    <span class="hljs-keyword">if</span> (item.substring) w = world[item];
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isa_obj(item) &amp;&amp; item.type === <span class="hljs-string">&#x27;World&#x27;</span>) w = item;

    <span class="hljs-keyword">if</span> (w) <span class="hljs-built_in">this</span>.world = w;
};

S.artefact = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">let</span> art;

    <span class="hljs-keyword">if</span> (item.substring) art = artefact[item];
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isa_obj(item) &amp;&amp; item.isArtefact) art = item;

    <span class="hljs-keyword">if</span> (art) <span class="hljs-built_in">this</span>.artefact = art;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>To generate along a path, or in an area, we set the <code>generateAlongPath</code> or <code>generateInArea</code> attributes to the (path-based) artefact we shall be using for the template. This can be the artefact’s String name, or the artefact object itself</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.generateAlongPath = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">let</span> art;

    <span class="hljs-keyword">if</span> (item.substring) art = artefact[item];
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isa_obj(item) &amp;&amp; item.isArtefact) art = item;

    <span class="hljs-keyword">if</span> (art &amp;&amp; art.useAsPath) <span class="hljs-built_in">this</span>.generateAlongPath = art;
    <span class="hljs-keyword">else</span> <span class="hljs-built_in">this</span>.generateAlongPath = <span class="hljs-literal">false</span>;
};

S.generateInArea = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">let</span> art;

    <span class="hljs-keyword">if</span> (item.substring) art = artefact[item];
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isa_obj(item) &amp;&amp; item.isArtefact) art = item;

    <span class="hljs-keyword">if</span> (art) <span class="hljs-built_in">this</span>.generateInArea = art;
    <span class="hljs-keyword">else</span> <span class="hljs-built_in">this</span>.generateInArea = <span class="hljs-literal">false</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Color management - we can set these attributes (<code>fillColor fillMinimumColor fillMaximumColor, strokeColor strokeMinimumColor strokeMaximumColor</code>) on the Emitter object - the setter functions pass the color value onto the appropriate color factory for processing and update</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.fillColor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.fillColorFactory.set({<span class="hljs-attr">color</span>: item});
};
S.fillMinimumColor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.fillColorFactory.set({<span class="hljs-attr">minimumColor</span>: item});
};
S.fillMaximumColor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.fillColorFactory.set({<span class="hljs-attr">maximumColor</span>: item});
};

S.strokeColor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.strokeColorFactory.set({<span class="hljs-attr">color</span>: item});
};
S.strokeMinimumColor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.strokeColorFactory.set({<span class="hljs-attr">minimumColor</span>: item});
};
S.strokeMaximumColor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.strokeColorFactory.set({<span class="hljs-attr">maximumColor</span>: item});
};

S.hitRadius = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item.toFixed) {

        <span class="hljs-built_in">this</span>.hitRadius = item;
        <span class="hljs-built_in">this</span>.width = <span class="hljs-built_in">this</span>.height = item * <span class="hljs-number">2</span>;
    }
};
D.hitRadius = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item.toFixed) {

        <span class="hljs-built_in">this</span>.hitRadius += item;
        <span class="hljs-built_in">this</span>.width = <span class="hljs-built_in">this</span>.height = <span class="hljs-built_in">this</span>.hitRadius * <span class="hljs-number">2</span>;
    }
};
S.width = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item.toFixed) {

        <span class="hljs-built_in">this</span>.hitRadius = item / <span class="hljs-number">2</span>;
        <span class="hljs-built_in">this</span>.width = <span class="hljs-built_in">this</span>.height = item;
    }
};
D.width = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (item.toFixed) {

        <span class="hljs-built_in">this</span>.hitRadius = item / <span class="hljs-number">2</span>;
        <span class="hljs-built_in">this</span>.width = <span class="hljs-built_in">this</span>.height = item;
    }
};
S.height = S.width;
D.height = D.width;</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <h4 id="prototype-functions">Prototype functions</h4>

            </div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p><code>prepareStamp</code> - internal - overwrites the entity mixin function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.prepareStamp = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyHost) {

        <span class="hljs-built_in">this</span>.dirtyHost = <span class="hljs-literal">false</span>;
        <span class="hljs-built_in">this</span>.dirtyDimensions = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyScale || <span class="hljs-built_in">this</span>.dirtyDimensions || <span class="hljs-built_in">this</span>.dirtyStart || <span class="hljs-built_in">this</span>.dirtyOffset || <span class="hljs-built_in">this</span>.dirtyHandle) <span class="hljs-built_in">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyScale) <span class="hljs-built_in">this</span>.cleanScale();

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyDimensions) <span class="hljs-built_in">this</span>.cleanDimensions();

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyLock) <span class="hljs-built_in">this</span>.cleanLock();

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyStart) <span class="hljs-built_in">this</span>.cleanStart();

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyOffset) <span class="hljs-built_in">this</span>.cleanOffset();

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyHandle) <span class="hljs-built_in">this</span>.cleanHandle();

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyRotation) <span class="hljs-built_in">this</span>.cleanRotation();

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.lockTo.indexOf(<span class="hljs-string">&#x27;mouse&#x27;</span>) &gt;= <span class="hljs-number">0</span> || <span class="hljs-built_in">this</span>.lockTo.indexOf(<span class="hljs-string">&#x27;particle&#x27;</span>) &gt;= <span class="hljs-number">0</span>) {

        <span class="hljs-built_in">this</span>.dirtyStampPositions = <span class="hljs-literal">true</span>;
        <span class="hljs-built_in">this</span>.dirtyStampHandlePositions = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyStampPositions) <span class="hljs-built_in">this</span>.cleanStampPositions();
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyStampHandlePositions) <span class="hljs-built_in">this</span>.cleanStampHandlePositions();</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Functionality specific to Emitter entitys</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> now = <span class="hljs-built_in">Date</span>.now();

    <span class="hljs-keyword">let</span> {particleStore, deadParticles, liveParticles, particleCount, generationRate, generatorChoke, resetAfterBlur} = <span class="hljs-built_in">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Create thew generator choke, if necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!generatorChoke) {

        <span class="hljs-built_in">this</span>.generatorChoke = generatorChoke = now;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Check through particles, removing all particles that have completed their lives</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    particleStore.forEach(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> {

        <span class="hljs-keyword">if</span> (p.isRunning) liveParticles.push(p);
        <span class="hljs-keyword">else</span> deadParticles.push(p);
    });
    particleStore.length = <span class="hljs-number">0</span>;

    deadParticles.forEach(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> releaseParticle(d));
    deadParticles.length = <span class="hljs-number">0</span>;

    particleStore.push(...liveParticles);
    liveParticles.length = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Determine how many new particles need to be generated</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> elapsed = now - generatorChoke;</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Need to prevent generation of new particles if the elapsed time is due to the user focussing on another tab in the browser before returning to the tab running this Scrawl-canvas animation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ((elapsed / <span class="hljs-number">1000</span>) &gt; resetAfterBlur) {

        elapsed = <span class="hljs-number">0</span>;
        <span class="hljs-built_in">this</span>.generatorChoke = now;
    }

    <span class="hljs-keyword">if</span> (elapsed &gt; <span class="hljs-number">0</span> &amp;&amp; generationRate) {

        <span class="hljs-keyword">let</span> canGenerate = <span class="hljs-built_in">Math</span>.floor((generationRate / <span class="hljs-number">1000</span>) * elapsed);

        <span class="hljs-keyword">if</span> (particleCount) {

            <span class="hljs-keyword">let</span> reqParticles = particleCount - particleStore.length;
            
            <span class="hljs-keyword">if</span> (reqParticles &lt;= <span class="hljs-number">0</span>) canGenerate = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (reqParticles &lt; canGenerate) canGenerate = reqParticles;
        }

        <span class="hljs-keyword">if</span> (canGenerate) {

            <span class="hljs-built_in">this</span>.addParticles(canGenerate);</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>We only update the choke value after particles have been generated</p>
<ul>
<li>Ensures that if we only want 2 particles a second, our requirement will be respected</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-built_in">this</span>.generatorChoke = now;
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p><code>addParticles</code> - internal function called by <code>prepareStamp</code> … if you are not a fan of overly-complex functions, look away now.</p>
<p>We can add particles to an emitter in a number of different ways, determined by the setting of two flag attributes on the emitter. The flags are actioned in the following order:</p>
<ul>
<li><strong>generateInArea</strong> - when this flag attribute is set to an artefact object, the emitter will use that artefact’s outline to decide where new particles will be added to the scene</li>
<li><strong>generateAlongPath</strong> - similarly, when this flag attribute is set to a shape-based entity (with its <code>useAsPath</code> attribute flag set to true), the emitter will use the path to dettermine wshere the new particle will be added.</li>
</ul>
<p>If neither of the above flags has been set, then the emitter will add particles from a single coordinate. This coordinate will be calculated according to the values set In the <code>lockTo</code> attribute (which can also be set using the <code>lockXTo</code> and <code>lockYTo</code> pseudo-attributes):</p>
<ul>
<li><strong><em>start</em></strong> - use the emitter entity’s start/handle/offset coordinates - which can be absolute px Number or relative % String values</li>
<li><strong><em>pivot</em></strong> - use a pivot entity to calculate the emitter’s reference coordinate</li>
<li><strong><em>mimic</em></strong> - use a mimic entity to calculate the emitter’s reference coordinate</li>
<li><strong><em>path</em></strong> - use a Shape-based entity’s path to determine the emitter’s reference coordinate</li>
<li><strong><em>mouse</em></strong> - use the mouse/touch/pointer cursor value as the emitter’s coordinate</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.addParticles = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req</span>) </span>{

    <span class="hljs-keyword">const</span> rnd = <span class="hljs-built_in">Math</span>.random;</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>internal helper functions, used when creating the particle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> calc = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item, itemVar</span>) </span>{
        <span class="hljs-keyword">return</span> item + ((rnd() * itemVar * <span class="hljs-number">2</span>) - itemVar);
    };

    <span class="hljs-keyword">const</span> velocityCalc = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item, itemVar</span>) </span>{
        <span class="hljs-keyword">return</span> item + (rnd() * itemVar);
    };

    <span class="hljs-keyword">let</span> i, p, cx, cy, 
        timeChoke = <span class="hljs-built_in">Date</span>.now();</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>The emitter object retains details of the initial values required for eachg particle it generates</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> {historyLength, engine, forces, mass, massVariation, fillColorFactory, strokeColorFactory, range, rangeFrom, currentStampPosition, particleStore, killAfterTime, killAfterTimeVariation, killRadius, killRadiusVariation, killBeyondCanvas, currentRotation, generateAlongPath, generateInArea, generationChoke} = <span class="hljs-built_in">this</span>;

    <span class="hljs-keyword">let</span> {x, y, z} = range;
    <span class="hljs-keyword">let</span> {<span class="hljs-attr">x</span>:fx, <span class="hljs-attr">y</span>:fy, <span class="hljs-attr">z</span>:fz} = rangeFrom;</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Use an artefact’s current area location to determine where the particle will be generated</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (generateInArea) {

        <span class="hljs-keyword">let</span> host = <span class="hljs-built_in">this</span>.currentHost;

        <span class="hljs-keyword">if</span> (host) {

            <span class="hljs-keyword">const</span> hostCanvas = host.element;

            <span class="hljs-keyword">const</span> {width, height} = hostCanvas;

            <span class="hljs-keyword">if</span> (!generateInArea.pathObject || generateInArea.dirtyPathObject) generateInArea.cleanPathObject();

            <span class="hljs-keyword">const</span> testCell = requestCell(),
                testEngine = testCell.engine,
                coord = requestCoordinate();

            <span class="hljs-keyword">let</span> {pathObject, winding, currentStart} = generateInArea;

            [cx, cy] = currentStart;

            <span class="hljs-keyword">const</span> test = <span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> testEngine.isPointInPath(pathObject, ...item, winding);

            testCell.rotateDestination(testEngine, cx, cy, generateInArea);
            
            GenerateInAreaLoops:    
            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; req; i++) {

                <span class="hljs-keyword">let</span> coordFlag = <span class="hljs-literal">false</span>;

                <span class="hljs-keyword">while</span> (!coordFlag) {

                    <span class="hljs-keyword">if</span> (timeChoke + generationChoke &lt; <span class="hljs-built_in">Date</span>.now()) <span class="hljs-keyword">break</span> GenerateInAreaLoops;

                    coord.set(rnd() * width, rnd() * height);

                    <span class="hljs-keyword">if</span> (test(coord)) coordFlag = <span class="hljs-literal">true</span>;
                }

                p = requestParticle();

                p.set({
                    <span class="hljs-attr">positionX</span>: coord[<span class="hljs-number">0</span>],
                    <span class="hljs-attr">positionY</span>: coord[<span class="hljs-number">1</span>],
                    <span class="hljs-attr">positionZ</span>: <span class="hljs-number">0</span>,

                    <span class="hljs-attr">velocityX</span>: velocityCalc(fx, x),
                    <span class="hljs-attr">velocityY</span>: velocityCalc(fy, y),
                    <span class="hljs-attr">velocityZ</span>: velocityCalc(fz, z),

                    historyLength, 
                    engine, 
                    forces, 

                    <span class="hljs-attr">mass</span>: calc(mass, massVariation), 

                    <span class="hljs-attr">fill</span>: fillColorFactory.get(<span class="hljs-string">&#x27;random&#x27;</span>),
                    <span class="hljs-attr">stroke</span>: strokeColorFactory.get(<span class="hljs-string">&#x27;random&#x27;</span>),
                });

                <span class="hljs-keyword">let</span> timeKill = <span class="hljs-built_in">Math</span>.abs(calc(killAfterTime, killAfterTimeVariation));
                <span class="hljs-keyword">let</span> radiusKill = <span class="hljs-built_in">Math</span>.abs(calc(killRadius, killRadiusVariation));

                p.run(timeKill, radiusKill, killBeyondCanvas);

                particleStore.push(p);
            }
            releaseCell(testCell);
            releaseCoordinate(coord);
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Use an Shape-based entity’s path to determine where the particle will be generated</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (generateAlongPath) {

        <span class="hljs-keyword">if</span> (generateAlongPath.useAsPath) {

            <span class="hljs-keyword">if</span> (!generateAlongPath.pathObject || generateAlongPath.dirtyPathObject) generateAlongPath.cleanPathObject();

            GenerateAlongPathLoops:
            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; req; i++) {

                <span class="hljs-keyword">let</span> coord = <span class="hljs-literal">false</span>,
                    coordFlag = <span class="hljs-literal">false</span>;

                <span class="hljs-keyword">while</span> (!coordFlag) {

                    <span class="hljs-keyword">if</span> (timeChoke + generationChoke &lt; <span class="hljs-built_in">Date</span>.now()) <span class="hljs-keyword">break</span> GenerateAlongPathLoops;

                    coord = generateAlongPath.getPathPositionData(rnd(), <span class="hljs-literal">true</span>);
                    
                    <span class="hljs-keyword">if</span> (coord) coordFlag = <span class="hljs-literal">true</span>;
                }

                p = requestParticle();

                p.set({
                    <span class="hljs-attr">positionX</span>: coord.x,
                    <span class="hljs-attr">positionY</span>: coord.y,
                    <span class="hljs-attr">positionZ</span>: <span class="hljs-number">0</span>,

                    <span class="hljs-attr">velocityX</span>: velocityCalc(fx, x),
                    <span class="hljs-attr">velocityY</span>: velocityCalc(fy, y),
                    <span class="hljs-attr">velocityZ</span>: velocityCalc(fz, z),

                    historyLength, 
                    engine, 
                    forces, 

                    <span class="hljs-attr">mass</span>: calc(mass, massVariation), 
 
                    <span class="hljs-attr">fill</span>: fillColorFactory.get(<span class="hljs-string">&#x27;random&#x27;</span>),
                    <span class="hljs-attr">stroke</span>: strokeColorFactory.get(<span class="hljs-string">&#x27;random&#x27;</span>),
                });

                <span class="hljs-keyword">let</span> timeKill = <span class="hljs-built_in">Math</span>.abs(calc(killAfterTime, killAfterTimeVariation));
                <span class="hljs-keyword">let</span> radiusKill = <span class="hljs-built_in">Math</span>.abs(calc(killRadius, killRadiusVariation));

                p.run(timeKill, radiusKill, killBeyondCanvas);

                particleStore.push(p);
            }
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Generate the particle using the emitter’s start coordinate, or a reference artifact’s coordinate</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> {

        [cx, cy] = currentStampPosition;
        
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; req; i++) {

            p = requestParticle();

            p.set({
                <span class="hljs-attr">positionX</span>: cx,
                <span class="hljs-attr">positionY</span>: cy,
                <span class="hljs-attr">positionZ</span>: <span class="hljs-number">0</span>,

                <span class="hljs-attr">velocityX</span>: velocityCalc(fx, x),
                <span class="hljs-attr">velocityY</span>: velocityCalc(fy, y),
                <span class="hljs-attr">velocityZ</span>: velocityCalc(fz, z),

                historyLength, 
                engine, 
                forces, 

                <span class="hljs-attr">mass</span>: calc(mass, massVariation), 

                <span class="hljs-attr">fill</span>: fillColorFactory.get(<span class="hljs-string">&#x27;random&#x27;</span>),
                <span class="hljs-attr">stroke</span>: strokeColorFactory.get(<span class="hljs-string">&#x27;random&#x27;</span>),
            });

            p.velocity.rotate(currentRotation);

            <span class="hljs-keyword">let</span> timeKill = <span class="hljs-built_in">Math</span>.abs(calc(killAfterTime, killAfterTimeVariation));
            <span class="hljs-keyword">let</span> radiusKill = <span class="hljs-built_in">Math</span>.abs(calc(killRadius, killRadiusVariation));

            p.run(timeKill, radiusKill, killBeyondCanvas);

            particleStore.push(p);
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p><code>regularStampSynchronousActions</code> - overwriters the functionality defined in the entity.js mixin</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.regularStampSynchronousActions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> {world, artefact, particleStore, preAction, stampAction, postAction, lastUpdated, resetAfterBlur, showHitRadius, hitRadius, hitRadiusColor, currentStampPosition} = <span class="hljs-built_in">this</span>;

    <span class="hljs-keyword">let</span> host = <span class="hljs-built_in">this</span>.currentHost;

    <span class="hljs-keyword">let</span> deltaTime = <span class="hljs-number">16</span> / <span class="hljs-number">1000</span>,
        now = <span class="hljs-built_in">Date</span>.now();

    <span class="hljs-keyword">if</span> (lastUpdated) deltaTime = (now - lastUpdated) / <span class="hljs-number">1000</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>If the user has focussed on another tab in the browser before returning to the tab running this Scrawl-canvas animation, then we risk breaking the page by continuing the animation with the existing particles - simplest solution is to remove all the particles and, in effect, restarting the emitter’s animation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (deltaTime &gt; resetAfterBlur) {

        particleStore.forEach(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> releaseParticle(p));
        particleStore.length = <span class="hljs-number">0</span>;
        deltaTime = <span class="hljs-number">16</span> / <span class="hljs-number">1000</span>;
    }

    particleStore.forEach(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.applyForces(world, host));
    particleStore.forEach(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.update(deltaTime, world));</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Perform canvas drawing before the main (developer-defined) <code>stampAction</code> function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    preAction.call(<span class="hljs-built_in">this</span>, host);

    particleStore.forEach(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> {

        p.manageHistory(deltaTime, host);
        stampAction.call(<span class="hljs-built_in">this</span>, artefact, p, host);
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Perform further canvas drawing after the main (developer-defined) <code>stampAction</code> function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    postAction.call(<span class="hljs-built_in">this</span>, host);

    <span class="hljs-keyword">if</span> (showHitRadius) {

        <span class="hljs-keyword">let</span> engine = host.engine;

        engine.save();
        engine.lineWidth = <span class="hljs-number">1</span>;
        engine.strokeStyle = hitRadiusColor;

        engine.setTransform(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        engine.beginPath();
        engine.arc(currentStampPosition[<span class="hljs-number">0</span>], currentStampPosition[<span class="hljs-number">1</span>], hitRadius, <span class="hljs-number">0</span>, <span class="hljs-built_in">Math</span>.PI * <span class="hljs-number">2</span>);
        engine.stroke();

        engine.restore();
    }

    <span class="hljs-built_in">this</span>.lastUpdated = now;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p><code>checkHit</code> - overwrites the function defined in mixin/position.js</p>
<ul>
<li>The Emitter entity’s hit area is a circle centred on the entity’s rotation/reflection (start) position or, where the entity’s position is determined by reference (pivot, mimic, path, etc), the reference’s current position.</li>
<li>Emitter entitys can be dragged and dropped around a canvas display like any other Scrawl-canvas artefact.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.checkHit = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = [], mycell</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.noUserInteraction) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">let</span> tests = (!<span class="hljs-built_in">Array</span>.isArray(items)) ?  [items] : items;

    <span class="hljs-keyword">let</span> currentStampPosition = <span class="hljs-built_in">this</span>.currentStampPosition,
        res = <span class="hljs-literal">false</span>,
        tx, ty;

    <span class="hljs-keyword">if</span> (tests.some(<span class="hljs-function"><span class="hljs-params">test</span> =&gt;</span> {

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(test)) {

            tx = test[<span class="hljs-number">0</span>];
            ty = test[<span class="hljs-number">1</span>];
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (xta(test, test.x, test.y)) {

            tx = test.x;
            ty = test.y;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">if</span> (!tx.toFixed || !ty.toFixed || <span class="hljs-built_in">isNaN</span>(tx) || <span class="hljs-built_in">isNaN</span>(ty)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">let</span> v = requestVector(currentStampPosition).vectorSubtract(test);

        <span class="hljs-keyword">if</span> (v.getMagnitude() &lt; <span class="hljs-built_in">this</span>.hitRadius) res = <span class="hljs-literal">true</span>;

        releaseVector(v);

        <span class="hljs-keyword">return</span> res;

    }, <span class="hljs-built_in">this</span>)) {

        <span class="hljs-keyword">let</span> r = <span class="hljs-built_in">this</span>.checkHitReturn(tx, ty, mycell);

        <span class="hljs-keyword">return</span> r;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <h4 id="factory">Factory</h4>
<pre><code><span class="hljs-keyword">let</span> myWorld = scrawl.makeWorld({

    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;demo-world&#x27;</span>,
    <span class="hljs-attr">tickMultiplier</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">userAttributes</span>: [
        {
            <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;particleColor&#x27;</span>, 
            <span class="hljs-attr">defaultValue</span>: <span class="hljs-string">&#x27;#F0F8FF&#x27;</span>,
        },
        {
            <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;alphaDecay&#x27;</span>, 
            <span class="hljs-attr">defaultValue</span>: <span class="hljs-number">6</span>,
        },
    ],
});

scrawl.makeEmitter({

    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;use-raw-2d-context&#x27;</span>,
    <span class="hljs-attr">world</span>: myWorld,
    <span class="hljs-attr">start</span>: [<span class="hljs-string">&#x27;center&#x27;</span>, <span class="hljs-string">&#x27;center&#x27;</span>],

    <span class="hljs-attr">generationRate</span>: <span class="hljs-number">60</span>,
    <span class="hljs-attr">killAfterTime</span>: <span class="hljs-number">5</span>,

    <span class="hljs-attr">historyLength</span>: <span class="hljs-number">50</span>,

    <span class="hljs-attr">rangeX</span>: <span class="hljs-number">40</span>,
    <span class="hljs-attr">rangeFromX</span>: -<span class="hljs-number">20</span>,
    <span class="hljs-attr">rangeY</span>: <span class="hljs-number">40</span>,
    <span class="hljs-attr">rangeFromY</span>: -<span class="hljs-number">20</span>,
    <span class="hljs-attr">rangeZ</span>: -<span class="hljs-number">1</span>,
    <span class="hljs-attr">rangeFromZ</span>: -<span class="hljs-number">0.2</span>,

    <span class="hljs-attr">stampAction</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">artefact, particle, host</span>) </span>{

        <span class="hljs-keyword">let</span> engine = host.engine,
            history = particle.history,
            remaining, radius, alpha, x, y, z,
            endRad = <span class="hljs-built_in">Math</span>.PI * <span class="hljs-number">2</span>;

        engine.save();
        engine.fillStyle = myWorld.get(<span class="hljs-string">&#x27;particleColor&#x27;</span>);
        engine.beginPath();
        history.forEach(<span class="hljs-function">(<span class="hljs-params">p, index</span>) =&gt;</span> {
            [remaining, z, x, y] = p;
            radius = <span class="hljs-number">6</span> * (<span class="hljs-number">1</span> + (z / <span class="hljs-number">3</span>));
            alpha = remaining / myWorld.alphaDecay;
            <span class="hljs-keyword">if</span> (radius &gt; <span class="hljs-number">0</span> &amp;&amp; alpha &gt; <span class="hljs-number">0</span>) {
                engine.moveTo(x, y);
                engine.arc(x, y, radius, <span class="hljs-number">0</span>, endRad);
            }
        });
        engine.globalAlpha = alpha;
        engine.fill();
        engine.restore();
    },
});</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> makeEmitter = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Emitter(items);
};

<span class="hljs-title">constructors</span>.<span class="hljs-title">Emitter</span> = <span class="hljs-title">Emitter</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <h4 id="exports">Exports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> {
    makeEmitter,
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
