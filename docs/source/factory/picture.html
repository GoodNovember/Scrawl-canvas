<!DOCTYPE html>

<html>
<head>
  <title>Picture factory</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../core/animationloop.html">
                  ./source/core/animationloop.js
                </a>
              
                
                <a class="source" href="../core/component.html">
                  ./source/core/component.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/events.html">
                  ./source/core/events.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/userInteraction.html">
                  ./source/core/userInteraction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="bezier.html">
                  ./source/factory/bezier.js
                </a>
              
                
                <a class="source" href="block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="emitter.html">
                  ./source/factory/emitter.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="fontAttributes.html">
                  ./source/factory/fontAttributes.js
                </a>
              
                
                <a class="source" href="gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="imageAsset.html">
                  ./source/factory/imageAsset.js
                </a>
              
                
                <a class="source" href="line.html">
                  ./source/factory/line.js
                </a>
              
                
                <a class="source" href="loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="net.html">
                  ./source/factory/net.js
                </a>
              
                
                <a class="source" href="oval.html">
                  ./source/factory/oval.js
                </a>
              
                
                <a class="source" href="palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="particle.html">
                  ./source/factory/particle.js
                </a>
              
                
                <a class="source" href="particleForce.html">
                  ./source/factory/particleForce.js
                </a>
              
                
                <a class="source" href="particleHistory.html">
                  ./source/factory/particleHistory.js
                </a>
              
                
                <a class="source" href="particleSpring.html">
                  ./source/factory/particleSpring.js
                </a>
              
                
                <a class="source" href="particleWorld.html">
                  ./source/factory/particleWorld.js
                </a>
              
                
                <a class="source" href="pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="polygon.html">
                  ./source/factory/polygon.js
                </a>
              
                
                <a class="source" href="polyline.html">
                  ./source/factory/polyline.js
                </a>
              
                
                <a class="source" href="quadratic.html">
                  ./source/factory/quadratic.js
                </a>
              
                
                <a class="source" href="quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="radialGradient.html">
                  ./source/factory/radialGradient.js
                </a>
              
                
                <a class="source" href="rectangle.html">
                  ./source/factory/rectangle.js
                </a>
              
                
                <a class="source" href="renderAnimation.html">
                  ./source/factory/renderAnimation.js
                </a>
              
                
                <a class="source" href="shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="spiral.html">
                  ./source/factory/spiral.js
                </a>
              
                
                <a class="source" href="spriteAsset.html">
                  ./source/factory/spriteAsset.js
                </a>
              
                
                <a class="source" href="stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="star.html">
                  ./source/factory/star.js
                </a>
              
                
                <a class="source" href="state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="tetragon.html">
                  ./source/factory/tetragon.js
                </a>
              
                
                <a class="source" href="ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="tracer.html">
                  ./source/factory/tracer.js
                </a>
              
                
                <a class="source" href="tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="unstackedElement.html">
                  ./source/factory/unstackedElement.js
                </a>
              
                
                <a class="source" href="vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="videoAsset.html">
                  ./source/factory/videoAsset.js
                </a>
              
                
                <a class="source" href="wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="../mixin/anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="../mixin/asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="../mixin/assetConsumer.html">
                  ./source/mixin/assetConsumer.js
                </a>
              
                
                <a class="source" href="../mixin/base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="../mixin/cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="../mixin/delta.html">
                  ./source/mixin/delta.js
                </a>
              
                
                <a class="source" href="../mixin/displayShape.html">
                  ./source/mixin/displayShape.js
                </a>
              
                
                <a class="source" href="../mixin/dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="../mixin/entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="../mixin/filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="../mixin/mimic.html">
                  ./source/mixin/mimic.js
                </a>
              
                
                <a class="source" href="../mixin/path.html">
                  ./source/mixin/path.js
                </a>
              
                
                <a class="source" href="../mixin/pattern.html">
                  ./source/mixin/pattern.js
                </a>
              
                
                <a class="source" href="../mixin/pivot.html">
                  ./source/mixin/pivot.js
                </a>
              
                
                <a class="source" href="../mixin/position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="../mixin/shapeBasic.html">
                  ./source/mixin/shapeBasic.js
                </a>
              
                
                <a class="source" href="../mixin/shapeCurve.html">
                  ./source/mixin/shapeCurve.js
                </a>
              
                
                <a class="source" href="../mixin/shapePathCalculation.html">
                  ./source/mixin/shapePathCalculation.js
                </a>
              
                
                <a class="source" href="../mixin/styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="../mixin/tween.html">
                  ./source/mixin/tween.js
                </a>
              
                
                <a class="source" href="../worker/filter-stringed.html">
                  ./source/worker/filter-stringed.js
                </a>
              
                
                <a class="source" href="../worker/filter.html">
                  ./source/worker/filter.js
                </a>
              
                
                <a class="source" href="../worker/filter_canvas.html">
                  ./source/worker/filter_canvas.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="picture-factory">Picture factory</h1>
<p>Picture entitys are image, video or canvas-based rectangles rendered onto a DOM &lt;canvas&gt; element using the Canvas API’s <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D">CanvasRenderingContext2D interface</a> - in particular the <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage">drawImage</a> method.</p>
<ul>
<li>Positioning and dimensions functionality for the Picture is supplied by the <strong>position</strong> mixin, while rendering functionality comes from the <strong>entity</strong> mixin. </li>
<li>Pictures can use <a href="./imageAsset.html">ImageAsset</a>, <a href="./spriteAsset.html">SpriteAsset</a>, <a href="./videoAsset.html">VideoAsset</a>, or <a href="./cell.html">Cells</a> for the source of the image they display.</li>
<li>Additionally, we can restrict the display to a portion of the source by defining and updating <code>copy</code> attributes.</li>
</ul>
<p>We define the source copy area in a similar way to how we position and dimension the Picture entity on its Cell host, using two additional <a href="./coordinate.html">Coordinate</a> Arrays to hold our data.</p>
<ul>
<li>for both positioning and dimensions, we can define the coordinate in absolute, or relative, terms</li>
<li><strong>absolute</strong> positioning and dimensions - where we give the artefact a Number coordinate measured in pixels. </li>
<li><strong>relative</strong> positioning and dimensions - where we use String percentage coordinates, with <code>[&#39;0%&#39;, &#39;0%&#39;]</code> representing the top left corner of the source, and <code>[&#39;100%&#39;, &#39;100%&#39;]</code> its bottom right corner.</li>
</ul>
<p>Source dimensions are the <strong><em>natural width and height</em></strong> of the image or video</p>
<ul>
<li>The code will check automatically to make sure that any combination of start and dimensions values does not lead to an attempt to copy image data that does not exist (which otherwise throws an error).</li>
<li>Where <code>copyStartX + width</code> values are greater than the source width, the start value will be reduced until the copy frame fits within the bounds of the source dimensions.</li>
<li>Where <code>copyStartY + height</code> values are greater than the source height, the start value will be reduced until the copy frame fits within the bounds of the source dimensions.</li>
</ul>
<p>Loading sources is an asynchronous action. If we attempt to stamp a Picture entity whose source has not yet been fetched or loaded, the Picture will skip its stamp functionality for that Display cycle.</p>
<ul>
<li>Stamping a Picture entity directly, immediately after defining it, will (almost certainly) lead to the image not displaying on the canvas.</li>
<li>For this reason, its best to use Picture entitys inside a Display cycle animation. As soon as the source finishes loading, the Picture entity will display as expected.</li>
</ul>
<p>Also:</p>
<ul>
<li>Pictures can use CSS color Strings for their strokeStyle values, alongside <strong>Gradient</strong>, <strong>RadialGradient</strong>, <strong>Color</strong> and <strong>Pattern</strong> objects. </li>
<li>They will also accept <strong>Filter</strong> objects.</li>
<li>They can use <strong>Anchor</strong> objects for user navigation. </li>
<li>They can be rendered to the canvas by including them in a <strong>Cell</strong> object’s <strong>Group</strong>. </li>
<li>They can be <strong>animated</strong> directly, or using delta animation, or act as the target for <strong>Tween</strong> animations.</li>
<li>Pictures (but not their source assets) can be cloned, and killed.</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h4 id="demos">Demos:</h4>
<ul>
<li><a href="../../demo/canvas-008.html">Canvas-008</a> - Picture entity position; manipulate copy attributes</li>
<li><a href="../../demo/canvas-010.html">Canvas-010</a> - Use video sources and media streams for Picture entitys</li>
<li><a href="../../demo/canvas-021.html">Canvas-021</a> - Import and use spritesheets</li>
<li><a href="../../demo/canvas-023.html">Canvas-023</a> - Grid entity - using picture-based assets (image, video, sprite)</li>
<li><a href="../../demo/canvas-024.html">Canvas-024</a> - Loom entity functionality</li>
<li><a href="../../demo/canvas-025.html">Canvas-025</a> - Responsive images</li>
<li><a href="../../demo/component-004.html">Component-004</a> - Scrawl-canvas packets - save and load a range of different entitys</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h4 id="imports">Imports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { <span class="hljs-title">constructors</span>, <span class="hljs-title">asset</span>, <span class="hljs-title">artefact</span> } <span class="hljs-title">from</span> &#x27;../<span class="hljs-title">core</span>/<span class="hljs-title">library</span>.<span class="hljs-title">js</span>&#x27;;

<span class="hljs-keyword">import</span> { mergeOver, xta, addStrings, pushUnique, removeItem } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../core/utilities.js&#x27;</span>;

<span class="hljs-keyword">import</span> { gettableVideoAssetAtributes, settableVideoAssetAtributes } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./videoAsset.js&#x27;</span>;
<span class="hljs-keyword">import</span> { gettableImageAssetAtributes, settableImageAssetAtributes } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./imageAsset.js&#x27;</span>;

<span class="hljs-keyword">import</span> { makeCoordinate } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./coordinate.js&#x27;</span>;

<span class="hljs-keyword">import</span> baseMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/base.js&#x27;</span>;
<span class="hljs-keyword">import</span> entityMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/entity.js&#x27;</span>;
<span class="hljs-keyword">import</span> assetConsumerMix <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../mixin/assetConsumer.js&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h4 id="picture-constructor">Picture constructor</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Picture = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-built_in">this</span>.copyStart = makeCoordinate();
    <span class="hljs-built_in">this</span>.currentCopyStart = makeCoordinate();

    <span class="hljs-built_in">this</span>.copyDimensions = makeCoordinate();
    <span class="hljs-built_in">this</span>.currentCopyDimensions = makeCoordinate();

    <span class="hljs-built_in">this</span>.copyArray = [];
    <span class="hljs-built_in">this</span>.pasteArray = [];

    <span class="hljs-built_in">this</span>.entityInit(items);

    <span class="hljs-keyword">if</span> (!items.copyStart) {

        <span class="hljs-keyword">if</span> (!items.copyStartX) <span class="hljs-built_in">this</span>.copyStart[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (!items.copyStartY) <span class="hljs-built_in">this</span>.copyStart[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;
    }

    <span class="hljs-keyword">if</span> (!items.copyDimensions) {

        <span class="hljs-keyword">if</span> (!items.copyWidth) <span class="hljs-built_in">this</span>.copyDimensions[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (!items.copyHeight) <span class="hljs-built_in">this</span>.copyDimensions[<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>;
    }

    <span class="hljs-built_in">this</span>.imageSubscribers = [];

    <span class="hljs-built_in">this</span>.dirtyCopyStart = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">this</span>.dirtyCopyDimensions = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">this</span>.dirtyImage = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h4 id="picture-prototype">Picture prototype</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> P = Picture.prototype = <span class="hljs-built_in">Object</span>.create(<span class="hljs-built_in">Object</span>.prototype);
P.type = <span class="hljs-string">&#x27;Picture&#x27;</span>;
P.lib = <span class="hljs-string">&#x27;entity&#x27;</span>;
P.isArtefact = <span class="hljs-literal">true</span>;
P.isAsset = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h4 id="mixins">Mixins</h4>
<ul>
<li><a href="../mixin/base.html">base</a></li>
<li><a href="../mixin/entity.html">entity</a></li>
<li><a href="../mixin/assetConsumer.html">assetConsumer</a></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P = baseMix(P);
P = entityMix(P);
P = assetConsumerMix(P);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h4 id="picture-attributes">Picture attributes</h4>
<ul>
<li>Attributes defined in the <a href="../mixin/base.html">base mixin</a>: <strong>name</strong>.</li>
<li>Attributes defined in the <a href="../mixin/position.html">position mixin</a>: <strong>group, visibility, order, start, <em>startX</em>, <em>startY</em>, handle, <em>handleX</em>, <em>handleY</em>, offset, <em>offsetX</em>, <em>offsetY</em>, dimensions, <em>width</em>, <em>height</em>, pivoted, mimicked, lockTo, <em>lockXTo</em>, <em>lockYTo</em>, scale, roll, noUserInteraction, noPositionDependencies, noCanvasEngineUpdates, noFilters, noPathUpdates, purge, bringToFrontOnDrag</strong>.</li>
<li>Attributes defined in the <a href="../mixin/delta.html">delta mixin</a>: <strong>delta, noDeltaUpdates</strong>.</li>
<li>Attributes defined in the <a href="../mixin/pivot.html">pivot mixin</a>: <strong>pivot, pivotCorner, addPivotHandle, addPivotOffset, addPivotRotation</strong>.</li>
<li>Attributes defined in the <a href="../mixin/mimic.html">mimic mixin</a>: <strong>mimic, useMimicDimensions, useMimicScale, useMimicStart, useMimicHandle, useMimicOffset, useMimicRotation, useMimicFlip, addOwnDimensionsToMimic, addOwnScaleToMimic, addOwnStartToMimic, addOwnHandleToMimic, addOwnOffsetToMimic, addOwnRotationToMimic</strong>.</li>
<li>Attributes defined in the <a href="../mixin/path.html">path mixin</a>: <strong>path, pathPosition, addPathHandle, addPathOffset, addPathRotation, constantPathSpeed</strong>.</li>
<li>Attributes defined in the <a href="../mixin/entity.html">entity mixin</a>: <strong>method, pathObject, winding, flipReverse, flipUpend, scaleOutline, lockFillStyleToEntity, lockStrokeStyleToEntity, onEnter, onLeave, onDown, onUp, <em>fillStyle, strokeStyle, globalAlpha, globalCompositeOperation, lineWidth, lineCap, lineJoin, lineDash, lineDashOffset, miterLimit, shadowOffsetX, shadowOffsetY, shadowBlur, shadowColor, filter</em></strong>.</li>
<li>Attributes defined in the <a href="../mixin/anchor.html">anchor mixin</a>: <strong>anchor</strong>.</li>
<li>Attributes defined in the <a href="../mixin/filter.html">filter mixin</a>: <strong>filters, isStencil</strong>.</li>
<li>Attributes defined in the <a href="../mixin/assetConsumer.html">assetConsumer mixin</a>: <strong>asset, spriteTrack, imageSource, spriteSource, videoSource, source</strong>.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> defaultAttributes = {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><strong>copyStart</strong> - Coordinate array</p>
<ul>
<li>We can use the pseudo-attributes <strong>copyStartX</strong> and <strong>copyStartY</strong> to make working with the Coordinate easier.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    copyStart: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p><strong>copyDimensions</strong> - Coordinate array</p>
<ul>
<li>We can use the pseudo-attributes <strong>copyWidth</strong> and <strong>copyHeight</strong> to make working with the Coordinate easier.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    copyDimensions: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p><strong>checkHitIgnoreTransparency</strong> - Boolean - when set, will check the stashedImage data to return whether a coordinate is hitting the image; otherwise checkHit will use the Picture entity’s dimensions to calculate the hit</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    checkHitIgnoreTransparency: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p><strong><em>Additional attributes and pseudo-attributes</em></strong> are defined in the <a href="../mixin/assetConsumer.html">assetConsumer mixin</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>};
P.defs = mergeOver(P.defs, defaultAttributes);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h4 id="packet-management">Packet management</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.packetCoordinates = pushUnique(P.packetCoordinates, [<span class="hljs-string">&#x27;copyStart&#x27;</span>, <span class="hljs-string">&#x27;copyDimensions&#x27;</span>]);
P.packetObjects = pushUnique(P.packetObjects, [<span class="hljs-string">&#x27;asset&#x27;</span>]);</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h4 id="clone-management">Clone management</h4>
<p>No additional clone functionality required</p>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h4 id="kill-management">Kill management</h4>
<p>P.kill = function () {</p>

            </div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <pre><code><span class="hljs-built_in">this</span>.asset.unsubscribe(<span class="hljs-built_in">this</span>);
<span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.group &amp;&amp; <span class="hljs-built_in">this</span>.group.name) <span class="hljs-built_in">this</span>.group.removeArtefacts(<span class="hljs-built_in">this</span>.name);
<span class="hljs-built_in">this</span>.demolishAnchor();
<span class="hljs-built_in">this</span>.deregister();
<span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;</code></pre>
<p>};</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.factoryKill = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-built_in">this</span>.asset.unsubscribe(<span class="hljs-built_in">this</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h4 id="get-set-deltaset">Get, Set, deltaSet</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> G = P.getters,
    S = P.setters,
    D = P.deltaSetters;</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p><strong>copyStart</strong></p>
<ul>
<li>Including <strong>copyStartX</strong>, <strong>copyStartY</strong></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>G.copyStartX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.currentCopyStart[<span class="hljs-number">0</span>];
};
G.copyStartY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.currentCopyStart[<span class="hljs-number">1</span>];
};
S.copyStartX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

    <span class="hljs-keyword">if</span> (coord != <span class="hljs-literal">null</span>) {

        <span class="hljs-built_in">this</span>.copyStart[<span class="hljs-number">0</span>] = coord;
        <span class="hljs-built_in">this</span>.dirtyCopyStart = <span class="hljs-literal">true</span>;
        <span class="hljs-built_in">this</span>.dirtyImageSubscribers = <span class="hljs-literal">true</span>;
    }
};
S.copyStartY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

    <span class="hljs-keyword">if</span> (coord != <span class="hljs-literal">null</span>) {

        <span class="hljs-built_in">this</span>.copyStart[<span class="hljs-number">1</span>] = coord;
        <span class="hljs-built_in">this</span>.dirtyCopyStart = <span class="hljs-literal">true</span>;
        <span class="hljs-built_in">this</span>.dirtyImageSubscribers = <span class="hljs-literal">true</span>;
    }
};
S.copyStart = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>{

    <span class="hljs-built_in">this</span>.setCoordinateHelper(<span class="hljs-string">&#x27;copyStart&#x27;</span>, x, y);
    <span class="hljs-built_in">this</span>.dirtyCopyStart = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">this</span>.dirtyImageSubscribers = <span class="hljs-literal">true</span>;
};
D.copyStartX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

    <span class="hljs-keyword">let</span> c = <span class="hljs-built_in">this</span>.copyStart;
    c[<span class="hljs-number">0</span>] = addStrings(c[<span class="hljs-number">0</span>], coord);
    <span class="hljs-built_in">this</span>.dirtyCopyStart = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">this</span>.dirtyImageSubscribers = <span class="hljs-literal">true</span>;
};
D.copyStartY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

    <span class="hljs-keyword">let</span> c = <span class="hljs-built_in">this</span>.copyStart;
    c[<span class="hljs-number">1</span>] = addStrings(c[<span class="hljs-number">1</span>], coord);
    <span class="hljs-built_in">this</span>.dirtyCopyStart = <span class="hljs-literal">true</span>;
};
D.copyStart = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>{

    <span class="hljs-built_in">this</span>.setDeltaCoordinateHelper(<span class="hljs-string">&#x27;copyStart&#x27;</span>, x, y);
    <span class="hljs-built_in">this</span>.dirtyCopyStart = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">this</span>.dirtyImageSubscribers = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p><strong>copyDimensions</strong></p>
<ul>
<li>Including <strong>copyWidth</strong>, <strong>copyHeight</strong></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>G.copyWidth = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.currentCopyDimensions[<span class="hljs-number">0</span>];
};
G.copyHeight = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.currentCopyDimensions[<span class="hljs-number">1</span>];
};
S.copyWidth = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{

    <span class="hljs-keyword">if</span> (val != <span class="hljs-literal">null</span>) {

        <span class="hljs-built_in">this</span>.copyDimensions[<span class="hljs-number">0</span>] = val;
        <span class="hljs-built_in">this</span>.dirtyCopyDimensions = <span class="hljs-literal">true</span>;
        <span class="hljs-built_in">this</span>.dirtyImageSubscribers = <span class="hljs-literal">true</span>;
    }
};
S.copyHeight = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{

    <span class="hljs-keyword">if</span> (val != <span class="hljs-literal">null</span>) {

        <span class="hljs-built_in">this</span>.copyDimensions[<span class="hljs-number">1</span>] = val;
        <span class="hljs-built_in">this</span>.dirtyCopyDimensions = <span class="hljs-literal">true</span>;
        <span class="hljs-built_in">this</span>.dirtyImageSubscribers = <span class="hljs-literal">true</span>;
    }
};
S.copyDimensions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">w, h</span>) </span>{

    <span class="hljs-built_in">this</span>.setCoordinateHelper(<span class="hljs-string">&#x27;copyDimensions&#x27;</span>, w, h);
    <span class="hljs-built_in">this</span>.dirtyCopyDimensions = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">this</span>.dirtyImageSubscribers = <span class="hljs-literal">true</span>;
};
D.copyWidth = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{

    <span class="hljs-keyword">let</span> c = <span class="hljs-built_in">this</span>.copyDimensions;
    c[<span class="hljs-number">0</span>] = addStrings(c[<span class="hljs-number">0</span>], val);
    <span class="hljs-built_in">this</span>.dirtyCopyDimensions = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">this</span>.dirtyImageSubscribers = <span class="hljs-literal">true</span>;
};
D.copyHeight = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{

    <span class="hljs-keyword">let</span> c = <span class="hljs-built_in">this</span>.copyDimensions;
    c[<span class="hljs-number">1</span>] = addStrings(c[<span class="hljs-number">1</span>], val);
    <span class="hljs-built_in">this</span>.dirtyCopyDimensions = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">this</span>.dirtyImageSubscribers = <span class="hljs-literal">true</span>;
};
D.copyDimensions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">w, h</span>) </span>{

    <span class="hljs-built_in">this</span>.setDeltaCoordinateHelper(<span class="hljs-string">&#x27;copyDimensions&#x27;</span>, w, h);
    <span class="hljs-built_in">this</span>.dirtyCopyDimensions = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">this</span>.dirtyImageSubscribers = <span class="hljs-literal">true</span>;
};

S.checkHitIgnoreTransparency = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-built_in">this</span>.checkHitIgnoreTransparency = item;

    <span class="hljs-keyword">if</span> (item) <span class="hljs-built_in">this</span>.stashOutput = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Picture <code>get</code> and <code>set</code> (but not <code>deltaSet</code>) functions need to take into account their current source, whose attributes can be retrieved/amended directly on the Picture object</p>

            </div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p><code>get</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.get = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">let</span> source = <span class="hljs-built_in">this</span>.source;

    <span class="hljs-keyword">if</span> ((item.indexOf(<span class="hljs-string">&#x27;video_&#x27;</span>) === <span class="hljs-number">0</span> || item.indexOf(<span class="hljs-string">&#x27;image_&#x27;</span>) === <span class="hljs-number">0</span>) &amp;&amp; source) {

        <span class="hljs-keyword">if</span> (gettableVideoAssetAtributes.indexOf(item) &gt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> source[item.substring(<span class="hljs-number">6</span>)];
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (gettableImageAssetAtributes.indexOf(item) &gt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> source[item.substring(<span class="hljs-number">6</span>)];
    }

    <span class="hljs-keyword">else</span> {

        <span class="hljs-keyword">let</span> getter = <span class="hljs-built_in">this</span>.getters[item];

        <span class="hljs-keyword">if</span> (getter) <span class="hljs-keyword">return</span> getter.call(<span class="hljs-built_in">this</span>);

        <span class="hljs-keyword">else</span> {

            <span class="hljs-keyword">let</span> def = <span class="hljs-built_in">this</span>.defs[item],
                state = <span class="hljs-built_in">this</span>.state,
                val;

            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> def != <span class="hljs-string">&#x27;undefined&#x27;</span>) {

                val = <span class="hljs-built_in">this</span>[item];
                <span class="hljs-keyword">return</span> (<span class="hljs-keyword">typeof</span> val != <span class="hljs-string">&#x27;undefined&#x27;</span>) ? val : def;
            }

            def = state.defs[item];

            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> def != <span class="hljs-string">&#x27;undefined&#x27;</span>) {

                val = state[item];
                <span class="hljs-keyword">return</span> (<span class="hljs-keyword">typeof</span> val != <span class="hljs-string">&#x27;undefined&#x27;</span>) ? val : def;
            }
            <span class="hljs-keyword">return</span> undef;
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p><code>set</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.set = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Object</span>.keys(items).length) {

        <span class="hljs-keyword">let</span> setters = <span class="hljs-built_in">this</span>.setters,
            defs = <span class="hljs-built_in">this</span>.defs,
            state = <span class="hljs-built_in">this</span>.state,
            source = <span class="hljs-built_in">this</span>.source,
            stateSetters = (state) ? state.setters : {},
            stateDefs = (state) ? state.defs : {},
            predefined, stateFlag;

        <span class="hljs-built_in">Object</span>.entries(items).forEach(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> {

            <span class="hljs-keyword">if</span> ((key.indexOf(<span class="hljs-string">&#x27;video_&#x27;</span>) === <span class="hljs-number">0</span> || key.indexOf(<span class="hljs-string">&#x27;image_&#x27;</span>) === <span class="hljs-number">0</span>) &amp;&amp; source) {

                <span class="hljs-keyword">if</span> (settableVideoAssetAtributes.indexOf(key) &gt;= <span class="hljs-number">0</span>) source[key.substring(<span class="hljs-number">6</span>)] = value
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (settableImageAssetAtributes.indexOf(key) &gt;= <span class="hljs-number">0</span>) source[key.substring(<span class="hljs-number">6</span>)] = value
            }

            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (key &amp;&amp; key !== <span class="hljs-string">&#x27;name&#x27;</span> &amp;&amp; value != <span class="hljs-literal">null</span>) {

                predefined = setters[key];
                stateFlag = <span class="hljs-literal">false</span>;

                <span class="hljs-keyword">if</span> (!predefined) {

                    predefined = stateSetters[key];
                    stateFlag = <span class="hljs-literal">true</span>;
                }

                <span class="hljs-keyword">if</span> (predefined) predefined.call(stateFlag ? <span class="hljs-built_in">this</span>.state : <span class="hljs-built_in">this</span>, value);
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> defs[key] !== <span class="hljs-string">&#x27;undefined&#x27;</span>) <span class="hljs-built_in">this</span>[key] = value;
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> stateDefs[key] !== <span class="hljs-string">&#x27;undefined&#x27;</span>) state[key] = value;
            }
        }, <span class="hljs-built_in">this</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <h4 id="subscriber-management">Subscriber management</h4>

            </div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p><code>updateImageSubscribers</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.updateImageSubscribers = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-built_in">this</span>.dirtyImageSubscribers = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.imageSubscribers.length) {

        <span class="hljs-built_in">this</span>.imageSubscribers.forEach(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {

            <span class="hljs-keyword">let</span> instance = artefact[name];

            <span class="hljs-keyword">if</span> (instance) instance.dirtyInput = <span class="hljs-literal">true</span>;
        });
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p><code>imageSubscribe</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.imageSubscribe = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) </span>{

    <span class="hljs-keyword">if</span> (name &amp;&amp; name.substring) pushUnique(<span class="hljs-built_in">this</span>.imageSubscribers, name);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p><code>imageUnsubscribe</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.imageUnsubscribe = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) </span>{

    <span class="hljs-keyword">if</span> (name &amp;&amp; name.substring) removeItem(<span class="hljs-built_in">this</span>.imageSubscribers, name);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h4 id="display-cycle-functionality">Display cycle functionality</h4>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p><code>cleanImage</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cleanImage = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> natWidth = <span class="hljs-built_in">this</span>.sourceNaturalWidth,
        natHeight = <span class="hljs-built_in">this</span>.sourceNaturalHeight;

    <span class="hljs-keyword">if</span> (xta(natWidth, natHeight)) {

        <span class="hljs-built_in">this</span>.dirtyImage = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">let</span> start = <span class="hljs-built_in">this</span>.currentCopyStart,
            x = start[<span class="hljs-number">0</span>],
            y = start[<span class="hljs-number">1</span>];

        <span class="hljs-keyword">let</span> dims = <span class="hljs-built_in">this</span>.currentCopyDimensions,
            w = dims[<span class="hljs-number">0</span>],
            h = dims[<span class="hljs-number">1</span>];

        <span class="hljs-keyword">if</span> (x + w &gt; natWidth) start[<span class="hljs-number">0</span>] = natWidth - w;
        <span class="hljs-keyword">if</span> (y + h &gt; natHeight) start[<span class="hljs-number">1</span>] = natHeight - h;

        <span class="hljs-keyword">let</span> copyArray = <span class="hljs-built_in">this</span>.copyArray;

        copyArray.length = <span class="hljs-number">0</span>;
        copyArray.push(start[<span class="hljs-number">0</span>], start[<span class="hljs-number">1</span>], w, h);
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p><code>cleanCopyStart</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cleanCopyStart = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> width = <span class="hljs-built_in">this</span>.sourceNaturalWidth,
        height = <span class="hljs-built_in">this</span>.sourceNaturalHeight;

    <span class="hljs-keyword">if</span> (xta(width, height)) {

        <span class="hljs-built_in">this</span>.dirtyCopyStart = <span class="hljs-literal">false</span>;

        <span class="hljs-built_in">this</span>.cleanPosition(<span class="hljs-built_in">this</span>.currentCopyStart, <span class="hljs-built_in">this</span>.copyStart, [width, height]);

        <span class="hljs-keyword">let</span> current = <span class="hljs-built_in">this</span>.currentCopyStart,
            x = current[<span class="hljs-number">0</span>],
            y = current[<span class="hljs-number">1</span>];

        <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span> || x &gt; width) {

            <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span>) current[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">else</span> current[<span class="hljs-number">0</span>] = width - <span class="hljs-number">1</span>;
        }

        <span class="hljs-keyword">if</span> (y &lt; <span class="hljs-number">0</span> || y &gt; height) {

            <span class="hljs-keyword">if</span> (y &lt; <span class="hljs-number">0</span>) current[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">else</span> current[<span class="hljs-number">1</span>] = height - <span class="hljs-number">1</span>;
        }
        <span class="hljs-built_in">this</span>.dirtyImage = <span class="hljs-literal">true</span>;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p><code>cleanCopyDimensions</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cleanCopyDimensions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> natWidth = <span class="hljs-built_in">this</span>.sourceNaturalWidth,
        natHeight = <span class="hljs-built_in">this</span>.sourceNaturalHeight;

    <span class="hljs-keyword">if</span> (xta(natWidth, natHeight)) {

        <span class="hljs-built_in">this</span>.dirtyCopyDimensions = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">let</span> dims = <span class="hljs-built_in">this</span>.copyDimensions,
            currentDims = <span class="hljs-built_in">this</span>.currentCopyDimensions,
            width = dims[<span class="hljs-number">0</span>], 
            height = dims[<span class="hljs-number">1</span>];

        <span class="hljs-keyword">if</span> (width.substring) currentDims[<span class="hljs-number">0</span>] = (<span class="hljs-built_in">parseFloat</span>(width) / <span class="hljs-number">100</span>) * natWidth;
        <span class="hljs-keyword">else</span> currentDims[<span class="hljs-number">0</span>] = width;

        <span class="hljs-keyword">if</span> (height.substring) currentDims[<span class="hljs-number">1</span>] = (<span class="hljs-built_in">parseFloat</span>(height) / <span class="hljs-number">100</span>) * natHeight;
        <span class="hljs-keyword">else</span> currentDims[<span class="hljs-number">1</span>] = height;

        <span class="hljs-keyword">let</span> currentWidth = currentDims[<span class="hljs-number">0</span>],
            currentHeight = currentDims[<span class="hljs-number">1</span>];

        <span class="hljs-keyword">if</span> (currentWidth &lt;= <span class="hljs-number">0</span> || currentWidth &gt; natWidth) {

            <span class="hljs-keyword">if</span> (currentWidth &lt;= <span class="hljs-number">0</span>) currentDims[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;
            <span class="hljs-keyword">else</span> currentDims[<span class="hljs-number">0</span>] = natWidth;
        }

        <span class="hljs-keyword">if</span> (currentHeight &lt;= <span class="hljs-number">0</span> || currentHeight &gt; natHeight) {

            <span class="hljs-keyword">if</span> (currentHeight &lt;= <span class="hljs-number">0</span>) currentDims[<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>;
            <span class="hljs-keyword">else</span> currentDims[<span class="hljs-number">1</span>] = natHeight;
        }
        <span class="hljs-built_in">this</span>.dirtyImage = <span class="hljs-literal">true</span>;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p><code>prepareStamp</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.prepareStamp = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>The asset itself will update the Picture entity object when changes occur, by setting the entity’s <code>dirtyAsset</code> flag</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyAsset) <span class="hljs-built_in">this</span>.cleanAsset();</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Not content with the dirty flag, the entity now interrogates its asset via its <code>checkSource</code> to trigger it to directly rewrite key information if it has changed - particularly dimensional data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.asset) {

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.asset.type === <span class="hljs-string">&#x27;Sprite&#x27;</span>) <span class="hljs-built_in">this</span>.checkSpriteFrame(<span class="hljs-built_in">this</span>);
        <span class="hljs-keyword">else</span> {

            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.asset.checkSource) <span class="hljs-built_in">this</span>.asset.checkSource(<span class="hljs-built_in">this</span>.sourceNaturalWidth, <span class="hljs-built_in">this</span>.sourceNaturalHeight);
            <span class="hljs-keyword">else</span> <span class="hljs-built_in">this</span>.dirtyAsset = <span class="hljs-literal">true</span>;
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p> See the <a href="http://localhost:8080/docs/source/mixin/entity.html#section-31">entity mixin function</a> for details on the following checks and actions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyDimensions || <span class="hljs-built_in">this</span>.dirtyHandle || <span class="hljs-built_in">this</span>.dirtyScale) <span class="hljs-built_in">this</span>.dirtyPaste = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyScale || <span class="hljs-built_in">this</span>.dirtyDimensions || <span class="hljs-built_in">this</span>.dirtyStart || <span class="hljs-built_in">this</span>.dirtyOffset || <span class="hljs-built_in">this</span>.dirtyHandle) <span class="hljs-built_in">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyScale) <span class="hljs-built_in">this</span>.cleanScale();
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyDimensions) <span class="hljs-built_in">this</span>.cleanDimensions();
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyLock) <span class="hljs-built_in">this</span>.cleanLock();
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyStart) <span class="hljs-built_in">this</span>.cleanStart();
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyOffset) <span class="hljs-built_in">this</span>.cleanOffset();
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyHandle) <span class="hljs-built_in">this</span>.cleanHandle();
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyRotation) <span class="hljs-built_in">this</span>.cleanRotation();

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.isBeingDragged || <span class="hljs-built_in">this</span>.lockTo.indexOf(<span class="hljs-string">&#x27;mouse&#x27;</span>) &gt;= <span class="hljs-number">0</span> || <span class="hljs-built_in">this</span>.lockTo.indexOf(<span class="hljs-string">&#x27;particle&#x27;</span>) &gt;= <span class="hljs-number">0</span>) {

        <span class="hljs-built_in">this</span>.dirtyStampPositions = <span class="hljs-literal">true</span>;
        <span class="hljs-built_in">this</span>.dirtyStampHandlePositions = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyStampPositions) <span class="hljs-built_in">this</span>.cleanStampPositions();
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyStampHandlePositions) <span class="hljs-built_in">this</span>.cleanStampHandlePositions();

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyCopyStart) <span class="hljs-built_in">this</span>.cleanCopyStart();
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyCopyDimensions) <span class="hljs-built_in">this</span>.cleanCopyDimensions();
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyImage) <span class="hljs-built_in">this</span>.cleanImage();
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyPaste) <span class="hljs-built_in">this</span>.preparePasteObject();

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyPathObject) <span class="hljs-built_in">this</span>.cleanPathObject();</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Update artefacts subscribed to this artefact (using it as their pivot or mimic source), if required</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyPositionSubscribers) <span class="hljs-built_in">this</span>.updatePositionSubscribers();</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Specifically for Loom entitys</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.dirtyImageSubscribers) <span class="hljs-built_in">this</span>.updateImageSubscribers();
};</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p><code>preparePasteObject</code> - internal function</p>
<ul>
<li>the <strong>pasteArray</strong> is a convenience Array containing start coordinate and dimensions data, which we can quickly add to the render engine’s drawImage function (which gets called many times)</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.preparePasteObject = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-built_in">this</span>.dirtyPaste = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">let</span> handle = <span class="hljs-built_in">this</span>.currentStampHandlePosition,
        dims = <span class="hljs-built_in">this</span>.currentDimensions,
        scale = <span class="hljs-built_in">this</span>.currentScale;

    <span class="hljs-keyword">let</span> x = -handle[<span class="hljs-number">0</span>] * scale,
        y = -handle[<span class="hljs-number">1</span>] * scale,
        w = dims[<span class="hljs-number">0</span>] * scale,
        h = dims[<span class="hljs-number">1</span>] * scale;

    <span class="hljs-keyword">let</span> pasteArray = <span class="hljs-built_in">this</span>.pasteArray;

    pasteArray.length = <span class="hljs-number">0</span>;
    pasteArray.push(x, y, w, h);

    <span class="hljs-built_in">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p><code>cleanPathObject</code> - internal function</p>
<ul>
<li>For Picture entitys, the pathObject is a rectangle</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cleanPathObject = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-built_in">this</span>.dirtyPathObject = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.noPathUpdates || !<span class="hljs-built_in">this</span>.pathObject) {

        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.pasteArray) <span class="hljs-built_in">this</span>.preparePasteObject();

        <span class="hljs-keyword">let</span> p = <span class="hljs-built_in">this</span>.pathObject = <span class="hljs-keyword">new</span> Path2D();

        p.rect(...this.pasteArray);
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <h5 id="stamp-methods">Stamp methods</h5>

            </div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p><code>draw</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.draw = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine</span>) </span>{

    engine.stroke(<span class="hljs-built_in">this</span>.pathObject);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p><code>fill</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.fill = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.source) engine.drawImage(<span class="hljs-built_in">this</span>.source, ...this.copyArray, ...this.pasteArray);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p><code>drawAndFill</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.drawAndFill = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine</span>) </span>{

    engine.stroke(<span class="hljs-built_in">this</span>.pathObject);

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.source) {

        <span class="hljs-built_in">this</span>.currentHost.clearShadow();
        engine.drawImage(<span class="hljs-built_in">this</span>.source, ...this.copyArray, ...this.pasteArray);
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p><code>fillAndDraw</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.fillAndDraw = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine</span>) </span>{

    engine.stroke(<span class="hljs-built_in">this</span>.pathObject);

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.source) {

        <span class="hljs-built_in">this</span>.currentHost.clearShadow();
        engine.drawImage(<span class="hljs-built_in">this</span>.source, ...this.copyArray, ...this.pasteArray);
    }
    engine.stroke(<span class="hljs-built_in">this</span>.pathObject);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p><code>drawThenFill</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.drawThenFill = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine</span>) </span>{

    engine.stroke(<span class="hljs-built_in">this</span>.pathObject);
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.source) engine.drawImage(<span class="hljs-built_in">this</span>.source, ...this.copyArray, ...this.pasteArray);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p><code>fillThenDraw</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.fillThenDraw = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.source) engine.drawImage(<span class="hljs-built_in">this</span>.source, ...this.copyArray, ...this.pasteArray);
    engine.stroke(<span class="hljs-built_in">this</span>.pathObject);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p><code>checkHitReturn</code> - overwrites mixin/position.js function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.checkHitReturn = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y, cell</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.checkHitIgnoreTransparency &amp;&amp; cell &amp;&amp; cell.engine) {

        <span class="hljs-keyword">let</span> [copyX, copyY, copyWidth, copyHeight] = <span class="hljs-built_in">this</span>.copyArray;
        <span class="hljs-keyword">let</span> [pasteX, pasteY, pasteWidth, pasteHeight] = <span class="hljs-built_in">this</span>.pasteArray;
        <span class="hljs-keyword">let</span> [stampX, stampY] = <span class="hljs-built_in">this</span>.currentStampPosition;

        <span class="hljs-keyword">let</span> img = cell.engine.getImageData(copyX, copyY, copyWidth, copyHeight);

        <span class="hljs-keyword">let</span> myX = x - stampX,
            myY = y - stampY;

        <span class="hljs-keyword">let</span> index = (((myY * pasteWidth) + myX) * <span class="hljs-number">4</span>) + <span class="hljs-number">3</span>;

        <span class="hljs-keyword">if</span> (img.data[index]) {

            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">x</span>: x,
                <span class="hljs-attr">y</span>: y,
                <span class="hljs-attr">artefact</span>: <span class="hljs-built_in">this</span>
            };
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-keyword">else</span> {

        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">x</span>: x,
            <span class="hljs-attr">y</span>: y,
            <span class="hljs-attr">artefact</span>: <span class="hljs-built_in">this</span>
        };
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <h4 id="factory">Factory</h4>
<pre><code>scrawl.importDomImage(<span class="hljs-string">&#x27;.flowers&#x27;</span>);

scrawl.makePicture({

    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;myFlower&#x27;</span>,
    <span class="hljs-attr">asset</span>: <span class="hljs-string">&#x27;iris&#x27;</span>,

    <span class="hljs-attr">width</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">200</span>,

    <span class="hljs-attr">startX</span>: <span class="hljs-number">300</span>,
    <span class="hljs-attr">startY</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">handleX</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">handleY</span>: <span class="hljs-number">100</span>,

    <span class="hljs-attr">copyWidth</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">copyHeight</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">copyStartX</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">copyStartY</span>: <span class="hljs-number">100</span>,

    <span class="hljs-attr">lineWidth</span>: <span class="hljs-number">10</span>,
    <span class="hljs-attr">strokeStyle</span>: <span class="hljs-string">&#x27;gold&#x27;</span>,

    <span class="hljs-attr">order</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;drawAndFill&#x27;</span>,

}).clone({

    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;myFactory&#x27;</span>,
    <span class="hljs-attr">imageSource</span>: <span class="hljs-string">&#x27;img/canalFactory-800.png&#x27;</span>,

    <span class="hljs-attr">width</span>: <span class="hljs-number">600</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">400</span>,

    <span class="hljs-attr">startX</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">startY</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">handleX</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">handleY</span>: <span class="hljs-number">0</span>,

    <span class="hljs-attr">copyWidth</span>: <span class="hljs-number">600</span>,
    <span class="hljs-attr">copyHeight</span>: <span class="hljs-number">400</span>,
    <span class="hljs-attr">copyStartX</span>: <span class="hljs-number">150</span>,
    <span class="hljs-attr">copyStartY</span>: <span class="hljs-number">0</span>,

    <span class="hljs-attr">order</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;fill&#x27;</span>,
});</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> makePicture = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Picture(items);
};

<span class="hljs-title">constructors</span>.<span class="hljs-title">Picture</span> = <span class="hljs-title">Picture</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <h4 id="exports">Exports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> {
    makePicture,
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
