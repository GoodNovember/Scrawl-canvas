<!DOCTYPE html>

<html>
<head>
  <title>filter-string.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../core/animationloop.html">
                  ./source/core/animationloop.js
                </a>
              
                
                <a class="source" href="../core/component.html">
                  ./source/core/component.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/events.html">
                  ./source/core/events.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/userInteraction.html">
                  ./source/core/userInteraction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="../factory/action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="../factory/anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="../factory/animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="../factory/bezier.html">
                  ./source/factory/bezier.js
                </a>
              
                
                <a class="source" href="../factory/block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="../factory/canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="../factory/cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="../factory/cog.html">
                  ./source/factory/cog.js
                </a>
              
                
                <a class="source" href="../factory/color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="../factory/coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="../factory/element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="../factory/emitter.html">
                  ./source/factory/emitter.js
                </a>
              
                
                <a class="source" href="../factory/filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="../factory/fontAttributes.html">
                  ./source/factory/fontAttributes.js
                </a>
              
                
                <a class="source" href="../factory/gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="../factory/grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="../factory/group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="../factory/imageAsset.html">
                  ./source/factory/imageAsset.js
                </a>
              
                
                <a class="source" href="../factory/line.html">
                  ./source/factory/line.js
                </a>
              
                
                <a class="source" href="../factory/loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="../factory/mesh.html">
                  ./source/factory/mesh.js
                </a>
              
                
                <a class="source" href="../factory/net.html">
                  ./source/factory/net.js
                </a>
              
                
                <a class="source" href="../factory/noise.html">
                  ./source/factory/noise.js
                </a>
              
                
                <a class="source" href="../factory/oval.html">
                  ./source/factory/oval.js
                </a>
              
                
                <a class="source" href="../factory/palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="../factory/particle.html">
                  ./source/factory/particle.js
                </a>
              
                
                <a class="source" href="../factory/particleForce.html">
                  ./source/factory/particleForce.js
                </a>
              
                
                <a class="source" href="../factory/particleHistory.html">
                  ./source/factory/particleHistory.js
                </a>
              
                
                <a class="source" href="../factory/particleSpring.html">
                  ./source/factory/particleSpring.js
                </a>
              
                
                <a class="source" href="../factory/particleWorld.html">
                  ./source/factory/particleWorld.js
                </a>
              
                
                <a class="source" href="../factory/pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="../factory/phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="../factory/picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="../factory/polygon.html">
                  ./source/factory/polygon.js
                </a>
              
                
                <a class="source" href="../factory/polyline.html">
                  ./source/factory/polyline.js
                </a>
              
                
                <a class="source" href="../factory/quadratic.html">
                  ./source/factory/quadratic.js
                </a>
              
                
                <a class="source" href="../factory/quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="../factory/radialGradient.html">
                  ./source/factory/radialGradient.js
                </a>
              
                
                <a class="source" href="../factory/rectangle.html">
                  ./source/factory/rectangle.js
                </a>
              
                
                <a class="source" href="../factory/renderAnimation.html">
                  ./source/factory/renderAnimation.js
                </a>
              
                
                <a class="source" href="../factory/shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="../factory/spiral.html">
                  ./source/factory/spiral.js
                </a>
              
                
                <a class="source" href="../factory/spriteAsset.html">
                  ./source/factory/spriteAsset.js
                </a>
              
                
                <a class="source" href="../factory/stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="../factory/star.html">
                  ./source/factory/star.js
                </a>
              
                
                <a class="source" href="../factory/state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="../factory/tetragon.html">
                  ./source/factory/tetragon.js
                </a>
              
                
                <a class="source" href="../factory/ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="../factory/tracer.html">
                  ./source/factory/tracer.js
                </a>
              
                
                <a class="source" href="../factory/tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="../factory/unstackedElement.html">
                  ./source/factory/unstackedElement.js
                </a>
              
                
                <a class="source" href="../factory/vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="../factory/videoAsset.html">
                  ./source/factory/videoAsset.js
                </a>
              
                
                <a class="source" href="../factory/wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="../mixin/anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="../mixin/asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="../mixin/assetConsumer.html">
                  ./source/mixin/assetConsumer.js
                </a>
              
                
                <a class="source" href="../mixin/base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="../mixin/cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="../mixin/delta.html">
                  ./source/mixin/delta.js
                </a>
              
                
                <a class="source" href="../mixin/displayShape.html">
                  ./source/mixin/displayShape.js
                </a>
              
                
                <a class="source" href="../mixin/dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="../mixin/entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="../mixin/filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="../mixin/mimic.html">
                  ./source/mixin/mimic.js
                </a>
              
                
                <a class="source" href="../mixin/path.html">
                  ./source/mixin/path.js
                </a>
              
                
                <a class="source" href="../mixin/pattern.html">
                  ./source/mixin/pattern.js
                </a>
              
                
                <a class="source" href="../mixin/pivot.html">
                  ./source/mixin/pivot.js
                </a>
              
                
                <a class="source" href="../mixin/position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="../mixin/shapeBasic.html">
                  ./source/mixin/shapeBasic.js
                </a>
              
                
                <a class="source" href="../mixin/shapeCurve.html">
                  ./source/mixin/shapeCurve.js
                </a>
              
                
                <a class="source" href="../mixin/shapePathCalculation.html">
                  ./source/mixin/shapePathCalculation.js
                </a>
              
                
                <a class="source" href="../mixin/styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="../mixin/tween.html">
                  ./source/mixin/tween.js
                </a>
              
                
                <a class="source" href="filter-string.html">
                  ./source/worker/filter-string.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/worker/filter.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>filter-string.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>Compressed using <a href="https://javascript-minifier.com/">https://javascript-minifier.com/</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> filterCode = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;let packet,packetFiltersArray,source,work,cache,actions,workstore={},workstoreLastAccessed={};const createResultObject=function(e){return{r:new Uint8ClampedArray(e),g:new Uint8ClampedArray(e),b:new Uint8ClampedArray(e),a:new Uint8ClampedArray(e)}},unknit=function(e){let t=e.data,l=Math.floor(t.length/4);source=createResultObject(l),e.channels=source;let n=source.r,r=source.g,o=source.b,s=source.a,u=(work=createResultObject(l)).r,a=work.g,c=work.b,i=work.a,f=0;for(let e=0,l=t.length;e&lt;l;e+=4)n[f]=t[e],r[f]=t[e+1],o[f]=t[e+2],s[f]=t[e+3],u[f]=t[e],a[f]=t[e+1],c[f]=t[e+2],i[f]=t[e+3],f++},knit=function(){let e=packet.image.data,t=work.r,l=work.g,n=work.b,r=work.a,o=0;for(let s=0,u=e.length;s&lt;u;s+=4)e[s]=t[o],e[s+1]=l[o],e[s+2]=n[o],e[s+3]=r[o],o++};onmessage=function(e){packet=e.data,packetFiltersArray=packet.filters;let t=Object.keys(workstore),l=Date.now()-3e3;t.forEach(e=&gt;{workstoreLastAccessed[e]&lt;l&amp;&amp;(delete workstore[e],delete workstoreLastAccessed[e])}),actions=[],(cache={}).source=packet.image,packetFiltersArray.forEach(e=&gt;actions.push(...e.actions)),actions.length&amp;&amp;(unknit(cache.source),actions.forEach(e=&gt;theBigActionsObject[e.action]&amp;&amp;theBigActionsObject[e.action](e)),knit()),postMessage(packet)},onerror=function(e){console.log(&quot;error&quot;+e.message),postMessage(packet)};const buildImageGrid=function(e){if(e||(e=cache.source),e&amp;&amp;e.width&amp;&amp;e.height){let t=`grid-${e.width}-${e.height}`;if(workstore[t])return workstoreLastAccessed[t]=Date.now(),workstore[t];let l=[],n=0;for(let t=0,r=e.height;t&lt;r;t++){let t=[];for(let l=0,r=e.width;l&lt;r;l++)t.push(n),n++;l.push(t)}return workstore[t]=l,workstoreLastAccessed[t]=Date.now(),l}return!1},buildAlphaTileSets=function(e,t,l,n,r,o,s,u){if(u||(u=cache.source),u&amp;&amp;u.width&amp;&amp;u.height){let s=u.width,a=u.height;(e=e.toFixed&amp;&amp;!isNaN(e)?e:1)&lt;1&amp;&amp;(e=1),(t=t.toFixed&amp;&amp;!isNaN(t)?t:1)&lt;1&amp;&amp;(t=1),e+(l=l.toFixed&amp;&amp;!isNaN(l)?l:1)&gt;=s&amp;&amp;(e=s-l-1),t+(n=n.toFixed&amp;&amp;!isNaN(n)?n:1)&gt;=a&amp;&amp;(t=a-n-1),e&lt;1&amp;&amp;(e=1),t&lt;1&amp;&amp;(t=1),e+l&gt;=s&amp;&amp;(l=s-e-1),t+n&gt;=a&amp;&amp;(n=a-t-1);let c=e+l,i=t+n;(r=r.toFixed&amp;&amp;!isNaN(r)?r:0)&lt;0&amp;&amp;(r=0),r&gt;=c&amp;&amp;(r=c-1),(o=o.toFixed&amp;&amp;!isNaN(o)?o:0)&lt;0&amp;&amp;(o=0),o&gt;=i&amp;&amp;(o=i-1);let f=`alphatileset-${s}-${a}-${e}-${t}-${l}-${n}-${r}-${o}`;if(workstore[f])return workstoreLastAccessed[f]=Date.now(),workstore[f];let h,g,p,d,b,k,w,R=[];for(d=o-i,b=a;d&lt;b;d+=i)for(g=r-c,p=s;g&lt;p;g+=c){for(h=[],k=d,w=d+t;k&lt;w;k++)if(k&gt;=0&amp;&amp;k&lt;a)for(let t=g,l=g+e;t&lt;l;t++)t&gt;=0&amp;&amp;t&lt;s&amp;&amp;h.push(k*s+t);for(R.push([].concat(h)),h=[],k=d+t,w=d+t+n;k&lt;w;k++)if(k&gt;=0&amp;&amp;k&lt;a)for(let t=g,l=g+e;t&lt;l;t++)t&gt;=0&amp;&amp;t&lt;s&amp;&amp;h.push(k*s+t);for(R.push([].concat(h)),h=[],k=d,w=d+t;k&lt;w;k++)if(k&gt;=0&amp;&amp;k&lt;a)for(let t=g+e,n=g+e+l;t&lt;n;t++)t&gt;=0&amp;&amp;t&lt;s&amp;&amp;h.push(k*s+t);for(R.push([].concat(h)),h=[],k=d+t,w=d+t+n;k&lt;w;k++)if(k&gt;=0&amp;&amp;k&lt;a)for(let t=g+e,n=g+e+l;t&lt;n;t++)t&gt;=0&amp;&amp;t&lt;s&amp;&amp;h.push(k*s+t);R.push([].concat(h))}return workstore[f]=R,workstoreLastAccessed[f]=Date.now(),R}return!1},buildImageTileSets=function(e,t,l,n,r){if(r||(r=cache.source),r&amp;&amp;r.width&amp;&amp;r.height){let o=r.width,s=r.height;(e=e.toFixed&amp;&amp;!isNaN(e)?e:1)&lt;1&amp;&amp;(e=1),e&gt;=o&amp;&amp;(e=o-1),(t=t.toFixed&amp;&amp;!isNaN(t)?t:1)&lt;1&amp;&amp;(t=1),t&gt;=s&amp;&amp;(t=s-1),(l=l.toFixed&amp;&amp;!isNaN(l)?l:0)&lt;0&amp;&amp;(l=0),l&gt;=e&amp;&amp;(l=e-1),(n=n.toFixed&amp;&amp;!isNaN(n)?n:0)&lt;0&amp;&amp;(n=0),n&gt;=t&amp;&amp;(n=t-1);let u=`imagetileset-${o}-${s}-${e}-${t}-${l}-${n}`;if(workstore[u])return workstoreLastAccessed[u]=Date.now(),workstore[u];let a=[];for(let r=n-t,u=s;r&lt;u;r+=t)for(let n=l-e,u=o;n&lt;u;n+=e){let l=[];for(y=r,yz=r+t;y&lt;yz;y++)if(y&gt;=0&amp;&amp;y&lt;s)for(let t=n,r=n+e;t&lt;r;t++)t&gt;=0&amp;&amp;t&lt;o&amp;&amp;l.push(y*o+t);l.length&amp;&amp;a.push(l)}return workstore[u]=a,workstoreLastAccessed[u]=Date.now(),a}return!1},buildHorizontalBlur=function(e,t,l){t&amp;&amp;t.toFixed&amp;&amp;!isNaN(t)||(t=0);let n=e.length,r=e[0].length,o=`blur-h-${r}-${n}-${t}`;if(workstore[o])return workstoreLastAccessed[o]=Date.now(),workstore[o];let s=[];for(let l=0;l&lt;n;l++)for(let o=0;o&lt;r;o++){let u=[];for(let n=o-t,s=o+t+1;n&lt;s;n++)n&gt;=0&amp;&amp;n&lt;r&amp;&amp;u.push(e[l][n]);s[l*n+o]=u}return workstore[o]=s,workstoreLastAccessed[o]=Date.now(),s},buildVerticalBlur=function(e,t,l){t&amp;&amp;t.toFixed&amp;&amp;!isNaN(t)||(t=0);let n=e.length,r=e[0].length,o=`blur-v-${r}-${n}-${t}`;if(workstore[o])return workstoreLastAccessed[o]=Date.now(),workstore[o];let s=[];for(let l=0;l&lt;r;l++)for(let r=0;r&lt;n;r++){let o=[];for(let s=r-t,u=r+t+1;s&lt;u;s++)s&gt;=0&amp;&amp;s&lt;n&amp;&amp;o.push(e[s][l]);s[r*n+l]=o}return workstore[o]=s,workstoreLastAccessed[o]=Date.now(),s},buildMatrixGrid=function(e,t,l,n,r,o){o||(o=cache.source),(null==e||e&lt;1)&amp;&amp;(e=1),(null==t||t&lt;1)&amp;&amp;(t=1),null==l||l&lt;0?l=0:l&gt;=e&amp;&amp;(l=e-1),null==n||n&lt;0?n=0:n&gt;=t&amp;&amp;(n=t-1);let s=o.width,u=o.height,a=`matrix-${s}-${u}-${e}-${t}-${l}-${n}`;if(workstore[a])return workstoreLastAccessed[a]=Date.now(),workstore[a];let c,i,f,h,g,p,d=o.data.length,b=[],k=[];for(f=-n,h=t-n;f&lt;h;f++)for(c=-l,i=e-l;c&lt;i;c++)b.push(f*s+c);for(f=0;f&lt;u;f++)for(c=0;c&lt;s;c++){let e=f*s+c,t=[];for(g=0,p=b.length;g&lt;p;g++){let l=e+b[g];l&lt;0?l+=d:l&gt;=d&amp;&amp;(l-=d),t.push(l)}k.push(t)}return workstore[a]=k,workstoreLastAccessed[a]=Date.now(),k},checkChannelLevelsParameters=function(e){const t=function(e,t=!1){if(e.toFixed)return e&lt;0?[[0,255,0]]:e&gt;255?[[0,255,255]]:isNaN(e)?t?[[0,255,255]]:[[0,255,0]]:[[0,255,e]];if(e.substring&amp;&amp;(e=e.split(&quot;,&quot;)),Array.isArray(e)){if(!e.length)return e;if(Array.isArray(e[0]))return e;if((e=e.map(e=&gt;parseInt(e,10))).sort((e,t)=&gt;e-t),1==e.length)return[[0,255,e[0]]];let t,l,n=[];for(let r=0,o=e.length;r&lt;o;r++)t=0,l=255,0!=r&amp;&amp;(t=Math.ceil(e[r-1]+(e[r]-e[r-1])/2)),r!=o-1&amp;&amp;(l=Math.floor(e[r]+(e[r+1]-e[r])/2)),n.push([t,l,e[r]]);return n}return t?[[0,255,255]]:[[0,255,0]]};e.red=t(e.red),e.green=t(e.green),e.blue=t(e.blue),e.alpha=t(e.alpha,!0)},cacheOutput=function(e,t,l){cache[e]=t},copyOver=function(e,t){let{r:l,g:n,b:r,a:o}=e,{r:s,g:u,b:a,a:c}=t;for(let e=0;e&lt;l.length;e++)s[e]=l[e],u[e]=n[e],a[e]=r[e],c[e]=o[e]},getInputAndOutputDimensions=function(e){let t=cache.source,l=[];return e.lineIn&amp;&amp;&quot;source&quot;!=e.lineIn&amp;&amp;&quot;source-alpha&quot;!=e.lineIn&amp;&amp;cache[e.lineIn]&amp;&amp;(t=cache[e.lineIn]),l.push(t.width,t.height),e.lineOut&amp;&amp;cache[e.lineOut]&amp;&amp;(t=cache[e.lineOut]),l.push(t.width,t.height),t=cache.source,e.lineMix&amp;&amp;&quot;source&quot;!=e.lineMix&amp;&amp;&quot;source-alpha&quot;!=e.lineMix&amp;&amp;cache[e.lineMix]&amp;&amp;(t=cache[e.lineMix]),l.push(t.width,t.height),l},getInputAndOutputChannels=function(e){let t=work,l=t.r.length,n=cache.source;if(e.lineIn)if(&quot;source&quot;==e.lineIn)t=n.channels;else if(&quot;source-alpha&quot;==e.lineIn){let e=(t=createResultObject(l)).a,r=n.channels.a;for(let t=0;t&lt;l;t++)e[t]=r[t]}else cache[e.lineIn]&amp;&amp;(t=(n=cache[e.lineIn]).channels);let r,o=!1;if(e.lineMix)if(&quot;source&quot;==e.lineMix)o=cache.source.channels;else if(&quot;source-alpha&quot;==e.lineMix){let e=(o=createResultObject(l)).a,t=cache.source.channels.a;for(let n=0;n&lt;l;n++)e[n]=t[n]}else cache[e.lineMix]&amp;&amp;(o=cache[e.lineMix].channels);return e.lineOut?cache[e.lineOut]?r=cache[e.lineOut].channels:(r=createResultObject(l),cache[e.lineOut]={width:n.width,height:n.height,channels:r}):r=createResultObject(l),[t,r,o]},processResults=function(e,t,l){let n=e.r,r=e.g,o=e.b,s=e.a,u=t.r,a=t.g,c=t.b,i=t.a;if(1===l)copyOver(t,e);else if(l&gt;0){antiRatio=1-l;for(let e=0,t=n.length;e&lt;t;e++)n[e]=Math.floor(n[e]*antiRatio+u[e]*l),r[e]=Math.floor(r[e]*antiRatio+a[e]*l),o[e]=Math.floor(o[e]*antiRatio+c[e]*l),s[e]=Math.floor(s[e]*antiRatio+i[e]*l)}},getHSLfromRGB=function(e,t,l){let n=Math.min(e,t,l),r=Math.max(e,t,l),o=(n+r)/2,s=0;n!==r&amp;&amp;(s=o&lt;=.5?(r-n)/(r+n):(r-n)/(2-r-n));let u=0;return u=r===e?(t-l)/(r-n):r===t?2+(l-e)/(r-n):4+(e-t)/(r-n),(u*=60)&lt;0&amp;&amp;(u+=360),[u,s,o]},getRGBfromHSL=function(e,t,l){if(!t){let e=Math.floor(255*l);return[e,e,e]}let n=l&lt;.5?l*(t+1):l+t-l*t,r=2*l-n;const o=function(e,t,l){return 6*e&lt;1?l+6*(t-l)*e:2*e&lt;1?t:2*e&lt;2?l+6*(t-l)*(.666*e):l};let s=(e/=360)+.333,u=e,a=e-.333;return s&lt;0&amp;&amp;(s+=1),s&gt;1&amp;&amp;(s-=1),u&lt;0&amp;&amp;(u+=1),u&gt;1&amp;&amp;(u-=1),a&lt;0&amp;&amp;(a+=1),a&gt;1&amp;&amp;(a-=1),[255*o(s,n,r),255*o(u,n,r),255*o(a,n,r)]},theBigActionsObject={&quot;alpha-to-channels&quot;:function(e){let[t,l]=getInputAndOutputChannels(e),n=t.r.length,{opacity:r,includeRed:o,includeGreen:s,includeBlue:u,excludeRed:a,excludeGreen:c,excludeBlue:i,lineOut:f}=e;null==r&amp;&amp;(r=1),null==o&amp;&amp;(o=!0),null==s&amp;&amp;(s=!0),null==u&amp;&amp;(u=!0),null==a&amp;&amp;(a=!0),null==c&amp;&amp;(c=!0),null==i&amp;&amp;(i=!0);const{r:h,g:g,b:p,a:d}=t,{r:b,g:k,b:w,a:R}=l;for(let e=0;e&lt;n;e++)b[e]=o?d[e]:a?0:h[e],k[e]=s?d[e]:c?0:g[e],w[e]=u?d[e]:i?0:p[e];R.fill(255,0,R.length-1),f?processResults(l,work,1-r):processResults(work,l,r)},&quot;area-alpha&quot;:function(e){let[t,l]=getInputAndOutputChannels(e),n=t.r.length,{opacity:r,tileWidth:o,tileHeight:s,offsetX:u,offsetY:a,gutterWidth:c,gutterHeight:i,areaAlphaLevels:f,lineOut:h}=e;null==r&amp;&amp;(r=1),null==o&amp;&amp;(o=1),null==s&amp;&amp;(s=1),null==u&amp;&amp;(u=0),null==a&amp;&amp;(a=0),null==c&amp;&amp;(c=1),null==i&amp;&amp;(i=1),null==f&amp;&amp;(f=[255,0,0,0]);let g=buildAlphaTileSets(o,s,c,i,u,a);Array.isArray(f)||(f=[255,0,0,0]);const{r:p,g:d,b:b,a:k}=t,{r:w,g:R,b:O,a:A}=l;for(let e=0;e&lt;n;e++)w[e]=p[e],R[e]=d[e],O[e]=b[e];g.forEach((e,t)=&gt;{for(let l=0,n=e.length;l&lt;n;l++)k[e[l]]&amp;&amp;(A[e[l]]=f[t%4])}),h?processResults(l,work,1-r):processResults(work,l,r)},&quot;average-channels&quot;:function(e){let[t,l]=getInputAndOutputChannels(e),n=t.r.length,{opacity:r,includeRed:o,includeGreen:s,includeBlue:u,excludeRed:a,excludeGreen:c,excludeBlue:i,lineOut:f}=e;null==r&amp;&amp;(r=1),null==o&amp;&amp;(o=!0),null==s&amp;&amp;(s=!0),null==u&amp;&amp;(u=!0),null==a&amp;&amp;(a=!1),null==c&amp;&amp;(c=!1),null==i&amp;&amp;(i=!1);let h=0;o&amp;&amp;h++,s&amp;&amp;h++,u&amp;&amp;h++;const{r:g,g:p,b:d,a:b}=t,{r:k,g:w,b:R,a:O}=l;for(let e=0;e&lt;n;e++)if(b[e])if(h){let t=0;o&amp;&amp;(t+=g[e]),s&amp;&amp;(t+=p[e]),u&amp;&amp;(t+=d[e]),t=Math.floor(t/h),k[e]=a?0:t,w[e]=c?0:t,R[e]=i?0:t,O[e]=b[e]}else k[e]=a?0:g[e],w[e]=c?0:p[e],R[e]=i?0:d[e],O[e]=b[e];else k[e]=g[e],w[e]=p[e],R[e]=d[e],O[e]=b[e];f?processResults(l,work,1-r):processResults(work,l,r)},binary:function(e){let[t,l]=getInputAndOutputChannels(e),n=t.r.length,{opacity:r,red:o,green:s,blue:u,alpha:a,lineOut:c}=e;null==r&amp;&amp;(r=1),null==o&amp;&amp;(o=0),null==s&amp;&amp;(s=0),null==u&amp;&amp;(u=0),null==a&amp;&amp;(a=0);const{r:i,g:f,b:h,a:g}=t,{r:p,g:d,b:b,a:k}=l;for(let e=0;e&lt;n;e++)p[e]=o?i[e]&gt;o?255:0:i[e],d[e]=s?f[e]&gt;s?255:0:f[e],b[e]=u?h[e]&gt;u?255:0:h[e],k[e]=a?g[e]&gt;a?255:0:g[e];c?processResults(l,work,1-r):processResults(work,l,r)},blend:function(e){let[t,l,n]=getInputAndOutputChannels(e),{opacity:r,blend:o,offsetX:s,offsetY:u,lineOut:a}=(l.r.length,e);null==r&amp;&amp;(r=1),null==o&amp;&amp;(o=&quot;&quot;),null==s&amp;&amp;(s=0),null==u&amp;&amp;(u=0);const{r:c,g:i,b:f,a:h}=t,{r:g,g:p,b:d,a:b}=l,{r:k,g:w,b:R,a:O}=n;let[A,y,I,m,M,x]=getInputAndOutputDimensions(e);const B=function(e,t,l){g[t]=l.r[e],p[t]=l.g[e],d[t]=l.b[e],b[t]=l.a[e]},G=function(e,t){let l=e-s,n=t-u,r=-1;return l&gt;=0&amp;&amp;l&lt;M&amp;&amp;n&gt;=0&amp;&amp;n&lt;x&amp;&amp;(r=n*M+l),[t*A+e,r]},C=function(e,l){return[t.r[e]/255,t.g[e]/255,t.b[e]/255,t.a[e]/255,n.r[l]/255,n.g[l]/255,n.b[l]/255,n.a[l]/255]},L=(e,t)=&gt;255*(e+t*(1-e));switch(o){case&quot;color-burn&quot;:const e=(e,t)=&gt;1==t?255:0==e?0:255*(1-Math.min(1,(1-t)/e));for(let l=0;l&lt;y;l++)for(let r=0;r&lt;A;r++){let[o,s]=G(r,l);if(s&lt;0)B(o,o,t);else if(h[o])if(O[s]){let[t,l,n,r,u,a,c,i]=C(o,s);g[o]=e(t,u),p[o]=e(l,a),d[o]=e(n,c),b[o]=L(r,i)}else B(o,o,t);else B(s,o,n)}break;case&quot;color-dodge&quot;:const l=(e,t)=&gt;0==t?0:1==e?255:255*Math.min(1,t/(1-e));for(let e=0;e&lt;y;e++)for(let r=0;r&lt;A;r++){let[o,s]=G(r,e);if(s&lt;0)B(o,o,t);else if(h[o])if(O[s]){let[e,t,n,r,u,a,c,i]=C(o,s);g[o]=l(e,u),p[o]=l(t,a),d[o]=l(n,c),b[o]=L(r,i)}else B(o,o,t);else B(s,o,n)}break;case&quot;darken&quot;:const r=(e,t)=&gt;e&lt;t?e:t;for(let e=0;e&lt;y;e++)for(let l=0;l&lt;A;l++){let[o,s]=G(l,e);s&lt;0?B(o,o,t):h[o]?O[s]?(g[o]=r(c[o],k[s]),p[o]=r(i[o],w[s]),d[o]=r(f[o],R[s]),b[o]=L(h[o]/255,O[s]/255)):B(o,o,t):B(s,o,n)}break;case&quot;difference&quot;:const s=(e,t)=&gt;255*Math.abs(e-t);for(let e=0;e&lt;y;e++)for(let l=0;l&lt;A;l++){let[r,o]=G(l,e);if(o&lt;0)B(r,r,t);else if(h[r]){let[e,t,l,n,u,a,c,i]=C(r,o);g[r]=s(e,u),p[r]=s(t,a),d[r]=s(l,c),b[r]=L(n,i)}else B(o,r,n)}break;case&quot;exclusion&quot;:const u=(e,t)=&gt;255*(e+t-2*t*e);for(let e=0;e&lt;y;e++)for(let l=0;l&lt;A;l++){let[r,o]=G(l,e);if(o&lt;0)B(r,r,t);else if(h[r]){let[e,t,l,n,s,a,c,i]=C(r,o);g[r]=u(e,s),p[r]=u(t,a),d[r]=u(l,c),b[r]=L(n,i)}else B(o,r,n)}break;case&quot;hard-light&quot;:const a=(e,t)=&gt;e&lt;=.5?e*t*255:255*(t+(e-t*e));for(let e=0;e&lt;y;e++)for(let l=0;l&lt;A;l++){let[r,o]=G(l,e);if(o&lt;0)B(r,r,t);else if(h[r]){let[e,t,l,n,s,u,c,i]=C(r,o);g[r]=a(e,s),p[r]=a(t,u),d[r]=a(l,c),b[r]=L(n,i)}else B(o,r,n)}break;case&quot;lighten&quot;:const I=(e,t)=&gt;e&gt;t?e:t;for(let e=0;e&lt;y;e++)for(let l=0;l&lt;A;l++){let[r,o]=G(l,e);o&lt;0?B(r,r,t):h[r]?(g[r]=I(c[r],k[o]),p[r]=I(i[r],w[o]),d[r]=I(f[r],R[o]),b[r]=L(h[r]/255,O[o]/255)):B(o,r,n)}break;case&quot;lighter&quot;:const m=(e,t)=&gt;255*(e+t);for(let e=0;e&lt;y;e++)for(let l=0;l&lt;A;l++){let[r,o]=G(l,e);if(o&lt;0)B(r,r,t);else if(h[r]){let[e,t,l,n,s,u,a,c]=C(r,o);g[r]=m(e,s),p[r]=m(t,u),d[r]=m(l,a),b[r]=L(n,c)}else B(o,r,n)}break;case&quot;multiply&quot;:const M=(e,t)=&gt;e*t*255;for(let e=0;e&lt;y;e++)for(let l=0;l&lt;A;l++){let[r,o]=G(l,e);if(o&lt;0)B(r,r,t);else if(h[r])if(O[o]){let[e,t,l,n,s,u,a,c]=C(r,o);g[r]=M(e,s),p[r]=M(t,u),d[r]=M(l,a),b[r]=L(n,c)}else B(r,r,t);else B(o,r,n)}break;case&quot;overlay&quot;:const x=(e,t)=&gt;e&gt;=.5?e*t*255:255*(t+(e-t*e));for(let e=0;e&lt;y;e++)for(let l=0;l&lt;A;l++){let[r,o]=G(l,e);if(o&lt;0)B(r,r,t);else if(h[r]){let[e,t,l,n,s,u,a,c]=C(r,o);g[r]=x(e,s),p[r]=x(t,u),d[r]=x(l,a),b[r]=L(n,c)}else B(o,r,n)}break;case&quot;screen&quot;:const $=(e,t)=&gt;255*(t+(e-t*e));for(let e=0;e&lt;y;e++)for(let l=0;l&lt;A;l++){let[r,o]=G(l,e);if(o&lt;0)B(r,r,t);else if(h[r]){let[e,t,l,n,s,u,a,c]=C(r,o);g[r]=$(e,s),p[r]=$(t,u),d[r]=$(l,a),b[r]=L(n,c)}else B(o,r,n)}break;case&quot;soft-light&quot;:const N=(e,t)=&gt;{let l=t&lt;=.25?((16*t-12)*t+4)*t:Math.sqrt(t);return e&lt;=.5?255*(t-(1-2*e)*t*(1-t)):255*(t+(2*e-1)*(l-t))};for(let e=0;e&lt;y;e++)for(let l=0;l&lt;A;l++){let[r,o]=G(l,e);if(o&lt;0)B(r,r,t);else if(h[r])if(O[o]){let[e,t,l,n,s,u,a,c]=C(r,o);g[r]=N(e,s),p[r]=N(t,u),d[r]=N(l,a),b[r]=L(n,c)}else B(r,r,t);else B(o,r,n)}break;case&quot;color&quot;:const v=(e,t,l,n,r,o)=&gt;{let[s,u,a]=getHSLfromRGB(e,t,l),[c,i,f]=getHSLfromRGB(n,r,o);return getRGBfromHSL(s,u,f)};for(let e=0;e&lt;y;e++)for(let l=0;l&lt;A;l++){let[r,o]=G(l,e);if(o&lt;0)B(r,r,t);else if(h[r])if(O[o]){let[e,t,l,n,s,u,a,c]=C(r,o),[i,f,h]=v(e,t,l,s,u,a);g[r]=i,p[r]=f,d[r]=h,b[r]=L(n,c)}else B(r,r,t);else B(o,r,n)}break;case&quot;hue&quot;:const H=(e,t,l,n,r,o)=&gt;{let[s,u,a]=getHSLfromRGB(e,t,l),[c,i,f]=getHSLfromRGB(n,r,o);return getRGBfromHSL(s,i,f)};for(let e=0;e&lt;y;e++)for(let l=0;l&lt;A;l++){let[r,o]=G(l,e);if(o&lt;0)B(r,r,t);else if(h[r])if(O[o]){let[e,t,l,n,s,u,a,c]=C(r,o),[i,f,h]=H(e,t,l,s,u,a);g[r]=i,p[r]=f,d[r]=h,b[r]=L(n,c)}else B(r,r,t);else B(o,r,n)}break;case&quot;luminosity&quot;:const D=(e,t,l,n,r,o)=&gt;{let[s,u,a]=getHSLfromRGB(e,t,l),[c,i,f]=getHSLfromRGB(n,r,o);return getRGBfromHSL(c,i,a)};for(let e=0;e&lt;y;e++)for(let l=0;l&lt;A;l++){let[r,o]=G(l,e);if(o&lt;0)B(r,r,t);else if(h[r])if(O[o]){let[e,t,l,n,s,u,a,c]=C(r,o),[i,f,h]=D(e,t,l,s,u,a);g[r]=i,p[r]=f,d[r]=h,b[r]=L(n,c)}else B(r,r,t);else B(o,r,n)}break;case&quot;saturation&quot;:const S=(e,t,l,n,r,o)=&gt;{let[s,u,a]=getHSLfromRGB(e,t,l),[c,i,f]=getHSLfromRGB(n,r,o);return getRGBfromHSL(c,u,f)};for(let e=0;e&lt;y;e++)for(let l=0;l&lt;A;l++){let[r,o]=G(l,e);if(o&lt;0)B(r,r,t);else if(h[r])if(O[o]){let[e,t,l,n,s,u,a,c]=C(r,o),[i,f,h]=S(e,t,l,s,u,a);g[r]=i,p[r]=f,d[r]=h,b[r]=L(n,c)}else B(r,r,t);else B(o,r,n)}break;default:const F=(e,t,l,n)=&gt;t*e+n*l*(1-t);for(let e=0;e&lt;y;e++)for(let l=0;l&lt;A;l++){let[r,o]=G(l,e);if(o&lt;0)B(r,r,t);else if(h[r]){let e=h[r]/255,t=O[o]/255;g[r]=F(c[r],e,k[o],t),p[r]=F(i[r],e,w[o],t),d[r]=F(f[r],e,R[o],t),b[r]=L(e,t)}else B(o,r,n)}}a?processResults(l,work,1-r):processResults(work,l,r)},blur:function(e){let t,l,[n,r]=getInputAndOutputChannels(e),o=n.r.length,{opacity:s,radius:u,passes:a,processVertical:c,processHorizontal:i,includeRed:f,includeGreen:h,includeBlue:g,includeAlpha:p,step:d,lineOut:b}=e;if(null==s&amp;&amp;(s=1),null==u&amp;&amp;(u=0),null==a&amp;&amp;(a=1),null==c&amp;&amp;(c=!0),null==i&amp;&amp;(i=!0),null==f&amp;&amp;(f=!0),null==h&amp;&amp;(h=!0),null==g&amp;&amp;(g=!0),null==p&amp;&amp;(p=!1),null==d&amp;&amp;(d=1),i||c){let e=buildImageGrid();i&amp;&amp;(t=buildHorizontalBlur(e,u,n.a)),c&amp;&amp;(l=buildVerticalBlur(e,u,n.a))}const{r:k,g:w,b:R,a:O}=n,{r:A,g:y,b:I,a:m}=r,M=function(e,t,l,n,r){if(e){let e=t[l],o=e.length,s=0,u=0;if(r){for(let t=0;t&lt;o;t+=d)r[e[t]]&amp;&amp;(u+=n[e[t]],s++);return u/s}for(let t=0;t&lt;o;t++)u+=n[e[t]];return u/o}return n[l]};if(a&amp;&amp;(i||c)){const e=createResultObject(o),{r:s,g:u,b:d,a:b}=e;copyOver(n,e);for(let n=0;n&lt;a;n++){if(i){for(let e=0;e&lt;o;e++)(p||b[e])&amp;&amp;(A[e]=M(f,t,e,s,b),y[e]=M(h,t,e,u,b),I[e]=M(g,t,e,d,b),m[e]=M(p,t,e,b,!1));(c||n&lt;a-1)&amp;&amp;copyOver(r,e)}if(c){for(let e=0;e&lt;o;e++)(p||b[e])&amp;&amp;(A[e]=M(f,l,e,s,b),y[e]=M(h,l,e,u,b),I[e]=M(g,l,e,d,b),m[e]=M(p,l,e,b,!1));n&lt;a-1&amp;&amp;copyOver(r,e)}}}else copyOver(n,r);b?processResults(r,work,1-s):processResults(work,r,s)},&quot;channels-to-alpha&quot;:function(e){let[t,l]=getInputAndOutputChannels(e),n=t.r.length,{opacity:r,includeRed:o,includeGreen:s,includeBlue:u,lineOut:a}=e;null==r&amp;&amp;(r=1),null==o&amp;&amp;(o=!0),null==s&amp;&amp;(s=!0),null==u&amp;&amp;(u=!0);let c=0;o&amp;&amp;c++,s&amp;&amp;c++,u&amp;&amp;c++;const{r:i,g:f,b:h,a:g}=t,{r:p,g:d,b:b,a:k}=l;for(let e=0;e&lt;n;e++)if(p[e]=i[e],d[e]=f[e],b[e]=h[e],c){let t=0;o&amp;&amp;(t+=i[e]),s&amp;&amp;(t+=f[e]),u&amp;&amp;(t+=h[e]),t=Math.floor(t/c),k[e]=t}else k[e]=g[e];a?processResults(l,work,1-r):processResults(work,l,r)},chroma:function(e){let[t,l]=getInputAndOutputChannels(e),n=t.r.length,{opacity:r,ranges:o,lineOut:s}=e;null==r&amp;&amp;(r=1),null==o&amp;&amp;(o=[]);const{r:u,g:a,b:c,a:f}=t,{r:h,g:g,b:p,a:d}=l;for(let e=0;e&lt;n;e++){let t=!1,l=u[e],n=a[e],r=c[e];for(i=0,iz=o.length;i&lt;iz;i++){o[i];let[e,s,u,a,c,f]=o[i];if(l&gt;=e&amp;&amp;l&lt;=a&amp;&amp;n&gt;=s&amp;&amp;n&lt;=c&amp;&amp;r&gt;=u&amp;&amp;r&lt;=f){t=!0;break}}h[e]=u[e],g[e]=a[e],p[e]=c[e],d[e]=t?0:f[e]}s?processResults(l,work,1-r):processResults(work,l,r)},&quot;clamp-channels&quot;:function(e){let[t,l]=getInputAndOutputChannels(e),n=t.r.length,{opacity:r,lowRed:o,lowGreen:s,lowBlue:u,highRed:a,highGreen:c,highBlue:i,lineOut:f}=e;null==r&amp;&amp;(r=1),null==o&amp;&amp;(o=0),null==s&amp;&amp;(s=0),null==u&amp;&amp;(u=0),null==a&amp;&amp;(a=255),null==c&amp;&amp;(c=255),null==i&amp;&amp;(i=255);const h=a-o,g=c-s,p=i-u,{r:d,g:b,b:k,a:w}=t,{r:R,g:O,b:A,a:y}=l;for(let e=0;e&lt;n;e++)if(w[e]){let t=d[e]/255,l=b[e]/255,n=k[e]/255;R[e]=o+t*h,O[e]=s+l*g,A[e]=u+n*p,y[e]=w[e]}else R[e]=d[e],O[e]=b[e],A[e]=k[e],y[e]=w[e];f?processResults(l,work,1-r):processResults(work,l,r)},&quot;colors-to-alpha&quot;:function(e){let[t,l]=getInputAndOutputChannels(e),n=t.r.length,{opacity:r,red:o,green:s,blue:u,opaqueAt:a,transparentAt:c,lineOut:i}=e;null==r&amp;&amp;(r=1),null==o&amp;&amp;(o=0),null==s&amp;&amp;(s=255),null==u&amp;&amp;(u=0),null==a&amp;&amp;(a=1),null==c&amp;&amp;(c=0);const f=Math.max((o+s+u)/3,(255-o+(255-s)+(255-u))/3),h=c*f,g=a*f,p=g-h,d=function(e,t,l){let n=(Math.abs(o-e)+Math.abs(s-t)+Math.abs(u-l))/3;return n&lt;h?0:n&gt;g?255:(n-h)/p*255},{r:b,g:k,b:w,a:R}=t,{r:O,g:A,b:y,a:I}=l;for(let e=0;e&lt;n;e++)O[e]=b[e],A[e]=k[e],y[e]=w[e],I[e]=d(b[e],k[e],w[e]);i?processResults(l,work,1-r):processResults(work,l,r)},compose:function(e){let[t,l,n]=getInputAndOutputChannels(e),{opacity:r,compose:o,offsetX:s,offsetY:u,lineOut:a}=(l.r.length,e);null==r&amp;&amp;(r=1),null==o&amp;&amp;(o=&quot;&quot;),null==s&amp;&amp;(s=0),null==u&amp;&amp;(u=0);const{r:c,g:i,b:f,a:h}=t,{r:g,g:p,b:d,a:b}=l,{r:k,g:w,b:R,a:O}=n;let[A,y,I,m,M,x]=getInputAndOutputDimensions(e);const B=function(e,t,l){g[t]=l.r[e],p[t]=l.g[e],d[t]=l.b[e],b[t]=l.a[e]},G=function(e,t){let l=e-s,n=t-u,r=-1;return l&gt;=0&amp;&amp;l&lt;M&amp;&amp;n&gt;=0&amp;&amp;n&lt;x&amp;&amp;(r=n*M+l),[t*A+e,r]};switch(o){case&quot;source-only&quot;:copyOver(t,l);break;case&quot;source-atop&quot;:const e=(e,t,l,n)=&gt;t*e*n+n*l*(1-t);for(let t=0;t&lt;y;t++)for(let l=0;l&lt;A;l++){let[n,r]=G(l,t);if(r&gt;=0){let t=h[n]/255,l=O[r]/255;g[n]=e(c[n],t,k[r],l),p[n]=e(i[n],t,w[r],l),d[n]=e(f[n],t,R[r],l),b[n]=255*(t*l+l*(1-t))}}break;case&quot;source-in&quot;:const r=(e,t,l)=&gt;t*e*l;for(let e=0;e&lt;y;e++)for(let t=0;t&lt;A;t++){let[l,n]=G(t,e);if(n&gt;=0){let e=h[l]/255,t=O[n]/255;g[l]=r(c[l],e,t),p[l]=r(i[l],e,t),d[l]=r(f[l],e,t),b[l]=e*t*255}}break;case&quot;source-out&quot;:const s=(e,t,l)=&gt;t*e*(1-l);for(let e=0;e&lt;y;e++)for(let l=0;l&lt;A;l++){let[n,r]=G(l,e);if(r&lt;0)B(n,n,t);else{let e=h[n]/255,t=O[r]/255;g[n]=s(c[n],e,t),p[n]=s(i[n],e,t),d[n]=s(f[n],e,t),b[n]=e*(1-t)*255}}break;case&quot;destination-only&quot;:for(let e=0;e&lt;y;e++)for(let t=0;t&lt;A;t++){let[l,r]=G(t,e);r&gt;=0&amp;&amp;B(r,l,n)}break;case&quot;destination-atop&quot;:const u=(e,t,l,n)=&gt;t*e*(1-n)+n*l*t;for(let e=0;e&lt;y;e++)for(let l=0;l&lt;A;l++){let[n,r]=G(l,e);if(r&lt;0)B(n,n,t);else{let e=h[n]/255,t=O[r]/255;g[n]=u(c[n],e,k[r],t),p[n]=u(i[n],e,w[r],t),d[n]=u(f[n],e,R[r],t),b[n]=255*(e*(1-t)+t*e)}}break;case&quot;destination-over&quot;:const a=(e,t,l,n)=&gt;t*e*(1-n)+n*l;for(let e=0;e&lt;y;e++)for(let l=0;l&lt;A;l++){let[n,r]=G(l,e);if(r&lt;0)B(n,n,t);else{let e=h[n]/255,t=O[r]/255;g[n]=a(c[n],e,k[r],t),p[n]=a(i[n],e,w[r],t),d[n]=a(f[n],e,R[r],t),b[n]=255*(e*(1-t)+t)}}break;case&quot;destination-in&quot;:const I=(e,t,l)=&gt;t*e*l;for(let e=0;e&lt;y;e++)for(let t=0;t&lt;A;t++){let[l,n]=G(t,e);if(n&gt;=0){let e=h[l]/255,t=O[n]/255;g[l]=I(k[n],t,e),p[l]=I(w[n],t,e),d[l]=I(R[n],t,e),b[l]=e*t*255}}break;case&quot;destination-out&quot;:const m=(e,t,l)=&gt;l*e*(1-t);for(let e=0;e&lt;y;e++)for(let t=0;t&lt;A;t++){let[l,n]=G(t,e);if(n&gt;=0){let e=h[l]/255,t=O[n]/255;g[l]=m(k[n],e,t),p[l]=m(w[n],e,t),d[l]=m(R[n],e,t),b[l]=t*(1-e)*255}}break;case&quot;clear&quot;:break;case&quot;xor&quot;:const M=(e,t,l,n)=&gt;t*e*(1-n)+n*l*(1-t);for(let e=0;e&lt;y;e++)for(let l=0;l&lt;A;l++){let[n,r]=G(l,e);if(r&lt;0)B(n,n,t);else{let e=h[n]/255,t=O[r]/255;g[n]=M(c[n],e,k[r],t),p[n]=M(i[n],e,w[r],t),d[n]=M(f[n],e,R[r],t),b[n]=255*(e*(1-t)+t*(1-e))}}break;default:const x=(e,t,l,n)=&gt;t*e+n*l*(1-t);for(let e=0;e&lt;y;e++)for(let l=0;l&lt;A;l++){let[n,r]=G(l,e);if(r&lt;0)B(n,n,t);else{let e=h[n]/255,t=O[r]/255;g[n]=x(c[n],e,k[r],t),p[n]=x(i[n],e,w[r],t),d[n]=x(f[n],e,R[r],t),b[n]=255*(e+t*(1-e))}}}a?processResults(l,work,1-r):processResults(work,l,r)},displace:function(e){let[t,l,n]=getInputAndOutputChannels(e),{opacity:r,channelX:o,channelY:s,scaleX:u,scaleY:a,offsetX:c,offsetY:i,transparentEdges:f,lineOut:h}=(t.r.length,e);null==r&amp;&amp;(r=1),null==o&amp;&amp;(o=&quot;red&quot;),null==s&amp;&amp;(s=&quot;green&quot;),null==u&amp;&amp;(u=1),null==a&amp;&amp;(a=1),null==c&amp;&amp;(c=0),null==i&amp;&amp;(i=0),null==f&amp;&amp;(f=!1);const{r:g,g:p,b:d,a:b}=t,{r:k,g:w,b:R,a:O}=l,{r:A,g:y,b:I,a:m}=n;o=&quot;red&quot;==o?A:&quot;green&quot;==o?y:&quot;blue&quot;==o?I:m,s=&quot;red&quot;==s?A:&quot;green&quot;==s?y:&quot;blue&quot;==s?I:m;let[M,x,B,G,C,L]=getInputAndOutputDimensions(e);const $=function(e,t,l){e&lt;0?O[t]=0:(k[t]=l.r[e],w[t]=l.g[e],R[t]=l.b[e],O[t]=l.a[e])},N=function(e,t){let l=e+c,n=t+i,r=-1;return l&gt;=0&amp;&amp;l&lt;C&amp;&amp;n&gt;=0&amp;&amp;n&lt;L&amp;&amp;(r=n*C+l),[t*M+e,r]};for(let e=0;e&lt;x;e++)for(let l=0;l&lt;M;l++){let[n,r]=N(l,e);if(r&gt;=0){let c,i=Math.floor(l+(127-o[r])/127*u),h=Math.floor(e+(127-s[r])/127*a);f?c=i&lt;0||i&gt;=M||h&lt;0||h&gt;=x?-1:h*M+i:(i&lt;0&amp;&amp;(i=0),i&gt;=M&amp;&amp;(i=M-1),h&lt;0&amp;&amp;(h=0),h&gt;=x&amp;&amp;(h=x-1),c=h*M+i),$(c,n,t)}else $(n,n,t)}h?processResults(l,work,1-r):processResults(work,l,r)},emboss:function(e){let[t,l]=getInputAndOutputChannels(e),n=t.r.length,{opacity:r,strength:o,angle:s,tolerance:u,keepOnlyChangedAreas:a,postProcessResults:c,lineOut:i}=e;for(null==r&amp;&amp;(r=1),null==o&amp;&amp;(o=1),null==s&amp;&amp;(s=0),null==u&amp;&amp;(u=0),null==a&amp;&amp;(a=!1),null==c&amp;&amp;(c=!1),o=Math.abs(o);s&lt;0;)s+=360;s%=360;let f=Math.floor(s/45),h=s%45/45*o,g=new Array(9);(g=g.fill(0,0,9))[4]=1,0==f?(g[5]=o-h,g[8]=h,g[3]=-g[5],g[0]=-g[8]):1==f?(g[8]=o-h,g[7]=h,g[0]=-g[8],g[1]=-g[7]):2==f?(g[7]=o-h,g[6]=h,g[1]=-g[7],g[2]=-g[6]):3==f?(g[6]=o-h,g[3]=h,g[2]=-g[6],g[5]=-g[3]):4==f?(g[3]=o-h,g[0]=h,g[5]=-g[3],g[8]=-g[0]):5==f?(g[0]=o-h,g[1]=h,g[8]=-g[0],g[7]=-g[1]):6==f?(g[1]=o-h,g[2]=h,g[7]=-g[1],g[6]=-g[2]):(g[2]=o-h,g[5]=h,g[6]=-g[2],g[3]=-g[5]);const{r:p,g:d,b:b,a:k}=t,{r:w,g:R,b:O,a:A}=l;grid=buildMatrixGrid(3,3,1,1);const y=function(e,t){let l=0;for(let n=0,r=t.length;n&lt;r;n++)g[n]&amp;&amp;(l+=e[t[n]]*g[n]);return l};for(let e=0;e&lt;n;e++)k[e]&amp;&amp;(w[e]=y(p,grid[e]),R[e]=y(d,grid[e]),O[e]=y(b,grid[e]),A[e]=k[e],c&amp;&amp;w[e]&gt;=p[e]-u&amp;&amp;w[e]&lt;=p[e]+u&amp;&amp;R[e]&gt;=d[e]-u&amp;&amp;R[e]&lt;=d[e]+u&amp;&amp;O[e]&gt;=b[e]-u&amp;&amp;O[e]&lt;=b[e]+u&amp;&amp;(a?A[e]=0:(w[e]=127,R[e]=127,O[e]=127)));i?processResults(l,work,1-r):processResults(work,l,r)},flood:function(e){let[t,l]=getInputAndOutputChannels(e),n=t.r.length,{opacity:r,red:o,green:s,blue:u,alpha:a,lineOut:c}=(Math.floor,e);null==r&amp;&amp;(r=1),null==o&amp;&amp;(o=0),null==s&amp;&amp;(s=0),null==u&amp;&amp;(u=0),null==a&amp;&amp;(a=255);const{r:i,g:f,b:h,a:g}=l;i.fill(o,0,n-1),f.fill(s,0,n-1),h.fill(u,0,n-1),g.fill(a,0,n-1),c?processResults(l,work,1-r):processResults(work,l,r)},grayscale:function(e){let[t,l]=getInputAndOutputChannels(e),n=t.r.length,{opacity:r,lineOut:o}=e;null==r&amp;&amp;(r=1);const{r:s,g:u,b:a,a:c}=t,{r:i,g:f,b:h,a:g}=l;for(let e=0;e&lt;n;e++){let t=Math.floor(.2126*s[e]+.7152*u[e]+.0722*a[e]);i[e]=t,f[e]=t,h[e]=t,g[e]=c[e]}o?processResults(l,work,1-r):processResults(work,l,r)},&quot;invert-channels&quot;:function(e){let[t,l]=getInputAndOutputChannels(e),n=t.r.length,{opacity:r,includeRed:o,includeGreen:s,includeBlue:u,includeAlpha:a,lineOut:c}=e;null==r&amp;&amp;(r=1),null==o&amp;&amp;(o=!0),null==s&amp;&amp;(s=!0),null==u&amp;&amp;(u=!0),null==a&amp;&amp;(a=!1);const{r:i,g:f,b:h,a:g}=t,{r:p,g:d,b:b,a:k}=l;for(let e=0;e&lt;n;e++)p[e]=o?255-i[e]:i[e],d[e]=s?255-f[e]:f[e],b[e]=u?255-h[e]:h[e],k[e]=a?255-g[e]:g[e];c?processResults(l,work,1-r):processResults(work,l,r)},&quot;lock-channels-to-levels&quot;:function(e){checkChannelLevelsParameters(e);const t=function(e,t){if(!t.length)return e;for(let l=0,n=t.length;l&lt;n;l++){let[n,r,o]=t[l];if(e&gt;=n&amp;&amp;e&lt;=r)return o}};let[l,n]=getInputAndOutputChannels(e),r=l.r.length,{opacity:o,red:s,green:u,blue:a,alpha:c,lineOut:i}=e;null==o&amp;&amp;(o=1),null==s&amp;&amp;(s=[0]),null==u&amp;&amp;(u=[0]),null==a&amp;&amp;(a=[0]),null==c&amp;&amp;(c=[255]);const{r:f,g:h,b:g,a:p}=l,{r:d,g:b,b:k,a:w}=n;for(let e=0;e&lt;r;e++)d[e]=t(f[e],s),b[e]=t(h[e],u),k[e]=t(g[e],a),w[e]=t(p[e],c);i?processResults(n,work,1-o):processResults(work,n,o)},matrix:function(e){let[t,l]=getInputAndOutputChannels(e),n=t.r.length,{opacity:r,includeRed:o,includeGreen:s,includeBlue:u,includeAlpha:a,width:c,height:i,offsetX:f,offsetY:h,weights:g,lineOut:p}=e;null==r&amp;&amp;(r=1),null==o&amp;&amp;(o=!0),null==s&amp;&amp;(s=!0),null==u&amp;&amp;(u=!0),null==a&amp;&amp;(a=!1),(null==c||c&lt;1)&amp;&amp;(c=3),(null==i||i&lt;1)&amp;&amp;(i=3),null==f&amp;&amp;(f=1),null==h&amp;&amp;(h=1),null==g&amp;&amp;((g=[].fill(0,0,c*i-1))[Math.floor(g.length/2)+1]=1),grid=buildMatrixGrid(c,i,f,h,t.a);const d=function(e,t){let l=0;for(let n=0,r=t.length;n&lt;r;n++)g[n]&amp;&amp;(l+=e[t[n]]*g[n]);return l},{r:b,g:k,b:w,a:R}=t,{r:O,g:A,b:y,a:I}=l;for(let e=0;e&lt;n;e++)R[e]&amp;&amp;(O[e]=o?d(b,grid[e]):b[e],A[e]=s?d(k,grid[e]):k[e],y[e]=u?d(w,grid[e]):w[e],I[e]=a?d(R,grid[e]):R[e]);p?processResults(l,work,1-r):processResults(work,l,r)},&quot;modulate-channels&quot;:function(e){let[t,l]=getInputAndOutputChannels(e),n=t.r.length,{opacity:r,red:o,green:s,blue:u,alpha:a,saturation:c,lineOut:i}=e;null==r&amp;&amp;(r=1),null==o&amp;&amp;(o=1),null==s&amp;&amp;(s=1),null==u&amp;&amp;(u=1),null==a&amp;&amp;(a=1),null==c&amp;&amp;(c=!1);const{r:f,g:h,b:g,a:p}=t,{r:d,g:b,b:k,a:w}=l;if(c)for(let e=0;e&lt;n;e++)d[e]=127+(f[e]-127)*o,b[e]=127+(h[e]-127)*s,k[e]=127+(g[e]-127)*u,w[e]=127+(p[e]-127)*a;else for(let e=0;e&lt;n;e++)d[e]=f[e]*o,b[e]=h[e]*s,k[e]=g[e]*u,w[e]=p[e]*a;i?processResults(l,work,1-r):processResults(work,l,r)},offset:function(e){let[t,l]=getInputAndOutputChannels(e),{opacity:n,offsetRedX:r,offsetRedY:o,offsetGreenX:s,offsetGreenY:u,offsetBlueX:a,offsetBlueY:c,offsetAlphaX:i,offsetAlphaY:f,lineOut:h}=e;null==n&amp;&amp;(n=1),null==r&amp;&amp;(r=0),null==o&amp;&amp;(o=0),null==s&amp;&amp;(s=0),null==u&amp;&amp;(u=0),null==a&amp;&amp;(a=0),null==c&amp;&amp;(c=0),null==i&amp;&amp;(i=0),null==f&amp;&amp;(f=0);let g=!1;r==s&amp;&amp;r==a&amp;&amp;r==i&amp;&amp;o==u&amp;&amp;o==c&amp;&amp;o==f&amp;&amp;(g=!0);const{r:p,g:d,b:b,a:k}=t,{r:w,g:R,b:O,a:A}=l;let y,I,m,M,x,B,G,C,L,$,N=buildImageGrid(),v=N[0].length,H=N.length;for(let e=0;e&lt;H;e++)for(let t=0;t&lt;v;t++)k[L=N[e][t]]&amp;&amp;(g?(I=e+o,(y=t+r)&gt;=0&amp;&amp;y&lt;v&amp;&amp;I&gt;=0&amp;&amp;I&lt;H&amp;&amp;(w[$=N[I][y]]=p[L],R[$]=d[L],O[$]=b[L],A[$]=k[L])):(I=e+o,m=t+s,M=e+u,x=t+a,B=e+c,G=t+i,C=e+f,(y=t+r)&gt;=0&amp;&amp;y&lt;v&amp;&amp;I&gt;=0&amp;&amp;I&lt;H&amp;&amp;(w[$=N[I][y]]=p[L]),m&gt;=0&amp;&amp;m&lt;v&amp;&amp;M&gt;=0&amp;&amp;M&lt;H&amp;&amp;(R[$=N[M][m]]=d[L]),x&gt;=0&amp;&amp;x&lt;v&amp;&amp;B&gt;=0&amp;&amp;B&lt;H&amp;&amp;(O[$=N[B][x]]=b[L]),G&gt;=0&amp;&amp;G&lt;v&amp;&amp;C&gt;=0&amp;&amp;C&lt;H&amp;&amp;(A[$=N[C][G]]=k[L])));h?processResults(l,work,1-n):processResults(work,l,n)},pixelate:function(e){const t=function(e,t,l){let n=l.reduce((t,l)=&gt;t+e[l],0);n=Math.floor(n/l.length);for(let e=0,r=l.length;e&lt;r;e++)t[l[e]]=n},l=function(e,t,l){let n;for(let r=0,o=l.length;r&lt;o;r++)t[n=l[r]]=e[n]};let[n,r]=getInputAndOutputChannels(e),{opacity:o,tileWidth:s,tileHeight:u,offsetX:a,offsetY:c,includeRed:i,includeGreen:f,includeBlue:h,includeAlpha:g,lineOut:p}=(n.r.length,e);null==o&amp;&amp;(o=1),null==i&amp;&amp;(i=!0),null==f&amp;&amp;(f=!0),null==h&amp;&amp;(h=!0),null==g&amp;&amp;(g=!1),null==s&amp;&amp;(s=1),null==u&amp;&amp;(u=1),null==a&amp;&amp;(a=0),null==c&amp;&amp;(c=0);const d=buildImageTileSets(s,u,a,c),{r:b,g:k,b:w,a:R}=n,{r:O,g:A,b:y,a:I}=r;d.forEach(e=&gt;{i?t(b,O,e):l(b,O,e),f?t(k,A,e):l(k,A,e),h?t(w,y,e):l(w,y,e),g?t(R,I,e):l(R,I,e)}),p?processResults(r,work,1-o):processResults(work,r,o)},&quot;process-image&quot;:function(e){const{assetData:t,lineOut:l}=e;if(l&amp;&amp;l.substring&amp;&amp;l.length&amp;&amp;t&amp;&amp;t.width&amp;&amp;t.height&amp;&amp;t.data){let e=t.data,n=e.length,r=createResultObject(n/4),o=r.r,s=r.g,u=r.b,a=r.a,c=0;for(let t=0;t&lt;n;t+=4)o[c]=e[t],s[c]=e[t+1],u[c]=e[t+2],a[c]=e[t+3],c++;t.channels=r,cache[l]=t}},&quot;set-channel-to-level&quot;:function(e){let[t,l]=getInputAndOutputChannels(e),n=t.r.length,{opacity:r,includeRed:o,includeGreen:s,includeBlue:u,includeAlpha:a,level:c,lineOut:i}=e;null==r&amp;&amp;(r=1),null==o&amp;&amp;(o=!1),null==s&amp;&amp;(s=!1),null==u&amp;&amp;(u=!1),null==a&amp;&amp;(a=!1),null==c&amp;&amp;(c=0);const{r:f,g:h,b:g,a:p}=t,{r:d,g:b,b:k,a:w}=l;for(let e=0;e&lt;n;e++)d[e]=o?c:f[e],b[e]=s?c:h[e],k[e]=u?c:g[e],w[e]=a?c:p[e];i?processResults(l,work,1-r):processResults(work,l,r)},&quot;step-channels&quot;:function(e){let[t,l]=getInputAndOutputChannels(e),n=t.r.length,r=Math.floor,{opacity:o,red:s,green:u,blue:a,lineOut:c}=e;null==o&amp;&amp;(o=1),null==s&amp;&amp;(s=1),null==u&amp;&amp;(u=1),null==a&amp;&amp;(a=1),null==s&amp;&amp;(s=1),null==u&amp;&amp;(u=1),null==a&amp;&amp;(a=1);const{r:i,g:f,b:h,a:g}=t,{r:p,g:d,b:b,a:k}=l;for(let e=0;e&lt;n;e++)p[e]=r(i[e]/s)*s,d[e]=r(f[e]/u)*u,b[e]=r(h[e]/a)*a,k[e]=g[e];c?processResults(l,work,1-o):processResults(work,l,o)},threshold:function(e){let[t,l]=getInputAndOutputChannels(e),n=t.r.length,{opacity:r,low:o,high:s,level:u,lineOut:a}=e;null==r&amp;&amp;(r=1),null==o&amp;&amp;(o=[0,0,0]),null==s&amp;&amp;(s=[255,255,255]),null==u&amp;&amp;(u=128);const{r:c,g:i,b:f,a:h}=t,{r:g,g:p,b:d,a:b}=l;let[k,w,R]=o,[O,A,y]=s;for(let e=0;e&lt;n;e++){Math.floor(.2126*c[e]+.7152*i[e]+.0722*f[e])&lt;u?(g[e]=k,p[e]=w,d[e]=R):(g[e]=O,p[e]=A,d[e]=y),b[e]=h[e]}a?processResults(l,work,1-r):processResults(work,l,r)},&quot;tint-channels&quot;:function(e){let[t,l]=getInputAndOutputChannels(e),n=t.r.length,{opacity:r,redInRed:o,redInGreen:s,redInBlue:u,greenInRed:a,greenInGreen:c,greenInBlue:i,blueInRed:f,blueInGreen:h,blueInBlue:g,lineOut:p}=e;null==r&amp;&amp;(r=1),null==o&amp;&amp;(o=1),null==s&amp;&amp;(s=0),null==u&amp;&amp;(u=0),null==a&amp;&amp;(a=0),null==c&amp;&amp;(c=1),null==i&amp;&amp;(i=0),null==f&amp;&amp;(f=0),null==h&amp;&amp;(h=0),null==g&amp;&amp;(g=1);const{r:d,g:b,b:k,a:w}=t,{r:R,g:O,b:A,a:y}=l;for(let e=0;e&lt;n;e++){let t=d[e],l=b[e],n=k[e];R[e]=Math.floor(t*o+l*a+n*f),O[e]=Math.floor(t*s+l*c+n*h),A[e]=Math.floor(t*u+l*i+n*g),y[e]=w[e]}p?processResults(l,work,1-r):processResults(work,l,r)},&quot;user-defined-legacy&quot;:function(e){let[t,l]=getInputAndOutputChannels(e),{opacity:n,lineOut:r}=e;null==n&amp;&amp;(n=1),copyOver(t,l),r?processResults(l,work,1-n):processResults(work,l,n)}};&#x27;</span>
};


<span class="hljs-keyword">const</span> filterUrl = URL.createObjectURL(

    <span class="hljs-keyword">new</span> Blob([ filterCode() ], { <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;text/javascript&#x27;</span> })
);</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h4 id="exports">Exports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> {
    filterUrl,
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
