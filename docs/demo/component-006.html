<!DOCTYPE html>

<html>
<head>
  <title>Demo Component 006</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="canvas-001.html">
                  ./demo/canvas-001.js
                </a>
              
                
                <a class="source" href="canvas-002.html">
                  ./demo/canvas-002.js
                </a>
              
                
                <a class="source" href="canvas-003.html">
                  ./demo/canvas-003.js
                </a>
              
                
                <a class="source" href="canvas-004.html">
                  ./demo/canvas-004.js
                </a>
              
                
                <a class="source" href="canvas-005.html">
                  ./demo/canvas-005.js
                </a>
              
                
                <a class="source" href="canvas-006.html">
                  ./demo/canvas-006.js
                </a>
              
                
                <a class="source" href="canvas-007.html">
                  ./demo/canvas-007.js
                </a>
              
                
                <a class="source" href="canvas-008.html">
                  ./demo/canvas-008.js
                </a>
              
                
                <a class="source" href="canvas-009.html">
                  ./demo/canvas-009.js
                </a>
              
                
                <a class="source" href="canvas-010.html">
                  ./demo/canvas-010.js
                </a>
              
                
                <a class="source" href="canvas-011.html">
                  ./demo/canvas-011.js
                </a>
              
                
                <a class="source" href="canvas-012.html">
                  ./demo/canvas-012.js
                </a>
              
                
                <a class="source" href="canvas-013.html">
                  ./demo/canvas-013.js
                </a>
              
                
                <a class="source" href="canvas-014.html">
                  ./demo/canvas-014.js
                </a>
              
                
                <a class="source" href="canvas-015.html">
                  ./demo/canvas-015.js
                </a>
              
                
                <a class="source" href="canvas-016.html">
                  ./demo/canvas-016.js
                </a>
              
                
                <a class="source" href="canvas-017.html">
                  ./demo/canvas-017.js
                </a>
              
                
                <a class="source" href="canvas-018.html">
                  ./demo/canvas-018.js
                </a>
              
                
                <a class="source" href="canvas-019.html">
                  ./demo/canvas-019.js
                </a>
              
                
                <a class="source" href="canvas-020.html">
                  ./demo/canvas-020.js
                </a>
              
                
                <a class="source" href="canvas-021.html">
                  ./demo/canvas-021.js
                </a>
              
                
                <a class="source" href="canvas-022.html">
                  ./demo/canvas-022.js
                </a>
              
                
                <a class="source" href="canvas-023.html">
                  ./demo/canvas-023.js
                </a>
              
                
                <a class="source" href="canvas-024.html">
                  ./demo/canvas-024.js
                </a>
              
                
                <a class="source" href="canvas-025.html">
                  ./demo/canvas-025.js
                </a>
              
                
                <a class="source" href="canvas-026.html">
                  ./demo/canvas-026.js
                </a>
              
                
                <a class="source" href="canvas-027.html">
                  ./demo/canvas-027.js
                </a>
              
                
                <a class="source" href="canvas-028.html">
                  ./demo/canvas-028.js
                </a>
              
                
                <a class="source" href="canvas-029.html">
                  ./demo/canvas-029.js
                </a>
              
                
                <a class="source" href="canvas-030.html">
                  ./demo/canvas-030.js
                </a>
              
                
                <a class="source" href="canvas-031.html">
                  ./demo/canvas-031.js
                </a>
              
                
                <a class="source" href="canvas-032.html">
                  ./demo/canvas-032.js
                </a>
              
                
                <a class="source" href="canvas-033.html">
                  ./demo/canvas-033.js
                </a>
              
                
                <a class="source" href="canvas-034.html">
                  ./demo/canvas-034.js
                </a>
              
                
                <a class="source" href="canvas-035.html">
                  ./demo/canvas-035.js
                </a>
              
                
                <a class="source" href="canvas-036.html">
                  ./demo/canvas-036.js
                </a>
              
                
                <a class="source" href="canvas-037.html">
                  ./demo/canvas-037.js
                </a>
              
                
                <a class="source" href="canvas-038.html">
                  ./demo/canvas-038.js
                </a>
              
                
                <a class="source" href="canvas-039.html">
                  ./demo/canvas-039.js
                </a>
              
                
                <a class="source" href="canvas-040.html">
                  ./demo/canvas-040.js
                </a>
              
                
                <a class="source" href="canvas-041.html">
                  ./demo/canvas-041.js
                </a>
              
                
                <a class="source" href="canvas-042.html">
                  ./demo/canvas-042.js
                </a>
              
                
                <a class="source" href="canvas-043.html">
                  ./demo/canvas-043.js
                </a>
              
                
                <a class="source" href="canvas-044.html">
                  ./demo/canvas-044.js
                </a>
              
                
                <a class="source" href="canvas-045.html">
                  ./demo/canvas-045.js
                </a>
              
                
                <a class="source" href="canvas-046.html">
                  ./demo/canvas-046.js
                </a>
              
                
                <a class="source" href="canvas-047.html">
                  ./demo/canvas-047.js
                </a>
              
                
                <a class="source" href="component-001.html">
                  ./demo/component-001.js
                </a>
              
                
                <a class="source" href="component-002.html">
                  ./demo/component-002.js
                </a>
              
                
                <a class="source" href="component-003.html">
                  ./demo/component-003.js
                </a>
              
                
                <a class="source" href="component-004.html">
                  ./demo/component-004.js
                </a>
              
                
                <a class="source" href="component-005.html">
                  ./demo/component-005.js
                </a>
              
                
                <a class="source" href="component-006.html">
                  ./demo/component-006.js
                </a>
              
                
                <a class="source" href="component-007.html">
                  ./demo/component-007.js
                </a>
              
                
                <a class="source" href="core-001.html">
                  ./demo/core-001.js
                </a>
              
                
                <a class="source" href="dom-001.html">
                  ./demo/dom-001.js
                </a>
              
                
                <a class="source" href="dom-002.html">
                  ./demo/dom-002.js
                </a>
              
                
                <a class="source" href="dom-003.html">
                  ./demo/dom-003.js
                </a>
              
                
                <a class="source" href="dom-004.html">
                  ./demo/dom-004.js
                </a>
              
                
                <a class="source" href="dom-005.html">
                  ./demo/dom-005.js
                </a>
              
                
                <a class="source" href="dom-006.html">
                  ./demo/dom-006.js
                </a>
              
                
                <a class="source" href="dom-007.html">
                  ./demo/dom-007.js
                </a>
              
                
                <a class="source" href="dom-008.html">
                  ./demo/dom-008.js
                </a>
              
                
                <a class="source" href="dom-009.html">
                  ./demo/dom-009.js
                </a>
              
                
                <a class="source" href="dom-010.html">
                  ./demo/dom-010.js
                </a>
              
                
                <a class="source" href="dom-011.html">
                  ./demo/dom-011.js
                </a>
              
                
                <a class="source" href="dom-012.html">
                  ./demo/dom-012.js
                </a>
              
                
                <a class="source" href="dom-013.html">
                  ./demo/dom-013.js
                </a>
              
                
                <a class="source" href="dom-014a.html">
                  ./demo/dom-014a.js
                </a>
              
                
                <a class="source" href="dom-014b.html">
                  ./demo/dom-014b.js
                </a>
              
                
                <a class="source" href="dom-014c.html">
                  ./demo/dom-014c.js
                </a>
              
                
                <a class="source" href="dom-015.html">
                  ./demo/dom-015.js
                </a>
              
                
                <a class="source" href="dom-016.html">
                  ./demo/dom-016.js
                </a>
              
                
                <a class="source" href="filters-001.html">
                  ./demo/filters-001.js
                </a>
              
                
                <a class="source" href="filters-002.html">
                  ./demo/filters-002.js
                </a>
              
                
                <a class="source" href="filters-003.html">
                  ./demo/filters-003.js
                </a>
              
                
                <a class="source" href="filters-004.html">
                  ./demo/filters-004.js
                </a>
              
                
                <a class="source" href="filters-005.html">
                  ./demo/filters-005.js
                </a>
              
                
                <a class="source" href="filters-006.html">
                  ./demo/filters-006.js
                </a>
              
                
                <a class="source" href="filters-007.html">
                  ./demo/filters-007.js
                </a>
              
                
                <a class="source" href="filters-008.html">
                  ./demo/filters-008.js
                </a>
              
                
                <a class="source" href="filters-009.html">
                  ./demo/filters-009.js
                </a>
              
                
                <a class="source" href="filters-010.html">
                  ./demo/filters-010.js
                </a>
              
                
                <a class="source" href="filters-011.html">
                  ./demo/filters-011.js
                </a>
              
                
                <a class="source" href="filters-012.html">
                  ./demo/filters-012.js
                </a>
              
                
                <a class="source" href="filters-013.html">
                  ./demo/filters-013.js
                </a>
              
                
                <a class="source" href="filters-014.html">
                  ./demo/filters-014.js
                </a>
              
                
                <a class="source" href="filters-015.html">
                  ./demo/filters-015.js
                </a>
              
                
                <a class="source" href="filters-016.html">
                  ./demo/filters-016.js
                </a>
              
                
                <a class="source" href="filters-017.html">
                  ./demo/filters-017.js
                </a>
              
                
                <a class="source" href="filters-018.html">
                  ./demo/filters-018.js
                </a>
              
                
                <a class="source" href="filters-019.html">
                  ./demo/filters-019.js
                </a>
              
                
                <a class="source" href="filters-020.html">
                  ./demo/filters-020.js
                </a>
              
                
                <a class="source" href="filters-501.html">
                  ./demo/filters-501.js
                </a>
              
                
                <a class="source" href="filters-502.html">
                  ./demo/filters-502.js
                </a>
              
                
                <a class="source" href="filters-503.html">
                  ./demo/filters-503.js
                </a>
              
                
                <a class="source" href="filters-504.html">
                  ./demo/filters-504.js
                </a>
              
                
                <a class="source" href="filters-505.html">
                  ./demo/filters-505.js
                </a>
              
                
                <a class="source" href="particles-001.html">
                  ./demo/particles-001.js
                </a>
              
                
                <a class="source" href="particles-002.html">
                  ./demo/particles-002.js
                </a>
              
                
                <a class="source" href="particles-003.html">
                  ./demo/particles-003.js
                </a>
              
                
                <a class="source" href="particles-004.html">
                  ./demo/particles-004.js
                </a>
              
                
                <a class="source" href="particles-005.html">
                  ./demo/particles-005.js
                </a>
              
                
                <a class="source" href="particles-006.html">
                  ./demo/particles-006.js
                </a>
              
                
                <a class="source" href="particles-007.html">
                  ./demo/particles-007.js
                </a>
              
                
                <a class="source" href="particles-008.html">
                  ./demo/particles-008.js
                </a>
              
                
                <a class="source" href="particles-009.html">
                  ./demo/particles-009.js
                </a>
              
                
                <a class="source" href="particles-010.html">
                  ./demo/particles-010.js
                </a>
              
                
                <a class="source" href="particles-011.html">
                  ./demo/particles-011.js
                </a>
              
                
                <a class="source" href="particles-012.html">
                  ./demo/particles-012.js
                </a>
              
                
                <a class="source" href="particles-013.html">
                  ./demo/particles-013.js
                </a>
              
                
                <a class="source" href="particles-014.html">
                  ./demo/particles-014.js
                </a>
              
                
                <a class="source" href="particles-015.html">
                  ./demo/particles-015.js
                </a>
              
                
                <a class="source" href="particles-016.html">
                  ./demo/particles-016.js
                </a>
              
                
                <a class="source" href="temp-001.html">
                  ./demo/temp-001.js
                </a>
              
                
                <a class="source" href="temp-inkscapeSvgFilters.html">
                  ./demo/temp-inkscapeSvgFilters.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="demo-component-006">Demo Component 006</h1>
<p>Spiral charts</p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p><a href="../../demo/component-006.html">Run code</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> scrawl <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../source/scrawl.js&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h4 id="scene-setup">Scene setup</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> canvas = scrawl.library.canvas.mycanvas;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Function to fetch and parse Wikipedia page view timeseries data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> getData = <span class="hljs-function">(<span class="hljs-params">page = <span class="hljs-string">&#x27;Cat&#x27;</span></span>) =&gt;</span> {

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {

        <span class="hljs-keyword">const</span> data = {
            <span class="hljs-attr">page</span>: <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">max</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">min</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">fromdate</span>: <span class="hljs-string">&#x27;20200101&#x27;</span>,
            <span class="hljs-attr">todate</span>: <span class="hljs-string">&#x27;20200101&#x27;</span>,
            <span class="hljs-attr">sunday</span>: [], 
            <span class="hljs-attr">monday</span>: [], 
            <span class="hljs-attr">tuesday</span>: [], 
            <span class="hljs-attr">wednesday</span>: [], 
            <span class="hljs-attr">thursday</span>: [], 
            <span class="hljs-attr">friday</span>: [], 
            <span class="hljs-attr">saturday</span>: [], 
        };

        <span class="hljs-keyword">let</span> t = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
            f = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();

        t.setDate(t.getDate() - <span class="hljs-number">1</span>);
        f.setFullYear(f.getFullYear() - <span class="hljs-number">3</span>);

        <span class="hljs-keyword">let</span> fromdate = f.toISOString().split(<span class="hljs-string">&#x27;T&#x27;</span>)[<span class="hljs-number">0</span>].replace(<span class="hljs-regexp">/-/g</span>, <span class="hljs-string">&#x27;&#x27;</span>),
            todate = t.toISOString().split(<span class="hljs-string">&#x27;T&#x27;</span>)[<span class="hljs-number">0</span>].replace(<span class="hljs-regexp">/-/g</span>, <span class="hljs-string">&#x27;&#x27;</span>),
            dayCounter = f.getDay(),
            maxViews = <span class="hljs-number">0</span>, minViews = -<span class="hljs-number">1</span>;

        <span class="hljs-keyword">let</span> url = <span class="hljs-string">`https://wikimedia.org/api/rest_v1/metrics/pageviews/per-article/en.wikipedia/all-access/user/<span class="hljs-subst">${page}</span>/daily/<span class="hljs-subst">${fromdate}</span>/<span class="hljs-subst">${todate}</span>`</span>;

        fetch(url)
        .then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.json())
        .then(<span class="hljs-function"><span class="hljs-params">dataObject</span> =&gt;</span> {

            <span class="hljs-keyword">let</span> dataArray = dataObject.items;

            <span class="hljs-keyword">let</span> results = [[],[],[],[],[],[],[]];

            dataArray.forEach(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> {

                <span class="hljs-keyword">let</span> views = d.views;

                maxViews = (views &gt; maxViews) ? views : maxViews;

                <span class="hljs-keyword">if</span> (minViews &lt; <span class="hljs-number">0</span>) minViews = maxViews;
                <span class="hljs-keyword">else</span> minViews = (views &lt; minViews) ? views : minViews;

                results[dayCounter].push(views);

                dayCounter++;
                dayCounter = dayCounter % <span class="hljs-number">7</span>;
            });

            data.page = page;
            data.max = maxViews;
            data.min = minViews;
            data.fromdate = fromdate;
            data.todate = todate;
            data.sun = results[<span class="hljs-number">0</span>];
            data.mon = results[<span class="hljs-number">1</span>];
            data.tue = results[<span class="hljs-number">2</span>];
            data.wed = results[<span class="hljs-number">3</span>];
            data.thu = results[<span class="hljs-number">4</span>];
            data.fri = results[<span class="hljs-number">5</span>];
            data.sat = results[<span class="hljs-number">6</span>];

            resolve(data);
        })
        .catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {

            <span class="hljs-built_in">console</span>.log(e);
            reject(data);
        });
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Function to build a new chart</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> buildChart = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">page, canvasWrapper, reqs = {}</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>We will eventually return a Picture entity to the calling invocation - but generating it takes time, hence we return a promise and resolve the Picture entity in due course</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>We will create a new Cell for the chart, fabricate the required entitys, render the Cell, then capture the output into a single Picture entity which we assign to the canvasWrapper’s Group. After this all completes we can kill the Cell, its Group, and all of the Group’s entitys</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">const</span> cell = canvasWrapper.buildCell({
            <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${page}</span>-cell`</span>,
            <span class="hljs-attr">width</span>: <span class="hljs-number">400</span>, <span class="hljs-comment">// reqs.size</span>
            <span class="hljs-attr">height</span>: <span class="hljs-number">400</span>, <span class="hljs-comment">// reqs.size</span>
            <span class="hljs-attr">cleared</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">compiled</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">shown</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">&#x27;transparent&#x27;</span>, <span class="hljs-comment">// reqs.backgroundColor</span>
        });

        <span class="hljs-keyword">const</span> chartGroup = scrawl.library.group[cell.name];</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Use Color objects to determine the appropriate color for each charted view value. Again, we’ll kill these objects once we’ve finished with them</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">const</span> lowViewsFactory = scrawl.makeColor({
            <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${page}</span>-low-views`</span>,
            <span class="hljs-attr">minimumColor</span>: <span class="hljs-string">&#x27;azure&#x27;</span>, <span class="hljs-comment">// reqs.minimumColor</span>
            <span class="hljs-attr">maximumColor</span>: <span class="hljs-string">&#x27;blue&#x27;</span>, <span class="hljs-comment">// reqs.medialColor</span>
        });

        <span class="hljs-keyword">const</span> highViewsFactory = scrawl.makeColor({
            <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${page}</span>-high-views`</span>,
            <span class="hljs-attr">minimumColor</span>: <span class="hljs-string">&#x27;blue&#x27;</span>, <span class="hljs-comment">// reqs.medialColor</span>
            <span class="hljs-attr">maximumColor</span>: <span class="hljs-string">&#x27;red&#x27;</span>, <span class="hljs-comment">// reqs.maximumColor</span>
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>We start by retrieving the data from Wikipedia</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        getData(page)
        .then(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Some initial calculations</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">const</span> maxViews = data.max,
                minViews = data.min,
                medianViews = (maxViews - minViews) / <span class="hljs-number">2</span>;

            <span class="hljs-keyword">const</span> maxDataLen = <span class="hljs-built_in">Math</span>.max(data.mon.length, data.tue.length, data.wed.length, data.thu.length, data.fri.length, data.sat.length, data.sun.length);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Each day series is a spiral of Line entitys. We’ll cut down on the code by creating a factory to generate each day’s spiral</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">const</span> buildDayChart = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">dayData, offsetVal, dayName, missFirst</span>) </span>{

                <span class="hljs-keyword">let</span> currentWeek, currentYear, nextWeek, nextYear;

                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, iz = dayData.length - <span class="hljs-number">2</span>; i &lt; iz; i++) {

                    <span class="hljs-keyword">if</span> (missFirst) {

                        currentWeek = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">52</span>;
                        currentYear = <span class="hljs-built_in">Math</span>.floor((i + <span class="hljs-number">1</span>) / <span class="hljs-number">52</span>);

                        nextWeek = (i + <span class="hljs-number">2</span>) % <span class="hljs-number">52</span>;
                        nextYear = <span class="hljs-built_in">Math</span>.floor((i + <span class="hljs-number">2</span>) / <span class="hljs-number">52</span>);

                        nextWeek = nextWeek % <span class="hljs-number">52</span>;
                    }
                    <span class="hljs-keyword">else</span> {

                        currentWeek = i % <span class="hljs-number">52</span>;
                        currentYear = <span class="hljs-built_in">Math</span>.floor(i / <span class="hljs-number">52</span>);

                        nextWeek = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">52</span>;
                        nextYear = <span class="hljs-built_in">Math</span>.floor((i + <span class="hljs-number">1</span>) / <span class="hljs-number">52</span>);

                        nextWeek = nextWeek % <span class="hljs-number">52</span>;
                    }

                    <span class="hljs-keyword">let</span> views = dayData[i] - minViews,
                        dataColor;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Get the appropriate color for this data point’s value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (views &lt; medianViews) dataColor = lowViewsFactory.getRangeColor(views / medianViews);
                    <span class="hljs-keyword">else</span> dataColor = highViewsFactory.getRangeColor((views - medianViews) / medianViews);</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Each line represents a siongle data point, positioned in its appropriate place on the spiral by reference to the chart’s spoke lines</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    scrawl.makeLine({

                        <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${page}</span>-<span class="hljs-subst">${dayName}</span>-line-<span class="hljs-subst">${i}</span>`</span>,
                        <span class="hljs-attr">group</span>: chartGroup,

                        <span class="hljs-attr">lineWidth</span>: <span class="hljs-number">5</span>,
                        <span class="hljs-attr">strokeStyle</span>: dataColor,

                        <span class="hljs-attr">path</span>: <span class="hljs-string">`<span class="hljs-subst">${page}</span>-week-line-<span class="hljs-subst">${currentWeek}</span>`</span>,
                        <span class="hljs-attr">pathPosition</span>: (currentYear * <span class="hljs-number">0.33</span>) + offsetVal,
                        <span class="hljs-attr">lockTo</span>: <span class="hljs-string">&#x27;path&#x27;</span>,

                        <span class="hljs-attr">endPath</span>: <span class="hljs-string">`<span class="hljs-subst">${page}</span>-week-line-<span class="hljs-subst">${nextWeek}</span>`</span>,
                        <span class="hljs-attr">endPathPosition</span>: (nextYear * <span class="hljs-number">0.33</span>) + offsetVal,
                        <span class="hljs-attr">endLockTo</span>: <span class="hljs-string">&#x27;path&#x27;</span>,

                        <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;draw&#x27;</span>,
                    });
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>A year is made up of 52 weeks. We create 52 Line entity spokes around a central point to act as the frame for our chart. By setting an appropriate value for each Line’s handleY and roll attributes means that when it comes to building the day spirals we just need to pivot those Lines to our spokes - positioning made easy!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">52</span>; i++) {

                scrawl.makeLine({

                    <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${page}</span>-week-line-<span class="hljs-subst">${i}</span>`</span>,
                    <span class="hljs-attr">group</span>: chartGroup,

                    <span class="hljs-attr">start</span>: [<span class="hljs-number">200</span>, <span class="hljs-number">220</span>],
                    <span class="hljs-attr">end</span>: [<span class="hljs-number">200</span>, (<span class="hljs-number">220</span> - <span class="hljs-number">120</span>)],
                    <span class="hljs-attr">handle</span>: [<span class="hljs-number">0</span>, ((i / <span class="hljs-number">52</span>) * (<span class="hljs-number">120</span> / <span class="hljs-number">3</span>)) + <span class="hljs-number">30</span>],
                    <span class="hljs-attr">roll</span>: (i / <span class="hljs-number">52</span>) * <span class="hljs-number">360</span>,
                    <span class="hljs-attr">useAsPath</span>: <span class="hljs-literal">true</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>We don’t need to see the spokes in the finished chart; we just need them positioned correctly</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    method: <span class="hljs-string">&#x27;none&#x27;</span>,
                });
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Build each day’s spiral</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            buildDayChart(data.mon, <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;mon&#x27;</span>, (data.mon.length &lt; maxDataLen) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>);
            buildDayChart(data.tue, <span class="hljs-number">0.042</span>, <span class="hljs-string">&#x27;tue&#x27;</span>, (data.tue.length &lt; maxDataLen) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>);
            buildDayChart(data.wed, <span class="hljs-number">0.084</span>, <span class="hljs-string">&#x27;wed&#x27;</span>, (data.wed.length &lt; maxDataLen) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>);
            buildDayChart(data.thu, <span class="hljs-number">0.126</span>, <span class="hljs-string">&#x27;thu&#x27;</span>, (data.thu.length &lt; maxDataLen) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>);
            buildDayChart(data.fri, <span class="hljs-number">0.168</span>, <span class="hljs-string">&#x27;fri&#x27;</span>, (data.fri.length &lt; maxDataLen) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>);
            buildDayChart(data.sat, <span class="hljs-number">0.21</span>, <span class="hljs-string">&#x27;sat&#x27;</span>, (data.sat.length &lt; maxDataLen) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>);
            buildDayChart(data.sun, <span class="hljs-number">0.252</span>, <span class="hljs-string">&#x27;sun&#x27;</span>, (data.sun.length &lt; maxDataLen) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Now all the chart entitys have been created, we no longer need the Color objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            lowViewsFactory.kill();
            highViewsFactory.kill();</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>We will render this Cell manually, outside of the Display cycle animation loop</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> cell.clear();
        })
        .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Setup the cell to capture its image as it compiles …</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            scrawl.createImageFromCell(cell, <span class="hljs-literal">true</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>… and invoke the compile step</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            cell.compile()
        })
        .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>The compile step will (eventually) add a hidden &lt;img&gt; element to the DOM. This means we no longer require the Cell or its entitys. We need to kill the Cell’s Group before we kill the Cell itself</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            chartGroup.kill(<span class="hljs-literal">true</span>);
            cell.kill();</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Now we can create a single Picture entity for display in the canvasWrapper’s &lt;canvas&gt; element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">let</span> img = scrawl.makePicture({
                <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${page}</span>-chart-image`</span>,
                <span class="hljs-attr">group</span>: canvasWrapper.base.name,

                <span class="hljs-attr">asset</span>: <span class="hljs-string">`<span class="hljs-subst">${page}</span>-cell-image`</span>,

                <span class="hljs-attr">dimensions</span>: [<span class="hljs-string">&#x27;100%&#x27;</span>, <span class="hljs-string">&#x27;100%&#x27;</span>],
                <span class="hljs-attr">copyDimensions</span>: [<span class="hljs-string">&#x27;100%&#x27;</span>, <span class="hljs-string">&#x27;100%&#x27;</span>],
            });

            resolve(img);
        })
        .catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {

            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;buildChart error&#x27;</span>, e);
            resolve(<span class="hljs-literal">false</span>);
        });
    });

};</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Initiate the process on page load</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> currentPage = <span class="hljs-literal">false</span>;

buildChart(<span class="hljs-string">&#x27;Cat&#x27;</span>, canvas, {})
.then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> currentPage = res)
.catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {});</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <h4 id="scene-animation">Scene animation</h4>
<p>Function to display frames-per-second data, and other information relevant to the demo</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> report = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> testTicker = <span class="hljs-built_in">Date</span>.now(),
        testTime, testNow,
        testMessage = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">&#x27;#reportmessage&#x27;</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        testNow = <span class="hljs-built_in">Date</span>.now();
        testTime = testNow - testTicker;
        testTicker = testNow;

        testMessage.textContent = <span class="hljs-string">`Screen refresh: <span class="hljs-subst">${<span class="hljs-built_in">Math</span>.ceil(testTime)}</span>ms; fps: <span class="hljs-subst">${<span class="hljs-built_in">Math</span>.floor(<span class="hljs-number">1000</span> / testTime)}</span>
Entity count: <span class="hljs-subst">${scrawl.library.entitynames.length}</span>`</span>;
    };
}();</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Create the Display cycle animation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>scrawl.makeRender({

    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;demo-animation&#x27;</span>,
    <span class="hljs-attr">target</span>: canvas,
    <span class="hljs-attr">afterShow</span>: report,
});</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h4 id="user-interaction">User interaction</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>scrawl.addNativeListener(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-function">() =&gt;</span> {

    <span class="hljs-keyword">let</span> page = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">&#x27;#wikipedia-page&#x27;</span>).value;

    <span class="hljs-keyword">if</span> (page) {

        buildChart(page, canvas, {})
        .then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {

            <span class="hljs-keyword">if</span> (currentPage) currentPage.kill();
            currentPage = res;
        })
        .catch(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {

            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;main invoker error&#x27;</span>, e);
        });
    };
}, <span class="hljs-string">&#x27;#page-request&#x27;</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <h4 id="development-and-testing">Development and testing</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">console</span>.log(scrawl.library);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
